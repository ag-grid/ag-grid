{"version":3,"sources":["../../src/ts/widgets/popupService.ts"],"names":[],"mappings":"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","file":"popupService.js","sourcesContent":["import { Constants } from \"../constants\";\nimport { Autowired, Bean, PostConstruct } from \"../context/context\";\nimport { GridCore } from \"../gridCore\";\nimport { GridOptionsWrapper } from \"../gridOptionsWrapper\";\nimport { PostProcessPopupParams } from \"../entities/gridOptions\";\nimport { RowNode } from \"../entities/rowNode\";\nimport { Column } from \"../entities/column\";\nimport { Environment } from \"../environment\";\nimport { EventService } from \"../eventService\";\nimport { Events } from '../events';\nimport { _ } from \"../utils\";\n\ninterface AgPopup {\n    element: HTMLElement;\n    hideFunc: () => void;\n}\n\ninterface Rect {\n    top: number;\n    left: number;\n    right: number;\n    bottom: number;\n}\n\n@Bean('popupService')\nexport class PopupService {\n\n    // really this should be using eGridDiv, not sure why it's not working.\n    // maybe popups in the future should be parent to the body??\n    @Autowired('gridOptionsWrapper') private gridOptionsWrapper: GridOptionsWrapper;\n    @Autowired('environment') private environment: Environment;\n    @Autowired('eventService') private eventService: EventService;\n\n    private gridCore: GridCore;\n    private popupList: AgPopup[] = [];\n\n    @PostConstruct\n    private init(): void {\n        this.eventService.addEventListener(Events.EVENT_KEYBOARD_FOCUS, () => {\n            this.popupList.forEach(popup => {\n                _.addCssClass(popup.element, 'ag-keyboard-focus');\n            });\n        });\n\n        this.eventService.addEventListener(Events.EVENT_MOUSE_FOCUS, () => {\n            this.popupList.forEach(popup => {\n                _.removeCssClass(popup.element, 'ag-keyboard-focus');\n            });\n        });\n    }\n\n    public registerGridCore(gridCore: GridCore): void {\n        this.gridCore = gridCore;\n    }\n\n    public getPopupParent(): HTMLElement {\n        const ePopupParent = this.gridOptionsWrapper.getPopupParent();\n\n        if (ePopupParent) { return ePopupParent; }\n\n        return this.gridCore.getRootGui();\n    }\n\n    public positionPopupForMenu(params: { eventSource: HTMLElement, ePopup: HTMLElement }) {\n        const sourceRect = params.eventSource.getBoundingClientRect();\n        const parentRect = this.getParentRect();\n        const y = this.keepYWithinBounds(params, sourceRect.top - parentRect.top);\n\n        const minWidth = (params.ePopup.clientWidth > 0) ? params.ePopup.clientWidth : 200;\n        params.ePopup.style.minWidth = `${minWidth}px`;\n        const widthOfParent = parentRect.right - parentRect.left;\n        const maxX = widthOfParent - minWidth;\n\n        // the x position of the popup depends on RTL or LTR. for normal cases, LTR, we put the child popup\n        // to the right, unless it doesn't fit and we then put it to the left. for RTL it's the other way around,\n        // we try place it first to the left, and then if not to the right.\n        let x: number;\n        if (this.gridOptionsWrapper.isEnableRtl()) {\n            // for RTL, try left first\n            x = xLeftPosition();\n            if (x < 0) {\n                x = xRightPosition();\n            }\n            if (x > maxX) {\n                x = 0;\n            }\n        } else {\n            // for LTR, try right first\n            x = xRightPosition();\n            if (x > maxX) {\n                x = xLeftPosition();\n            }\n            if (x < 0) {\n                x = 0;\n            }\n        }\n\n        params.ePopup.style.left = `${x}px`;\n        params.ePopup.style.top = `${y}px`;\n\n        function xRightPosition(): number {\n            return sourceRect.right - parentRect.left - 2;\n        }\n\n        function xLeftPosition(): number {\n            return sourceRect.left - parentRect.left - minWidth;\n        }\n    }\n\n    public positionPopupUnderMouseEvent(params: {\n        rowNode?: RowNode,\n        column?: Column,\n        type: string,\n        mouseEvent: MouseEvent | Touch,\n        nudgeX?: number,\n        nudgeY?: number,\n        ePopup: HTMLElement,\n    }): void {\n\n        const {x, y} = this.calculatePointerAlign(params.mouseEvent);\n        const { ePopup, nudgeX, nudgeY} = params;\n\n        this.positionPopup({\n            ePopup: ePopup,\n            x,\n            y,\n            nudgeX,\n            nudgeY,\n            keepWithinBounds: true\n        });\n\n        this.callPostProcessPopup(params.ePopup, null, params.mouseEvent, params.type, params.column, params.rowNode);\n    }\n\n    private calculatePointerAlign(e: MouseEvent | Touch): { x: number, y: number } {\n        const parentRect = this.getParentRect();\n\n        return {\n            x: e.clientX - parentRect.left,\n            y: e.clientY - parentRect.top\n        };\n    }\n\n    public positionPopupUnderComponent(params: {\n        type: string,\n        eventSource: HTMLElement,\n        ePopup: HTMLElement,\n        column?: Column,\n        rowNode?: RowNode,\n        minWidth?: number,\n        minHeight?: number,\n        nudgeX?: number,\n        nudgeY?: number,\n        alignSide?: 'left' | 'right',\n        keepWithinBounds?: boolean\n    }) {\n        const sourceRect = params.eventSource.getBoundingClientRect();\n        const alignSide = params.alignSide || 'left';\n        const parentRect = this.getParentRect();\n\n        let x = sourceRect.left - parentRect.left;\n\n        if (alignSide === 'right') {\n            x -= (params.ePopup.offsetWidth - sourceRect.width);\n        }\n\n        this.positionPopup({\n            ePopup: params.ePopup,\n            minWidth: params.minWidth,\n            minHeight: params.minHeight,\n            nudgeX: params.nudgeX,\n            nudgeY: params.nudgeY,\n            x,\n            y: sourceRect.top - parentRect.top + sourceRect.height,\n            keepWithinBounds: params.keepWithinBounds\n        });\n\n        this.callPostProcessPopup(params.ePopup, params.eventSource, null, params.type, params.column, params.rowNode);\n    }\n\n    public positionPopupOverComponent(params: {\n        type: string,\n        eventSource: HTMLElement,\n        ePopup: HTMLElement | null,\n        column: Column,\n        rowNode: RowNode,\n        minWidth?: number,\n        nudgeX?: number,\n        nudgeY?: number,\n        keepWithinBounds?: boolean\n    }) {\n        const sourceRect = params.eventSource.getBoundingClientRect();\n        const parentRect = this.getParentRect();\n\n        this.positionPopup({\n            ePopup: params.ePopup,\n            minWidth: params.minWidth,\n            nudgeX: params.nudgeX,\n            nudgeY: params.nudgeY,\n            x: sourceRect.left - parentRect.left,\n            y: sourceRect.top - parentRect.top,\n            keepWithinBounds: params.keepWithinBounds\n        });\n\n        this.callPostProcessPopup(params.ePopup, params.eventSource, null, params.type, params.column, params.rowNode);\n    }\n\n    private callPostProcessPopup(ePopup: HTMLElement | null, eventSource: HTMLElement | null, mouseEvent: MouseEvent | Touch | null, type: string, column: Column | null | undefined, rowNode: RowNode | undefined): void {\n        const callback = this.gridOptionsWrapper.getPostProcessPopupFunc();\n        if (callback) {\n            const params: PostProcessPopupParams = {\n                column: column,\n                rowNode: rowNode,\n                ePopup: ePopup,\n                type: type,\n                eventSource: eventSource,\n                mouseEvent: mouseEvent\n            };\n            callback(params);\n        }\n    }\n\n    public positionPopup(params: {\n        ePopup: HTMLElement | null,\n        minWidth?: number,\n        minHeight?: number,\n        nudgeX?: number,\n        nudgeY?: number,\n        x: number,\n        y: number,\n        keepWithinBounds?: boolean\n    }): void {\n\n        let x = params.x;\n        let y = params.y;\n\n        if (params.nudgeX) {\n            x += params.nudgeX;\n        }\n        if (params.nudgeY) {\n            y += params.nudgeY;\n        }\n\n        // if popup is overflowing to the bottom, move it up\n        if (params.keepWithinBounds) {\n            x = this.keepXWithinBounds(params, x);\n            y = this.keepYWithinBounds(params, y);\n        }\n\n        params.ePopup!.style.left = `${x}px`;\n        params.ePopup!.style.top = `${y}px`;\n    }\n\n    private getParentRect(): Rect {\n        // subtract the popup parent borders, because popupParent.getBoundingClientRect\n        // returns the rect outside the borders, but the 0,0 coordinate for absolute\n        // positioning is inside the border, leading the popup to be off by the width\n        // of the border\n        let popupParent = this.getPopupParent();\n        const eDocument = this.gridOptionsWrapper.getDocument();\n        if (popupParent === eDocument.body) {\n            popupParent = eDocument.documentElement;\n        }\n        const style = getComputedStyle(popupParent);\n        const bounds = popupParent.getBoundingClientRect();\n        return {\n            top: bounds.top + parseFloat(style.borderTopWidth) || 0,\n            left: bounds.left + parseFloat(style.borderLeftWidth) || 0,\n            right: bounds.right + parseFloat(style.borderRightWidth) || 0,\n            bottom: bounds.bottom + parseFloat(style.borderBottomWidth) || 0,\n        };\n    }\n\n    private keepYWithinBounds(params: { ePopup: HTMLElement | null, minHeight?: number }, y: number): number {\n        const eDocument = this.gridOptionsWrapper.getDocument();\n        const docElement = eDocument.documentElement;\n        const popupParent = this.getPopupParent();\n        const parentRect = popupParent.getBoundingClientRect();\n        const documentRect = eDocument.documentElement!.getBoundingClientRect();\n        const isBody = popupParent === eDocument.body;\n        const defaultPadding = 3;\n\n        let minHeight = Math.min(200, parentRect.height);\n        let diff = 0;\n\n        if (params.minHeight && params.minHeight < minHeight) {\n            minHeight = params.minHeight;\n        } else if (params.ePopup!.offsetHeight > 0) {\n            minHeight = params.ePopup!.clientHeight;\n            diff = _.getAbsoluteHeight(params.ePopup) - minHeight;\n        }\n\n        let heightOfParent = isBody ? (_.getAbsoluteHeight(docElement) + docElement!.scrollTop) : parentRect.height;\n        if (isBody) {\n            heightOfParent -= Math.abs(documentRect.top - parentRect.top);\n        }\n        const maxY = heightOfParent - minHeight - diff - defaultPadding;\n\n        return Math.min(Math.max(y, 0), Math.abs(maxY));\n    }\n\n    private keepXWithinBounds(params: { minWidth?: number, ePopup: HTMLElement }, x: number): number {\n        const eDocument = this.gridOptionsWrapper.getDocument();\n        const docElement = eDocument.documentElement;\n        const popupParent = this.getPopupParent();\n        const parentRect = popupParent.getBoundingClientRect();\n        const documentRect = eDocument.documentElement!.getBoundingClientRect();\n        const isBody = popupParent === eDocument.body;\n        const defaultPadding = 3;\n        const ePopup = params.ePopup;\n\n        let minWidth = Math.min(200, parentRect.width);\n        let diff = 0;\n\n        if (params.minWidth && params.minWidth < minWidth) {\n            minWidth = params.minWidth;\n        } else if (ePopup.offsetWidth > 0) {\n            minWidth = ePopup.offsetWidth;\n            ePopup.style.minWidth = `${minWidth}px`;\n            diff = _.getAbsoluteWidth(ePopup) - minWidth;\n        }\n\n        let widthOfParent = isBody ? (_.getAbsoluteWidth(docElement!) + docElement!.scrollLeft) : parentRect.width;\n\n        if (isBody) {\n            widthOfParent -= Math.abs(documentRect.left - parentRect.left);\n        }\n\n        const maxX = widthOfParent - minWidth - diff - defaultPadding;\n\n        return Math.min(Math.max(x, 0), Math.abs(maxX));\n    }\n\n    // adds an element to a div, but also listens to background checking for clicks,\n    // so that when the background is clicked, the child is removed again, giving\n    // a model look to popups.\n    public addAsModalPopup(eChild: any, closeOnEsc: boolean, closedCallback?: () => void, click?: MouseEvent | Touch | null): (event?: any) => void {\n        return this.addPopup(true, eChild, closeOnEsc, closedCallback, click);\n    }\n\n    public addPopup(\n        modal: boolean,\n        eChild: any,\n        closeOnEsc: boolean,\n        closedCallback?: () => void,\n        click?: MouseEvent | Touch | null,\n        alwaysOnTop?: boolean\n    ): (event?: any) => void {\n        const eDocument = this.gridOptionsWrapper.getDocument();\n\n        if (!eDocument) {\n            console.warn('ag-grid: could not find the document, document is empty');\n            return () => {};\n        }\n\n        const pos = _.findIndex(this.popupList, popup => popup.element === eChild);\n\n        if (pos !== -1) {\n            const popup = this.popupList[pos];\n            return popup.hideFunc;\n        }\n\n        const ePopupParent = this.getPopupParent();\n\n        // for angular specifically, but shouldn't cause an issue with js or other fw's\n        // https://github.com/angular/angular/issues/8563\n        ePopupParent.appendChild(eChild);\n\n        eChild.style.top = '0px';\n        eChild.style.left = '0px';\n\n        // add env CSS class to child, in case user provided a popup parent, which means\n        // theme class may be missing\n        const eWrapper = document.createElement('div');\n        const { theme } = this.environment.getTheme();\n\n        if (theme) {\n            _.addCssClass(eWrapper, theme);\n        }\n\n        _.addCssClass(eWrapper, 'ag-popup');\n        _.addCssClass(eChild, this.gridOptionsWrapper.isEnableRtl() ? 'ag-rtl' : 'ag-ltr');\n        _.addCssClass(eChild, 'ag-popup-child');\n\n        eWrapper.appendChild(eChild);\n\n        ePopupParent.appendChild(eWrapper);\n\n        if (alwaysOnTop) {\n            this.setAlwaysOnTop(eWrapper, true);\n        } else {\n            this.bringPopupToFront(eWrapper);\n        }\n\n        let popupHidden = false;\n\n        const hidePopupOnKeyboardEvent = (event: KeyboardEvent) => {\n            const key = event.which || event.keyCode;\n            if (key === Constants.KEY_ESCAPE && eWrapper.contains(document.activeElement)) {\n                hidePopup(null);\n            }\n        };\n\n        const hidePopupOnMouseEvent = (event: MouseEvent) => {\n            hidePopup(event);\n        };\n\n        const hidePopupOnTouchEvent = (event: TouchEvent) => {\n            hidePopup(null, event);\n        };\n\n        const hidePopup = (mouseEvent?: MouseEvent | null, touchEvent?: TouchEvent) => {\n            if (\n                // we don't hide popup if the event was on the child, or any\n                // children of this child\n                this.isEventFromCurrentPopup(mouseEvent, touchEvent, eChild) ||\n                // if the event to close is actually the open event, then ignore it\n                this.isEventSameChainAsOriginalEvent(click, mouseEvent, touchEvent) ||\n                // this method should only be called once. the client can have different\n                // paths, each one wanting to close, so this method may be called multiple times.\n                popupHidden\n            ) {\n                return;\n            }\n\n            popupHidden = true;\n\n            ePopupParent.removeChild(eWrapper);\n\n            eDocument.removeEventListener('keydown', hidePopupOnKeyboardEvent);\n            eDocument.removeEventListener('mousedown', hidePopupOnMouseEvent);\n            eDocument.removeEventListener('touchstart', hidePopupOnTouchEvent);\n            eDocument.removeEventListener('contextmenu', hidePopupOnMouseEvent);\n            this.eventService.removeEventListener(Events.EVENT_DRAG_STARTED, hidePopupOnMouseEvent);\n\n            if (closedCallback) {\n                closedCallback();\n            }\n\n            this.popupList = this.popupList.filter(popup => popup.element !== eChild);\n        };\n\n        // if we add these listeners now, then the current mouse\n        // click will be included, which we don't want\n        window.setTimeout(() => {\n            if (closeOnEsc) {\n                eDocument.addEventListener('keydown', hidePopupOnKeyboardEvent);\n            }\n            if (modal) {\n                eDocument.addEventListener('mousedown', hidePopupOnMouseEvent);\n                this.eventService.addEventListener(Events.EVENT_DRAG_STARTED, hidePopupOnMouseEvent);\n                eDocument.addEventListener('touchstart', hidePopupOnTouchEvent);\n                eDocument.addEventListener('contextmenu', hidePopupOnMouseEvent);\n            }\n        }, 0);\n\n        this.popupList.push({\n            element: eChild,\n            hideFunc: hidePopup\n        });\n\n        return hidePopup;\n    }\n\n    private isEventFromCurrentPopup(mouseEvent: MouseEvent | null | undefined, touchEvent: TouchEvent | undefined, eChild: HTMLElement): boolean {\n        const event = mouseEvent ? mouseEvent : touchEvent;\n\n        if (!event) {\n            return false;\n        }\n\n        const indexOfThisChild = _.findIndex(this.popupList, popup => popup.element === eChild);\n\n        if (indexOfThisChild === -1) {\n            return false;\n        }\n\n        for (let i = indexOfThisChild; i < this.popupList.length; i++) {\n            const popup = this.popupList[i];\n\n            if (_.isElementInEventPath(popup.element, event)) {\n                return true;\n            }\n        }\n\n        // if the user did not write their own Custom Element to be rendered as popup\n        // and this component has additional popup element, they should have the\n        // `ag-custom-component-popup` class to be detected as part of the Custom Component\n        let el = event.target as HTMLElement;\n        while (el && el != document.body) {\n            if (el.classList.contains('ag-custom-component-popup') || el.parentElement === null) { return true; }\n            el = el.parentElement;\n        }\n    }\n\n    // in some browsers, the context menu event can be fired before the click event, which means\n    // the context menu event could open the popup, but then the click event closes it straight away.\n    private isEventSameChainAsOriginalEvent(originalClick: MouseEvent | Touch | undefined | null, mouseEvent: MouseEvent | undefined | null, touchEvent: TouchEvent | undefined): boolean {\n        // we check the coordinates of the event, to see if it's the same event. there is a 1 / 1000 chance that\n        // the event is a different event, however that is an edge case that is not very relevant (the user clicking\n        // twice on the same location isn't a normal path).\n\n        // event could be mouse event or touch event.\n        let mouseEventOrTouch: MouseEvent | Touch | null = null;\n        if (mouseEvent) {\n            // mouse event can be used direction, it has coordinates\n            mouseEventOrTouch = mouseEvent;\n        } else if (touchEvent) {\n            // touch event doesn't have coordinates, need it's touch object\n            mouseEventOrTouch = touchEvent.touches[0];\n        }\n        if (mouseEventOrTouch && originalClick) {\n            // for x, allow 4px margin, to cover iPads, where touch (which opens menu) is followed\n            // by browser click (when you life finger up, touch is interrupted as click in browser)\n            const screenX = mouseEvent ? mouseEvent.screenX : 0;\n            const screenY = mouseEvent ? mouseEvent.screenY : 0;\n\n            const xMatch = Math.abs(originalClick.screenX - screenX) < 5;\n            const yMatch = Math.abs(originalClick.screenY - screenY) < 5;\n\n            if (xMatch && yMatch) {\n                return true;\n            }\n        }\n\n        return false;\n    }\n\n    private getWrapper(ePopup: HTMLElement): HTMLElement | null {\n        while (!_.containsClass(ePopup, 'ag-popup') && ePopup.parentElement) {\n            ePopup = ePopup.parentElement;\n        }\n\n        return _.containsClass(ePopup, 'ag-popup') ? ePopup : null;\n    }\n\n    public setAlwaysOnTop(ePopup: HTMLElement, alwaysOnTop?: boolean): void {\n        const eWrapper = this.getWrapper(ePopup);\n\n        if (!eWrapper) { return; }\n\n        _.addOrRemoveCssClass(eWrapper, 'ag-always-on-top', !!alwaysOnTop);\n\n        if (alwaysOnTop) {\n            this.bringPopupToFront(eWrapper);\n        }\n    }\n\n    public bringPopupToFront(ePopup: HTMLElement) {\n        const parent = this.getPopupParent();\n        const popupList = Array.prototype.slice.call(parent.querySelectorAll('.ag-popup'));\n        const popupLen = popupList.length;\n        const alwaysOnTopList = Array.prototype.slice.call(parent.querySelectorAll('.ag-popup.ag-always-on-top'));\n        const onTopLength = alwaysOnTopList.length;\n        const eWrapper = this.getWrapper(ePopup);\n\n        if (!eWrapper || popupLen <= 1 || !parent.contains(ePopup)) { return; }\n\n        const pos = popupList.indexOf(eWrapper);\n\n        if (onTopLength) {\n            const isPopupAlwaysOnTop = _.containsClass(eWrapper, 'ag-always-on-top');\n            if (isPopupAlwaysOnTop) {\n                if (pos !== popupLen - 1) {\n                    (_.last(alwaysOnTopList) as HTMLElement).insertAdjacentElement('afterend', eWrapper);\n                }\n            } else if (pos !== popupLen - onTopLength - 1) {\n                alwaysOnTopList[0].insertAdjacentElement('beforebegin', eWrapper);\n            }\n        } else if (pos !== popupLen - 1) {\n            (_.last(popupList) as HTMLElement).insertAdjacentElement('afterend', eWrapper);\n        }\n\n        const params = {\n            type: 'popupToFront',\n            api: this.gridOptionsWrapper.getApi(),\n            columnApi: this.gridOptionsWrapper.getColumnApi(),\n            eWrapper\n        };\n\n        this.eventService.dispatchEvent(params);\n    }\n}\n"]}
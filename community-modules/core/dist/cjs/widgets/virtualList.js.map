{"version":3,"sources":["../../src/ts/widgets/virtualList.ts"],"names":[],"mappings":"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","file":"virtualList.js","sourcesContent":["import { Component } from './component';\nimport { Autowired } from '../context/context';\nimport { RefSelector } from './componentAnnotations';\nimport { ManagedFocusComponent } from './managedFocusComponent';\nimport { addCssClass, containsClass } from '../utils/dom';\nimport { getAriaPosInSet, setAriaSetSize, setAriaPosInSet, setAriaSelected, setAriaChecked } from '../utils/aria';\nimport { KeyCode } from '../constants/keyCode';\nimport { ResizeObserverService } from \"../misc/resizeObserverService\";\nimport { waitUntil } from '../utils/function';\n\nexport interface VirtualListModel {\n    getRowCount(): number;\n    getRow(index: number): any;\n    isRowSelected?(index: number): boolean | undefined;\n}\n\nexport class VirtualList extends ManagedFocusComponent {\n    private model: VirtualListModel;\n    private renderedRows = new Map<number, { rowComponent: Component, eDiv: HTMLDivElement; }>();\n    private componentCreator: (value: any, listItemElement: HTMLElement) => Component;\n    private rowHeight = 20;\n    private lastFocusedRowIndex: number | null;\n    private isDestroyed = false;\n\n    @Autowired('resizeObserverService') private readonly resizeObserverService: ResizeObserverService;\n    @RefSelector('eContainer') private readonly eContainer: HTMLElement;\n\n    constructor(private readonly cssIdentifier = 'default', private readonly ariaRole = 'listbox') {\n        super(VirtualList.getTemplate(cssIdentifier), true);\n    }\n\n    protected postConstruct(): void {\n        this.addScrollListener();\n        this.rowHeight = this.getItemHeight();\n        this.addResizeObserver();\n\n        super.postConstruct();\n    }\n\n    private addResizeObserver(): void {\n        const listener = this.drawVirtualRows.bind(this);\n        const destroyObserver = this.resizeObserverService.observeResize(this.getGui(), listener);\n        this.addDestroyFunc(destroyObserver);\n    }\n\n    protected focusInnerElement(fromBottom: boolean): void {\n        this.focusRow(fromBottom ? this.model.getRowCount() - 1 : 0);\n    }\n\n    protected onFocusIn(e: FocusEvent): void {\n        super.onFocusIn(e);\n        const target = e.target as HTMLElement;\n\n        if (containsClass(target, 'ag-virtual-list-item')) {\n            this.lastFocusedRowIndex = getAriaPosInSet(target) - 1;\n        }\n    }\n\n    protected onFocusOut(e: FocusEvent) {\n        super.onFocusOut(e);\n\n        if (!this.getFocusableElement().contains(e.relatedTarget as HTMLElement)) {\n            this.lastFocusedRowIndex = null;\n        }\n    }\n\n    protected handleKeyDown(e: KeyboardEvent): void {\n        switch (e.keyCode) {\n            case KeyCode.UP:\n            case KeyCode.DOWN:\n                if (this.navigate(e.keyCode === KeyCode.UP)) {\n                    e.preventDefault();\n                }\n\n                break;\n        }\n    }\n\n    protected onTabKeyDown(e: KeyboardEvent): void {\n        if (this.navigate(e.shiftKey)) {\n            e.preventDefault();\n        } else {\n            // focus on the first or last focusable element to ensure that any other handlers start from there\n            this.focusController.focusInto(this.getGui(), !e.shiftKey);\n        }\n    }\n\n    private navigate(up: boolean): boolean {\n        if (this.lastFocusedRowIndex == null) { return false; }\n\n        const nextRow = this.lastFocusedRowIndex + (up ? -1 : 1);\n\n        if (nextRow < 0 || nextRow >= this.model.getRowCount()) { return false; }\n\n        this.focusRow(nextRow);\n\n        return true;\n    }\n\n    public getLastFocusedRow(): number | null {\n        return this.lastFocusedRowIndex;\n    }\n\n    public focusRow(rowNumber: number): void {\n        this.ensureIndexVisible(rowNumber);\n\n        window.setTimeout(() => {\n            const renderedRow = this.renderedRows.get(rowNumber);\n\n            if (renderedRow) {\n                renderedRow.eDiv.focus();\n            }\n        }, 10);\n    }\n\n    public getComponentAt(rowIndex: number): Component | undefined {\n        const comp = this.renderedRows.get(rowIndex);\n\n        return comp && comp.rowComponent;\n    }\n\n    private static getTemplate(cssIdentifier: string) {\n        return /* html */`\n            <div class=\"ag-virtual-list-viewport ag-${cssIdentifier}-virtual-list-viewport\" role=\"listbox\">\n                <div class=\"ag-virtual-list-container ag-${cssIdentifier}-virtual-list-container\" ref=\"eContainer\"></div>\n            </div>`;\n    }\n\n    private getItemHeight(): number {\n        return this.gridOptionsWrapper.getListItemHeight();\n    }\n\n    public ensureIndexVisible(index: number): void {\n        const lastRow = this.model.getRowCount();\n\n        if (typeof index !== 'number' || index < 0 || index >= lastRow) {\n            console.warn('invalid row index for ensureIndexVisible: ' + index);\n            return;\n        }\n\n        const rowTopPixel = index * this.rowHeight;\n        const rowBottomPixel = rowTopPixel + this.rowHeight;\n        const eGui = this.getGui();\n\n        const viewportTopPixel = eGui.scrollTop;\n        const viewportHeight = eGui.offsetHeight;\n        const viewportBottomPixel = viewportTopPixel + viewportHeight;\n\n        const viewportScrolledPastRow = viewportTopPixel > rowTopPixel;\n        const viewportScrolledBeforeRow = viewportBottomPixel < rowBottomPixel;\n\n        if (viewportScrolledPastRow) {\n            // if row is before, scroll up with row at top\n            eGui.scrollTop = rowTopPixel;\n        } else if (viewportScrolledBeforeRow) {\n            // if row is below, scroll down with row at bottom\n            const newScrollPosition = rowBottomPixel - viewportHeight;\n            eGui.scrollTop = newScrollPosition;\n        }\n    }\n\n    public setComponentCreator(componentCreator: (value: any, listItemElement: HTMLElement) => Component): void {\n        this.componentCreator = componentCreator;\n    }\n\n    public getRowHeight(): number {\n        return this.rowHeight;\n    }\n\n    public getScrollTop(): number {\n        return this.getGui().scrollTop;\n    }\n\n    public setRowHeight(rowHeight: number): void {\n        this.rowHeight = rowHeight;\n        this.refresh();\n    }\n\n    public refresh(): void {\n        if (this.model == null || this.isDestroyed) { return; }\n\n        const rowCount = this.model.getRowCount();\n        this.eContainer.style.height = `${rowCount * this.rowHeight}px`;\n\n        // ensure height is applied before attempting to redraw rows\n        waitUntil(() => this.eContainer.clientHeight >= rowCount * this.rowHeight,\n            () => {\n                if (this.isDestroyed) { return; }\n\n                this.clearVirtualRows();\n                this.drawVirtualRows();\n            }\n        );\n    }\n\n    private clearVirtualRows() {\n        this.renderedRows.forEach((_, rowIndex) => this.removeRow(rowIndex));\n    }\n\n    private drawVirtualRows() {\n        const gui = this.getGui();\n        const topPixel = gui.scrollTop;\n        const bottomPixel = topPixel + gui.offsetHeight;\n        const firstRow = Math.floor(topPixel / this.rowHeight);\n        const lastRow = Math.floor(bottomPixel / this.rowHeight);\n\n        this.ensureRowsRendered(firstRow, lastRow);\n    }\n\n    private ensureRowsRendered(start: number, finish: number) {\n        // remove any rows that are no longer required\n        this.renderedRows.forEach((_, rowIndex) => {\n            if ((rowIndex < start || rowIndex > finish) && rowIndex !== this.lastFocusedRowIndex) {\n                this.removeRow(rowIndex);\n            }\n        });\n\n        // insert any required new rows\n        for (let rowIndex = start; rowIndex <= finish; rowIndex++) {\n            if (this.renderedRows.has(rowIndex)) { continue; }\n\n            // check this row actually exists (in case overflow buffer window exceeds real data)\n            if (rowIndex < this.model.getRowCount()) {\n                this.insertRow(rowIndex);\n            }\n        }\n    }\n\n    private insertRow(rowIndex: number): void {\n        const value = this.model.getRow(rowIndex);\n        const eDiv = document.createElement('div');\n\n        addCssClass(eDiv, 'ag-virtual-list-item');\n        addCssClass(eDiv, `ag-${this.cssIdentifier}-virtual-list-item`);\n\n        eDiv.setAttribute('role', this.ariaRole === 'tree' ? 'treeitem' : 'option');\n        setAriaSetSize(eDiv, this.model.getRowCount());\n        setAriaPosInSet(eDiv, rowIndex + 1);\n        eDiv.setAttribute('tabindex', '-1');\n\n        if (typeof this.model.isRowSelected === 'function') {\n            const isSelected = this.model.isRowSelected(rowIndex);\n\n            setAriaSelected(eDiv, !!isSelected);\n            setAriaChecked(eDiv, isSelected);\n        }\n\n        eDiv.style.height = `${this.rowHeight}px`;\n        eDiv.style.top = `${this.rowHeight * rowIndex}px`;\n\n        const rowComponent = this.componentCreator(value, eDiv);\n\n        rowComponent.addGuiEventListener('focusin', () => this.lastFocusedRowIndex = rowIndex);\n\n        eDiv.appendChild(rowComponent.getGui());\n\n        // keep the DOM order consistent with the order of the rows\n        if (this.renderedRows.has(rowIndex - 1)) {\n            this.renderedRows.get(rowIndex - 1)!.eDiv.insertAdjacentElement('afterend', eDiv);\n        } else if (this.renderedRows.has(rowIndex + 1)) {\n            this.renderedRows.get(rowIndex + 1)!.eDiv.insertAdjacentElement('beforebegin', eDiv);\n        } else {\n            this.eContainer.appendChild(eDiv);\n        }\n\n        this.renderedRows.set(rowIndex, { rowComponent, eDiv });\n    }\n\n    private removeRow(rowIndex: number) {\n        const component = this.renderedRows.get(rowIndex)!;\n\n        this.eContainer.removeChild(component.eDiv);\n        this.destroyBean(component.rowComponent);\n        this.renderedRows.delete(rowIndex);\n    }\n\n    private addScrollListener() {\n        this.addGuiEventListener('scroll', () => this.drawVirtualRows());\n    }\n\n    public setModel(model: VirtualListModel): void {\n        this.model = model;\n    }\n\n    public destroy(): void {\n        if (this.isDestroyed) { return; }\n\n        this.clearVirtualRows();\n        this.isDestroyed = true;\n\n        super.destroy();\n    }\n}\n"]}
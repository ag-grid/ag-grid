{"version":3,"sources":["../../src/ts/pinnedRowModel/pinnedRowModel.ts"],"names":[],"mappings":"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","file":"pinnedRowModel.js","sourcesContent":["import { RowNode } from \"../entities/rowNode\";\nimport { Autowired, Bean, PostConstruct } from \"../context/context\";\nimport { Events, PinnedRowDataChangedEvent } from \"../events\";\nimport { Constants } from \"../constants/constants\";\nimport { ColumnApi } from \"../columnController/columnApi\";\nimport { GridApi } from \"../gridApi\";\nimport { BeanStub } from \"../context/beanStub\";\nimport { missingOrEmpty } from \"../utils/generic\";\nimport { last } from \"../utils/array\";\n\n@Bean('pinnedRowModel')\nexport class PinnedRowModel extends BeanStub {\n\n    @Autowired('columnApi') private columnApi: ColumnApi;\n    @Autowired('gridApi') private gridApi: GridApi;\n\n    private pinnedTopRows: RowNode[];\n    private pinnedBottomRows: RowNode[];\n\n    @PostConstruct\n    public init(): void {\n        this.setPinnedTopRowData(this.gridOptionsWrapper.getPinnedTopRowData());\n        this.setPinnedBottomRowData(this.gridOptionsWrapper.getPinnedBottomRowData());\n    }\n\n    public isEmpty(floating: string): boolean {\n        const rows = floating === Constants.PINNED_TOP ? this.pinnedTopRows : this.pinnedBottomRows;\n        return missingOrEmpty(rows);\n    }\n\n    public isRowsToRender(floating: string): boolean {\n        return !this.isEmpty(floating);\n    }\n\n    public getRowAtPixel(pixel: number, floating: string): number {\n        const rows = floating === Constants.PINNED_TOP ? this.pinnedTopRows : this.pinnedBottomRows;\n        if (missingOrEmpty(rows)) {\n            return 0; // this should never happen, just in case, 0 is graceful failure\n        }\n        for (let i = 0; i < rows.length; i++) {\n            const rowNode = rows[i];\n            const rowTopPixel = rowNode.rowTop! + rowNode.rowHeight! - 1;\n            // only need to range check against the top pixel, as we are going through the list\n            // in order, first row to hit the pixel wins\n            if (rowTopPixel >= pixel) {\n                return i;\n            }\n        }\n        return rows.length - 1;\n    }\n\n    public setPinnedTopRowData(rowData: any[] | undefined): void {\n        this.pinnedTopRows = this.createNodesFromData(rowData, true);\n        const event: PinnedRowDataChangedEvent = {\n            type: Events.EVENT_PINNED_ROW_DATA_CHANGED,\n            api: this.gridApi,\n            columnApi: this.columnApi\n        };\n        this.eventService.dispatchEvent(event);\n    }\n\n    public setPinnedBottomRowData(rowData: any[] | undefined): void {\n        this.pinnedBottomRows = this.createNodesFromData(rowData, false);\n        const event: PinnedRowDataChangedEvent = {\n            type: Events.EVENT_PINNED_ROW_DATA_CHANGED,\n            api: this.gridApi,\n            columnApi: this.columnApi\n        };\n        this.eventService.dispatchEvent(event);\n    }\n\n    private createNodesFromData(allData: any[] | undefined, isTop: boolean): RowNode[] {\n        const rowNodes: RowNode[] = [];\n        if (allData) {\n            let nextRowTop = 0;\n            allData.forEach((dataItem: any, index: number) => {\n                const rowNode = new RowNode();\n                this.context.createBean(rowNode);\n                rowNode.data = dataItem;\n\n                const idPrefix = isTop ? RowNode.ID_PREFIX_TOP_PINNED : RowNode.ID_PREFIX_BOTTOM_PINNED;\n                rowNode.id = idPrefix + index;\n\n                rowNode.rowPinned = isTop ? Constants.PINNED_TOP : Constants.PINNED_BOTTOM;\n                rowNode.setRowTop(nextRowTop);\n                rowNode.setRowHeight(this.gridOptionsWrapper.getRowHeightForNode(rowNode).height);\n                rowNode.setRowIndex(index);\n                nextRowTop += rowNode.rowHeight!;\n                rowNodes.push(rowNode);\n            });\n        }\n        return rowNodes;\n    }\n\n    public getPinnedTopRowData(): RowNode[] {\n        return this.pinnedTopRows;\n    }\n\n    public getPinnedBottomRowData(): RowNode[] {\n        return this.pinnedBottomRows;\n    }\n\n    public getPinnedTopTotalHeight(): number {\n        return this.getTotalHeight(this.pinnedTopRows);\n    }\n\n    public getPinnedTopRowCount(): number {\n        return this.pinnedTopRows ? this.pinnedTopRows.length : 0;\n    }\n\n    public getPinnedBottomRowCount(): number {\n        return this.pinnedBottomRows ? this.pinnedBottomRows.length : 0;\n    }\n\n    public getPinnedTopRow(index: number): RowNode {\n        return this.pinnedTopRows[index];\n    }\n\n    public getPinnedBottomRow(index: number): RowNode {\n        return this.pinnedBottomRows[index];\n    }\n\n    public forEachPinnedTopRow(callback: (rowNode: RowNode, index: number) => void): void {\n        if (missingOrEmpty(this.pinnedTopRows)) {\n            return;\n        }\n        this.pinnedTopRows.forEach(callback);\n    }\n\n    public forEachPinnedBottomRow(callback: (rowNode: RowNode, index: number) => void): void {\n        if (missingOrEmpty(this.pinnedBottomRows)) {\n            return;\n        }\n        this.pinnedBottomRows.forEach(callback);\n    }\n\n    public getPinnedBottomTotalHeight(): number {\n        return this.getTotalHeight(this.pinnedBottomRows);\n    }\n\n    private getTotalHeight(rowNodes: RowNode[]): number {\n        if (!rowNodes || rowNodes.length === 0) { return 0; }\n\n        const lastNode = last(rowNodes);\n        return lastNode.rowTop! + lastNode.rowHeight!;\n    }\n\n}\n"]}
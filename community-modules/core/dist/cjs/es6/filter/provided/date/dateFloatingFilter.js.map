{"version":3,"sources":["../../../src/ts/filter/provided/date/dateFloatingFilter.ts"],"names":[],"mappings":"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","file":"dateFloatingFilter.js","sourcesContent":["import { DateFilter, DateFilterModel } from './dateFilter';\nimport { Autowired } from '../../../context/context';\nimport { UserComponentFactory } from '../../../components/framework/userComponentFactory';\nimport { IDateParams } from '../../../rendering/dateComponent';\nimport { IFloatingFilterParams } from '../../floating/floatingFilter';\nimport { DateCompWrapper } from './dateCompWrapper';\nimport { RefSelector } from '../../../widgets/componentAnnotations';\nimport { SimpleFilter, ISimpleFilterModel } from '../simpleFilter';\nimport { SimpleFloatingFilter } from '../../floating/provided/simpleFloatingFilter';\nimport { FilterChangedEvent } from '../../../events';\nimport { ProvidedFilter } from '../providedFilter';\nimport { AgInputTextField } from '../../../widgets/agInputTextField';\nimport { setDisplayed } from '../../../utils/dom';\nimport { parseDateTimeFromString, serialiseDate } from '../../../utils/date';\nimport { debounce } from '../../../utils/function';\nimport { IFilterOptionDef } from '../../../interfaces/iFilter';\n\nexport class DateFloatingFilter extends SimpleFloatingFilter {\n    @Autowired('userComponentFactory') private readonly userComponentFactory: UserComponentFactory;\n\n    @RefSelector('eReadOnlyText') private readonly eReadOnlyText: AgInputTextField;\n    @RefSelector('eDateWrapper') private readonly eDateWrapper: HTMLInputElement;\n\n    private dateComp: DateCompWrapper;\n    private params: IFloatingFilterParams;\n\n    constructor() {\n        super(/* html */`\n            <div class=\"ag-floating-filter-input\" role=\"presentation\">\n                <ag-input-text-field ref=\"eReadOnlyText\"></ag-input-text-field>\n                <div ref=\"eDateWrapper\" style=\"display: flex;\"></div>\n            </div>`);\n    }\n\n    protected getDefaultFilterOptions(): string[] {\n        return DateFilter.DEFAULT_FILTER_OPTIONS;\n    }\n\n    protected conditionToString(condition: DateFilterModel, options?: IFilterOptionDef): string {\n        const { type } = condition;\n        const { numberOfInputs } = options || {};\n        const isRange = type == SimpleFilter.IN_RANGE || numberOfInputs === 2;\n\n        const dateFrom = parseDateTimeFromString(condition.dateFrom);\n        const dateTo = parseDateTimeFromString(condition.dateTo);\n\n        if (isRange) {\n            return `${serialiseDate(dateFrom, false)}-${serialiseDate(dateTo, false)}`;\n        }\n\n        if (dateFrom != null) {\n            return `${serialiseDate(dateFrom, false)}`;\n        }\n\n        // cater for when the type doesn't need a value\n        return `${type}`;\n    }\n\n    public init(params: IFloatingFilterParams): void {\n        super.init(params);\n        this.params = params;\n        this.createDateComponent();\n        const translate = this.gridOptionsWrapper.getLocaleTextFunc();\n        this.eReadOnlyText\n            .setDisabled(true)\n            .setInputAriaLabel(translate('ariaDateFilterInput', 'Date Filter Input'));\n    }\n\n    protected setEditable(editable: boolean): void {\n        setDisplayed(this.eDateWrapper, editable);\n        setDisplayed(this.eReadOnlyText.getGui(), !editable);\n    }\n\n    public onParentModelChanged(model: ISimpleFilterModel, event: FilterChangedEvent): void {\n        // We don't want to update the floating filter if the floating filter caused the change,\n        // because the UI is already in sync. if we didn't do this, the UI would behave strangely\n        // as it would be updating as the user is typing\n        if (this.isEventFromFloatingFilter(event)) { return; }\n\n        super.setLastTypeFromModel(model);\n\n        const allowEditing = !this.isReadOnly() &&\n            this.canWeEditAfterModelFromParentFilter(model);\n\n        this.setEditable(allowEditing);\n\n        if (allowEditing) {\n            if (model) {\n                const dateModel = model as DateFilterModel;\n\n                this.dateComp.setDate(parseDateTimeFromString(dateModel.dateFrom));\n            } else {\n                this.dateComp.setDate(null);\n            }\n\n            this.eReadOnlyText.setValue('');\n        } else {\n            this.eReadOnlyText.setValue(this.getTextFromModel(model));\n            this.dateComp.setDate(null);\n        }\n    }\n\n    private onDateChanged(): void {\n        const filterValueDate = this.dateComp.getDate();\n        const filterValueText = serialiseDate(filterValueDate);\n\n        this.params.parentFilterInstance(filterInstance => {\n            if (filterInstance) {\n                const date = parseDateTimeFromString(filterValueText);\n                filterInstance.onFloatingFilterChanged(this.getLastType() || null, date);\n            }\n        });\n    }\n\n    private createDateComponent(): void {\n        const debounceMs = ProvidedFilter.getDebounceMs(this.params.filterParams, this.getDefaultDebounceMs());\n        const dateComponentParams: IDateParams = {\n            onDateChanged: debounce(this.onDateChanged.bind(this), debounceMs),\n            filterParams: this.params.column.getColDef().filterParams\n        };\n\n        this.dateComp = new DateCompWrapper(this.getContext(), this.userComponentFactory, dateComponentParams, this.eDateWrapper);\n\n        this.addDestroyFunc(() => this.dateComp.destroy());\n    }\n}\n"]}
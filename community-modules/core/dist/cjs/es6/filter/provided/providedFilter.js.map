{"version":3,"sources":["../../../src/ts/filter/provided/providedFilter.ts"],"names":[],"mappings":"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","file":"providedFilter.js","sourcesContent":["import { IDoesFilterPassParams, IFilter, IFilterComp, IFilterParams } from '../../interfaces/iFilter';\nimport { Autowired, PostConstruct } from '../../context/context';\nimport { IRowModel } from '../../interfaces/iRowModel';\nimport { IAfterGuiAttachedParams } from '../../interfaces/iAfterGuiAttachedParams';\nimport { loadTemplate, setDisabled } from '../../utils/dom';\nimport { debounce } from '../../utils/function';\nimport { AgPromise } from '../../utils/promise';\nimport { PopupEventParams } from '../../widgets/popupService';\nimport { IFilterLocaleText, IFilterTitleLocaleText, DEFAULT_FILTER_LOCALE_TEXT } from '../filterLocaleText';\nimport { ManagedFocusFeature } from '../../widgets/managedFocusFeature';\nimport { convertToSet } from '../../utils/set';\nimport { Component } from '../../widgets/component';\nimport { RowNode } from '../../entities/rowNode';\nimport { ValueService } from '../../valueService/valueService';\nimport { _ } from '../../utils';\n\ntype FilterButtonType = 'apply' | 'clear' | 'reset' | 'cancel';\n\nexport interface IProvidedFilterParams extends IFilterParams {\n    /**\n     * Specifies the buttons to be shown in the filter, in the order they should be displayed in.\n     * The options are:\n     * \n     *  - `'apply'`: If the Apply button is present, the filter is only applied after the user hits the Apply button.\n     *  - `'clear'`: The Clear button will clear the (form) details of the filter without removing any active filters on the column.\n     *  - `'reset'`: The Reset button will clear the details of the filter and any active filters on that column.\n     *  - `'cancel'`: The Cancel button will discard any changes that have been made to the filter in the UI, restoring the applied model.\n     */\n    buttons?: FilterButtonType[];\n    /**\n     * If the Apply button is present, the filter popup will be closed immediately when the Apply\n     * or Reset button is clicked if this is set to `true`.\n     * \n     * Default: `false`\n     */\n    closeOnApply?: boolean;\n    /**\n     * Overrides the default debounce time in milliseconds for the filter. Defaults are:\n     * - `TextFilter` and `NumberFilter`: 500ms. (These filters have text field inputs, so a short delay before the input is formatted and the filtering applied is usually appropriate).\n     * - `DateFilter` and `SetFilter`: 0ms\n     */\n    debounceMs?: number;\n    /**\n     * If set to `true`, disables controls in the filter to mutate its state. Normally this would\n     * be used in conjunction with the Filter API.\n     * \n     * Default: `false`\n     */\n    readOnly?: boolean;\n}\n\n/** Interface contract for the public aspects of the ProvidedFilter implementation(s). */\nexport interface IProvidedFilter extends IFilter {\n    /**\n     * Applies the model shown in the UI (so that `getModel()` will now return what was in the UI\n     * when `applyModel()` was called).\n     */\n    applyModel(): boolean;\n    /**\n     * Returns the filter model from the UI. If changes have been made to the UI but not yet\n     * applied, this model will reflect those changes.\n     */\n    getModelFromUi(): any;\n}\n\n/**\n * Contains common logic to all provided filters (apply button, clear button, etc).\n * All the filters that come with AG Grid extend this class. User filters do not\n * extend this class.\n *\n * @param M type of filter-model managed by the concrete sub-class that extends this type\n * @param V type of value managed by the concrete sub-class that extends this type\n */\nexport abstract class ProvidedFilter<M, V> extends Component implements IProvidedFilter, IFilterComp {\n    // each level in the hierarchy will save params with the appropriate type for that level.\n    private providedFilterParams: IProvidedFilterParams;\n\n    private applyActive = false;\n    private hidePopup: ((params: PopupEventParams) => void) | null | undefined = null;\n    // a debounce of the onBtApply method\n    private onBtApplyDebounce: () => void;\n\n    // after the user hits 'apply' the model gets copied to here. this is then the model that we use for\n    // all filtering. so if user changes UI but doesn't hit apply, then the UI will be out of sync with this model.\n    // this is what we want, as the UI should only become the 'active' filter once it's applied. when apply is\n    // inactive, this model will be in sync (following the debounce ms). if the UI is not a valid filter\n    // (eg the value is missing so nothing to filter on, or for set filter all checkboxes are checked so filter\n    // not active) then this appliedModel will be null/undefined.\n    private appliedModel: M | null = null;\n\n    @Autowired('rowModel') protected readonly rowModel: IRowModel;\n    @Autowired('valueService') private valueService: ValueService;\n\n    constructor(private readonly filterNameKey: keyof IFilterTitleLocaleText) {\n        super();\n    }\n\n    public abstract doesFilterPass(params: IDoesFilterPassParams): boolean;\n\n    protected abstract updateUiVisibility(): void;\n\n    protected abstract createBodyTemplate(): string;\n    protected abstract getCssIdentifier(): string;\n    protected abstract resetUiToDefaults(silent?: boolean): AgPromise<void>;\n\n    protected abstract setModelIntoUi(model: M): AgPromise<void>;\n    protected abstract areModelsEqual(a: M, b: M): boolean;\n\n    /** Used to get the filter type for filter models. */\n    protected abstract getFilterType(): string;\n\n    @PostConstruct\n    protected postConstruct(): void {\n        this.resetTemplate(); // do this first to create the DOM\n        this.createManagedBean(new ManagedFocusFeature(\n            this.getFocusableElement(),\n            {\n                handleKeyDown: this.handleKeyDown.bind(this)\n            }\n        ));\n    }\n\n    // override\n    protected handleKeyDown(e: KeyboardEvent): void { }\n\n    public abstract getModelFromUi(): M | null;\n\n    public getFilterTitle(): string {\n        return this.translate(this.filterNameKey);\n    }\n\n    public isFilterActive(): boolean {\n        // filter is active if we have a valid applied model\n        return !!this.appliedModel;\n    }\n\n    protected resetTemplate(paramsMap?: any) {\n        const templateString = /* html */`\n            <div class=\"ag-filter-wrapper\">\n                <div class=\"ag-filter-body-wrapper ag-${this.getCssIdentifier()}-body-wrapper\">\n                    ${this.createBodyTemplate()}\n                </div>\n            </div>`;\n\n        this.setTemplate(templateString, paramsMap);\n    }\n\n    protected isReadOnly(): boolean {\n        return !!this.providedFilterParams.readOnly;\n    }\n\n    public init(params: IProvidedFilterParams): void {\n        this.setParams(params);\n\n        this.resetUiToDefaults(true).then(() => {\n            this.updateUiVisibility();\n            this.setupOnBtApplyDebounce();\n        });\n    }\n\n    protected setParams(params: IProvidedFilterParams): void {\n        this.providedFilterParams = params;\n\n        this.applyActive = ProvidedFilter.isUseApplyButton(params);\n\n        this.createButtonPanel();\n    }\n\n    private createButtonPanel(): void {\n        const { buttons } = this.providedFilterParams;\n\n        if (!buttons || buttons.length < 1 || this.isReadOnly()) {\n            return;\n        }\n\n        const eButtonsPanel = document.createElement('div');\n\n        eButtonsPanel.classList.add('ag-filter-apply-panel');\n\n        const addButton = (type: FilterButtonType): void => {\n            let text;\n            let clickListener: (e?: Event) => void;\n\n            switch (type) {\n                case 'apply':\n                    text = this.translate('applyFilter');\n                    clickListener = (e) => this.onBtApply(false, false, e);\n                    break;\n                case 'clear':\n                    text = this.translate('clearFilter');\n                    clickListener = () => this.onBtClear();\n                    break;\n                case 'reset':\n                    text = this.translate('resetFilter');\n                    clickListener = () => this.onBtReset();\n                    break;\n                case 'cancel':\n                    text = this.translate('cancelFilter');\n                    clickListener = (e) => { this.onBtCancel(e!); };\n                    break;\n                default:\n                    console.warn('AG Grid: Unknown button type specified');\n                    return;\n            }\n\n            const button = loadTemplate(\n                /* html */\n                `<button\n                    type=\"button\"\n                    ref=\"${type}FilterButton\"\n                    class=\"ag-standard-button ag-filter-apply-panel-button\"\n                >${text}\n                </button>`\n            );\n\n            eButtonsPanel.appendChild(button);\n            this.addManagedListener(button, 'click', clickListener);\n        };\n\n        convertToSet(buttons).forEach(type => addButton(type));\n\n        this.getGui().appendChild(eButtonsPanel);\n    }\n\n    // subclasses can override this to provide alternative debounce defaults\n    protected getDefaultDebounceMs(): number {\n        return 0;\n    }\n\n    private setupOnBtApplyDebounce(): void {\n        const debounceMs = ProvidedFilter.getDebounceMs(this.providedFilterParams, this.getDefaultDebounceMs());\n        this.onBtApplyDebounce = debounce(this.onBtApply.bind(this), debounceMs);\n    }\n\n    public getModel(): M | null {\n        return this.appliedModel ? _.deepCloneObject(this.appliedModel) : null;\n    }\n\n    public setModel(model: M | null): AgPromise<void> {\n        const promise = model != null ? this.setModelIntoUi(model) : this.resetUiToDefaults();\n\n        return promise.then(() => {\n            this.updateUiVisibility();\n\n            // we set the model from the GUI, rather than the provided model,\n            // so the model is consistent, e.g. handling of null/undefined will be the same,\n            // or if model is case insensitive, then casing is removed.\n            this.applyModel();\n        });\n    }\n\n    private onBtCancel(e: Event): void {\n        const currentModel = this.getModel();\n\n        const afterAppliedFunc = () => {\n            this.onUiChanged(false, 'prevent');\n\n            if (this.providedFilterParams.closeOnApply) {\n                this.close(e);\n            }\n        };\n\n        if (currentModel != null) {\n            this.setModelIntoUi(currentModel).then(afterAppliedFunc);\n        } else {\n            this.resetUiToDefaults().then(afterAppliedFunc);\n        }\n    }\n\n    private onBtClear(): void {\n        this.resetUiToDefaults().then(() => this.onUiChanged());\n    }\n\n    private onBtReset(): void {\n        this.onBtClear();\n        this.onBtApply();\n    }\n\n    /**\n     * Applies changes made in the UI to the filter, and returns true if the model has changed.\n     */\n    public applyModel(): boolean {\n        const newModel = this.getModelFromUi();\n\n        if (!this.isModelValid(newModel!)) { return false; }\n\n        const previousModel = this.appliedModel;\n\n        this.appliedModel = newModel;\n\n        // models can be same if user pasted same content into text field, or maybe just changed the case\n        // and it's a case insensitive filter\n        return !this.areModelsEqual(previousModel!, newModel!);\n    }\n\n    protected isModelValid(model: M): boolean {\n        return true;\n    }\n\n    protected onBtApply(afterFloatingFilter = false, afterDataChange = false, e?: Event): void {\n        if (this.applyModel()) {\n            // the floating filter uses 'afterFloatingFilter' info, so it doesn't refresh after filter changed if change\n            // came from floating filter\n            this.providedFilterParams.filterChangedCallback({ afterFloatingFilter, afterDataChange });\n        }\n\n        const { closeOnApply } = this.providedFilterParams;\n\n        // only close if an apply button is visible, otherwise we'd be closing every time a change was made!\n        if (closeOnApply && this.applyActive && !afterFloatingFilter && !afterDataChange) {\n            this.close(e);\n        }\n    }\n\n    public onNewRowsLoaded(): void {\n        this.resetUiToDefaults().then(() => this.appliedModel = null);\n    }\n\n    public close(e?: Event): void {\n        if (!this.hidePopup) { return; }\n\n        const keyboardEvent = e as KeyboardEvent;\n        const key = keyboardEvent && keyboardEvent.key;\n        let params: PopupEventParams;\n\n        if (key === 'Enter' || key === 'Space') {\n            params = { keyboardEvent };\n        }\n\n        this.hidePopup(params!);\n        this.hidePopup = null;\n    }\n\n    /**\n     * By default, if the change came from a floating filter it will be applied immediately, otherwise if there is no\n     * apply button it will be applied after a debounce, otherwise it will not be applied at all. This behaviour can\n     * be adjusted by using the apply parameter.\n     */\n    protected onUiChanged(fromFloatingFilter = false, apply?: 'immediately' | 'debounce' | 'prevent'): void {\n        this.updateUiVisibility();\n        this.providedFilterParams.filterModifiedCallback();\n\n        if (this.applyActive && !this.isReadOnly) {\n            const isValid = this.isModelValid(this.getModelFromUi()!);\n\n            setDisabled(this.getRefElement('applyFilterButton'), !isValid);\n        }\n\n        if ((fromFloatingFilter && !apply) || apply === 'immediately') {\n            this.onBtApply(fromFloatingFilter);\n        } else if ((!this.applyActive && !apply) || apply === 'debounce') {\n            this.onBtApplyDebounce();\n        }\n    }\n\n    public afterGuiAttached(params?: IAfterGuiAttachedParams): void {\n        if (params == null) { return; }\n\n        this.hidePopup = params.hidePopup;\n    }\n\n    // static, as used by floating filter also\n    public static getDebounceMs(params: IProvidedFilterParams, debounceDefault: number): number {\n        if (ProvidedFilter.isUseApplyButton(params)) {\n            if (params.debounceMs != null) {\n                console.warn('AG Grid: debounceMs is ignored when apply button is present');\n            }\n\n            return 0;\n        }\n\n        return params.debounceMs != null ? params.debounceMs : debounceDefault;\n    }\n\n    // static, as used by floating filter also\n    public static isUseApplyButton(params: IProvidedFilterParams): boolean {\n        return !!params.buttons && params.buttons.indexOf('apply') >= 0;\n    }\n\n    public destroy(): void {\n        this.hidePopup = null;\n\n        super.destroy();\n    }\n\n    protected translate(key: keyof IFilterLocaleText | keyof IFilterTitleLocaleText): string {\n        const translate = this.gridOptionsWrapper.getLocaleTextFunc();\n\n        return translate(key, DEFAULT_FILTER_LOCALE_TEXT[key]);\n    }\n\n    protected getCellValue(rowNode: RowNode): V {\n        const { api, colDef, column, columnApi, context } = this.providedFilterParams;\n        return this.providedFilterParams.valueGetter({\n            api,\n            colDef,\n            column,\n            columnApi,\n            context,\n            data: rowNode.data,\n            getValue: (field) => rowNode.data[field],\n            node: rowNode,\n        });\n    }\n}\n"]}
{"version":3,"sources":["../../src/ts/gridComp/gridCompController.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,8CAAwE;AAIxE,gDAA+C;AAC/C,4DAA2D;AAC3D,sDAAqD;AAErD,0DAAqE;AACrE,0CAAsC;AAKtC,wCAA2C;AAe3C;IAAwC,sCAAQ;IAmB5C;eACI,iBAAO;IACX,CAAC;IAGS,0CAAa,GAAvB;QADA,iBAeC;QAbG,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,oBAAoB,CAAC,CAAC;QAE9D,6CAA6C;QAC7C;YACI,IAAI,CAAC,OAAO;YACZ,IAAI,CAAC,YAAY;YACjB,IAAI,CAAC,eAAe;YACpB,IAAI,CAAC,kBAAkB;SAC1B,CAAC,OAAO,CAAC,UAAA,OAAO,IAAI,OAAA,OAAO,CAAC,0BAA0B,CAAC,KAAI,CAAC,EAAxC,CAAwC,CAAC,CAAC;QAE/D,IAAI,+BAAc,CAAC,YAAY,CAAC,yBAAW,CAAC,eAAe,CAAC,EAAE;YAC1D,IAAI,CAAC,gBAAgB,CAAC,0BAA0B,CAAC,IAAI,CAAC,CAAC;SAC1D;IACL,CAAC;IAEM,oCAAO,GAAd,UAAe,IAAkB,EAAE,QAAqB,EAAE,IAAiB;QAA3E,iBAwBC;QAvBG,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;QACjB,IAAI,CAAC,YAAY,GAAG,QAAQ,CAAC;QAC7B,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;QAEjB,IAAI,CAAC,iBAAiB,CAAC,qCAAqC,CAAC,QAAQ,CAAC,CAAC;QAEvE,IAAI,CAAC,iBAAiB,CAAC,IAAI,6BAAa,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;QAErD,8FAA8F;QAC9F,uCAAuC;QACvC,IAAI,CAAC,aAAa,EAAE,CAAC;QAErB,IAAI,CAAC,kBAAkB,CAAC,IAAI,EAAE,kBAAM,CAAC,oBAAoB,EAAE;YACvD,KAAI,CAAC,IAAI,CAAC,6BAA6B,CAAC,IAAI,CAAC,CAAC;QAClD,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,kBAAkB,CAAC,IAAI,EAAE,kBAAM,CAAC,iBAAiB,EAAE;YACpD,KAAI,CAAC,IAAI,CAAC,6BAA6B,CAAC,KAAK,CAAC,CAAC;QACnD,CAAC,CAAC,CAAC;QAEH,IAAM,qBAAqB,GAAG,IAAI,CAAC,qBAAqB,CAAC,aAAa,CAClE,IAAI,CAAC,YAAY,EAAE,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;QAC1D,IAAI,CAAC,cAAc,CAAC,cAAM,OAAA,qBAAqB,EAAE,EAAvB,CAAuB,CAAC,CAAC;IACvD,CAAC;IAEM,0CAAa,GAApB;QACI,OAAO,+BAAc,CAAC,YAAY,CAAC,yBAAW,CAAC,iBAAiB,CAAC,CAAC;IACtE,CAAC;IAEM,wCAAW,GAAlB;QACI,OAAO,+BAAc,CAAC,YAAY,CAAC,yBAAW,CAAC,aAAa,CAAC,CAAC;IAClE,CAAC;IAEM,0CAAa,GAApB;QACI,OAAO,+BAAc,CAAC,YAAY,CAAC,yBAAW,CAAC,eAAe,CAAC,CAAC;IACpE,CAAC;IAEM,0CAAa,GAApB;QACI,OAAO,+BAAc,CAAC,YAAY,CAAC,yBAAW,CAAC,oBAAoB,CAAC,CAAC;QAAC,CAAC;IAC3E,CAAC;IAEO,8CAAiB,GAAzB;QACI,IAAM,KAAK,GAAyB;YAChC,IAAI,EAAE,kBAAM,CAAC,uBAAuB;YACpC,GAAG,EAAE,IAAI,CAAC,OAAO;YACjB,SAAS,EAAE,IAAI,CAAC,SAAS;YACzB,WAAW,EAAE,IAAI,CAAC,YAAY,CAAC,WAAW;YAC1C,YAAY,EAAE,IAAI,CAAC,YAAY,CAAC,YAAY;SAC/C,CAAC;QACF,IAAI,CAAC,YAAY,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;IAC3C,CAAC;IAEO,0CAAa,GAArB;QACI,IAAM,QAAQ,GAAG,IAAI,CAAC,kBAAkB,CAAC,WAAW,EAAE,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,QAAQ,CAAC;QAC7E,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,QAAQ,CAAC,CAAC;IACpC,CAAC;IAEM,0CAAa,GAApB;QACI,IAAI,CAAC,IAAI,CAAC,aAAa,EAAE,CAAC;IAC9B,CAAC;IAEM,mCAAM,GAAb;QACI,OAAO,IAAI,CAAC,IAAI,CAAC;IACrB,CAAC;IAEM,oDAAuB,GAA9B,UAA+B,SAAkB;QAC7C,IAAM,mBAAmB,GAAG,IAAI,CAAC,IAAI,CAAC,sBAAsB,EAAE,CAAC;QAC/D,IAAM,YAAY,GAAG,iBAAS,CAAC,mBAAmB,EAAE,UAAA,SAAS,IAAI,OAAA,SAAS,CAAC,QAAQ,CAAC,QAAQ,CAAC,aAAa,CAAC,EAA1C,CAA0C,CAAC,CAAC;QAC7G,IAAM,OAAO,GAAG,YAAY,GAAG,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QAEpD,IAAI,OAAO,GAAG,CAAC,IAAI,OAAO,IAAI,mBAAmB,CAAC,MAAM,EAAE;YACtD,OAAO,KAAK,CAAC;SAChB;QAED,IAAI,OAAO,KAAK,CAAC,EAAE;YACf,OAAO,IAAI,CAAC,eAAe,EAAE,CAAC;SACjC;QAED,OAAO,IAAI,CAAC,eAAe,CAAC,SAAS,CAAC,mBAAmB,CAAC,OAAO,CAAC,CAAC,CAAC;IACxE,CAAC;IAEM,4CAAe,GAAtB;QACI,IAAI,WAAW,GAAyB,IAAI,CAAC,gBAAgB,CAAC,sBAAsB,EAAE,CAAC,CAAC,CAAC,CAAC;QAC1F,IAAI,CAAC,WAAW,EAAE;YAAE,OAAO,KAAK,CAAC;SAAE;QAEnC,IAAI,WAAW,CAAC,SAAS,EAAE,EAAE;YACzB,WAAW,GAAG,IAAI,CAAC,gBAAgB,CAAC,qBAAqB,CAAC,WAAW,EAAE,CAAC,CAAE,CAAC;SAC9E;QAED,IAAI,CAAC,eAAe,CAAC,mBAAmB,CACpC,EAAE,cAAc,EAAE,CAAC,EAAE,MAAM,EAAE,WAAW,EAAE,CAC7C,CAAC;QAEF,OAAO,IAAI,CAAC;IAChB,CAAC;IAEM,qDAAwB,GAA/B,UAAgC,EAAU;QAAV,mBAAA,EAAA,UAAU;QACtC,IAAI,CAAC,IAAI,CAAC,wBAAwB,CAAC,EAAE,CAAC,CAAC;IAC3C,CAAC;IAzIuB;QAAvB,mBAAS,CAAC,WAAW,CAAC;yDAA8B;IAC/B;QAArB,mBAAS,CAAC,SAAS,CAAC;uDAA0B;IACpB;QAA1B,mBAAS,CAAC,cAAc,CAAC;4DAAoC;IAChC;QAA7B,mBAAS,CAAC,iBAAiB,CAAC;+DAAqD;IACpD;QAA7B,kBAAQ,CAAC,kBAAkB,CAAC;gEAA6C;IAC9C;QAA3B,mBAAS,CAAC,eAAe,CAAC;6DAA8B;IACrB;QAAnC,mBAAS,CAAC,uBAAuB,CAAC;qEAAsD;IAC1D;QAA9B,mBAAS,CAAC,kBAAkB,CAAC;gEAA4C;IACzC;QAAhC,mBAAS,CAAC,oBAAoB,CAAC;kEAAgD;IAChD;QAA/B,mBAAS,CAAC,mBAAmB,CAAC;iEAA8C;IAa7E;QADC,uBAAa;2DAeb;IAuGL,yBAAC;CA7ID,AA6IC,CA7IuC,mBAAQ,GA6I/C;AA7IY,gDAAkB","file":"gridCompController.js","sourcesContent":["import { Autowired, Optional, PostConstruct } from \"../context/context\";\nimport { GridApi } from \"../gridApi\";\nimport { PopupService } from \"../widgets/popupService\";\nimport { FocusController } from \"../focusController\";\nimport { BeanStub } from \"../context/beanStub\";\nimport { ModuleRegistry } from \"../modules/moduleRegistry\";\nimport { ModuleNames } from \"../modules/moduleNames\";\nimport { IClipboardService } from \"../interfaces/iClipboardService\";\nimport { LayoutFeature, LayoutView } from \"../styling/layoutFeature\";\nimport { Events } from \"../eventKeys\";\nimport { Logger, LoggerFactory } from \"../logger\";\nimport { ResizeObserverService } from \"../misc/resizeObserverService\";\nimport { GridSizeChangedEvent } from \"../events\";\nimport { ColumnApi } from \"../columnController/columnApi\";\nimport { findIndex } from \"../utils/array\";\nimport { Column } from \"../entities/column\";\nimport { ColumnGroup } from \"../entities/columnGroup\";\nimport { ColumnController } from \"../columnController/columnController\";\nimport { ControllersService } from \"../controllersService\";\nimport { MouseEventService } from \"../gridBodyComp/mouseEventService\";\n\nexport interface GridCompView extends LayoutView {\n    setRtlClass(cssClass: string): void;\n    destroyGridUi(): void;\n    forceFocusOutOfContainer(up: boolean): void;\n    addOrRemoveKeyboardFocusClass(value: boolean): void;\n    getFocusableContainers(): HTMLElement[];\n}\n\nexport class GridCompController extends BeanStub {\n\n    @Autowired('columnApi') private columnApi: ColumnApi;\n    @Autowired('gridApi') private gridApi: GridApi;\n    @Autowired('popupService') private popupService: PopupService;\n    @Autowired('focusController') protected readonly focusController: FocusController;\n    @Optional('clipboardService') private clipboardService: IClipboardService;\n    @Autowired('loggerFactory') loggerFactory: LoggerFactory;\n    @Autowired('resizeObserverService') private resizeObserverService: ResizeObserverService;\n    @Autowired('columnController') private columnController: ColumnController;\n    @Autowired('controllersService') private controllersService: ControllersService;\n    @Autowired('mouseEventService') private mouseEventService: MouseEventService;\n\n    private view: GridCompView;\n    private eGridHostDiv: HTMLElement;\n    private eGui: HTMLElement;\n\n    private logger: Logger;\n\n    constructor() {\n        super();\n    }\n\n    @PostConstruct\n    protected postConstruct(): void {\n        this.logger = this.loggerFactory.create('GridCompController');\n\n        // register with services that need grid core\n        [\n            this.gridApi,\n            this.popupService,\n            this.focusController,\n            this.controllersService\n        ].forEach(service => service.registerGridCompController(this));\n\n        if (ModuleRegistry.isRegistered(ModuleNames.ClipboardModule)) {\n            this.clipboardService.registerGridCompController(this);\n        }\n    }\n\n    public setView(view: GridCompView, eGridDiv: HTMLElement, eGui: HTMLElement): void {\n        this.view = view;\n        this.eGridHostDiv = eGridDiv;\n        this.eGui = eGui;\n\n        this.mouseEventService.stampTopLevelGridCompWithGridInstance(eGridDiv);\n\n        this.createManagedBean(new LayoutFeature(this.view));\n\n        // important to set rtl before doLayout, as setting the RTL class impacts the scroll position,\n        // which doLayout indirectly depends on\n        this.addRtlSupport();\n\n        this.addManagedListener(this, Events.EVENT_KEYBOARD_FOCUS, () => {\n            this.view.addOrRemoveKeyboardFocusClass(true);\n        });\n\n        this.addManagedListener(this, Events.EVENT_MOUSE_FOCUS, () => {\n            this.view.addOrRemoveKeyboardFocusClass(false);\n        });\n\n        const unsubscribeFromResize = this.resizeObserverService.observeResize(\n            this.eGridHostDiv, this.onGridSizeChanged.bind(this));\n        this.addDestroyFunc(() => unsubscribeFromResize());\n    }\n\n    public showDropZones(): boolean {\n        return ModuleRegistry.isRegistered(ModuleNames.RowGroupingModule);\n    }\n\n    public showSideBar(): boolean {\n        return ModuleRegistry.isRegistered(ModuleNames.SideBarModule);\n    }\n\n    public showStatusBar(): boolean {\n        return ModuleRegistry.isRegistered(ModuleNames.StatusBarModule);\n    }\n\n    public showWatermark(): boolean {\n        return ModuleRegistry.isRegistered(ModuleNames.EnterpriseCoreModule); ;\n    }\n\n    private onGridSizeChanged(): void {\n        const event: GridSizeChangedEvent = {\n            type: Events.EVENT_GRID_SIZE_CHANGED,\n            api: this.gridApi,\n            columnApi: this.columnApi,\n            clientWidth: this.eGridHostDiv.clientWidth,\n            clientHeight: this.eGridHostDiv.clientHeight\n        };\n        this.eventService.dispatchEvent(event);\n    }\n\n    private addRtlSupport(): void {\n        const cssClass = this.gridOptionsWrapper.isEnableRtl() ? 'ag-rtl' : 'ag-ltr';\n        this.view.setRtlClass(cssClass);\n    }\n\n    public destroyGridUi(): void {\n        this.view.destroyGridUi();\n    }\n\n    public getGui(): HTMLElement {\n        return this.eGui;\n    }\n\n    public focusNextInnerContainer(backwards: boolean): boolean {\n        const focusableContainers = this.view.getFocusableContainers();\n        const idxWithFocus = findIndex(focusableContainers, container => container.contains(document.activeElement));\n        const nextIdx = idxWithFocus + (backwards ? -1 : 1);\n\n        if (nextIdx < 0 || nextIdx >= focusableContainers.length) {\n            return false;\n        }\n\n        if (nextIdx === 0) {\n            return this.focusGridHeader();\n        }\n\n        return this.focusController.focusInto(focusableContainers[nextIdx]);\n    }\n\n    public focusGridHeader(): boolean {\n        let firstColumn: Column | ColumnGroup = this.columnController.getAllDisplayedColumns()[0];\n        if (!firstColumn) { return false; }\n\n        if (firstColumn.getParent()) {\n            firstColumn = this.columnController.getColumnGroupAtLevel(firstColumn, 0)!;\n        }\n\n        this.focusController.focusHeaderPosition(\n            { headerRowIndex: 0, column: firstColumn }\n        );\n\n        return true;\n    }\n\n    public forceFocusOutOfContainer(up = false): void {\n        this.view.forceFocusOutOfContainer(up);\n    }\n\n}"]}
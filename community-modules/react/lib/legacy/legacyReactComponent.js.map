{"version":3,"sources":["legacy/legacyReactComponent.ts"],"names":[],"mappings":"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","file":"legacyReactComponent.js","sourcesContent":["import { createElement, ReactPortal } from 'react';\nimport { createPortal } from 'react-dom';\nimport { AgPromise, ComponentType } from '@ag-grid-community/core';\nimport { ReactComponent } from '../shared/reactComponent';\nimport { renderToStaticMarkup } from 'react-dom/server';\nimport generateNewKey from '../shared/keyGenerator';\nimport { AgGridReactLegacy } from './agGridReactLegacy';\nimport { PortalManager } from '../shared/portalManager';\n\nexport class LegacyReactComponent extends ReactComponent {\n    static SLOW_RENDERING_THRESHOLD = 3;\n\n    private staticMarkup: HTMLElement | null | string = null;\n    private staticRenderTime: number = 0;\n\n    private parentComponent: AgGridReactLegacy;\n\n    constructor(reactComponent: any, parentComponent: AgGridReactLegacy, portalManager: PortalManager, componentType: ComponentType) {\n        super(reactComponent, portalManager, componentType);\n        this.parentComponent = parentComponent;\n    }\n\n    public init(params: any): AgPromise<void> {\n        this.eParentElement = this.createParentElement(params);\n        this.renderStaticMarkup(params);\n\n        return new AgPromise<void>(resolve => this.createReactComponent(params, resolve));\n    }\n\n    private createReactComponent(params: any, resolve: (value: any) => void) {\n        // regular components (ie not functional)\n        if (!this.isStatelessComponent()) {\n            // grab hold of the actual instance created\n            params.ref = (element: any) => {\n                this.componentInstance = element;\n                this.addParentContainerStyleAndClasses();\n\n                this.removeStaticMarkup();\n            };\n        }\n\n        const reactComponent = createElement(this.reactComponent, params);\n        const portal: ReactPortal = createPortal(\n            reactComponent,\n            this.eParentElement as any,\n            generateNewKey() // fixed deltaRowModeRefreshCompRenderer\n        );\n\n        this.portal = portal;\n        this.portalManager.mountReactPortal(portal, this, (value: any) => {\n            resolve(value);\n\n            // functional/stateless components have a slightly different lifecycle (no refs) so we'll clean them up\n            // here\n            if (this.isStatelessComponent()) {\n                if (this.isSlowRenderer()) {\n                    this.removeStaticMarkup();\n                }\n                setTimeout(() => {\n                    this.removeStaticMarkup();\n                });\n            }\n        });\n    }\n\n    protected fallbackMethodAvailable(name: string): boolean {\n        return false;\n    }\n\n    protected fallbackMethod(name: string, params: any): void { /* no op */ }\n\n    private isSlowRenderer() {\n        return this.staticRenderTime >= LegacyReactComponent.SLOW_RENDERING_THRESHOLD;\n    }\n\n    public isNullValue(): boolean {\n        return this.staticMarkup === '';\n    }\n\n    /*\n     * Attempt to render the component as static markup if possible\n     * What this does is eliminate any visible flicker for the user in the scenario where a component is destroyed and\n     * recreated with exactly the same data (ie with force refresh)\n     * Note: Some use cases will throw an error (ie when using Context) so if an error occurs just ignore it any move on\n     */\n    private renderStaticMarkup(params: any) {\n        if (this.parentComponent.isDisableStaticMarkup() || !this.componentType.cellRenderer) {\n            return;\n        }\n\n        const originalConsoleError = console.error;\n        const reactComponent = createElement(this.reactComponent, params);\n\n        try {\n            // if a user is doing anything that uses useLayoutEffect (like material ui) then it will throw and we\n            // can't do anything to stop it; this is just a warning and has no effect on anything so just suppress it\n            // for this single operation\n            console.error = () => {\n            };\n\n            const start = Date.now();\n            const staticMarkup = renderToStaticMarkup(reactComponent);\n            this.staticRenderTime = Date.now() - start;\n\n            console.error = originalConsoleError;\n\n            // if the render method returns null the result will be an empty string\n            if (staticMarkup === '') {\n                this.staticMarkup = staticMarkup;\n            } else {\n                if (staticMarkup) {\n                    // we wrap the content as if there is \"trailing\" text etc it's not easy to safely remove\n                    // the same is true for memoized renderers, renderers that that return simple strings or NaN etc\n                    this.staticMarkup = document.createElement('span');\n                    this.staticMarkup.innerHTML = staticMarkup;\n                    this.eParentElement.appendChild(this.staticMarkup);\n                }\n            }\n        } catch (e) {\n            // we tried - this can happen with certain (rare) edge cases\n        } finally {\n            console.error = originalConsoleError;\n        }\n    }\n\n    private removeStaticMarkup() {\n        if (this.parentComponent.isDisableStaticMarkup() || !this.componentType.cellRenderer) {\n            return;\n        }\n\n        if (this.staticMarkup) {\n            if ((this.staticMarkup as HTMLElement).remove) {\n                // everyone else in the world\n                (this.staticMarkup as HTMLElement).remove();\n                this.staticMarkup = null;\n            } else if (this.eParentElement.removeChild) {\n                // ie11...\n                this.eParentElement.removeChild(this.staticMarkup as any);\n                this.staticMarkup = null;\n            }\n        }\n    }\n\n    rendered(): boolean {\n        return this.isNullValue() ||\n            !!this.staticMarkup || (this.isStatelessComponent() && this.statelessComponentRendered()) ||\n            !!(!this.isStatelessComponent() && this.getFrameworkComponentInstance());\n    }\n}\n"]}
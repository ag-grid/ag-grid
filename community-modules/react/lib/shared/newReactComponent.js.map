{"version":3,"sources":["shared/newReactComponent.ts"],"names":[],"mappings":"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","file":"newReactComponent.js","sourcesContent":["import { ReactPortal, createElement } from 'react';\nimport { createPortal } from 'react-dom';\nimport { ComponentType, AgPromise } from '@ag-grid-community/core';\nimport { ReactComponent } from './reactComponent';\nimport { renderToStaticMarkup } from \"react-dom/server\";\nimport generateNewKey from \"./keyGenerator\";\nimport { PortalManager } from './portalManager';\n\n\nexport class NewReactComponent extends ReactComponent {\n    \n    private key: string;\n    private portalKey: string;\n    private oldPortal: ReactPortal | null = null;\n    private reactElement: any;\n    private params: any;\n\n    constructor(reactComponent: any, parentComponent: PortalManager, componentType: ComponentType) {\n        super(reactComponent, parentComponent, componentType);\n\n        this.key = generateNewKey();\n        this.portalKey = generateNewKey();\n    }\n\n    public init(params: any): AgPromise<void> {\n        this.eParentElement = this.createParentElement(params);\n        this.params = params;\n\n        this.createOrUpdatePortal(params);\n\n        return new AgPromise<void>(resolve => this.createReactComponent(resolve));\n    }\n\n    private createOrUpdatePortal(params: any) {\n        if (!this.isStatelessComponent()) {\n            // grab hold of the actual instance created\n            params.ref = (element: any) => {\n                this.componentInstance = element;\n                this.addParentContainerStyleAndClasses();\n            };\n        }\n\n        this.reactElement = createElement(this.reactComponent, { ...params, key: this.key });\n\n        this.portal = createPortal(\n            this.reactElement,\n            this.eParentElement as any,\n            this.portalKey // fixed deltaRowModeRefreshCompRenderer\n        );\n    }\n\n    private createReactComponent(resolve: (value: any) => void) {\n        this.portalManager.mountReactPortal(this.portal!, this, (value: any) => {\n            resolve(value);\n        });\n    }\n\n    public isNullValue(): boolean {\n        return this.valueRenderedIsNull(this.params);\n    }\n\n    rendered(): boolean {\n        return (this.isStatelessComponent() && this.statelessComponentRendered()) ||\n            !!(!this.isStatelessComponent() && this.getFrameworkComponentInstance());\n    }\n\n    private valueRenderedIsNull(params: any): boolean {\n        // we only do this for cellRenderers\n        if (!this.componentType.cellRenderer) {\n            return false;\n        }\n\n        // we've no way of knowing if a component returns null without rendering it first\n        // so we render it to markup and check the output - if it'll be null we know and won't timeout\n        // waiting for a component that will never be created\n\n        const originalConsoleError = console.error;\n        try {\n            // if a user is doing anything that uses useLayoutEffect (like material ui) then it will throw and we\n            // can't do anything to stop it; this is just a warning and has no effect on anything so just suppress it\n            // for this single operation\n            console.error = () => {\n            };\n            const staticMarkup = renderToStaticMarkup(createElement(this.reactComponent, params));\n            return staticMarkup === '';\n        } catch (ignore) {\n        } finally {\n            console.error = originalConsoleError;\n        }\n\n        return false;\n    }\n\n    /*\n    * fallback methods - these will be invoked if a corresponding instance method is not present\n    * for example if refresh is called and is not available on the component instance, then refreshComponent on this\n    * class will be invoked instead\n    *\n    * Currently only refresh is supported\n    */\n    protected refreshComponent(args: any): void {\n        this.oldPortal = this.portal;\n        this.createOrUpdatePortal(args);\n        this.portalManager.updateReactPortal(this.oldPortal!, this.portal!);\n    }\n\n    protected fallbackMethod(name: string, params: any): any {\n        const method = (this as any)[`${name}Component`];\n        if (!!method) {\n            return method.bind(this)(params);\n        }\n    }\n\n    protected fallbackMethodAvailable(name: string): boolean {\n        const method = (this as any)[`${name}Component`];\n        return !!method;\n    }\n}\n"]}
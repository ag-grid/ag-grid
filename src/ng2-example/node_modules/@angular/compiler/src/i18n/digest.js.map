{"version":3,"file":"digest.js","sourceRoot":"","sources":["../../../../../modules/@angular/compiler/src/i18n/digest.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\nimport * as i18n from './i18n_ast';\n\nexport function digestMessage(message: i18n.Message): string {\n  return sha1(serializeNodes(message.nodes).join('') + `[${message.meaning}]`);\n}\n\n/**\n * Serialize the i18n ast to something xml-like in order to generate an UID.\n *\n * The visitor is also used in the i18n parser tests\n *\n * @internal\n */\nclass _SerializerVisitor implements i18n.Visitor {\n  visitText(text: i18n.Text, context: any): any { return text.value; }\n\n  visitContainer(container: i18n.Container, context: any): any {\n    return `[${container.children.map(child => child.visit(this)).join(', ')}]`;\n  }\n\n  visitIcu(icu: i18n.Icu, context: any): any {\n    let strCases = Object.keys(icu.cases).map((k: string) => `${k} {${icu.cases[k].visit(this)}}`);\n    return `{${icu.expression}, ${icu.type}, ${strCases.join(', ')}}`;\n  }\n\n  visitTagPlaceholder(ph: i18n.TagPlaceholder, context: any): any {\n    return ph.isVoid ?\n        `<ph tag name=\"${ph.startName}\"/>` :\n        `<ph tag name=\"${ph.startName}\">${ph.children.map(child => child.visit(this)).join(', ')}</ph name=\"${ph.closeName}\">`;\n  }\n\n  visitPlaceholder(ph: i18n.Placeholder, context: any): any {\n    return `<ph name=\"${ph.name}\">${ph.value}</ph>`;\n  }\n\n  visitIcuPlaceholder(ph: i18n.IcuPlaceholder, context?: any): any {\n    return `<ph icu name=\"${ph.name}\">${ph.value.visit(this)}</ph>`;\n  }\n}\n\nconst serializerVisitor = new _SerializerVisitor();\n\nexport function serializeNodes(nodes: i18n.Node[]): string[] {\n  return nodes.map(a => a.visit(serializerVisitor, null));\n}\n\n/**\n * Compute the SHA1 of the given string\n *\n * see http://csrc.nist.gov/publications/fips/fips180-4/fips-180-4.pdf\n *\n * WARNING: this function has not been designed not tested with security in mind.\n *          DO NOT USE IT IN A SECURITY SENSITIVE CONTEXT.\n */\nexport function sha1(str: string): string {\n  const utf8 = utf8Encode(str);\n  const words32 = stringToWords32(utf8);\n  const len = utf8.length * 8;\n\n  const w = new Array(80);\n  let [a, b, c, d, e]: number[] = [0x67452301, 0xefcdab89, 0x98badcfe, 0x10325476, 0xc3d2e1f0];\n\n  words32[len >> 5] |= 0x80 << (24 - len % 32);\n  words32[((len + 64 >> 9) << 4) + 15] = len;\n\n  for (let i = 0; i < words32.length; i += 16) {\n    const [h0, h1, h2, h3, h4]: number[] = [a, b, c, d, e];\n\n    for (let j = 0; j < 80; j++) {\n      if (j < 16) {\n        w[j] = words32[i + j];\n      } else {\n        w[j] = rol32(w[j - 3] ^ w[j - 8] ^ w[j - 14] ^ w[j - 16], 1);\n      }\n\n      const [f, k] = fk(j, b, c, d);\n      const temp = [rol32(a, 5), f, e, k, w[j]].reduce(add32);\n      [e, d, c, b, a] = [d, c, rol32(b, 30), a, temp];\n    }\n\n    [a, b, c, d, e] = [add32(a, h0), add32(b, h1), add32(c, h2), add32(d, h3), add32(e, h4)];\n  }\n\n  const sha1 = words32ToString([a, b, c, d, e]);\n\n  let hex: string = '';\n  for (let i = 0; i < sha1.length; i++) {\n    const b = sha1.charCodeAt(i);\n    hex += (b >>> 4 & 0x0f).toString(16) + (b & 0x0f).toString(16);\n  }\n\n  return hex.toLowerCase();\n}\n\nfunction utf8Encode(str: string): string {\n  let encoded: string = '';\n\n  for (let index = 0; index < str.length; index++) {\n    const codePoint = decodeSurrogatePairs(str, index);\n\n    if (codePoint <= 0x7f) {\n      encoded += String.fromCharCode(codePoint);\n    } else if (codePoint <= 0x7ff) {\n      encoded += String.fromCharCode(0xc0 | codePoint >>> 6, 0x80 | codePoint & 0x3f);\n    } else if (codePoint <= 0xffff) {\n      encoded += String.fromCharCode(\n          0xe0 | codePoint >>> 12, 0x80 | codePoint >>> 6 & 0x3f, 0x80 | codePoint & 0x3f);\n    } else if (codePoint <= 0x1fffff) {\n      encoded += String.fromCharCode(\n          0xf0 | codePoint >>> 18, 0x80 | codePoint >>> 12 & 0x3f, 0x80 | codePoint >>> 6 & 0x3f,\n          0x80 | codePoint & 0x3f);\n    }\n  }\n\n  return encoded;\n}\n\n// see https://mathiasbynens.be/notes/javascript-encoding#surrogate-formulae\nfunction decodeSurrogatePairs(str: string, index: number): number {\n  if (index < 0 || index >= str.length) {\n    throw new Error(`index=${index} is out of range in \"${str}\"`);\n  }\n\n  const high = str.charCodeAt(index);\n  let low: number;\n\n  if (high >= 0xd800 && high <= 0xdfff && str.length > index + 1) {\n    low = str.charCodeAt(index + 1);\n    if (low >= 0xdc00 && low <= 0xdfff) {\n      return (high - 0xd800) * 0x400 + low - 0xdc00 + 0x10000;\n    }\n  }\n\n  return high;\n}\n\nfunction stringToWords32(str: string): number[] {\n  const words32 = Array(str.length >>> 2);\n\n  for (let i = 0; i < words32.length; i++) {\n    words32[i] = 0;\n  }\n\n  for (let i = 0; i < str.length; i++) {\n    words32[i >>> 2] |= (str.charCodeAt(i) & 0xff) << 8 * (3 - i & 0x3);\n  }\n\n  return words32;\n}\n\nfunction words32ToString(words32: number[]): string {\n  let str = '';\n  for (let i = 0; i < words32.length * 4; i++) {\n    str += String.fromCharCode((words32[i >>> 2] >>> 8 * (3 - i & 0x3)) & 0xff);\n  }\n  return str;\n}\n\nfunction fk(index: number, b: number, c: number, d: number): [number, number] {\n  if (index < 20) {\n    return [(b & c) | (~b & d), 0x5a827999];\n  }\n\n  if (index < 40) {\n    return [b ^ c ^ d, 0x6ed9eba1];\n  }\n\n  if (index < 60) {\n    return [(b & c) | (b & d) | (c & d), 0x8f1bbcdc];\n  }\n\n  return [b ^ c ^ d, 0xca62c1d6];\n}\n\nfunction add32(a: number, b: number): number {\n  const low = (a & 0xffff) + (b & 0xffff);\n  const high = (a >> 16) + (b >> 16) + (low >> 16);\n  return (high << 16) | (low & 0xffff);\n}\n\nfunction rol32(a: number, count: number): number {\n  return (a << count) | (a >>> (32 - count));\n}\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n"]}
var G=Object.defineProperty,te=Object.defineProperties,se=Object.getOwnPropertyDescriptor,ne=Object.getOwnPropertyDescriptors,K=Object.getOwnPropertySymbols,oe=Object.prototype.hasOwnProperty,ie=Object.prototype.propertyIsEnumerable,z=(t,e,s)=>e in t?G(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,M=(t,e)=>{for(var s in e||(e={}))oe.call(e,s)&&z(t,s,e[s]);if(K)for(var s of K(e))ie.call(e,s)&&z(t,s,e[s]);return t},A=(t,e)=>te(t,ne(e)),u=(t,e,s,n)=>{for(var o=n>1?void 0:n?se(e,s):e,i=t.length-1,l;i>=0;i--)(l=t[i])&&(o=(n?l(e,s,o):l(o))||o);return n&&o&&G(e,s,o),o};import{ModuleNames as le}from"@ag-grid-community/core";import{EnterpriseCoreModule as re}from"@ag-grid-enterprise/core";import{Autowired as V,Bean as ae,Events as P,PostConstruct as ce,BeanStub as de,AutoScrollService as ge,CellCtrl as he,_ as w}from"@ag-grid-community/core";var S=class extends de{constructor(){super(...arguments),this.cellRanges=[],this.bodyScrollListener=this.onBodyScroll.bind(this),this.dragging=!1,this.intersectionRange=!1}init(){this.addManagedListener(this.eventService,P.EVENT_NEW_COLUMNS_LOADED,()=>this.onColumnsChanged()),this.addManagedListener(this.eventService,P.EVENT_COLUMN_VISIBLE,this.onColumnsChanged.bind(this)),this.addManagedListener(this.eventService,P.EVENT_COLUMN_VALUE_CHANGED,this.onColumnsChanged.bind(this)),this.addManagedListener(this.eventService,P.EVENT_COLUMN_PIVOT_MODE_CHANGED,()=>this.removeAllCellRanges()),this.addManagedListener(this.eventService,P.EVENT_COLUMN_ROW_GROUP_CHANGED,()=>this.removeAllCellRanges()),this.addManagedListener(this.eventService,P.EVENT_COLUMN_PIVOT_CHANGED,()=>this.removeAllCellRanges()),this.addManagedListener(this.eventService,P.EVENT_COLUMN_GROUP_OPENED,this.refreshLastRangeStart.bind(this)),this.addManagedListener(this.eventService,P.EVENT_COLUMN_MOVED,this.refreshLastRangeStart.bind(this)),this.addManagedListener(this.eventService,P.EVENT_COLUMN_PINNED,this.refreshLastRangeStart.bind(this)),this.ctrlsService.whenReady(t=>{const e=t.gridBodyCtrl;this.autoScrollService=new ge({scrollContainer:e.getBodyViewportElement(),scrollAxis:"xy",getVerticalPosition:()=>e.getScrollFeature().getVScrollPosition().top,setVerticalPosition:s=>e.getScrollFeature().setVerticalScrollPosition(s),getHorizontalPosition:()=>e.getScrollFeature().getHScrollPosition().left,setHorizontalPosition:s=>e.getScrollFeature().setHorizontalScrollPosition(s),shouldSkipVerticalScroll:()=>!this.gos.isDomLayout("normal"),shouldSkipHorizontalScroll:()=>!e.getScrollFeature().isHorizontalScrollShowing()})})}onColumnsChanged(){this.refreshLastRangeStart();const t=this.columnModel.getAllDisplayedColumns();this.cellRanges.forEach(s=>{const n=s.columns;s.columns=s.columns.filter(i=>i.isVisible()&&t.indexOf(i)!==-1),!w.areEqual(n,s.columns)&&this.dispatchChangedEvent(!1,!0,s.id)});const e=this.cellRanges.length;this.cellRanges=this.cellRanges.filter(s=>s.columns.length>0),e>this.cellRanges.length&&this.dispatchChangedEvent(!1,!0)}refreshLastRangeStart(){const t=w.last(this.cellRanges);t&&this.refreshRangeStart(t)}isContiguousRange(t){const e=t.columns;if(!e.length)return!1;const s=this.columnModel.getAllDisplayedColumns(),n=e.map(o=>s.indexOf(o)).sort((o,i)=>o-i);return w.last(n)-n[0]+1===e.length}getRangeStartRow(t){return t.startRow&&t.endRow?this.rowPositionUtils.before(t.startRow,t.endRow)?t.startRow:t.endRow:{rowIndex:0,rowPinned:this.pinnedRowModel.getPinnedTopRowCount()>0?"top":null}}getRangeEndRow(t){if(t.startRow&&t.endRow)return this.rowPositionUtils.before(t.startRow,t.endRow)?t.endRow:t.startRow;const e=this.pinnedRowModel.getPinnedBottomRowCount();return e>0?{rowIndex:e-1,rowPinned:"bottom"}:{rowIndex:this.rowModel.getRowCount()-1,rowPinned:null}}setRangeToCell(t,e=!1){if(!this.gos.get("enableRangeSelection"))return;const s=this.calculateColumnsBetween(t.column,t.column);if(!s)return;(this.gos.get("suppressMultiRangeSelection")||!e||w.missing(this.cellRanges))&&this.removeAllCellRanges(!0);const o={rowIndex:t.rowIndex,rowPinned:t.rowPinned},i={startRow:o,endRow:o,columns:s,startColumn:t.column};this.cellRanges.push(i),this.setNewestRangeStartCell(t),this.onDragStop(),this.dispatchChangedEvent(!0,!0)}extendLatestRangeToCell(t){if(this.isEmpty()||!this.newestRangeStartCell)return;const e=w.last(this.cellRanges);this.updateRangeEnd(e,t)}updateRangeEnd(t,e,s=!1){const n=e.column,o=this.calculateColumnsBetween(t.startColumn,n);!o||this.isLastCellOfRange(t,e)||(t.columns=o,t.endRow={rowIndex:e.rowIndex,rowPinned:e.rowPinned},s||this.dispatchChangedEvent(!0,!0,t.id))}refreshRangeStart(t){const{startColumn:e,columns:s}=t,n=(a,c)=>{const d=t.columns.filter(g=>g!==a);a?(t.startColumn=a,t.columns=c?[a,...d]:[...d,a]):t.columns=d},{left:o,right:i}=this.getRangeEdgeColumns(t);if(e===s[0]&&e!==o){n(o,!0);return}if(e===w.last(s)&&e===i){n(i,!1);return}}getRangeEdgeColumns(t){const e=this.columnModel.getAllDisplayedColumns(),s=t.columns.map(n=>e.indexOf(n)).filter(n=>n>-1).sort((n,o)=>n-o);return{left:e[s[0]],right:e[w.last(s)]}}extendLatestRangeInDirection(t){if(this.isEmpty()||!this.newestRangeStartCell)return;const e=t.key,s=t.ctrlKey||t.metaKey,n=w.last(this.cellRanges),o=this.newestRangeStartCell,i=n.columns[0],l=w.last(n.columns),r=n.endRow.rowIndex,a=n.endRow.rowPinned,d={column:o.column===i?l:i,rowIndex:r,rowPinned:a},g=this.cellNavigationService.getNextCellToFocus(e,d,s);if(g)return this.setCellRange({rowStartIndex:o.rowIndex,rowStartPinned:o.rowPinned,rowEndIndex:g.rowIndex,rowEndPinned:g.rowPinned,columnStart:o.column,columnEnd:g.column}),g}setCellRange(t){this.gos.get("enableRangeSelection")&&(this.removeAllCellRanges(!0),this.addCellRange(t))}setCellRanges(t){w.shallowCompare(this.cellRanges,t)||(this.removeAllCellRanges(!0),t.forEach(e=>{e.columns&&e.startRow&&this.setNewestRangeStartCell({rowIndex:e.startRow.rowIndex,rowPinned:e.startRow.rowPinned,column:e.columns[0]}),this.cellRanges.push(e)}),this.dispatchChangedEvent(!1,!0))}setNewestRangeStartCell(t){this.newestRangeStartCell=t}clearCellRangeCellValues(t){let{cellRanges:e}=t;const{cellEventSource:s="rangeService",dispatchWrapperEvents:n,wrapperEventSource:o="deleteKey"}=t;if(n){const i={type:P.EVENT_RANGE_DELETE_START,source:o};this.eventService.dispatchEvent(i)}if(e||(e=this.cellRanges),e.forEach(i=>{this.forEachRowInRange(i,l=>{var r;const a=this.rowPositionUtils.getRowNode(l);if(a)for(let c=0;c<i.columns.length;c++){const d=this.columnModel.getGridColumn(i.columns[c]);if(!d||!d.isCellEditable(a))continue;const g=(r=this.valueService.parseValue(d,a,"",a.getValueFromValueService(d)))!=null?r:null;a.setDataValue(d,g,s)}})}),n){const i={type:P.EVENT_RANGE_DELETE_END,source:o};this.eventService.dispatchEvent(i)}}createCellRangeFromCellRangeParams(t){return this.createPartialCellRangeFromRangeParams(t,!1)}createPartialCellRangeFromRangeParams(t,e){let s,n=!1;if(t.columns)s=t.columns.map(l=>this.columnModel.getColumnWithValidation(l)).filter(l=>l);else{const l=this.columnModel.getColumnWithValidation(t.columnStart),r=this.columnModel.getColumnWithValidation(t.columnEnd);if(!l||!r)return;s=this.calculateColumnsBetween(l,r),s&&s.length&&(n=s[0]!==l)}if(!s||!e&&s.length===0)return;const o=t.rowStartIndex!=null?{rowIndex:t.rowStartIndex,rowPinned:t.rowStartPinned||null}:void 0,i=t.rowEndIndex!=null?{rowIndex:t.rowEndIndex,rowPinned:t.rowEndPinned||null}:void 0;return{startRow:o,endRow:i,columns:s,startColumn:n?w.last(s):s[0]}}addCellRange(t){if(!this.gos.get("enableRangeSelection"))return;const e=this.createCellRangeFromCellRangeParams(t);e&&(e.startRow&&this.setNewestRangeStartCell({rowIndex:e.startRow.rowIndex,rowPinned:e.startRow.rowPinned,column:e.startColumn}),this.cellRanges.push(e),this.dispatchChangedEvent(!1,!0,e.id))}getCellRanges(){return this.cellRanges}isEmpty(){return this.cellRanges.length===0}isMoreThanOneCell(){const t=this.cellRanges.length;if(t===0)return!1;if(t>1)return!0;const e=this.cellRanges[0],s=this.getRangeStartRow(e),n=this.getRangeEndRow(e);return s.rowPinned!==n.rowPinned||s.rowIndex!==n.rowIndex||e.columns.length!==1}areAllRangesAbleToMerge(){const t=new Map;if(this.cellRanges.length<=1)return!0;this.cellRanges.forEach(n=>{this.forEachRowInRange(n,o=>{const i=`${o.rowPinned||"normal"}_${o.rowIndex}`,l=t.get(i),r=n.columns.map(a=>a.getId());if(l){const a=r.filter(c=>l.indexOf(c)===-1);l.push(...a)}else t.set(i,r)})});let s;for(const n of t.values()){const o=n.sort().join();if(s===void 0){s=o;continue}if(s!==o)return!1}return!0}forEachRowInRange(t,e){const s=this.getRangeStartRow(t),n=this.getRangeEndRow(t);let o=s;for(;o&&(e(o),!this.rowPositionUtils.sameRow(o,n));)o=this.cellNavigationService.getRowBelow(o)}removeAllCellRanges(t){this.isEmpty()||(this.onDragStop(),this.cellRanges.length=0,t||this.dispatchChangedEvent(!1,!0))}onBodyScroll(){this.dragging&&this.lastMouseEvent&&this.onDragging(this.lastMouseEvent)}isCellInAnyRange(t){return this.getCellRangeCount(t)>0}isCellInSpecificRange(t,e){const s=e.columns!==null&&w.includes(e.columns,t.column),n=this.isRowInRange(t.rowIndex,t.rowPinned,e);return s&&n}isLastCellOfRange(t,e){const{startRow:s,endRow:n}=t,o=this.rowPositionUtils.before(s,n)?n:s,i=e.rowIndex===o.rowIndex&&e.rowPinned===o.rowPinned,l=t.columns[0],r=w.last(t.columns),a=t.startColumn===l?r:l;return e.column===a&&i}isBottomRightCell(t,e){const s=this.columnModel.getAllDisplayedColumns(),n=t.columns.map(c=>s.indexOf(c)).sort((c,d)=>c-d),{startRow:o,endRow:i}=t,l=this.rowPositionUtils.before(o,i)?i:o,r=s.indexOf(e.column)===w.last(n),a=e.rowIndex===l.rowIndex&&w.makeNull(e.rowPinned)===w.makeNull(l.rowPinned);return r&&a}getCellRangeCount(t){return this.isEmpty()?0:this.cellRanges.filter(e=>this.isCellInSpecificRange(t,e)).length}isRowInRange(t,e,s){const n=this.getRangeStartRow(s),o=this.getRangeEndRow(s),i={rowIndex:t,rowPinned:e||null},l=i.rowIndex===n.rowIndex&&i.rowPinned==n.rowPinned,r=i.rowIndex===o.rowIndex&&i.rowPinned==o.rowPinned;if(l||r)return!0;const a=!this.rowPositionUtils.before(i,n),c=this.rowPositionUtils.before(i,o);return a&&c}getDraggingRange(){return this.draggingRange}onDragStart(t){if(!this.gos.get("enableRangeSelection"))return;const{ctrlKey:e,metaKey:s,shiftKey:n}=t,o=e||s,l=!this.gos.get("suppressMultiRangeSelection")?o:!1,r=n&&w.existsAndNotEmpty(this.cellRanges);!l&&(!r||w.exists(w.last(this.cellRanges).type))&&this.removeAllCellRanges(!0);const a=this.dragService.getStartTarget();if(a&&this.updateValuesOnMove(a),!!this.lastCellHovered){if(this.dragging=!0,this.lastMouseEvent=t,this.intersectionRange=l&&this.getCellRangeCount(this.lastCellHovered)>1,r||this.setNewestRangeStartCell(this.lastCellHovered),this.cellRanges.length>0)this.draggingRange=w.last(this.cellRanges);else{const c={rowIndex:this.lastCellHovered.rowIndex,rowPinned:this.lastCellHovered.rowPinned};this.draggingRange={startRow:c,endRow:c,columns:[this.lastCellHovered.column],startColumn:this.newestRangeStartCell.column},this.cellRanges.push(this.draggingRange)}this.ctrlsService.getGridBodyCtrl().addScrollEventListener(this.bodyScrollListener),this.dispatchChangedEvent(!0,!1,this.draggingRange.id)}}intersectLastRange(t){if(t&&this.dragging||this.gos.get("suppressMultiRangeSelection")||this.isEmpty())return;const e=this.rowPositionUtils,s=w.last(this.cellRanges),n=this.getRangeStartRow(s),o=this.getRangeEndRow(s),i=[];this.cellRanges.slice(0,-1).forEach(l=>{const r=this.getRangeStartRow(l),a=this.getRangeEndRow(l),c=l.columns,d=c.filter(h=>s.columns.indexOf(h)===-1);if(d.length===c.length){i.push(l);return}if(e.before(o,r)||e.before(a,n)){i.push(l);return}const g=i.length;if(e.before(r,n)){const h={columns:[...c],startColumn:s.startColumn,startRow:M({},r),endRow:this.cellNavigationService.getRowAbove(n)};i.push(h)}if(d.length>0){const h={columns:d,startColumn:w.includes(d,s.startColumn)?s.startColumn:d[0],startRow:this.rowMax([M({},n),M({},r)]),endRow:this.rowMin([M({},o),M({},a)])};i.push(h)}e.before(o,a)&&i.push({columns:[...c],startColumn:s.startColumn,startRow:this.cellNavigationService.getRowBelow(o),endRow:M({},a)}),i.length-g===1&&(i[i.length-1].id=l.id)}),this.cellRanges=i,t&&this.dispatchChangedEvent(!1,!0)}rowMax(t){let e;return t.forEach(s=>{(e===void 0||this.rowPositionUtils.before(e,s))&&(e=s)}),e}rowMin(t){let e;return t.forEach(s=>{(e===void 0||this.rowPositionUtils.before(s,e))&&(e=s)}),e}updateValuesOnMove(t){const e=w.getCtrlForEventTarget(this.gos,t,he.DOM_DATA_KEY_CELL_CTRL),s=e?.getCellPosition();this.cellHasChanged=!1,!(!s||this.lastCellHovered&&this.cellPositionUtils.equals(s,this.lastCellHovered))&&(this.lastCellHovered&&(this.cellHasChanged=!0),this.lastCellHovered=s)}onDragging(t){if(!this.dragging||!t)return;this.updateValuesOnMove(t.target),this.lastMouseEvent=t;const e=this.lastCellHovered,s=i=>e&&e.rowPinned===i&&this.newestRangeStartCell.rowPinned===i,n=s("top")||s("bottom");if(this.autoScrollService.check(t,n),!this.cellHasChanged)return;const o=this.calculateColumnsBetween(this.newestRangeStartCell.column,e.column);o&&(this.draggingRange.endRow={rowIndex:e.rowIndex,rowPinned:e.rowPinned},this.draggingRange.columns=o,this.dispatchChangedEvent(!1,!1,this.draggingRange.id))}onDragStop(){if(!this.dragging)return;const{id:t}=this.draggingRange;this.autoScrollService.ensureCleared(),this.ctrlsService.getGridBodyCtrl().removeScrollEventListener(this.bodyScrollListener),this.lastMouseEvent=null,this.dragging=!1,this.draggingRange=void 0,this.lastCellHovered=void 0,this.intersectionRange&&(this.intersectionRange=!1,this.intersectLastRange()),this.dispatchChangedEvent(!1,!0,t)}dispatchChangedEvent(t,e,s){const n={type:P.EVENT_RANGE_SELECTION_CHANGED,started:t,finished:e,id:s};this.eventService.dispatchEvent(n)}calculateColumnsBetween(t,e){const s=this.columnModel.getAllDisplayedColumns(),n=t===e,o=s.indexOf(t);if(o<0){console.warn(`AG Grid: column ${t.getId()} is not visible`);return}const i=n?o:s.indexOf(e);if(i<0){console.warn(`AG Grid: column ${e.getId()} is not visible`);return}if(n)return[t];const l=Math.min(o,i),r=l===o?i:o,a=[];for(let c=l;c<=r;c++)a.push(s[c]);return a}};u([V("rowModel")],S.prototype,"rowModel",2),u([V("dragService")],S.prototype,"dragService",2),u([V("columnModel")],S.prototype,"columnModel",2),u([V("cellNavigationService")],S.prototype,"cellNavigationService",2),u([V("pinnedRowModel")],S.prototype,"pinnedRowModel",2),u([V("rowPositionUtils")],S.prototype,"rowPositionUtils",2),u([V("cellPositionUtils")],S.prototype,"cellPositionUtils",2),u([V("ctrlsService")],S.prototype,"ctrlsService",2),u([V("valueService")],S.prototype,"valueService",2),u([ce],S.prototype,"init",1),S=u([ae("rangeService")],S);import{Autowired as ue,Events as X,SelectionHandleType as we,_ as O}from"@ag-grid-community/core";import{Autowired as I,Component as Re,PostConstruct as fe,_ as H,SelectionHandleType as me}from"@ag-grid-community/core";var E=class extends Re{constructor(){super(...arguments),this.changedCalculatedValues=!1,this.dragging=!1,this.shouldDestroyOnEndDragging=!1}init(){this.dragService.addDragSource({dragStartPixels:0,eElement:this.getGui(),onDragStart:this.onDragStart.bind(this),onDragging:t=>{this.dragging=!0,this.rangeService.autoScrollService.check(t),this.changedCalculatedValues&&(this.onDrag(t),this.changedCalculatedValues=!1)},onDragStop:t=>{this.dragging=!1,this.onDragEnd(t),this.clearValues(),this.rangeService.autoScrollService.ensureCleared(),document.body.classList.remove(this.getDraggingCssClass()),this.shouldDestroyOnEndDragging&&this.destroy()}}),this.addManagedListener(this.getGui(),"mousedown",this.preventRangeExtension.bind(this))}isDragging(){return this.dragging}getCellCtrl(){return this.cellCtrl}setCellCtrl(t){this.cellCtrl=t}getCellRange(){return this.cellRange}setCellRange(t){this.cellRange=t}getRangeStartRow(){return this.rangeStartRow}setRangeStartRow(t){this.rangeStartRow=t}getRangeEndRow(){return this.rangeEndRow}setRangeEndRow(t){this.rangeEndRow=t}getLastCellHovered(){return this.lastCellHovered}preventRangeExtension(t){t.stopPropagation()}onDragStart(t){this.cellHoverListener=this.addManagedListener(this.ctrlsService.get("gridCtrl").getGui(),"mousemove",this.updateValuesOnMove.bind(this)),document.body.classList.add(this.getDraggingCssClass())}getDraggingCssClass(){return`ag-dragging-${this.type===me.FILL?"fill":"range"}-handle`}updateValuesOnMove(t){const e=this.mouseEventService.getCellPositionForEvent(t);!e||this.lastCellHovered&&this.cellPositionUtils.equals(e,this.lastCellHovered)||(this.lastCellHovered=e,this.changedCalculatedValues=!0)}getType(){return this.type}refresh(t){const e=this.getCellCtrl(),s=this.getGui(),n=H.last(this.rangeService.getCellRanges()),o=n.startRow,i=n.endRow;if(o&&i&&(this.rowPositionUtils.before(i,o)?(this.setRangeStartRow(i),this.setRangeEndRow(o)):(this.setRangeStartRow(o),this.setRangeEndRow(i))),e!==t||!H.isVisible(s)){this.setCellCtrl(t);const l=t.getComp().getParentOfValue();l&&l.appendChild(s)}this.setCellRange(n)}clearValues(){this.lastCellHovered=void 0,this.removeListeners()}removeListeners(){this.cellHoverListener&&(this.cellHoverListener(),this.cellHoverListener=void 0)}destroy(){if(!this.shouldDestroyOnEndDragging&&this.isDragging()){H.setDisplayed(this.getGui(),!1),this.shouldDestroyOnEndDragging=!0;return}this.shouldDestroyOnEndDragging=!1,super.destroy(),this.removeListeners();const t=this.getGui();t.parentElement&&t.parentElement.removeChild(t)}};u([I("rowRenderer")],E.prototype,"rowRenderer",2),u([I("dragService")],E.prototype,"dragService",2),u([I("rangeService")],E.prototype,"rangeService",2),u([I("mouseEventService")],E.prototype,"mouseEventService",2),u([I("columnModel")],E.prototype,"columnModel",2),u([I("cellNavigationService")],E.prototype,"cellNavigationService",2),u([I("navigationService")],E.prototype,"navigationService",2),u([I("rowPositionUtils")],E.prototype,"rowPositionUtils",2),u([I("cellPositionUtils")],E.prototype,"cellPositionUtils",2),u([I("ctrlsService")],E.prototype,"ctrlsService",2),u([fe],E.prototype,"init",1);function Ce(t){const e=t.length;let s=0;if(e<=1)return t;for(let g=0;g<t.length;g++){const h=t[g],C=h.toString().split("e-");if(C.length>1){s=Math.max(s,parseInt(C[1],10));continue}Math.floor(h)!==h&&(s=Math.max(s,h.toString().split(".")[1].length))}let n=0,o=0,i=0,l=0,r=0;for(let g=0;g<e;g++)r=t[g],n+=g,o+=r,l+=g*g,i+=g*r;const a=(e*i-n*o)/(e*l-n*n),c=o/e-a*n/e,d=[];for(let g=0;g<=e;g++)d.push(parseFloat((g*a+c).toFixed(s)));return d}var U=class J extends E{constructor(){super(J.TEMPLATE),this.markedCells=[],this.cellValues=[],this.isUp=!1,this.isLeft=!1,this.isReduce=!1,this.type=we.FILL}updateValuesOnMove(e){super.updateValuesOnMove(e),this.initialXY||(this.initialXY=this.mouseEventService.getNormalisedPosition(e));const{x:s,y:n}=this.initialXY,{x:o,y:i}=this.mouseEventService.getNormalisedPosition(e),l=Math.abs(s-o),r=Math.abs(n-i),a=this.getFillHandleDirection();let c;a==="xy"?c=l>r?"x":"y":c=a,c!==this.dragAxis&&(this.dragAxis=c,this.changedCalculatedValues=!0)}onDrag(e){if(!this.initialPosition){const n=this.getCellCtrl();if(!n)return;this.initialPosition=n.getCellPosition()}const s=this.getLastCellHovered();s&&this.markPathFrom(this.initialPosition,s)}onDragEnd(e){if(this.initialXY=null,!this.markedCells.length)return;const s=this.dragAxis==="x",n=this.getCellRange(),o=n.columns.length,i=this.getRangeStartRow(),l=this.getRangeEndRow();let r;if(!this.isUp&&!this.isLeft)r=this.rangeService.createCellRangeFromCellRangeParams({rowStartIndex:i.rowIndex,rowStartPinned:i.rowPinned,columnStart:n.columns[0],rowEndIndex:s?l.rowIndex:this.lastCellMarked.rowIndex,rowEndPinned:s?l.rowPinned:this.lastCellMarked.rowPinned,columnEnd:s?this.lastCellMarked.column:n.columns[o-1]});else{const a=s?i:this.lastCellMarked;r=this.rangeService.createCellRangeFromCellRangeParams({rowStartIndex:a.rowIndex,rowStartPinned:a.rowPinned,columnStart:s?this.lastCellMarked.column:n.columns[0],rowEndIndex:l.rowIndex,rowEndPinned:l.rowPinned,columnEnd:n.columns[o-1]})}r&&(this.raiseFillStartEvent(),this.handleValueChanged(n,r,e),this.rangeService.setCellRanges([r]),this.raiseFillEndEvent(n,r))}getFillHandleDirection(){const e=this.gos.get("fillHandleDirection");return e?e!=="x"&&e!=="y"&&e!=="xy"?(O.warnOnce("valid values for fillHandleDirection are 'x', 'y' and 'xy'. Default to 'xy'."),"xy"):e:"xy"}raiseFillStartEvent(){const e={type:X.EVENT_FILL_START};this.eventService.dispatchEvent(e)}raiseFillEndEvent(e,s){const n={type:X.EVENT_FILL_END,initialRange:e,finalRange:s};this.eventService.dispatchEvent(n)}handleValueChanged(e,s,n){const o=this.rangeService.getRangeEndRow(e),i=this.rangeService.getRangeStartRow(e),l=this.rangeService.getRangeEndRow(s),r=this.rangeService.getRangeStartRow(s),a=this.dragAxis==="y";if(this.isReduce&&!this.gos.get("suppressClearOnFillReduction")){const x=a?e.columns:e.columns.filter(f=>s.columns.indexOf(f)<0),v=a?this.cellNavigationService.getRowBelow(l):r;v&&this.clearCellsInRange(v,o,x);return}const c=[],d=[],g=[],h=[];let C=!0,m=0;const R=()=>{c.length=0,d.length=0,g.length=0,h.length=0,m=0},y=(x,v)=>{let f=this.isUp?o:i,D=!1;for(a&&(C=!0,R());!D&&f;){const L=this.rowPositionUtils.getRowNode(f);if(!L)break;a&&x?_(c,x,L,()=>!this.rowPositionUtils.sameRow(f,this.isUp?i:o)):v&&(C=!0,R(),v.forEach(N=>_(c,N,L,()=>N!==(this.isLeft?e.columns[0]:O.last(e.columns))))),D=this.rowPositionUtils.sameRow(f,this.isUp?r:l),f=this.isUp?this.cellNavigationService.getRowAbove(f):this.cellNavigationService.getRowBelow(f)}},_=(x,v,f,D)=>{var L,N;let p,T=!1;if(C)p=this.valueService.getValue(v,f),d.push(p),g.push(this.valueService.getValue(v,f,void 0,!0)),h.push(this.valueService.formatValue(v,f,p)),C=D();else{const{value:Z,fromUserFunction:B,sourceCol:b,sourceRowNode:ee}=this.processValues({event:n,values:x,initialValues:d,initialNonAggregatedValues:g,initialFormattedValues:h,col:v,rowNode:f,idx:m++});if(p=Z,v.isCellEditable(f)){const k=this.valueService.getValue(v,f);B||(b&&((L=b.getColDef())==null?void 0:L.useValueFormatterForExport)!==!1&&(p=(N=this.valueService.formatValue(b,ee,p))!=null?N:p),v.getColDef().useValueParserForImport!==!1&&(p=this.valueService.parseValue(v,f,b?p:O.toStringOrNull(p),k))),!B||k!==p?f.setDataValue(v,p,"rangeService"):T=!0}}T||x.push({value:p,column:v,rowNode:f})};if(a)e.columns.forEach(x=>{y(x)});else{const x=this.isLeft?[...s.columns].reverse():s.columns;y(void 0,x)}}clearCellsInRange(e,s,n){const o={startRow:e,endRow:s,columns:n,startColumn:n[0]};this.rangeService.clearCellRangeCellValues({cellRanges:[o]})}processValues(e){const{event:s,values:n,initialValues:o,initialNonAggregatedValues:i,initialFormattedValues:l,col:r,rowNode:a,idx:c}=e,d=this.gos.getCallback("fillOperation"),g=this.dragAxis==="y";let h;if(g?h=this.isUp?"up":"down":h=this.isLeft?"left":"right",d){const m={event:s,values:n.map(({value:y})=>y),initialValues:o,initialNonAggregatedValues:i,initialFormattedValues:l,currentIndex:c,currentCellValue:this.valueService.getValue(r,a),direction:h,column:r,rowNode:a},R=d(m);if(R!==!1)return{value:R,fromUserFunction:!0}}const C=!n.some(({value:m})=>{const R=parseFloat(m);return isNaN(R)||R.toString()!==m.toString()});if(s.altKey||!C){if(C&&o.length===1){const _=this.isUp||this.isLeft?-1:1;return{value:parseFloat(O.last(n).value)+1*_,fromUserFunction:!1}}const{value:m,column:R,rowNode:y}=n[c%n.length];return{value:m,fromUserFunction:!1,sourceCol:R,sourceRowNode:y}}return{value:O.last(Ce(n.map(({value:m})=>Number(m)))),fromUserFunction:!1}}clearValues(){this.clearMarkedPath(),this.clearCellValues(),this.lastCellMarked=void 0,super.clearValues()}clearMarkedPath(){this.markedCells.forEach(e=>{if(!e.isAlive())return;const s=e.getComp();s.addOrRemoveCssClass("ag-selection-fill-top",!1),s.addOrRemoveCssClass("ag-selection-fill-right",!1),s.addOrRemoveCssClass("ag-selection-fill-bottom",!1),s.addOrRemoveCssClass("ag-selection-fill-left",!1)}),this.markedCells.length=0,this.isUp=!1,this.isLeft=!1,this.isReduce=!1}clearCellValues(){this.cellValues.length=0}markPathFrom(e,s){if(this.clearMarkedPath(),this.clearCellValues(),this.dragAxis==="y"){if(this.rowPositionUtils.sameRow(s,e))return;const n=this.rowPositionUtils.before(s,e),o=this.getRangeStartRow(),i=this.getRangeEndRow();n&&(s.rowPinned==o.rowPinned&&s.rowIndex>=o.rowIndex||o.rowPinned!=i.rowPinned&&s.rowPinned==i.rowPinned&&s.rowIndex<=i.rowIndex)?(this.reduceVertical(e,s),this.isReduce=!0):(this.extendVertical(e,s,n),this.isReduce=!1)}else{const n=e.column,o=s.column;if(n===o)return;const i=this.columnModel.getAllDisplayedColumns(),l=i.indexOf(n),r=i.indexOf(o);r<=l&&r>=i.indexOf(this.getCellRange().columns[0])?(this.reduceHorizontal(e,s),this.isReduce=!0):(this.extendHorizontal(e,s,r<l),this.isReduce=!1)}this.lastCellMarked=s}extendVertical(e,s,n){const{navigationService:o,rangeService:i}=this;let l=e;do{const r=this.getCellRange(),a=r.columns.length;for(let c=0;c<a;c++){const d=r.columns[c],g={rowIndex:l.rowIndex,rowPinned:l.rowPinned},h=A(M({},g),{column:d}),C=i.isCellInSpecificRange(h,r),m=this.rowPositionUtils.sameRow(l,e);if(n&&(this.isUp=!0),!m){const R=o.getCellByPosition(h);if(R){this.markedCells.push(R);const y=R.getComp();C||(y.addOrRemoveCssClass("ag-selection-fill-left",c===0),y.addOrRemoveCssClass("ag-selection-fill-right",c===a-1)),y.addOrRemoveCssClass(n?"ag-selection-fill-top":"ag-selection-fill-bottom",this.rowPositionUtils.sameRow(l,s))}}}if(this.rowPositionUtils.sameRow(l,s))break}while(l=n?this.cellNavigationService.getRowAbove(l):this.cellNavigationService.getRowBelow(l))}reduceVertical(e,s){let n=e;do{const o=this.getCellRange(),i=o.columns.length,l=this.rowPositionUtils.sameRow(n,s);for(let r=0;r<i;r++){const a={rowIndex:n.rowIndex,rowPinned:n.rowPinned},c=A(M({},a),{column:o.columns[r]}),d=this.navigationService.getCellByPosition(c);d&&(this.markedCells.push(d),d.getComp().addOrRemoveCssClass("ag-selection-fill-bottom",this.rowPositionUtils.sameRow(n,s)))}if(l)break}while(n=this.cellNavigationService.getRowAbove(n))}extendHorizontal(e,s,n){const o=this.columnModel.getAllDisplayedColumns(),i=o.indexOf(n?s.column:e.column),l=o.indexOf(n?this.getCellRange().columns[0]:s.column),r=n?0:1,a=o.slice(i+r,l+r),c=this.getRangeStartRow(),d=this.getRangeEndRow();a.forEach(g=>{let h=c,C=!1;do{C=this.rowPositionUtils.sameRow(h,d);const m=this.navigationService.getCellByPosition({rowIndex:h.rowIndex,rowPinned:h.rowPinned,column:g});if(m){this.markedCells.push(m);const R=m.getComp();R.addOrRemoveCssClass("ag-selection-fill-top",this.rowPositionUtils.sameRow(h,c)),R.addOrRemoveCssClass("ag-selection-fill-bottom",this.rowPositionUtils.sameRow(h,d)),n?(this.isLeft=!0,R.addOrRemoveCssClass("ag-selection-fill-left",g===a[0])):R.addOrRemoveCssClass("ag-selection-fill-right",g===O.last(a))}h=this.cellNavigationService.getRowBelow(h)}while(!C)})}reduceHorizontal(e,s){const n=this.columnModel.getAllDisplayedColumns(),o=n.indexOf(s.column),i=n.indexOf(e.column),l=n.slice(o,i),r=this.getRangeStartRow(),a=this.getRangeEndRow();l.forEach(c=>{let d=r,g=!1;do{g=this.rowPositionUtils.sameRow(d,a);const h=this.navigationService.getCellByPosition({rowIndex:d.rowIndex,rowPinned:d.rowPinned,column:c});h&&(this.markedCells.push(h),h.getComp().addOrRemoveCssClass("ag-selection-fill-right",c===l[0])),d=this.cellNavigationService.getRowBelow(d)}while(!g)})}refresh(e){const s=this.rangeService.getCellRanges()[0];if(!s.startRow||!s.endRow){this.destroy();return}super.refresh(e)}};U.TEMPLATE='<div class="ag-fill-handle"></div>',u([ue("valueService")],U.prototype,"valueService",2);var Y=U;import{CellRangeType as j,SelectionHandleType as ve,_ as q}from"@ag-grid-community/core";var W=class Q extends E{constructor(){super(Q.TEMPLATE),this.type=ve.RANGE,this.rangeFixed=!1}onDrag(e){const s=this.getLastCellHovered();if(!s)return;const n=this.rangeService.getCellRanges(),o=q.last(n);this.rangeFixed||(this.fixRangeStartEnd(o),this.rangeFixed=!0),this.endPosition={rowIndex:s.rowIndex,rowPinned:s.rowPinned,column:s.column},n.length===2&&n[0].type===j.DIMENSION&&o.type===j.VALUE&&!this.rowPositionUtils.sameRow(this.endPosition,this.rangeService.getRangeEndRow(o))&&this.rangeService.updateRangeEnd(n[0],A(M({},this.endPosition),{column:n[0].columns[0]}),!0),this.rangeService.extendLatestRangeToCell(this.endPosition)}onDragEnd(e){const s=q.last(this.rangeService.getCellRanges());this.fixRangeStartEnd(s),this.rangeFixed=!1}fixRangeStartEnd(e){const s=this.rangeService.getRangeStartRow(e),n=this.rangeService.getRangeEndRow(e),o=e.columns[0];e.startRow=s,e.endRow=n,e.startColumn=o}};W.TEMPLATE='<div class="ag-range-handle"></div>';var $=W;import{Bean as pe,BeanStub as Se,SelectionHandleType as Ee}from"@ag-grid-community/core";var F=class extends Se{createSelectionHandle(t){return this.createBean(t===Ee.RANGE?new $:new Y)}};F=u([pe("selectionHandleFactory")],F);var Pe="31.3.4",xe={version:Pe,moduleName:le.RangeSelectionModule,beans:[S,F],agStackComponents:[{componentName:"AgFillHandle",componentClass:Y},{componentName:"AgRangeHandle",componentClass:$}],dependantModules:[re]};export{xe as RangeSelectionModule};

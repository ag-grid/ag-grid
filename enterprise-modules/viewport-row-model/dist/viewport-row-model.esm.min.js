/**
          * @ag-grid-enterprise/viewport-row-model - Advanced Data Grid / Data Table supporting Javascript / Typescript / React / Angular / Vue * @version v27.3.0
          * @link https://www.ag-grid.com/
          * @license Commercial
          */
/**
          * @ag-grid-enterprise/viewport-row-model - Advanced Data Grid / Data Table supporting Javascript / Typescript / React / Angular / Vue * @version v27.3.0
          * @link https://www.ag-grid.com/
          * @license Commercial
          */
import{Events as t,Constants as o,_ as e,RowNode as r,Autowired as i,PostConstruct as n,PreDestroy as s,Bean as p,BeanStub as a,ModuleNames as w}from"@ag-grid-community/core";import{EnterpriseCoreModule as u}from"@ag-grid-enterprise/core";var h,c=(h=function(t,o){return(h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var e in o)o.hasOwnProperty(e)&&(t[e]=o[e])})(t,o)},function(t,o){function e(){this.constructor=t}h(t,o),t.prototype=null===o?Object.create(o):(e.prototype=o.prototype,new e)}),d=function(t,o,e,r){var i,n=arguments.length,s=n<3?o:null===r?r=Object.getOwnPropertyDescriptor(o,e):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,o,e,r);else for(var p=t.length-1;p>=0;p--)(i=t[p])&&(s=(n<3?i(s):n>3?i(o,e,s):i(o,e))||s);return n>3&&s&&Object.defineProperty(o,e,s),s},f=function(a){function w(){var t=null!==a&&a.apply(this,arguments)||this;return t.firstRow=-1,t.lastRow=-1,t.rowCount=-1,t.rowNodesByIndex={},t}return c(w,a),w.prototype.ensureRowHeightsValid=function(t,o,e,r){return!1},w.prototype.init=function(){this.rowHeight=this.gridOptionsWrapper.getRowHeightAsNumber(),this.addManagedListener(this.eventService,t.EVENT_VIEWPORT_CHANGED,this.onViewportChanged.bind(this))},w.prototype.start=function(){this.gridOptionsWrapper.getViewportDatasource()&&this.setViewportDatasource(this.gridOptionsWrapper.getViewportDatasource())},w.prototype.isLastRowIndexKnown=function(){return!0},w.prototype.destroyDatasource=function(){this.viewportDatasource&&(this.viewportDatasource.destroy&&this.viewportDatasource.destroy(),this.rowRenderer.datasourceChanged(),this.firstRow=-1,this.lastRow=-1)},w.prototype.calculateFirstRow=function(t){var o=this.gridOptionsWrapper.getViewportRowModelBufferSize(),e=this.gridOptionsWrapper.getViewportRowModelPageSize(),r=t-o;return r<0?0:Math.floor(r/e)*e},w.prototype.calculateLastRow=function(t){if(-1===t)return t;var o=this.gridOptionsWrapper.getViewportRowModelBufferSize(),e=this.gridOptionsWrapper.getViewportRowModelPageSize(),r=t+o,i=Math.ceil(r/e)*e,n=this.rowCount-1;return Math.min(i,n)},w.prototype.onViewportChanged=function(t){var o=this.calculateFirstRow(t.firstRow),e=this.calculateLastRow(t.lastRow);this.firstRow===o&&this.lastRow===e||(this.firstRow=o,this.lastRow=e,this.purgeRowsNotInViewport(),this.viewportDatasource&&this.viewportDatasource.setViewportRange(this.firstRow,this.lastRow))},w.prototype.purgeRowsNotInViewport=function(){var t=this;Object.keys(this.rowNodesByIndex).forEach((function(o){var e=parseInt(o,10);(e<t.firstRow||e>t.lastRow)&&delete t.rowNodesByIndex[e]}))},w.prototype.setViewportDatasource=function(t){this.destroyDatasource(),this.viewportDatasource=t,this.rowCount=0,t.init?t.init({setRowCount:this.setRowCount.bind(this),setRowData:this.setRowData.bind(this),getRow:this.getRow.bind(this)}):console.warn("AG Grid: viewport is missing init method.")},w.prototype.getType=function(){return o.ROW_MODEL_TYPE_VIEWPORT},w.prototype.getRow=function(t){return this.rowNodesByIndex[t]||(this.rowNodesByIndex[t]=this.createBlankRowNode(t)),this.rowNodesByIndex[t]},w.prototype.getRowNode=function(t){var o;return this.forEachNode((function(e){e.id===t&&(o=e)})),o},w.prototype.getRowCount=function(){return this.rowCount},w.prototype.getRowIndexAtPixel=function(t){return 0!==this.rowHeight?Math.floor(t/this.rowHeight):0},w.prototype.getRowBounds=function(t){return{rowHeight:this.rowHeight,rowTop:this.rowHeight*t}},w.prototype.getTopLevelRowCount=function(){return this.getRowCount()},w.prototype.getTopLevelRowDisplayedIndex=function(t){return t},w.prototype.isEmpty=function(){return this.rowCount>0},w.prototype.isRowsToRender=function(){return this.rowCount>0},w.prototype.getNodesInRangeForSelection=function(t,o){var r=e.missing(t)?0:t.rowIndex,i=o.rowIndex,n=r<this.firstRow||r>this.lastRow,s=i<this.firstRow||i>this.lastRow;if(n||s)return[];for(var p=[],a=r<=i?i:r,w=r<=i?r:i;w<=a;w++)p.push(this.rowNodesByIndex[w]);return p},w.prototype.forEachNode=function(t){var o=this,e=0;Object.keys(this.rowNodesByIndex).forEach((function(r){var i=parseInt(r,10),n=o.rowNodesByIndex[i];t(n,e),e++}))},w.prototype.setRowData=function(t){var o=this;e.iterateObject(t,(function(t,r){var i=parseInt(t,10);if(i>=o.firstRow&&i<=o.lastRow){var n=o.rowNodesByIndex[i];e.missing(n)&&(n=o.createBlankRowNode(i),o.rowNodesByIndex[i]=n),n.setDataAndId(r,i.toString())}}))},w.prototype.createBlankRowNode=function(t){var o=new r(this.beans);return o.setRowHeight(this.rowHeight),o.setRowTop(this.rowHeight*t),o.setRowIndex(t),o},w.prototype.setRowCount=function(o,e){if(void 0===e&&(e=!1),o!==this.rowCount){this.rowCount=o;var r={type:t.EVENT_MODEL_UPDATED,api:this.gridApi,columnApi:this.columnApi,newData:!1,newPage:!1,keepRenderedRows:e,animate:!1};this.eventService.dispatchEvent(r)}},w.prototype.isRowPresent=function(t){return!1},d([i("gridApi")],w.prototype,"gridApi",void 0),d([i("columnApi")],w.prototype,"columnApi",void 0),d([i("rowRenderer")],w.prototype,"rowRenderer",void 0),d([i("beans")],w.prototype,"beans",void 0),d([n],w.prototype,"init",null),d([s],w.prototype,"destroyDatasource",null),w=d([p("rowModel")],w)}(a),R={moduleName:w.ViewportRowModelModule,rowModels:{viewport:f},dependantModules:[u]};export{R as ViewportRowModelModule};
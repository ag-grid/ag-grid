var K=Object.defineProperty,Ee=Object.getOwnPropertyDescriptor,z=Object.getOwnPropertySymbols,ye=Object.prototype.hasOwnProperty,Pe=Object.prototype.propertyIsEnumerable,j=(o,e,t)=>e in o?K(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,X=(o,e)=>{for(var t in e||(e={}))ye.call(e,t)&&j(o,t,e[t]);if(z)for(var t of z(e))Pe.call(e,t)&&j(o,t,e[t]);return o},a=(o,e,t,s)=>{for(var i=s>1?void 0:s?Ee(e,t):e,n=o.length-1,r;n>=0;n--)(r=o[n])&&(i=(s?r(e,t,i):r(i))||i);return s&&i&&K(e,t,i),i};import{ModuleNames as Se}from"@ag-grid-community/core";import{EnterpriseCoreModule as Le}from"@ag-grid-enterprise/core";import{_ as m,Autowired as Ae,Events as Me,RefSelector as O,KeyCode as Y,PostConstruct as De,Component as be}from"@ag-grid-community/core";var g=class _ extends be{constructor(){super(_.TEMPLATE)}postConstruct(){this.createExpandIcons(),this.addManagedListener(this.eExpand,"click",this.onExpandClicked.bind(this)),this.addManagedListener(this.eExpand,"keydown",t=>{t.key===Y.SPACE&&(t.preventDefault(),this.onExpandClicked())}),this.addManagedListener(this.eSelect.getInputElement(),"click",this.onSelectClicked.bind(this)),this.addManagedPropertyListener("functionsReadOnly",()=>this.onFunctionsReadOnlyPropChanged()),this.eFilterTextField.setAutoComplete(!1).onValueChange(()=>this.onFilterTextChanged()),this.addManagedListener(this.eFilterTextField.getInputElement(),"keydown",this.onMiniFilterKeyDown.bind(this)),this.addManagedListener(this.eventService,Me.EVENT_NEW_COLUMNS_LOADED,this.showOrHideOptions.bind(this));const e=this.localeService.getLocaleTextFunc();this.eSelect.setInputAriaLabel(e("ariaColumnSelectAll","Toggle Select All Columns")),this.eFilterTextField.setInputAriaLabel(e("ariaFilterColumnsInput","Filter Columns Input")),this.activateTabIndex([this.eExpand])}onFunctionsReadOnlyPropChanged(){const e=this.gos.get("functionsReadOnly");this.eSelect.setReadOnly(e),this.eSelect.addOrRemoveCssClass("ag-column-select-column-readonly",e)}init(e){this.params=e;const t=this.gos.get("functionsReadOnly");this.eSelect.setReadOnly(t),this.eSelect.addOrRemoveCssClass("ag-column-select-column-readonly",t),this.columnModel.isReady()&&this.showOrHideOptions()}createExpandIcons(){this.eExpand.appendChild(this.eExpandChecked=m.createIconNoSpan("columnSelectOpen",this.gos)),this.eExpand.appendChild(this.eExpandUnchecked=m.createIconNoSpan("columnSelectClosed",this.gos)),this.eExpand.appendChild(this.eExpandIndeterminate=m.createIconNoSpan("columnSelectIndeterminate",this.gos)),this.setExpandState(0)}showOrHideOptions(){const e=!this.params.suppressColumnFilter,t=!this.params.suppressColumnSelectAll,s=!this.params.suppressColumnExpandAll,i=this.columnModel.isPrimaryColumnGroupsPresent(),n=this.localeService.getLocaleTextFunc();this.eFilterTextField.setInputPlaceholder(n("searchOoo","Search...")),m.setDisplayed(this.eFilterTextField.getGui(),e),m.setDisplayed(this.eSelect.getGui(),t),m.setDisplayed(this.eExpand,s&&i)}onFilterTextChanged(){this.onFilterTextChangedDebounced||(this.onFilterTextChangedDebounced=m.debounce(()=>{const e=this.eFilterTextField.getValue();this.dispatchEvent({type:"filterChanged",filterText:e})},_.DEBOUNCE_DELAY)),this.onFilterTextChangedDebounced()}onMiniFilterKeyDown(e){e.key===Y.ENTER&&setTimeout(()=>this.onSelectClicked(),_.DEBOUNCE_DELAY)}onSelectClicked(){this.dispatchEvent({type:this.selectState?"unselectAll":"selectAll"})}onExpandClicked(){this.dispatchEvent({type:this.expandState===0?"collapseAll":"expandAll"})}setExpandState(e){this.expandState=e,m.setDisplayed(this.eExpandChecked,this.expandState===0),m.setDisplayed(this.eExpandUnchecked,this.expandState===1),m.setDisplayed(this.eExpandIndeterminate,this.expandState===2)}setSelectionState(e){this.selectState=e,this.eSelect.setValue(this.selectState)}};g.DEBOUNCE_DELAY=300,g.TEMPLATE=`<div class="ag-column-select-header" role="presentation">
            <div ref="eExpand" class="ag-column-select-header-icon"></div>
            <ag-checkbox ref="eSelect" class="ag-column-select-header-checkbox"></ag-checkbox>
            <ag-input-text-field class="ag-column-select-header-filter-wrapper" ref="eFilterTextField"></ag-input-text-field>
        </div>`,a([Ae("columnModel")],g.prototype,"columnModel",2),a([O("eExpand")],g.prototype,"eExpand",2),a([O("eSelect")],g.prototype,"eSelect",2),a([O("eFilterTextField")],g.prototype,"eFilterTextField",2),a([De],g.prototype,"postConstruct",1);var Te=g;import{_ as L,Autowired as F,Component as Ge,Events as v,ProvidedColumnGroup as xe,VirtualList as Ie,PreDestroy as Ne}from"@ag-grid-community/core";import{Autowired as _e,BeanStub as we,DragSourceType as Oe,Events as Q,ProvidedColumnGroup as Fe,PostConstruct as Ve,VirtualListDragFeature as Re}from"@ag-grid-community/core";import{_ as C,Autowired as V,Column as G,Component as ke,CssClassApplier as Ue,DragAndDropService as q,DragSourceType as He,Events as A,KeyCode as R,PostConstruct as Be,RefSelector as M,TouchListener as J}from"@ag-grid-community/core";import{EventService as We}from"@ag-grid-community/core";var ee=class he{constructor(e,t,s,i=!1,n){this.eventService=new We,this.displayName=e,this.dept=s,this.group=i,i?(this.columnGroup=t,this.expanded=n,this.children=[]):this.column=t}isGroup(){return this.group}getDisplayName(){return this.displayName}getColumnGroup(){return this.columnGroup}getColumn(){return this.column}getDept(){return this.dept}isExpanded(){return!!this.expanded}getChildren(){return this.children}isPassesFilter(){return this.passesFilter}setExpanded(e){e!==this.expanded&&(this.expanded=e,this.eventService.dispatchEvent({type:he.EVENT_EXPANDED_CHANGED}))}setPassesFilter(e){this.passesFilter=e}addEventListener(e,t){this.eventService.addEventListener(e,t)}removeEventListener(e,t){this.eventService.removeEventListener(e,t)}};ee.EVENT_EXPANDED_CHANGED="expandedChanged";var D=ee;import{AgMenuItemComponent as Ze,AgMenuList as $e,Autowired as k,Column as Ke,Component as ze,PostConstruct as je,ProvidedColumnGroup as Xe,_ as te}from"@ag-grid-community/core";var y=class extends ze{constructor(o,e,t){super('<div class="ag-menu"></div>'),this.column=o,this.mouseEvent=e,this.parentEl=t,this.displayName=null}postConstruct(){if(this.initializeProperties(this.column),this.buildMenuItemMap(),this.column instanceof Ke?this.displayName=this.columnModel.getDisplayNameForColumn(this.column,"columnToolPanel"):this.displayName=this.columnModel.getDisplayNameForProvidedColumnGroup(null,this.column,"columnToolPanel"),this.isActive()){this.mouseEvent.preventDefault();const o=this.getMappedMenuItems();if(o.length===0)return;this.displayContextMenu(o)}}initializeProperties(o){o instanceof Xe?this.columns=o.getLeafColumns():this.columns=[o],this.allowGrouping=this.columns.some(e=>e.isPrimary()&&e.isAllowRowGroup()),this.allowValues=this.columns.some(e=>e.isPrimary()&&e.isAllowValue()),this.allowPivoting=this.columnModel.isPivotMode()&&this.columns.some(e=>e.isPrimary()&&e.isAllowPivot())}buildMenuItemMap(){const o=this.localeService.getLocaleTextFunc();this.menuItemMap=new Map,this.menuItemMap.set("rowGroup",{allowedFunction:e=>e.isPrimary()&&e.isAllowRowGroup()&&!this.columnModel.isColumnGroupingLocked(e),activeFunction:e=>e.isRowGroupActive(),activateLabel:()=>`${o("groupBy","Group by")} ${this.displayName}`,deactivateLabel:()=>`${o("ungroupBy","Un-Group by")} ${this.displayName}`,activateFunction:()=>{const e=this.columnModel.getRowGroupColumns();this.columnModel.setRowGroupColumns(this.addColumnsToList(e),"toolPanelUi")},deActivateFunction:()=>{const e=this.columnModel.getRowGroupColumns();this.columnModel.setRowGroupColumns(this.removeColumnsFromList(e),"toolPanelUi")},addIcon:"menuAddRowGroup",removeIcon:"menuRemoveRowGroup"}),this.menuItemMap.set("value",{allowedFunction:e=>e.isPrimary()&&e.isAllowValue(),activeFunction:e=>e.isValueActive(),activateLabel:()=>o("addToValues",`Add ${this.displayName} to values`,[this.displayName]),deactivateLabel:()=>o("removeFromValues",`Remove ${this.displayName} from values`,[this.displayName]),activateFunction:()=>{const e=this.columnModel.getValueColumns();this.columnModel.setValueColumns(this.addColumnsToList(e),"toolPanelUi")},deActivateFunction:()=>{const e=this.columnModel.getValueColumns();this.columnModel.setValueColumns(this.removeColumnsFromList(e),"toolPanelUi")},addIcon:"valuePanel",removeIcon:"valuePanel"}),this.menuItemMap.set("pivot",{allowedFunction:e=>this.columnModel.isPivotMode()&&e.isPrimary()&&e.isAllowPivot(),activeFunction:e=>e.isPivotActive(),activateLabel:()=>o("addToLabels",`Add ${this.displayName} to labels`,[this.displayName]),deactivateLabel:()=>o("removeFromLabels",`Remove ${this.displayName} from labels`,[this.displayName]),activateFunction:()=>{const e=this.columnModel.getPivotColumns();this.columnModel.setPivotColumns(this.addColumnsToList(e),"toolPanelUi")},deActivateFunction:()=>{const e=this.columnModel.getPivotColumns();this.columnModel.setPivotColumns(this.removeColumnsFromList(e),"toolPanelUi")},addIcon:"pivotPanel",removeIcon:"pivotPanel"})}addColumnsToList(o){return[...o].concat(this.columns.filter(e=>o.indexOf(e)===-1))}removeColumnsFromList(o){return o.filter(e=>this.columns.indexOf(e)===-1)}displayContextMenu(o){const e=this.getGui(),t=this.createBean(new $e),s=this.localeService.getLocaleTextFunc();let i=()=>{};e.appendChild(t.getGui()),t.addMenuItems(o),t.addManagedListener(t,Ze.EVENT_CLOSE_MENU,()=>{this.parentEl.focus(),i()});const n=this.popupService.addPopup({modal:!0,eChild:e,closeOnEsc:!0,afterGuiAttached:()=>this.focusService.focusInto(t.getGui()),ariaLabel:s("ariaLabelContextMenu","Context Menu"),closedCallback:r=>{r instanceof KeyboardEvent&&this.parentEl.focus(),this.destroyBean(t)}});n&&(i=n.hideFunc),this.popupService.positionPopupUnderMouseEvent({type:"columnContextMenu",mouseEvent:this.mouseEvent,ePopup:e})}isActive(){return this.allowGrouping||this.allowValues||this.allowPivoting}getMappedMenuItems(){const o=[];for(const e of this.menuItemMap.values()){const t=this.columns.some(i=>e.allowedFunction(i)&&!e.activeFunction(i)),s=this.columns.some(i=>e.allowedFunction(i)&&e.activeFunction(i));t&&o.push({name:e.activateLabel(this.displayName),icon:te.createIconNoSpan(e.addIcon,this.gos,null),action:()=>e.activateFunction()}),s&&o.push({name:e.deactivateLabel(this.displayName),icon:te.createIconNoSpan(e.removeIcon,this.gos,null),action:()=>e.deActivateFunction()})}return o}};a([k("columnModel")],y.prototype,"columnModel",2),a([k("popupService")],y.prototype,"popupService",2),a([k("focusService")],y.prototype,"focusService",2),a([je],y.prototype,"postConstruct",1);var p=class pe extends ke{constructor(e,t,s,i){super(),this.modelItem=e,this.allowDragging=t,this.eventType=s,this.focusWrapper=i,this.processingColumnStateChange=!1,this.modelItem=e,this.columnGroup=e.getColumnGroup(),this.columnDept=e.getDept(),this.displayName=e.getDisplayName(),this.allowDragging=t}init(){this.setTemplate(pe.TEMPLATE),this.eDragHandle=C.createIconNoSpan("columnDrag",this.gos),this.eDragHandle.classList.add("ag-drag-handle","ag-column-select-column-group-drag-handle");const e=this.cbSelect.getGui(),t=this.cbSelect.getInputElement();e.insertAdjacentElement("afterend",this.eDragHandle),t.setAttribute("tabindex","-1"),this.eLabel.innerHTML=this.displayName?this.displayName:"",this.setupExpandContract(),this.addCssClass("ag-column-select-indent-"+this.columnDept),this.addManagedListener(this.eventService,A.EVENT_COLUMN_PIVOT_MODE_CHANGED,this.onColumnStateChanged.bind(this)),this.addManagedListener(this.eLabel,"click",this.onLabelClicked.bind(this)),this.addManagedListener(this.cbSelect,A.EVENT_FIELD_VALUE_CHANGED,this.onCheckboxChanged.bind(this)),this.addManagedListener(this.modelItem,D.EVENT_EXPANDED_CHANGED,this.onExpandChanged.bind(this)),this.addManagedListener(this.focusWrapper,"keydown",this.handleKeyDown.bind(this)),this.addManagedListener(this.focusWrapper,"contextmenu",this.onContextMenu.bind(this)),this.setOpenClosedIcons(),this.setupDragging(),this.onColumnStateChanged(),this.addVisibilityListenersToAllChildren(),this.refreshAriaExpanded(),this.refreshAriaLabel(),this.setupTooltip(),Ue.getToolPanelClassesFromColDef(this.columnGroup.getColGroupDef(),this.gos,null,this.columnGroup).forEach(i=>this.addOrRemoveCssClass(i,!0))}getColumns(){return this.columnGroup.getLeafColumns()}setupTooltip(){const e=this.columnGroup.getColGroupDef();if(!e)return;const t=this.gos.get("tooltipShowMode")==="whenTruncated";let s;t&&(s=()=>this.eLabel.scrollWidth>this.eLabel.clientWidth);const i=()=>{const n=e.headerTooltip;this.setTooltip({newTooltipText:n,location:"columnToolPanelColumnGroup",shouldDisplayTooltip:s})};i(),this.addManagedListener(this.eventService,A.EVENT_NEW_COLUMNS_LOADED,i)}getTooltipParams(){const e=super.getTooltipParams();return e.location="columnToolPanelColumnGroup",e}handleKeyDown(e){switch(e.key){case R.LEFT:e.preventDefault(),this.modelItem.setExpanded(!1);break;case R.RIGHT:e.preventDefault(),this.modelItem.setExpanded(!0);break;case R.SPACE:e.preventDefault(),this.isSelectable()&&this.onSelectAllChanged(!this.isSelected());break}}onContextMenu(e){const{columnGroup:t,gos:s}=this;if(s.get("functionsReadOnly"))return;const i=this.createBean(new y(t,e,this.focusWrapper));this.addDestroyFunc(()=>{i.isAlive()&&this.destroyBean(i)})}addVisibilityListenersToAllChildren(){this.columnGroup.getLeafColumns().forEach(e=>{this.addManagedListener(e,G.EVENT_VISIBLE_CHANGED,this.onColumnStateChanged.bind(this)),this.addManagedListener(e,G.EVENT_VALUE_CHANGED,this.onColumnStateChanged.bind(this)),this.addManagedListener(e,G.EVENT_PIVOT_CHANGED,this.onColumnStateChanged.bind(this)),this.addManagedListener(e,G.EVENT_ROW_GROUP_CHANGED,this.onColumnStateChanged.bind(this))})}setupDragging(){if(!this.allowDragging){C.setDisplayed(this.eDragHandle,!1);return}let e=!this.gos.get("suppressDragLeaveHidesColumns");const t={type:He.ToolPanel,eElement:this.eDragHandle,dragItemName:this.displayName,getDefaultIconName:()=>e?q.ICON_HIDE:q.ICON_NOT_ALLOWED,getDragItem:()=>this.createDragItem(),onDragStarted:()=>{e=!this.gos.get("suppressDragLeaveHidesColumns");const s={type:A.EVENT_COLUMN_PANEL_ITEM_DRAG_START,column:this.columnGroup};this.eventService.dispatchEvent(s)},onDragStopped:()=>{const s={type:A.EVENT_COLUMN_PANEL_ITEM_DRAG_END};this.eventService.dispatchEvent(s)},onGridEnter:s=>{e&&this.modelItemUtils.updateColumns({columns:this.columnGroup.getLeafColumns(),visibleState:s?.visibleState,pivotState:s?.pivotState,eventType:this.eventType})},onGridExit:()=>{e&&this.onChangeCommon(!1)}};this.dragAndDropService.addDragSource(t,!0),this.addDestroyFunc(()=>this.dragAndDropService.removeDragSource(t))}createDragItem(){const e=this.columnGroup.getLeafColumns(),t={},s={};return e.forEach(i=>{const n=i.getId();t[n]=i.isVisible(),s[n]=this.modelItemUtils.createPivotState(i)}),{columns:e,visibleState:t,pivotState:s}}setupExpandContract(){this.eGroupClosedIcon.appendChild(C.createIcon("columnSelectClosed",this.gos,null)),this.eGroupOpenedIcon.appendChild(C.createIcon("columnSelectOpen",this.gos,null)),this.addManagedListener(this.eGroupClosedIcon,"click",this.onExpandOrContractClicked.bind(this)),this.addManagedListener(this.eGroupOpenedIcon,"click",this.onExpandOrContractClicked.bind(this));const e=new J(this.eColumnGroupIcons,!0);this.addManagedListener(e,J.EVENT_TAP,this.onExpandOrContractClicked.bind(this)),this.addDestroyFunc(e.destroy.bind(e))}onLabelClicked(){const e=!this.cbSelect.getValue();this.onChangeCommon(e)}onCheckboxChanged(e){this.onChangeCommon(e.selected)}getVisibleLeafColumns(){const e=[],t=s=>{s.forEach(i=>{i.isPassesFilter()&&(i.isGroup()?t(i.getChildren()):e.push(i.getColumn()))})};return t(this.modelItem.getChildren()),e}onChangeCommon(e){this.refreshAriaLabel(),!this.processingColumnStateChange&&this.modelItemUtils.selectAllChildren(this.modelItem.getChildren(),e,this.eventType)}refreshAriaLabel(){const e=this.localeService.getLocaleTextFunc(),t=e("ariaColumnGroup","Column Group"),s=this.cbSelect.getValue(),i=s===void 0?e("ariaIndeterminate","indeterminate"):s?e("ariaVisible","visible"):e("ariaHidden","hidden"),n=e("ariaToggleVisibility","Press SPACE to toggle visibility");C.setAriaLabel(this.focusWrapper,`${this.displayName} ${t}`),this.cbSelect.setInputAriaLabel(`${n} (${i})`),C.setAriaDescribedBy(this.focusWrapper,this.cbSelect.getInputElement().id)}onColumnStateChanged(){const e=this.workOutSelectedValue(),t=this.workOutReadOnlyValue();this.processingColumnStateChange=!0,this.cbSelect.setValue(e),this.cbSelect.setReadOnly(t),this.addOrRemoveCssClass("ag-column-select-column-group-readonly",t),this.processingColumnStateChange=!1}workOutSelectedValue(){const e=this.columnModel.isPivotMode(),t=this.getVisibleLeafColumns();let s=0,i=0;if(t.forEach(n=>{!e&&n.getColDef().lockVisible||(this.isColumnChecked(n,e)?s++:i++)}),!(s>0&&i>0))return s>0}workOutReadOnlyValue(){const e=this.columnModel.isPivotMode();let t=0;return this.columnGroup.getLeafColumns().forEach(s=>{e?s.isAnyFunctionAllowed()&&t++:s.getColDef().lockVisible||t++}),t===0}isColumnChecked(e,t){if(t){const s=e.isPivotActive(),i=e.isRowGroupActive(),n=e.isValueActive();return s||i||n}return e.isVisible()}onExpandOrContractClicked(){const e=this.modelItem.isExpanded();this.modelItem.setExpanded(!e)}onExpandChanged(){this.setOpenClosedIcons(),this.refreshAriaExpanded()}setOpenClosedIcons(){const e=this.modelItem.isExpanded();C.setDisplayed(this.eGroupClosedIcon,!e),C.setDisplayed(this.eGroupOpenedIcon,e)}refreshAriaExpanded(){C.setAriaExpanded(this.focusWrapper,this.modelItem.isExpanded())}getDisplayName(){return this.displayName}onSelectAllChanged(e){const t=this.cbSelect.getValue();!this.cbSelect.isReadOnly()&&(e&&!t||!e&&t)&&this.cbSelect.toggle()}isSelected(){return this.cbSelect.getValue()}isSelectable(){return!this.cbSelect.isReadOnly()}setSelected(e){this.cbSelect.setValue(e,!0)}};p.TEMPLATE=`<div class="ag-column-select-column-group" aria-hidden="true">
            <span class="ag-column-group-icons" ref="eColumnGroupIcons" >
                <span class="ag-column-group-closed-icon" ref="eGroupClosedIcon"></span>
                <span class="ag-column-group-opened-icon" ref="eGroupOpenedIcon"></span>
            </span>
            <ag-checkbox ref="cbSelect" class="ag-column-select-checkbox"></ag-checkbox>
            <span class="ag-column-select-column-label" ref="eLabel"></span>
        </div>`,a([V("columnModel")],p.prototype,"columnModel",2),a([V("dragAndDropService")],p.prototype,"dragAndDropService",2),a([V("modelItemUtils")],p.prototype,"modelItemUtils",2),a([M("cbSelect")],p.prototype,"cbSelect",2),a([M("eLabel")],p.prototype,"eLabel",2),a([M("eGroupOpenedIcon")],p.prototype,"eGroupOpenedIcon",2),a([M("eGroupClosedIcon")],p.prototype,"eGroupClosedIcon",2),a([M("eColumnGroupIcons")],p.prototype,"eColumnGroupIcons",2),a([Be],p.prototype,"init",1);var se=p,U=class extends we{constructor(o,e){super(),this.comp=o,this.virtualList=e}postConstruct(){this.createManagedBean(new Re(this.comp,this.virtualList,{dragSourceType:Oe.ToolPanel,listItemDragStartEvent:Q.EVENT_COLUMN_PANEL_ITEM_DRAG_START,listItemDragEndEvent:Q.EVENT_COLUMN_PANEL_ITEM_DRAG_END,eventSource:this.eventService,getCurrentDragValue:o=>this.getCurrentDragValue(o),isMoveBlocked:o=>this.isMoveBlocked(o),getNumRows:o=>o.getDisplayedColsList().length,moveItem:(o,e)=>this.moveItem(o,e)}))}getCurrentDragValue(o){return o.column}isMoveBlocked(o){return this.gos.get("suppressMovableColumns")?!0:!!this.getCurrentColumns(o).find(i=>{const n=i.getColDef();return!!n.suppressMovable||!!n.lockPosition})}moveItem(o,e){const t=this.getTargetIndex(o,e),s=this.getCurrentColumns(o);t!=null&&this.columnModel.moveColumns(s,t,"toolPanelUi")}getMoveDiff(o,e){const t=this.columnModel.getAllGridColumns(),s=this.getCurrentColumns(o),i=s[0],n=s.length;return t.indexOf(i)<e?n:0}getCurrentColumns(o){return o instanceof Fe?o.getLeafColumns():[o]}getTargetIndex(o,e){if(!e)return null;const t=e.component;let s=e.position==="top",i;if(t instanceof se?(i=t.getColumns()[0],s=!0):i=t.getColumn(),this.getCurrentColumns(o).indexOf(i)!==-1)return null;const r=this.columnModel.getAllGridColumns().indexOf(i),l=s?r:r+1,d=this.getMoveDiff(o,l);return l-d}};a([_e("columnModel")],U.prototype,"columnModel",2),a([Ve],U.prototype,"postConstruct",1);import{_ as b,Autowired as H,Column as x,Component as Ye,CssClassApplier as Qe,DragAndDropService as ie,DragSourceType as qe,Events as T,KeyCode as Je,PostConstruct as et,RefSelector as oe}from"@ag-grid-community/core";var f=class me extends Ye{constructor(e,t,s,i){super(),this.allowDragging=t,this.groupsExist=s,this.focusWrapper=i,this.processingColumnStateChange=!1,this.column=e.getColumn(),this.columnDept=e.getDept(),this.displayName=e.getDisplayName()}init(){this.setTemplate(me.TEMPLATE),this.eDragHandle=b.createIconNoSpan("columnDrag",this.gos),this.eDragHandle.classList.add("ag-drag-handle","ag-column-select-column-drag-handle");const e=this.cbSelect.getGui(),t=this.cbSelect.getInputElement();e.insertAdjacentElement("afterend",this.eDragHandle),t.setAttribute("tabindex","-1");const s=b.escapeString(this.displayName);this.eLabel.innerHTML=s;const i=this.columnDept;this.groupsExist&&this.addCssClass("ag-column-select-add-group-indent"),this.addCssClass(`ag-column-select-indent-${i}`),this.setupDragging(),this.addManagedListener(this.eventService,T.EVENT_COLUMN_PIVOT_MODE_CHANGED,this.onColumnStateChanged.bind(this)),this.addManagedListener(this.column,x.EVENT_VALUE_CHANGED,this.onColumnStateChanged.bind(this)),this.addManagedListener(this.column,x.EVENT_PIVOT_CHANGED,this.onColumnStateChanged.bind(this)),this.addManagedListener(this.column,x.EVENT_ROW_GROUP_CHANGED,this.onColumnStateChanged.bind(this)),this.addManagedListener(this.column,x.EVENT_VISIBLE_CHANGED,this.onColumnStateChanged.bind(this)),this.addManagedListener(this.focusWrapper,"keydown",this.handleKeyDown.bind(this)),this.addManagedListener(this.focusWrapper,"contextmenu",this.onContextMenu.bind(this)),this.addManagedPropertyListener("functionsReadOnly",this.onColumnStateChanged.bind(this)),this.addManagedListener(this.cbSelect,T.EVENT_FIELD_VALUE_CHANGED,this.onCheckboxChanged.bind(this)),this.addManagedListener(this.eLabel,"click",this.onLabelClicked.bind(this)),this.onColumnStateChanged(),this.refreshAriaLabel(),this.setupTooltip(),Qe.getToolPanelClassesFromColDef(this.column.getColDef(),this.gos,this.column,null).forEach(r=>this.addOrRemoveCssClass(r,!0))}getColumn(){return this.column}setupTooltip(){const e=this.gos.get("tooltipShowMode")==="whenTruncated";let t;e&&(t=()=>this.eLabel.scrollWidth>this.eLabel.clientWidth);const s=()=>{const i=this.column.getColDef().headerTooltip;this.setTooltip({newTooltipText:i,location:"columnToolPanelColumn",shouldDisplayTooltip:t})};s(),this.addManagedListener(this.eventService,T.EVENT_NEW_COLUMNS_LOADED,s)}getTooltipParams(){const e=super.getTooltipParams();return e.location="columnToolPanelColumn",e.colDef=this.column.getColDef(),e}onContextMenu(e){const{column:t,gos:s}=this;if(s.get("functionsReadOnly"))return;const i=this.createBean(new y(t,e,this.focusWrapper));this.addDestroyFunc(()=>{i.isAlive()&&this.destroyBean(i)})}handleKeyDown(e){e.key===Je.SPACE&&(e.preventDefault(),this.isSelectable()&&this.onSelectAllChanged(!this.isSelected()))}onLabelClicked(){if(this.gos.get("functionsReadOnly"))return;const e=!this.cbSelect.getValue();this.onChangeCommon(e)}onCheckboxChanged(e){this.onChangeCommon(e.selected)}onChangeCommon(e){this.cbSelect.isReadOnly()||(this.refreshAriaLabel(),!this.processingColumnStateChange&&this.modelItemUtils.setColumn(this.column,e,"toolPanelUi"))}refreshAriaLabel(){const e=this.localeService.getLocaleTextFunc(),t=e("ariaColumn","Column"),s=this.cbSelect.getValue()?e("ariaVisible","visible"):e("ariaHidden","hidden"),i=e("ariaToggleVisibility","Press SPACE to toggle visibility");b.setAriaLabel(this.focusWrapper,`${this.displayName} ${t}`),this.cbSelect.setInputAriaLabel(`${i} (${s})`),b.setAriaDescribedBy(this.focusWrapper,this.cbSelect.getInputElement().id)}setupDragging(){if(!this.allowDragging){b.setDisplayed(this.eDragHandle,!1);return}let e=!this.gos.get("suppressDragLeaveHidesColumns");const t={type:qe.ToolPanel,eElement:this.eDragHandle,dragItemName:this.displayName,getDefaultIconName:()=>e?ie.ICON_HIDE:ie.ICON_NOT_ALLOWED,getDragItem:()=>this.createDragItem(),onDragStarted:()=>{e=!this.gos.get("suppressDragLeaveHidesColumns");const s={type:T.EVENT_COLUMN_PANEL_ITEM_DRAG_START,column:this.column};this.eventService.dispatchEvent(s)},onDragStopped:()=>{const s={type:T.EVENT_COLUMN_PANEL_ITEM_DRAG_END};this.eventService.dispatchEvent(s)},onGridEnter:s=>{e&&this.modelItemUtils.updateColumns({columns:[this.column],visibleState:s?.visibleState,pivotState:s?.pivotState,eventType:"toolPanelUi"})},onGridExit:()=>{e&&this.onChangeCommon(!1)}};this.dragAndDropService.addDragSource(t,!0),this.addDestroyFunc(()=>this.dragAndDropService.removeDragSource(t))}createDragItem(){const e=this.column.getColId(),t={[e]:this.column.isVisible()},s={[e]:this.modelItemUtils.createPivotState(this.column)};return{columns:[this.column],visibleState:t,pivotState:s}}onColumnStateChanged(){this.processingColumnStateChange=!0;const e=this.columnModel.isPivotMode();if(e){const n=this.column.isAnyFunctionActive();this.cbSelect.setValue(n)}else this.cbSelect.setValue(this.column.isVisible());let t=!0,s=!0;if(e){const n=this.gos.get("functionsReadOnly"),r=!this.column.isAnyFunctionAllowed();t=!n&&!r,s=t}else{const{enableRowGroup:n,enableValue:r,lockPosition:l,suppressMovable:d,lockVisible:c}=this.column.getColDef(),h=!!n||!!r,u=!!l||!!d;t=!c,s=h||!u}this.cbSelect.setReadOnly(!t),this.eDragHandle.classList.toggle("ag-column-select-column-readonly",!s),this.addOrRemoveCssClass("ag-column-select-column-readonly",!s&&!t);const i=e&&this.gos.get("functionsPassive");this.cbSelect.setPassive(i),this.processingColumnStateChange=!1}getDisplayName(){return this.displayName}onSelectAllChanged(e){e!==this.cbSelect.getValue()&&(this.cbSelect.isReadOnly()||this.cbSelect.toggle())}isSelected(){return this.cbSelect.getValue()}isSelectable(){return!this.cbSelect.isReadOnly()}isExpandable(){return!1}setExpanded(e){console.warn("AG Grid: can not expand a column item that does not represent a column group header")}};f.TEMPLATE=`<div class="ag-column-select-column" aria-hidden="true">
            <ag-checkbox ref="cbSelect" class="ag-column-select-checkbox"></ag-checkbox>
            <span class="ag-column-select-column-label" ref="eLabel"></span>
        </div>`,a([H("columnModel")],f.prototype,"columnModel",2),a([H("dragAndDropService")],f.prototype,"dragAndDropService",2),a([H("modelItemUtils")],f.prototype,"modelItemUtils",2),a([oe("eLabel")],f.prototype,"eLabel",2),a([oe("cbSelect")],f.prototype,"cbSelect",2),a([et],f.prototype,"init",1);var tt=f,st=class{constructor(o){this.items=o}getRowCount(){return this.items.length}getRow(o){return this.items[o]}},it="ag-column-select-list",P=class Ce extends Ge{constructor(){super(Ce.TEMPLATE),this.destroyColumnItemFuncs=[],this.hasLoadedInitialState=!1,this.isInitialState=!1}destroyColumnTree(){this.allColsTree=[],this.destroyColumnItemFuncs.forEach(e=>e()),this.destroyColumnItemFuncs=[]}init(e,t,s){this.params=e,this.allowDragging=t,this.eventType=s,this.params.suppressSyncLayoutWithGrid||this.addManagedListener(this.eventService,v.EVENT_COLUMN_MOVED,this.onColumnsChanged.bind(this)),this.addManagedListener(this.eventService,v.EVENT_NEW_COLUMNS_LOADED,this.onColumnsChanged.bind(this)),[v.EVENT_COLUMN_PIVOT_CHANGED,v.EVENT_COLUMN_PIVOT_MODE_CHANGED,v.EVENT_COLUMN_ROW_GROUP_CHANGED,v.EVENT_COLUMN_VALUE_CHANGED,v.EVENT_COLUMN_VISIBLE,v.EVENT_NEW_COLUMNS_LOADED].forEach(n=>{this.addManagedListener(this.eventService,n,this.fireSelectionChangedEvent.bind(this))}),this.expandGroupsByDefault=!this.params.contractColumnSelection,this.virtualList=this.createManagedBean(new Ie({cssIdentifier:"column-select",ariaRole:"tree"})),this.appendChild(this.virtualList.getGui()),this.virtualList.setComponentCreator((n,r)=>(L.setAriaLevel(r,n.getDept()+1),this.createComponentFromItem(n,r))),this.columnModel.isReady()&&this.onColumnsChanged(),!this.params.suppressColumnMove&&this.createManagedBean(new U(this,this.virtualList))}createComponentFromItem(e,t){if(e.isGroup()){const i=new se(e,this.allowDragging,this.eventType,t);return this.getContext().createBean(i),i}const s=new tt(e,this.allowDragging,this.groupsExist,t);return this.getContext().createBean(s),s}onColumnsChanged(){this.hasLoadedInitialState||(this.hasLoadedInitialState=!0,this.isInitialState=!!this.params.initialState);const e=this.getExpandedStates(),t=this.columnModel.isPivotMode();!this.params.suppressSyncLayoutWithGrid&&!t?this.buildTreeFromWhatGridIsDisplaying():this.buildTreeFromProvidedColumnDefs(),this.setExpandedStates(e),this.markFilteredColumns(),this.flattenAndFilterModel(),this.isInitialState=!1}getDisplayedColsList(){return this.displayedColsList}getExpandedStates(){const e={};if(this.isInitialState){const{expandedGroupIds:t}=this.params.initialState;return t.forEach(s=>{e[s]=!0}),e}return this.allColsTree?(this.forEachItem(t=>{if(!t.isGroup())return;const s=t.getColumnGroup();s&&(e[s.getId()]=t.isExpanded())}),e):{}}setExpandedStates(e){if(!this.allColsTree)return;const{isInitialState:t}=this;this.forEachItem(s=>{if(!s.isGroup())return;const i=s.getColumnGroup();if(i){const n=e[i.getId()];(n!=null||t)&&s.setExpanded(!!n)}})}buildTreeFromWhatGridIsDisplaying(){this.colDefService.syncLayoutWithGrid(this.setColumnLayout.bind(this))}setColumnLayout(e){const t=this.colDefService.createColumnTree(e);this.buildListModel(t),this.groupsExist=e.some(s=>s&&typeof s.children<"u"),this.markFilteredColumns(),this.flattenAndFilterModel()}buildTreeFromProvidedColumnDefs(){this.buildListModel(this.columnModel.getPrimaryColumnTree()),this.groupsExist=this.columnModel.isPrimaryColumnGroupsPresent()}buildListModel(e){const t=this.onColumnExpanded.bind(this),s=l=>{l.addEventListener(D.EVENT_EXPANDED_CHANGED,t);const d=l.removeEventListener.bind(l,D.EVENT_EXPANDED_CHANGED,t);this.destroyColumnItemFuncs.push(d)},i=(l,d,c)=>{l.forEach(h=>{h instanceof xe?n(h,d,c):r(h,d,c)})},n=(l,d,c)=>{const h=l.getColGroupDef();if(h&&h.suppressColumnsToolPanel)return;if(l.isPadding()){i(l.getChildren(),d,c);return}const fe=this.columnModel.getDisplayNameForProvidedColumnGroup(null,l,"columnToolPanel"),w=new D(fe,l,d,!0,this.expandGroupsByDefault);c.push(w),s(w),i(l.getChildren(),d+1,w.getChildren())},r=(l,d,c)=>{if(l.getColDef()&&l.getColDef().suppressColumnsToolPanel)return;const u=this.columnModel.getDisplayNameForColumn(l,"columnToolPanel");c.push(new D(u,l,d))};this.destroyColumnTree(),i(e,0,this.allColsTree)}onColumnExpanded(){this.flattenAndFilterModel()}flattenAndFilterModel(){this.displayedColsList=[];const e=s=>{s.isPassesFilter()&&(this.displayedColsList.push(s),s.isGroup()&&s.isExpanded()&&s.getChildren().forEach(e))};this.allColsTree.forEach(e),this.virtualList.setModel(new st(this.displayedColsList));const t=this.virtualList.getLastFocusedRow();this.virtualList.refresh(),t!=null&&this.focusRowIfAlive(t),this.notifyListeners(),this.refreshAriaLabel()}refreshAriaLabel(){const e=this.localeService.getLocaleTextFunc(),t=e("ariaColumnPanelList","Column List"),s=e("columns","Columns"),i=this.displayedColsList.length;L.setAriaLabel(this.virtualList.getAriaElement(),`${t} ${i} ${s}`)}focusRowIfAlive(e){window.setTimeout(()=>{this.isAlive()&&this.virtualList.focusRow(e)},0)}forEachItem(e){const t=s=>{s.forEach(i=>{e(i),i.isGroup()&&t(i.getChildren())})};this.allColsTree&&t(this.allColsTree)}doSetExpandedAll(e){this.forEachItem(t=>{t.isGroup()&&t.setExpanded(e)})}setGroupsExpanded(e,t){if(!t){this.doSetExpandedAll(e);return}const s=[];this.forEachItem(n=>{if(!n.isGroup())return;const r=n.getColumnGroup().getId();t.indexOf(r)>=0&&(n.setExpanded(e),s.push(r))});const i=t.filter(n=>!L.includes(s,n));i.length>0&&console.warn("AG Grid: unable to find group(s) for supplied groupIds:",i)}getExpandState(){let e=0,t=0;return this.forEachItem(s=>{s.isGroup()&&(s.isExpanded()?e++:t++)}),e>0&&t>0?2:t>0?1:0}doSetSelectedAll(e){this.modelItemUtils.selectAllChildren(this.allColsTree,e,this.eventType)}getSelectionState(){let e=0,t=0;const s=this.columnModel.isPivotMode();if(this.forEachItem(i=>{if(i.isGroup()||!i.isPassesFilter())return;const n=i.getColumn(),r=n.getColDef();let l;if(s){if(!n.isAllowPivot()&&!n.isAllowRowGroup()&&!n.isAllowValue())return;l=n.isValueActive()||n.isPivotActive()||n.isRowGroupActive()}else{if(r.lockVisible)return;l=n.isVisible()}l?e++:t++}),!(e>0&&t>0))return!(e===0||t>0)}setFilterText(e){this.filterText=L.exists(e)?e.toLowerCase():null,this.markFilteredColumns(),this.flattenAndFilterModel()}markFilteredColumns(){const e=s=>{if(!L.exists(this.filterText))return!0;const i=s.getDisplayName();return i==null||i.toLowerCase().indexOf(this.filterText)!==-1},t=(s,i)=>{let n=!1;if(s.isGroup()){const l=e(s);s.getChildren().forEach(d=>{const c=t(d,l||i);c&&(n=c)})}const r=i||n?!0:e(s);return s.setPassesFilter(r),r};this.allColsTree.forEach(s=>t(s,!1))}notifyListeners(){this.fireGroupExpandedEvent(),this.fireSelectionChangedEvent()}fireGroupExpandedEvent(){const e=this.getExpandState();this.dispatchEvent({type:"groupExpanded",state:e})}fireSelectionChangedEvent(){if(!this.allColsTree)return;const e=this.getSelectionState();this.dispatchEvent({type:"selectionChanged",state:e})}getExpandedGroups(){const e=[];return this.allColsTree&&this.forEachItem(t=>{t.isGroup()&&t.isExpanded()&&e.push(t.getColumnGroup().getId())}),e}};P.TEMPLATE=`<div class="${it}" role="presentation"></div>`,a([F("columnModel")],P.prototype,"columnModel",2),a([F("toolPanelColDefService")],P.prototype,"colDefService",2),a([F("modelItemUtils")],P.prototype,"modelItemUtils",2),a([Ne],P.prototype,"destroyColumnTree",1);var ot=P;import{_ as ne,Component as nt,Events as lt,ModuleNames as at,ModuleRegistry as rt}from"@ag-grid-community/core";import{Autowired as le,Component as dt,Events as B,PreConstruct as ut,RefSelector as ct}from"@ag-grid-community/core";var S=class extends dt{createTemplate(){return`<div class="ag-pivot-mode-panel">
                <ag-toggle-button ref="cbPivotMode" class="ag-pivot-mode-select"></ag-toggle-button>
            </div>`}init(){this.setTemplate(this.createTemplate()),this.cbPivotMode.setValue(this.columnModel.isPivotMode());const o=this.localeService.getLocaleTextFunc();this.cbPivotMode.setLabel(o("pivotMode","Pivot Mode")),this.addManagedListener(this.cbPivotMode,B.EVENT_FIELD_VALUE_CHANGED,this.onBtPivotMode.bind(this)),this.addManagedListener(this.eventService,B.EVENT_NEW_COLUMNS_LOADED,this.onPivotModeChanged.bind(this)),this.addManagedListener(this.eventService,B.EVENT_COLUMN_PIVOT_MODE_CHANGED,this.onPivotModeChanged.bind(this))}onBtPivotMode(){const o=!!this.cbPivotMode.getValue();if(o!==this.columnModel.isPivotMode()){this.gos.updateGridOptions({options:{pivotMode:o},source:"toolPanelUi"});const{api:e}=this;e&&e.refreshHeader()}}onPivotModeChanged(){const o=this.columnModel.isPivotMode();this.cbPivotMode.setValue(o)}};a([le("columnModel")],S.prototype,"columnModel",2),a([le("gridApi")],S.prototype,"api",2),a([ct("cbPivotMode")],S.prototype,"cbPivotMode",2),a([ut],S.prototype,"init",1);import{PivotDropZonePanel as ae,RowGroupDropZonePanel as re,ValuesDropZonePanel as de}from"@ag-grid-enterprise/row-grouping";import{Component as ht,RefSelector as ue,PositionableFeature as pt}from"@ag-grid-community/core";var I=class ge extends ht{constructor(){super(ge.TEMPLATE)}init(e,t,s){this.allowDragging=e,this.params=t,this.eventType=s,this.primaryColsHeaderPanel.init(this.params);const i=this.params.suppressColumnFilter,n=this.params.suppressColumnSelectAll;this.params.suppressColumnExpandAll&&i&&n&&this.primaryColsHeaderPanel.setDisplayed(!1),this.addManagedListener(this.primaryColsListPanel,"groupExpanded",this.onGroupExpanded.bind(this)),this.addManagedListener(this.primaryColsListPanel,"selectionChanged",this.onSelectionChange.bind(this)),this.primaryColsListPanel.init(this.params,this.allowDragging,this.eventType),this.addManagedListener(this.primaryColsHeaderPanel,"expandAll",this.onExpandAll.bind(this)),this.addManagedListener(this.primaryColsHeaderPanel,"collapseAll",this.onCollapseAll.bind(this)),this.addManagedListener(this.primaryColsHeaderPanel,"selectAll",this.onSelectAll.bind(this)),this.addManagedListener(this.primaryColsHeaderPanel,"unselectAll",this.onUnselectAll.bind(this)),this.addManagedListener(this.primaryColsHeaderPanel,"filterChanged",this.onFilterChanged.bind(this)),this.positionableFeature=new pt(this.getGui(),{minHeight:100}),this.createManagedBean(this.positionableFeature)}toggleResizable(e){this.positionableFeature.setResizable(e?{bottom:!0}:!1)}onExpandAll(){this.primaryColsListPanel.doSetExpandedAll(!0)}onCollapseAll(){this.primaryColsListPanel.doSetExpandedAll(!1)}expandGroups(e){this.primaryColsListPanel.setGroupsExpanded(!0,e)}collapseGroups(e){this.primaryColsListPanel.setGroupsExpanded(!1,e)}setColumnLayout(e){this.primaryColsListPanel.setColumnLayout(e)}onFilterChanged(e){this.primaryColsListPanel.setFilterText(e.filterText)}syncLayoutWithGrid(){this.primaryColsListPanel.onColumnsChanged()}onSelectAll(){this.primaryColsListPanel.doSetSelectedAll(!0)}onUnselectAll(){this.primaryColsListPanel.doSetSelectedAll(!1)}onGroupExpanded(e){this.primaryColsHeaderPanel.setExpandState(e.state),this.params.onStateUpdated()}onSelectionChange(e){this.primaryColsHeaderPanel.setSelectionState(e.state)}getExpandedGroups(){return this.primaryColsListPanel.getExpandedGroups()}};I.TEMPLATE=`<div class="ag-column-select">
            <ag-primary-cols-header ref="primaryColsHeaderPanel"></ag-primary-cols-header>
            <ag-primary-cols-list ref="primaryColsListPanel"></ag-primary-cols-list>
        </div>`,a([ue("primaryColsHeaderPanel")],I.prototype,"primaryColsHeaderPanel",2),a([ue("primaryColsListPanel")],I.prototype,"primaryColsListPanel",2);var W=I,ce=class ve extends nt{constructor(){super(ve.TEMPLATE),this.initialised=!1,this.childDestroyFuncs=[]}setVisible(e){super.setDisplayed(e),e&&!this.initialised&&this.init(this.params)}init(e){const t=this.gos.addGridCommonParams({suppressColumnMove:!1,suppressColumnSelectAll:!1,suppressColumnFilter:!1,suppressColumnExpandAll:!1,contractColumnSelection:!1,suppressPivotMode:!1,suppressRowGroups:!1,suppressValues:!1,suppressPivots:!1,suppressSyncLayoutWithGrid:!1});if(this.params=X(X({},t),e),this.isRowGroupingModuleLoaded()&&!this.params.suppressPivotMode&&(this.pivotModePanel=this.createBean(new S),this.childDestroyFuncs.push(()=>this.destroyBean(this.pivotModePanel)),this.appendChild(this.pivotModePanel)),this.primaryColsPanel=this.createBean(new W),this.childDestroyFuncs.push(()=>this.destroyBean(this.primaryColsPanel)),this.primaryColsPanel.init(!0,this.params,"toolPanelUi"),this.primaryColsPanel.addCssClass("ag-column-panel-column-select"),this.appendChild(this.primaryColsPanel),this.isRowGroupingModuleLoaded()){this.params.suppressRowGroups||(this.rowGroupDropZonePanel=this.createBean(new re(!1)),this.childDestroyFuncs.push(()=>this.destroyBean(this.rowGroupDropZonePanel)),this.appendChild(this.rowGroupDropZonePanel)),this.params.suppressValues||(this.valuesDropZonePanel=this.createBean(new de(!1)),this.childDestroyFuncs.push(()=>this.destroyBean(this.valuesDropZonePanel)),this.appendChild(this.valuesDropZonePanel)),this.params.suppressPivots||(this.pivotDropZonePanel=this.createBean(new ae(!1)),this.childDestroyFuncs.push(()=>this.destroyBean(this.pivotDropZonePanel)),this.appendChild(this.pivotDropZonePanel)),this.setLastVisible();const s=this.addManagedListener(this.eventService,lt.EVENT_COLUMN_PIVOT_MODE_CHANGED,()=>{this.resetChildrenHeight(),this.setLastVisible()});this.childDestroyFuncs.push(()=>s())}this.initialised=!0}setPivotModeSectionVisible(e){this.isRowGroupingModuleLoaded()&&(this.pivotModePanel?this.pivotModePanel.setDisplayed(e):e&&(this.pivotModePanel=this.createBean(new S),this.getGui().insertBefore(this.pivotModePanel.getGui(),this.getGui().firstChild),this.childDestroyFuncs.push(()=>this.destroyBean(this.pivotModePanel))),this.setLastVisible())}setRowGroupsSectionVisible(e){this.isRowGroupingModuleLoaded()&&(this.rowGroupDropZonePanel?this.rowGroupDropZonePanel.setDisplayed(e):e&&(this.rowGroupDropZonePanel=this.createManagedBean(new re(!1)),this.appendChild(this.rowGroupDropZonePanel)),this.setLastVisible())}setValuesSectionVisible(e){this.isRowGroupingModuleLoaded()&&(this.valuesDropZonePanel?this.valuesDropZonePanel.setDisplayed(e):e&&(this.valuesDropZonePanel=this.createManagedBean(new de(!1)),this.appendChild(this.valuesDropZonePanel)),this.setLastVisible())}setPivotSectionVisible(e){this.isRowGroupingModuleLoaded()&&(this.pivotDropZonePanel?this.pivotDropZonePanel.setDisplayed(e):e&&(this.pivotDropZonePanel=this.createManagedBean(new ae(!1)),this.appendChild(this.pivotDropZonePanel),this.pivotDropZonePanel.setDisplayed(e)),this.setLastVisible())}setResizers(){[this.primaryColsPanel,this.rowGroupDropZonePanel,this.valuesDropZonePanel,this.pivotDropZonePanel].forEach(e=>{if(!e)return;const t=e.getGui();e.toggleResizable(!t.classList.contains("ag-last-column-drop")&&!t.classList.contains("ag-hidden"))})}setLastVisible(){const e=this.getGui();Array.prototype.slice.call(e.querySelectorAll(".ag-column-drop")).forEach(n=>n.classList.remove("ag-last-column-drop"));const s=e.querySelectorAll(".ag-column-drop:not(.ag-hidden)"),i=ne.last(s);i&&i.classList.add("ag-last-column-drop"),this.setResizers()}resetChildrenHeight(){const t=this.getGui().children;for(let s=0;s<t.length;s++){const i=t[s];i.style.removeProperty("height"),i.style.removeProperty("flex")}}isRowGroupingModuleLoaded(){return rt.__assertRegistered(at.RowGroupingModule,"Row Grouping",this.context.getGridId())}expandColumnGroups(e){this.primaryColsPanel.expandGroups(e)}collapseColumnGroups(e){this.primaryColsPanel.collapseGroups(e)}setColumnLayout(e){this.primaryColsPanel.setColumnLayout(e)}syncLayoutWithGrid(){this.primaryColsPanel.syncLayoutWithGrid()}destroyChildren(){this.childDestroyFuncs.forEach(e=>e()),this.childDestroyFuncs.length=0,ne.clearElement(this.getGui())}refresh(e){return this.destroyChildren(),this.init(e),!0}getState(){return{expandedGroupIds:this.primaryColsPanel.getExpandedGroups()}}destroy(){this.destroyChildren(),super.destroy()}};ce.TEMPLATE='<div class="ag-column-panel"></div>';var mt=ce;import{RowGroupingModule as Ct}from"@ag-grid-enterprise/row-grouping";import{SideBarModule as gt}from"@ag-grid-enterprise/side-bar";import{Events as Z,Bean as vt,Autowired as N,_ as $}from"@ag-grid-community/core";var E=class{selectAllChildren(o,e,t){const s=this.extractAllLeafColumns(o);this.setAllColumns(s,e,t)}setColumn(o,e,t){this.setAllColumns([o],e,t)}setAllColumns(o,e,t){this.columnModel.isPivotMode()?this.setAllPivot(o,e,t):this.setAllVisible(o,e,t)}extractAllLeafColumns(o){const e=[],t=s=>{s.forEach(i=>{i.isPassesFilter()&&(i.isGroup()?t(i.getChildren()):e.push(i.getColumn()))})};return t(o),e}setAllVisible(o,e,t){const s=[];o.forEach(i=>{i.getColDef().lockVisible||i.isVisible()!=e&&s.push({colId:i.getId(),hide:!e})}),s.length>0&&this.columnModel.applyColumnState({state:s},t)}setAllPivot(o,e,t){this.gos.get("functionsPassive")?this.setAllPivotPassive(o,e):this.setAllPivotActive(o,e,t)}setAllPivotPassive(o,e){const t=this.columnModel.getPivotColumns().slice(),s=this.columnModel.getValueColumns().slice(),i=this.columnModel.getRowGroupColumns().slice();let n=!1,r=!1,l=!1;const h=e?u=>{u.isAnyFunctionActive()||(u.isAllowValue()?(s.push(u),r=!0):u.isAllowRowGroup()?(i.push(u),n=!0):u.isAllowPivot()&&(t.push(u),l=!0))}:u=>{u.isAnyFunctionActive()&&(t.indexOf(u)>=0&&($.removeFromArray(t,u),n=!0),s.indexOf(u)>=0&&($.removeFromArray(s,u),r=!0),i.indexOf(u)>=0&&($.removeFromArray(i,u),l=!0))};if(o.forEach(h),n){const u={type:Z.EVENT_COLUMN_PIVOT_CHANGE_REQUEST,columns:t};this.eventService.dispatchEvent(u)}if(l){const u={type:Z.EVENT_COLUMN_ROW_GROUP_CHANGE_REQUEST,columns:i};this.eventService.dispatchEvent(u)}if(r){const u={type:Z.EVENT_COLUMN_VALUE_CHANGE_REQUEST,columns:i};this.eventService.dispatchEvent(u)}}setAllPivotActive(o,e,t){const s=[],r=e?l=>{if(!l.isAnyFunctionActive())if(l.isAllowValue()){const d=typeof l.getAggFunc()=="string"?l.getAggFunc():this.aggFuncService.getDefaultAggFunc(l);s.push({colId:l.getId(),aggFunc:d})}else l.isAllowRowGroup()?s.push({colId:l.getId(),rowGroup:!0}):l.isAllowPivot()&&s.push({colId:l.getId(),pivot:!0})}:l=>{(l.isPivotActive()||l.isRowGroupActive()||l.isValueActive())&&s.push({colId:l.getId(),pivot:!1,rowGroup:!1,aggFunc:null})};o.forEach(r),s.length>0&&this.columnModel.applyColumnState({state:s},t)}updateColumns(o){const{columns:e,visibleState:t,pivotState:s,eventType:i}=o,n=e.map(r=>{const l=r.getColId();if(this.columnModel.isPivotMode()){const d=s?.[l];return{colId:l,pivot:d?.pivot,rowGroup:d?.rowGroup,aggFunc:d?.aggFunc}}else return{colId:l,hide:!t?.[l]}});this.columnModel.applyColumnState({state:n},i)}createPivotState(o){return{pivot:o.isPivotActive(),rowGroup:o.isRowGroupActive(),aggFunc:o.isValueActive()?o.getAggFunc():void 0}}};a([N("aggFuncService")],E.prototype,"aggFuncService",2),a([N("columnModel")],E.prototype,"columnModel",2),a([N("gridOptionsService")],E.prototype,"gos",2),a([N("eventService")],E.prototype,"eventService",2),E=a([vt("modelItemUtils")],E);var ft="31.3.4",Et={version:ft,moduleName:Se.ColumnsToolPanelModule,beans:[E],agStackComponents:[{componentName:"AgPrimaryColsHeader",componentClass:Te},{componentName:"AgPrimaryColsList",componentClass:ot},{componentName:"AgPrimaryCols",componentClass:W}],userComponents:[{componentName:"agColumnsToolPanel",componentClass:mt}],dependantModules:[Le,Ct,gt]};export{Et as ColumnsToolPanelModule,W as PrimaryColsPanel};

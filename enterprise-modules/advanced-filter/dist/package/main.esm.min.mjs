var Fe=Object.defineProperty,Ie=Object.defineProperties,Ne=Object.getOwnPropertyDescriptor,ke=Object.getOwnPropertyDescriptors,Pe=Object.getOwnPropertySymbols,Re=Object.prototype.hasOwnProperty,Ge=Object.prototype.propertyIsEnumerable,Ce=(e,t,i)=>t in e?Fe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,z=(e,t)=>{for(var i in t||(t={}))Re.call(t,i)&&Ce(e,i,t[i]);if(Pe)for(var i of Pe(t))Ge.call(t,i)&&Ce(e,i,t[i]);return e},Q=(e,t)=>Ie(e,ke(t)),l=(e,t,i,s)=>{for(var r=s>1?void 0:s?Ne(t,i):t,a=e.length-1,n;a>=0;a--)(n=e[a])&&(r=(s?n(t,i,r):n(r))||r);return s&&r&&Fe(t,i,r),r};import{ModuleNames as We}from"@ag-grid-community/core";import{EnterpriseCoreModule as He}from"@ag-grid-enterprise/core";import{AgAutocomplete as U,Autowired as Y,Component as Ue,PostConstruct as je,RefSelector as _,_ as A}from"@ag-grid-community/core";import{AgDialog as ye,Autowired as j,BeanStub as $e,Events as X,PostConstruct as Ke,_ as Z}from"@ag-grid-community/core";import{Autowired as ee,Component as qe,Events as Je,KeyCode as w,PostConstruct as ze,_ as T}from"@ag-grid-community/core";var I=class extends qe{constructor(e){super(`
            <div class="ag-advanced-filter-header" role="row">
            </div>`),this.enabled=e}postConstruct(){this.setupAdvancedFilter(this.enabled),this.addDestroyFunc(()=>this.destroyBean(this.eAdvancedFilter)),this.addManagedListener(this.eventService,Je.EVENT_GRID_COLUMNS_CHANGED,()=>this.onGridColumnsChanged()),this.addGuiEventListener("keydown",e=>this.onKeyDown(e)),this.addGuiEventListener("focusout",e=>{this.getFocusableElement().contains(e.relatedTarget)||this.focusService.clearAdvancedFilterColumn()})}getFocusableElement(){var e,t;return(t=(e=this.eAdvancedFilter)==null?void 0:e.getGui())!=null?t:this.getGui()}setEnabled(e){e!==this.enabled&&this.setupAdvancedFilter(e)}refresh(){var e;(e=this.eAdvancedFilter)==null||e.refresh()}getHeight(){return this.height}setInputDisabled(e){var t;(t=this.eAdvancedFilter)==null||t.setInputDisabled(e)}setupAdvancedFilter(e){const t=this.getGui();if(e){this.eAdvancedFilter=this.createBean(new E);const i=this.eAdvancedFilter.getGui();this.eAdvancedFilter.addCssClass("ag-advanced-filter-header-cell"),this.height=this.columnModel.getFloatingFiltersHeight();const s=`${this.height}px`;t.style.height=s,t.style.minHeight=s,this.setAriaRowIndex(),T.setAriaRole(i,"gridcell"),T.setAriaColIndex(i,1),this.setAriaColumnCount(i),t.appendChild(i)}else T.clearElement(t),this.destroyBean(this.eAdvancedFilter),this.height=0;T.setDisplayed(t,e),this.enabled=e}setAriaColumnCount(e){T.setAriaColSpan(e,this.columnModel.getAllGridColumns().length)}setAriaRowIndex(){T.setAriaRowIndex(this.getGui(),this.headerNavigationService.getHeaderRowCount())}onGridColumnsChanged(){this.eAdvancedFilter&&(this.setAriaColumnCount(this.eAdvancedFilter.getGui()),this.setAriaRowIndex())}onKeyDown(e){switch(e.key){case w.ENTER:{this.hasFocus()&&this.focusService.focusInto(this.getFocusableElement())&&e.preventDefault();break}case w.ESCAPE:this.hasFocus()||this.getFocusableElement().focus();break;case w.UP:this.navigateUpDown(!0,e);break;case w.DOWN:this.navigateUpDown(!1,e);break;case w.TAB:if(this.hasFocus())this.navigateLeftRight(e);else{const t=this.focusService.findNextFocusableElement(this.getFocusableElement(),null,e.shiftKey);t?(e.preventDefault(),t.focus()):this.navigateLeftRight(e)}break}}navigateUpDown(e,t){this.hasFocus()&&this.focusService.focusNextFromAdvancedFilter(e)&&t.preventDefault()}navigateLeftRight(e){(e.shiftKey?this.focusService.focusLastHeader():this.focusService.focusNextFromAdvancedFilter(!1,!0))&&e.preventDefault()}hasFocus(){return this.gos.getActiveDomElement()===this.getFocusableElement()}};l([ee("columnModel")],I.prototype,"columnModel",2),l([ee("focusService")],I.prototype,"focusService",2),l([ee("headerNavigationService")],I.prototype,"headerNavigationService",2),l([ze],I.prototype,"postConstruct",1);import{Autowired as $,Component as Qe,PostConstruct as Ye,RefSelector as te,TooltipFeature as Xe,VirtualList as Ze,_ as xe}from"@ag-grid-community/core";import{Autowired as ie,DragAndDropService as et,DragSourceType as tt,Events as se,KeyCode as re,PostConstruct as it,RefSelector as F,TabGuardComp as st,TooltipFeature as N,_ as c}from"@ag-grid-community/core";import{AgRichSelect as rt,_ as K}from"@ag-grid-community/core";var Ae=class extends rt{constructor(e){super(Q(z({},e),{template:`
                <div class="ag-picker-field" role="presentation">
                    <div ref="eLabel"></div>
                    <div ref="eWrapper" class="ag-wrapper ag-picker-collapsed">
                        <div ref="eDisplayField" class="ag-picker-field-display"></div>
                        <ag-input-text-field ref="eInput" class="ag-rich-select-field-input"></ag-input-text-field>
                        <div ref="eIcon" class="ag-picker-field-icon" aria-hidden="true"></div>
                    </div>
                </div>`})),this.params=e}showPicker(){setTimeout(()=>super.showPicker())}hidePicker(){setTimeout(()=>super.hidePicker())}postConstruct(){super.postConstruct();const{wrapperClassName:e,ariaLabel:t}=this.params;K.setDisplayed(this.eDisplayField,!1),e&&this.eWrapper.classList.add(e),K.setAriaLabelledBy(this.eWrapper,""),K.setAriaLabel(this.eWrapper,t)}onEnterKeyDown(e){K.stopPropagationForAgGrid(e),this.isPickerDisplayed?super.onEnterKeyDown(e):(e.preventDefault(),this.showPicker())}};import{BeanStub as at,DragSourceType as nt,PostConstruct as ot,VirtualListDragFeature as lt}from"@ag-grid-community/core";var q=class fe extends at{constructor(t,i){super(),this.comp=t,this.virtualList=i}postConstruct(){this.createManagedBean(new lt(this.comp,this.virtualList,{dragSourceType:nt.AdvancedFilterBuilder,listItemDragStartEvent:fe.EVENT_DRAG_STARTED,listItemDragEndEvent:fe.EVENT_DRAG_ENDED,eventSource:this,getCurrentDragValue:t=>this.getCurrentDragValue(t),isMoveBlocked:()=>!1,getNumRows:t=>t.getNumItems(),moveItem:(t,i)=>this.moveItem(t,i)}))}getCurrentDragValue(t){return t.item}moveItem(t,i){this.comp.moveItem(t,i)}};q.EVENT_DRAG_STARTED="advancedFilterBuilderDragStarted",q.EVENT_DRAG_ENDED="advancedFilterBuilderDragEnded",l([ot],q.prototype,"postConstruct",1);var ae=q;import{BeanStub as dt,KeyCode as k,PostConstruct as ut,_ as M}from"@ag-grid-community/core";var ne=class extends dt{constructor(e,t,i){super(),this.eGui=e,this.focusWrapper=t,this.eFocusableComp=i}postConstruct(){this.addManagedListener(this.eGui,"keydown",e=>{switch(e.key){case k.TAB:e.defaultPrevented||M.stopPropagationForAgGrid(e);break;case k.UP:case k.DOWN:M.stopPropagationForAgGrid(e);break;case k.ESCAPE:if(M.isStopPropagationForAgGrid(e))return;this.eGui.contains(this.gos.getActiveDomElement())&&(e.preventDefault(),M.stopPropagationForAgGrid(e),this.focusWrapper.focus());break}}),this.addManagedListener(this.focusWrapper,"keydown",e=>{switch(e.key){case k.ENTER:if(M.isStopPropagationForAgGrid(e))return;this.gos.getActiveDomElement()===this.focusWrapper&&(e.preventDefault(),M.stopPropagationForAgGrid(e),this.eFocusableComp.getFocusableElement().focus());break}}),this.addManagedListener(this.focusWrapper,"focusin",()=>{this.focusWrapper.classList.add("ag-advanced-filter-builder-virtual-list-item-highlight")}),this.addManagedListener(this.focusWrapper,"focusout",e=>{this.focusWrapper.contains(e.relatedTarget)||this.focusWrapper.classList.remove("ag-advanced-filter-builder-virtual-list-item-highlight")})}};l([ut],ne.prototype,"postConstruct",1);function be(e,t){return{pickerAriaLabelKey:"ariaLabelAdvancedFilterBuilderAddField",pickerAriaLabelValue:"Advanced Filter Builder Add Field",pickerType:"ag-list",valueList:[{key:"condition",displayValue:e("advancedFilterBuilderAddCondition")},{key:"join",displayValue:e("advancedFilterBuilderAddJoin")}],valueFormatter:i=>{var s;return i==null?null:(s=i.displayValue)!=null?s:i.key},pickerIcon:"advancedFilterBuilderAdd",maxPickerWidth:`${t??120}px`,wrapperClassName:"ag-advanced-filter-builder-item-button",ariaLabel:e("advancedFilterBuilderAddButtonTooltip")}}import{Autowired as De,Component as pt,_ as R}from"@ag-grid-community/core";var m=class{};m.EVENT_ADDED="advancedFilterBuilderAdded",m.EVENT_MOVED="advancedFilterBuilderMoved",m.EVENT_REMOVED="advancedFilterBuilderRemoved",m.EVENT_VALUE_CHANGED="advancedFilterBuilderValueChanged",m.EVENT_VALID_CHANGED="advancedFilterBuilderValidChanged";var oe=class extends pt{constructor(){super(`
            <div class="ag-advanced-filter-builder-item-condition" role="presentation"></div>
        `),this.validationMessage=null}init(e){const{item:t,createPill:i}=e;this.item=t,this.createPill=i,this.filterModel=t.filterModel,this.setupColumnCondition(this.filterModel),this.validate(),this.addDestroyFunc(()=>this.destroyBeans([this.eColumnPill,this.eOperatorPill,this.eOperandPill]))}getDragName(){return this.filterModel.colId?this.advancedFilterExpressionService.parseColumnFilterModel(this.filterModel):this.getDefaultColumnDisplayValue()}getAriaLabel(){return`${this.advancedFilterExpressionService.translate("ariaAdvancedFilterBuilderFilterItem")} ${this.getDragName()}`}getValidationMessage(){return this.validationMessage}getFocusableElement(){return this.eColumnPill.getFocusableElement()}setupColumnCondition(e){var t;const i=this.advancedFilterExpressionService.getColumnDetails(e.colId);this.baseCellDataType=i.baseCellDataType,this.column=i.column,this.numOperands=this.getNumOperands(this.getOperatorKey()),this.eColumnPill=this.createPill({key:this.getColumnKey(),displayValue:(t=this.getColumnDisplayValue())!=null?t:this.getDefaultColumnDisplayValue(),cssClass:"ag-advanced-filter-builder-column-pill",isSelect:!0,getEditorParams:()=>({values:this.advancedFilterExpressionService.getColumnAutocompleteEntries()}),update:s=>this.setColumnKey(s),pickerAriaLabelKey:"ariaLabelAdvancedFilterBuilderColumnSelectField",pickerAriaLabelValue:"Advanced Filter Builder Column Select Field",ariaLabel:this.advancedFilterExpressionService.translate("ariaAdvancedFilterBuilderColumn")}),this.getGui().appendChild(this.eColumnPill.getGui()),R.exists(this.getColumnKey())&&(this.createOperatorPill(),this.hasOperand()&&this.createOperandPill())}createOperatorPill(){var e;this.eOperatorPill=this.createPill({key:this.getOperatorKey(),displayValue:(e=this.getOperatorDisplayValue())!=null?e:this.getDefaultOptionSelectValue(),cssClass:"ag-advanced-filter-builder-option-pill",isSelect:!0,getEditorParams:()=>({values:this.getOperatorAutocompleteEntries()}),update:t=>this.setOperatorKey(t),pickerAriaLabelKey:"ariaLabelAdvancedFilterBuilderOptionSelectField",pickerAriaLabelValue:"Advanced Filter Builder Option Select Field",ariaLabel:this.advancedFilterExpressionService.translate("ariaAdvancedFilterBuilderOption")}),this.eColumnPill.getGui().insertAdjacentElement("afterend",this.eOperatorPill.getGui())}createOperandPill(){var e;const t=(e=this.getOperandDisplayValue())!=null?e:"";this.eOperandPill=this.createPill({key:t,displayValue:t,baseCellDataType:this.baseCellDataType,cssClass:"ag-advanced-filter-builder-value-pill",isSelect:!1,update:i=>this.setOperand(i),ariaLabel:this.advancedFilterExpressionService.translate("ariaAdvancedFilterBuilderValue")}),this.getGui().appendChild(this.eOperandPill.getGui())}getColumnKey(){return this.filterModel.colId}getColumnDisplayValue(){return this.advancedFilterExpressionService.getColumnDisplayValue(this.filterModel)}getOperatorKey(){return this.filterModel.type}getOperatorDisplayValue(){return this.advancedFilterExpressionService.getOperatorDisplayValue(this.filterModel)}getOperandDisplayValue(){return this.advancedFilterExpressionService.getOperandDisplayValue(this.filterModel,!0)}hasOperand(){return this.numOperands>0}getOperatorAutocompleteEntries(){return this.column?this.advancedFilterExpressionService.getOperatorAutocompleteEntries(this.column,this.baseCellDataType):[]}setColumnKey(e){this.eOperatorPill||this.createOperatorPill();const t=this.advancedFilterExpressionService.getColumnDetails(e);this.column=t.column;const i=t.baseCellDataType;this.baseCellDataType!==i&&(this.baseCellDataType=i,this.setOperatorKey(void 0),this.eOperatorPill&&(R.removeFromParent(this.eOperatorPill.getGui()),this.destroyBean(this.eOperatorPill),this.createOperatorPill()),this.validate()),this.filterModel.colId=e,this.filterModel.filterType=this.baseCellDataType}setOperatorKey(e){const t=this.getNumOperands(e);t!==this.numOperands&&(this.numOperands=t,t===0?this.destroyOperandPill():(this.createOperandPill(),this.baseCellDataType!=="number"&&this.setOperand(""))),this.filterModel.type=e,this.validate()}setOperand(e){var t;let i=e;this.column&&(i=(t=this.advancedFilterExpressionService.getOperandModelValue(e,this.baseCellDataType,this.column))!=null?t:""),this.filterModel.filter=i,this.validate()}getNumOperands(e){var t,i;return(i=(t=this.advancedFilterExpressionService.getExpressionOperator(this.baseCellDataType,e))==null?void 0:t.numOperands)!=null?i:0}destroyOperandPill(){delete this.filterModel.filter,this.getGui().removeChild(this.eOperandPill.getGui()),this.destroyBean(this.eOperandPill),this.eOperandPill=void 0}validate(){let e=null;R.exists(this.getColumnKey())?R.exists(this.getOperatorKey())?this.numOperands>0&&!R.exists(this.getOperandDisplayValue())&&(e=this.advancedFilterExpressionService.translate("advancedFilterBuilderValidationEnterValue")):e=this.advancedFilterExpressionService.translate("advancedFilterBuilderValidationSelectOption"):e=this.advancedFilterExpressionService.translate("advancedFilterBuilderValidationSelectColumn"),this.item.valid=!e,e!==this.validationMessage&&(this.validationMessage=e,this.dispatchEvent({type:m.EVENT_VALID_CHANGED}))}getDefaultColumnDisplayValue(){return this.advancedFilterExpressionService.translate("advancedFilterBuilderSelectColumn")}getDefaultOptionSelectValue(){return this.advancedFilterExpressionService.translate("advancedFilterBuilderSelectOption")}};l([De("advancedFilterExpressionService")],oe.prototype,"advancedFilterExpressionService",2),l([De("valueService")],oe.prototype,"valueService",2);import{AgInputDateField as ct,AgInputNumberField as ht,AgInputTextField as vt,Autowired as mt,Component as gt,Events as ft,KeyCode as le,PostConstruct as Et,RefSelector as Be,_ as b}from"@ag-grid-community/core";var G=class extends gt{constructor(e){super(`
            <div class="ag-advanced-filter-builder-pill-wrapper" role="presentation">
                <div ref="ePill" class="ag-advanced-filter-builder-pill" role="button">
                    <span ref="eLabel" class="ag-advanced-filter-builder-pill-display"></span>
                </div>
            </div>
        `),this.params=e,this.value=e.value}postConstruct(){const{cssClass:e,ariaLabel:t}=this.params;this.ePill.classList.add(e),this.activateTabIndex([this.ePill]),this.eLabel.id=`${this.getCompId()}`,b.setAriaDescribedBy(this.ePill,this.eLabel.id),b.setAriaLabel(this.ePill,t),this.renderValue(),this.addManagedListener(this.ePill,"click",i=>{i.preventDefault(),this.showEditor()}),this.addManagedListener(this.ePill,"keydown",i=>{switch(i.key){case le.ENTER:i.preventDefault(),b.stopPropagationForAgGrid(i),this.showEditor();break}}),this.addDestroyFunc(()=>this.destroyBean(this.eEditor))}getFocusableElement(){return this.ePill}showEditor(){if(this.eEditor)return;b.setDisplayed(this.ePill,!1),this.eEditor=this.createEditorComp(this.params.type),this.eEditor.setValue(this.value);const e=this.eEditor.getGui();this.eEditor.addManagedListener(e,"keydown",t=>{switch(t.key){case le.ENTER:t.preventDefault(),b.stopPropagationForAgGrid(t),this.updateValue(!0);break;case le.ESCAPE:t.preventDefault(),b.stopPropagationForAgGrid(t),this.hideEditor(!0);break}}),this.eEditor.addManagedListener(e,"focusout",()=>{this.updateValue(!1)}),this.getGui().appendChild(e),this.eEditor.getFocusableElement().focus()}createEditorComp(e){let t;switch(e){case"text":t=new vt;break;case"number":t=new ht;break;case"date":t=new ct;break}return this.createBean(t)}hideEditor(e){const{eEditor:t}=this;t&&(this.eEditor=void 0,this.getGui().removeChild(t.getGui()),this.destroyBean(t),b.setDisplayed(this.ePill,!0),e&&this.ePill.focus())}renderValue(){let e;this.eLabel.classList.remove("ag-advanced-filter-builder-value-empty","ag-advanced-filter-builder-value-number","ag-advanced-filter-builder-value-text"),b.exists(this.value)?this.params.type==="number"?(e=this.value,this.eLabel.classList.add("ag-advanced-filter-builder-value-number")):(e=`"${this.value}"`,this.eLabel.classList.add("ag-advanced-filter-builder-value-text")):(e=this.advancedFilterExpressionService.translate("advancedFilterBuilderEnterValue"),this.eLabel.classList.add("ag-advanced-filter-builder-value-empty")),this.eLabel.innerText=e}updateValue(e){var t;if(!this.eEditor)return;const i=(t=this.eEditor.getValue())!=null?t:"";this.dispatchEvent({type:ft.EVENT_FIELD_VALUE_CHANGED,value:i}),this.value=i,this.renderValue(),this.hideEditor(e)}};l([Be("ePill")],G.prototype,"ePill",2),l([Be("eLabel")],G.prototype,"eLabel",2),l([mt("advancedFilterExpressionService")],G.prototype,"advancedFilterExpressionService",2),l([Et],G.prototype,"postConstruct",1);import{Autowired as Ft,Component as Pt}from"@ag-grid-community/core";var Se=class extends Pt{constructor(){super(`
            <div class="ag-advanced-filter-builder-item-condition" role="presentation"></div>
        `)}init(e){const{item:t,createPill:i}=e,s=t.filterModel;this.filterModel=s,this.ePill=i({key:s.type,displayValue:this.advancedFilterExpressionService.parseJoinOperator(s),cssClass:"ag-advanced-filter-builder-join-pill",isSelect:!0,getEditorParams:()=>({values:this.advancedFilterExpressionService.getJoinOperatorAutocompleteEntries()}),update:r=>s.type=r,pickerAriaLabelKey:"ariaLabelAdvancedFilterBuilderJoinSelectField",pickerAriaLabelValue:"Advanced Filter Builder Join Operator Select Field",ariaLabel:this.advancedFilterExpressionService.translate("ariaAdvancedFilterBuilderJoinOperator")}),this.getGui().appendChild(this.ePill.getGui()),this.addDestroyFunc(()=>this.destroyBean(this.ePill))}getDragName(){return this.advancedFilterExpressionService.parseJoinOperator(this.filterModel)}getAriaLabel(){return`${this.advancedFilterExpressionService.translate("ariaAdvancedFilterBuilderGroupItem")} ${this.getDragName()}`}getValidationMessage(){return null}getFocusableElement(){return this.ePill.getFocusableElement()}};l([Ft("advancedFilterExpressionService")],Se.prototype,"advancedFilterExpressionService",2);import{AgRichSelect as Ct,_ as de}from"@ag-grid-community/core";var yt=class extends Ct{constructor(e){super(Q(z({},e),{template:`
                <div class="ag-picker-field ag-advanced-filter-builder-pill-wrapper" role="presentation">
                    <div ref="eLabel"></div>
                    <div ref="eWrapper" class="ag-wrapper ag-advanced-filter-builder-pill ag-picker-collapsed">
                        <div ref="eDisplayField" class="ag-picker-field-display ag-advanced-filter-builder-pill-display"></div>
                        <ag-input-text-field ref="eInput" class="ag-rich-select-field-input"></ag-input-text-field>
                        <div ref="eIcon" class="ag-picker-field-icon" aria-hidden="true"></div>
                    </div>
                </div>`})),this.params=e}getFocusableElement(){return this.eWrapper}showPicker(){setTimeout(()=>super.showPicker())}hidePicker(){setTimeout(()=>super.hidePicker())}postConstruct(){super.postConstruct();const{wrapperClassName:e,ariaLabel:t}=this.params;this.eWrapper.classList.add(e),de.setAriaLabelledBy(this.eWrapper,""),de.setAriaLabel(this.eWrapper,t)}createPickerComponent(){var e;if(!this.values){const{values:t}=this.params.getEditorParams();this.values=t;const i=this.value.key,s=(e=t.find(r=>r.key===i))!=null?e:{key:i,displayValue:this.value.displayValue};this.value=s}return super.createPickerComponent()}onEnterKeyDown(e){de.stopPropagationForAgGrid(e),this.isPickerDisplayed?super.onEnterKeyDown(e):(e.preventDefault(),this.showPicker())}},g=class extends st{constructor(e,t,i){super(`
            <div class="ag-advanced-filter-builder-item-wrapper" role="presentation">
                <div ref="eItem" class="ag-advanced-filter-builder-item" role="presentation">
                    <div ref="eTreeLines" class="ag-advanced-filter-builder-item-tree-lines" aria-hidden="true"></div>
                    <span ref="eDragHandle" class="ag-drag-handle" aria-hidden="true"></span>
                    <span ref="eValidation" class="ag-advanced-filter-builder-item-button ag-advanced-filter-builder-invalid" aria-hidden="true"></span>
                </div>
                <div ref="eButtons" class="ag-advanced-filter-builder-item-buttons">
                    <span ref="eMoveUpButton" class="ag-advanced-filter-builder-item-button" role="button"></span>
                    <span ref="eMoveDownButton" class="ag-advanced-filter-builder-item-button" role="button"></span>
                    <div ref="eAddButton" role="presentation"></div>
                    <span ref="eRemoveButton" class="ag-advanced-filter-builder-item-button" role="button"></span>
                </div>
            </div>
        `),this.item=e,this.dragFeature=t,this.focusWrapper=i,this.moveUpDisabled=!1,this.moveDownDisabled=!1}postConstruct(){const{filterModel:e,level:t,showMove:i}=this.item,s=e.filterType==="join";if(this.ePillWrapper=this.createManagedBean(s?new Se:new oe),this.ePillWrapper.init({item:this.item,createPill:r=>this.createPill(r)}),this.eDragHandle.insertAdjacentElement("afterend",this.ePillWrapper.getGui()),t===0){const r=document.createElement("div");r.classList.add("ag-advanced-filter-builder-item-tree-line-vertical-bottom"),r.classList.add("ag-advanced-filter-builder-item-tree-line-root"),this.eTreeLines.appendChild(r),c.setDisplayed(this.eDragHandle,!1),c.setDisplayed(this.eButtons,!1),c.setAriaExpanded(this.focusWrapper,!0)}else this.setupTreeLines(t),this.eDragHandle.appendChild(c.createIconNoSpan("advancedFilterBuilderDrag",this.gos)),this.setupValidation(),this.setupMoveButtons(i),this.setupAddButton(),this.setupRemoveButton(),this.setupDragging(),this.updateAriaExpanded();c.setAriaLevel(this.focusWrapper,t+1),this.initialiseTabGuard({}),this.createManagedBean(new ne(this.getGui(),this.focusWrapper,this.ePillWrapper)),this.updateAriaLabel(),this.addManagedListener(this.ePillWrapper,m.EVENT_VALUE_CHANGED,()=>this.dispatchEvent({type:m.EVENT_VALUE_CHANGED})),this.addManagedListener(this.ePillWrapper,m.EVENT_VALID_CHANGED,()=>this.updateValidity())}setState(e){const{level:t}=this.item;if(t===0)return;const{showMove:i}=this.item,{disableMoveUp:s,disableMoveDown:r,treeLines:a,showStartTreeLine:n}=e;this.updateTreeLines(a,n),this.updateAriaExpanded(),i&&(this.moveUpDisabled=!!s,this.moveDownDisabled=!!r,this.eMoveUpButton.classList.toggle("ag-advanced-filter-builder-item-button-disabled",s),this.eMoveDownButton.classList.toggle("ag-advanced-filter-builder-item-button-disabled",r),c.setAriaDisabled(this.eMoveUpButton,!!s),c.setAriaDisabled(this.eMoveDownButton,!!r),this.moveUpTooltipFeature.refreshToolTip(),this.moveDownTooltipFeature.refreshToolTip())}focusMoveButton(e){(e?this.eMoveUpButton:this.eMoveDownButton).focus()}afterAdd(){this.ePillWrapper.getFocusableElement().focus()}setupTreeLines(e){for(let t=0;t<e;t++){const i=document.createElement("div");this.eTreeLines.appendChild(i)}}updateTreeLines(e,t){const i=e.length-1,{children:s}=this.eTreeLines;for(let a=0;a<i;a++){const n=s.item(a);n&&n.classList.toggle("ag-advanced-filter-builder-item-tree-line-vertical",!e[a])}const r=s.item(i);if(r){r.classList.add("ag-advanced-filter-builder-item-tree-line-horizontal");const a=e[i];r.classList.toggle("ag-advanced-filter-builder-item-tree-line-vertical-top",a),r.classList.toggle("ag-advanced-filter-builder-item-tree-line-vertical",!a)}this.eDragHandle.classList.toggle("ag-advanced-filter-builder-item-tree-line-vertical-bottom",t)}setupValidation(){this.eValidation.appendChild(c.createIconNoSpan("advancedFilterBuilderInvalid",this.gos)),this.validationTooltipFeature=this.createManagedBean(new N({getGui:()=>this.eValidation,getLocation:()=>"advancedFilter",getTooltipValue:()=>this.ePillWrapper.getValidationMessage(),getTooltipShowDelayOverride:()=>1e3})),this.updateValidity()}setupAddButton(){var e;const t=be(s=>this.advancedFilterExpressionService.translate(s),(e=this.gos.get("advancedFilterBuilderParams"))==null?void 0:e.addSelectWidth),i=this.createManagedBean(new Ae(t));this.addManagedListener(i,se.EVENT_FIELD_PICKER_VALUE_SELECTED,({value:s})=>this.dispatchEvent({type:m.EVENT_ADDED,item:this.item,isJoin:s.key==="join"})),this.eAddButton.appendChild(i.getGui()),this.createManagedBean(new N({getGui:()=>this.eAddButton,getLocation:()=>"advancedFilter",getTooltipValue:()=>this.advancedFilterExpressionService.translate("advancedFilterBuilderAddButtonTooltip")}))}setupRemoveButton(){this.eRemoveButton.appendChild(c.createIconNoSpan("advancedFilterBuilderRemove",this.gos)),this.addManagedListener(this.eRemoveButton,"click",()=>this.removeItem()),this.addManagedListener(this.eRemoveButton,"keydown",e=>{switch(e.key){case re.ENTER:e.preventDefault(),c.stopPropagationForAgGrid(e),this.removeItem();break}}),this.createManagedBean(new N({getGui:()=>this.eRemoveButton,getLocation:()=>"advancedFilter",getTooltipValue:()=>this.advancedFilterExpressionService.translate("advancedFilterBuilderRemoveButtonTooltip")})),c.setAriaLabel(this.eRemoveButton,this.advancedFilterExpressionService.translate("advancedFilterBuilderRemoveButtonTooltip")),this.activateTabIndex([this.eRemoveButton])}setupMoveButtons(e){e?(this.eMoveUpButton.appendChild(c.createIconNoSpan("advancedFilterBuilderMoveUp",this.gos)),this.addManagedListener(this.eMoveUpButton,"click",()=>this.moveItem(!0)),this.addManagedListener(this.eMoveUpButton,"keydown",t=>{switch(t.key){case re.ENTER:t.preventDefault(),c.stopPropagationForAgGrid(t),this.moveItem(!0);break}}),this.moveUpTooltipFeature=this.createManagedBean(new N({getGui:()=>this.eMoveUpButton,getLocation:()=>"advancedFilter",getTooltipValue:()=>this.moveUpDisabled?null:this.advancedFilterExpressionService.translate("advancedFilterBuilderMoveUpButtonTooltip")})),c.setAriaLabel(this.eMoveUpButton,this.advancedFilterExpressionService.translate("advancedFilterBuilderMoveUpButtonTooltip")),this.eMoveDownButton.appendChild(c.createIconNoSpan("advancedFilterBuilderMoveDown",this.gos)),this.addManagedListener(this.eMoveDownButton,"click",()=>this.moveItem(!1)),this.addManagedListener(this.eMoveDownButton,"keydown",t=>{switch(t.key){case re.ENTER:t.preventDefault(),c.stopPropagationForAgGrid(t),this.moveItem(!1);break}}),this.moveDownTooltipFeature=this.createManagedBean(new N({getGui:()=>this.eMoveDownButton,getLocation:()=>"advancedFilter",getTooltipValue:()=>this.moveDownDisabled?null:this.advancedFilterExpressionService.translate("advancedFilterBuilderMoveDownButtonTooltip")})),c.setAriaLabel(this.eMoveDownButton,this.advancedFilterExpressionService.translate("advancedFilterBuilderMoveDownButtonTooltip")),this.activateTabIndex([this.eMoveUpButton,this.eMoveDownButton])):(c.setDisplayed(this.eMoveUpButton,!1),c.setDisplayed(this.eMoveDownButton,!1))}updateValidity(){c.setVisible(this.eValidation,!this.item.valid),this.validationTooltipFeature.refreshToolTip(),this.updateAriaLabel()}createPill(e){var t,i;const{key:s,displayValue:r,cssClass:a,update:n,ariaLabel:o}=e,d=u=>{u!=null&&(n(u),this.dispatchEvent({type:m.EVENT_VALUE_CHANGED}))};if(e.isSelect){const{getEditorParams:u,pickerAriaLabelKey:p,pickerAriaLabelValue:h}=e,f=this.gos.get("advancedFilterBuilderParams"),v=`${(t=f?.pillSelectMinWidth)!=null?t:140}px`,O=`${(i=f?.pillSelectMaxWidth)!=null?i:200}px`,L=this.createBean(new yt({pickerAriaLabelKey:p,pickerAriaLabelValue:h,pickerType:"ag-list",value:{key:s,displayValue:r},valueFormatter:x=>{var Ee;return x==null?null:(Ee=x.displayValue)!=null?Ee:x.key},variableWidth:!0,minPickerWidth:v,maxPickerWidth:O,getEditorParams:u,wrapperClassName:a,ariaLabel:o}));return this.addManagedListener(L,se.EVENT_FIELD_PICKER_VALUE_SELECTED,({value:x})=>d(x?.key)),L}else{const u=this.createBean(new G({value:r,cssClass:a,type:this.getInputType(e.baseCellDataType),ariaLabel:o}));return this.addManagedListener(u,se.EVENT_FIELD_VALUE_CHANGED,({value:p})=>d(p)),u}}getInputType(e){switch(e){case"text":case"object":case"boolean":return"text";case"number":return"number";case"date":case"dateString":return"date"}}setupDragging(){const e={type:tt.AdvancedFilterBuilder,eElement:this.eDragHandle,dragItemName:()=>this.ePillWrapper.getDragName(),getDefaultIconName:()=>et.ICON_NOT_ALLOWED,getDragItem:()=>({}),onDragStarted:()=>this.dragFeature.dispatchEvent({type:ae.EVENT_DRAG_STARTED,item:this.item}),onDragStopped:()=>this.dragFeature.dispatchEvent({type:ae.EVENT_DRAG_ENDED})};this.dragAndDropService.addDragSource(e,!0),this.addDestroyFunc(()=>this.dragAndDropService.removeDragSource(e))}updateAriaLabel(){const e=this.ePillWrapper.getAriaLabel(),t=`${this.item.level+1}`,i=this.ePillWrapper.getValidationMessage();let s;i?s=this.advancedFilterExpressionService.translate("ariaAdvancedFilterBuilderItemValidation",[e,t,i]):s=this.advancedFilterExpressionService.translate("ariaAdvancedFilterBuilderItem",[e,t]),c.setAriaLabel(this.focusWrapper,s)}updateAriaExpanded(){c.removeAriaExpanded(this.focusWrapper);const{filterModel:e}=this.item;e?.filterType==="join"&&e.conditions.length&&c.setAriaExpanded(this.focusWrapper,!0)}removeItem(){this.dispatchEvent({type:m.EVENT_REMOVED,item:this.item})}moveItem(e){this.dispatchEvent({type:m.EVENT_MOVED,item:this.item,backwards:e})}};l([F("eTreeLines")],g.prototype,"eTreeLines",2),l([F("eDragHandle")],g.prototype,"eDragHandle",2),l([F("eItem")],g.prototype,"eItem",2),l([F("eButtons")],g.prototype,"eButtons",2),l([F("eValidation")],g.prototype,"eValidation",2),l([F("eMoveUpButton")],g.prototype,"eMoveUpButton",2),l([F("eMoveDownButton")],g.prototype,"eMoveDownButton",2),l([F("eAddButton")],g.prototype,"eAddButton",2),l([F("eRemoveButton")],g.prototype,"eRemoveButton",2),l([ie("beans")],g.prototype,"beans",2),l([ie("dragAndDropService")],g.prototype,"dragAndDropService",2),l([ie("advancedFilterExpressionService")],g.prototype,"advancedFilterExpressionService",2),l([it],g.prototype,"postConstruct",1);import{Autowired as Ve,Component as xt,Events as At,PostConstruct as bt,RefSelector as Dt,TooltipFeature as Bt,_ as Oe}from"@ag-grid-community/core";var W=class extends xt{constructor(e,t){super(`
            <div class="ag-advanced-filter-builder-item-wrapper" role="presentation">
                <div ref="eItem" class="ag-advanced-filter-builder-item" role="presentation">
                    <div class="ag-advanced-filter-builder-item-tree-lines" aria-hidden="true">
                        <div class="ag-advanced-filter-builder-item-tree-line-vertical-top ag-advanced-filter-builder-item-tree-line-horizontal"></div>
                    </div>
                </div>
            </div>
        `),this.item=e,this.focusWrapper=t}postConstruct(){var e;Oe.setAriaLevel(this.focusWrapper,2);const t=be(s=>this.advancedFilterExpressionService.translate(s),(e=this.gos.get("advancedFilterBuilderParams"))==null?void 0:e.addSelectWidth),i=this.createManagedBean(new Ae(t));this.addManagedListener(i,At.EVENT_FIELD_PICKER_VALUE_SELECTED,({value:s})=>{this.dispatchEvent({type:m.EVENT_ADDED,item:this.item,isJoin:s.key==="join"})}),this.eItem.appendChild(i.getGui()),this.createManagedBean(new Bt({getGui:()=>i.getGui(),getLocation:()=>"advancedFilter",getTooltipValue:()=>this.advancedFilterExpressionService.translate("advancedFilterBuilderAddButtonTooltip")})),this.createManagedBean(new ne(this.getGui(),this.focusWrapper,i)),Oe.setAriaLabel(this.focusWrapper,this.advancedFilterExpressionService.translate("ariaAdvancedFilterBuilderItem",[this.advancedFilterExpressionService.translate("advancedFilterBuilderAddButtonTooltip"),`${this.item.level+1}`]))}afterAdd(){}};l([Ve("beans")],W.prototype,"beans",2),l([Ve("advancedFilterExpressionService")],W.prototype,"advancedFilterExpressionService",2),l([Dt("eItem")],W.prototype,"eItem",2),l([bt],W.prototype,"postConstruct",1);var P=class extends Qe{constructor(){super(`
            <div role="presentation" class="ag-advanced-filter-builder" tabindex="-1">
                <div role="presentation" class="ag-advanced-filter-builder-list" ref="eList"></div>
                <div role="presentation" class="ag-advanced-filter-builder-button-panel">
                    <button class="ag-button ag-standard-button ag-advanced-filter-builder-apply-button" ref="eApplyFilterButton"></button>
                    <button class="ag-button ag-standard-button ag-advanced-filter-builder-cancel-button" ref="eCancelFilterButton"></button>
                </div>
            </div>`),this.validationMessage=null}postConstruct(){var e;const{showMoveButtons:t}=(e=this.gos.get("advancedFilterBuilderParams"))!=null?e:{};this.showMove=!!t,this.addManagedPropertyListener("advancedFilterBuilderParams",({currentValue:i})=>{this.showMove=!!i?.showMoveButtons,this.refreshList(!1)}),this.filterModel=this.setupFilterModel(),this.setupVirtualList(),this.dragFeature=this.createManagedBean(new ae(this,this.virtualList)),this.setupButtons()}refresh(){let e=this.virtualList.getLastFocusedRow();this.setupFilterModel(),this.validateItems(),this.refreshList(!1),e!=null&&(this.virtualList.getComponentAt(e)||(e=0),this.virtualList.focusRow(e))}getNumItems(){return this.items.length}moveItem(e,t){!t||!e||this.moveItemToIndex(e,t.rowIndex,t.position)}afterGuiAttached(){this.virtualList.focusRow(0)}setupVirtualList(){this.virtualList=this.createManagedBean(new Ze({cssIdentifier:"advanced-filter-builder",ariaRole:"tree",listName:this.advancedFilterExpressionService.translate("ariaAdvancedFilterBuilderList")})),this.virtualList.setComponentCreator(this.createItemComponent.bind(this)),this.virtualList.setComponentUpdater(this.updateItemComponent.bind(this)),this.virtualList.setRowHeight(40),this.eList.appendChild(this.virtualList.getGui()),this.virtualList.setModel({getRowCount:()=>this.items.length,getRow:e=>this.items[e],areRowsEqual:(e,t)=>e===t}),this.buildList(),this.virtualList.refresh()}setupButtons(){this.eApplyFilterButton.innerText=this.advancedFilterExpressionService.translate("advancedFilterBuilderApply"),this.activateTabIndex([this.eApplyFilterButton]),this.addManagedListener(this.eApplyFilterButton,"click",()=>{this.advancedFilterService.setModel(this.filterModel),this.filterManager.onFilterChanged({source:"advancedFilter"}),this.close()}),this.validationTooltipFeature=this.createManagedBean(new Xe({getGui:()=>this.eApplyFilterButton,getLocation:()=>"advancedFilter",getTooltipValue:()=>this.validationMessage,getTooltipShowDelayOverride:()=>1e3})),this.validate(),this.addManagedListener(this.eApplyFilterButton,"mouseenter",()=>this.addOrRemoveCssClass("ag-advanced-filter-builder-validation",!0)),this.addManagedListener(this.eApplyFilterButton,"mouseleave",()=>this.addOrRemoveCssClass("ag-advanced-filter-builder-validation",!1)),this.eCancelFilterButton.innerText=this.advancedFilterExpressionService.translate("advancedFilterBuilderCancel"),this.activateTabIndex([this.eCancelFilterButton]),this.addManagedListener(this.eCancelFilterButton,"click",()=>this.close())}removeItemFromParent(e){const t=e.parent.conditions.indexOf(e.filterModel);return e.parent.conditions.splice(t,1),t}moveItemToIndex(e,t,i){var s;const r=this.items[t],a=((s=r.filterModel)==null?void 0:s.filterType)==="join"&&i==="bottom",n=a?r.filterModel:r.parent;if(!n||this.isChildOrSelf(n,e.filterModel)||r===e)return;this.removeItemFromParent(e);let o;a?o=0:(o=n.conditions.indexOf(r.filterModel),o===-1?o=n.conditions.length:i==="bottom"&&(o+=1)),n.conditions.splice(o,0,e.filterModel),this.refreshList(!1)}isChildOrSelf(e,t){return e===t||t.filterType==="join"&&t.conditions.some(i=>this.isChildOrSelf(e,i))}setupFilterModel(){const e=this.formatFilterModel(this.advancedFilterService.getModel());return this.stringifiedModel=JSON.stringify(e),e}formatFilterModel(e){return e=e??{filterType:"join",type:"AND",conditions:[]},e.filterType!=="join"&&(e={filterType:"join",type:"AND",conditions:[e]}),e}buildList(){const e=(t,i,s,r)=>{i.push({filterModel:t,level:s,parent:r,valid:!0,showMove:this.showMove}),t.filterType==="join"&&(t.conditions.forEach(a=>e(a,i,s+1,t)),s===0&&i.push({filterModel:null,level:s+1,parent:t,valid:!0}))};this.items=[],e(this.filterModel,this.items,0)}refreshList(e){if(!e){const t=[];this.items.forEach(i=>{i.valid||t.push(i.filterModel)}),this.buildList(),t.length&&this.items.forEach(i=>{i.filterModel&&t.includes(i.filterModel)&&(i.valid=!1)})}this.virtualList.refresh(e),this.validate()}updateItemComponent(e,t){const i=this.items.indexOf(e),s=(o,d)=>{const u=this.items.find(h=>h.filterModel===o),p=u?.parent;if(p){const{conditions:h}=p;s(p,d),d.push(h[h.length-1]===o)}},r=[],{filterModel:a}=e;a&&(s(a,r),r[0]=!1);const n=a?.filterType==="join"&&!!a.conditions.length;t.setState({disableMoveUp:i===1,disableMoveDown:!this.canMoveDown(e,i),treeLines:r,showStartTreeLine:n})}createItemComponent(e,t){const i=this.createBean(e.filterModel?new g(e,this.dragFeature,t):new W(e,t));return i.addManagedListener(i,m.EVENT_REMOVED,({item:s})=>this.removeItem(s)),i.addManagedListener(i,m.EVENT_VALUE_CHANGED,()=>this.validate()),i.addManagedListener(i,m.EVENT_ADDED,({item:s,isJoin:r})=>this.addItem(s,r)),i.addManagedListener(i,m.EVENT_MOVED,({item:s,backwards:r})=>this.moveItemUpDown(s,r)),i instanceof g&&this.updateItemComponent(e,i),i}addItem(e,t){var i;const{parent:s,level:r,filterModel:a}=e,n=a?.filterType==="join",o=t?{filterType:"join",type:"AND",conditions:[]}:{},d=n?a:s;let u=n?0:d.conditions.indexOf(a);u>=0?(n||(u+=1),d.conditions.splice(u,0,o)):d.conditions.push(o);let p=this.items.indexOf(e);const h=p>=0;if(h){e.filterModel&&p++;const f=[{filterModel:o,level:n?r+1:r,parent:d,valid:t,showMove:this.showMove}];this.items.splice(p,0,...f)}this.refreshList(h),h&&((i=this.virtualList.getComponentAt(p))==null||i.afterAdd())}removeItem(e){var t;const i=e.parent,{filterModel:s}=e,r=i.conditions.indexOf(s);i.conditions.splice(r,1);const a=((t=e.filterModel)==null?void 0:t.filterType)==="join",n=this.items.indexOf(e),o=!a&&n>=0;o&&this.items.splice(n,1),this.refreshList(o),n>=0&&this.virtualList.focusRow(n)}moveItemUpDown(e,t){const i=this.items.indexOf(e),s=t?i-1:i+1;if(s===0||!t&&!this.canMoveDown(e,i))return;const r=this.items[s],a=this.removeItemFromParent(e),{level:n,filterModel:o,parent:d}=e,{level:u,filterModel:p,parent:h}=r;if(t)if(u===n&&p.filterType==="join")p.conditions.push(o);else if(u<=n){const v=h.conditions.indexOf(p);h.conditions.splice(v,0,o)}else d.conditions[a-1].conditions.push(o);else if(u===n)if(p.filterType==="join")p.conditions.splice(0,0,o);else{const v=h.conditions.indexOf(p);h.conditions.splice(v+1,0,o)}else if(a<d.conditions.length)d.conditions.splice(a+1,0,o);else{const v=this.items.find(L=>L.filterModel===d),O=v.parent.conditions.indexOf(v.filterModel)+1;v.parent.conditions.splice(O,0,o)}this.refreshList(!1);const f=this.items.findIndex(({filterModel:v})=>v===o);if(f>=0){const v=this.virtualList.getComponentAt(f);v instanceof g&&v.focusMoveButton(t)}}canMoveDown(e,t){return!(e.level===1&&t===this.items.length-2||e.level===1&&e.parent.conditions[e.parent.conditions.length-1]===e.filterModel)}close(){this.advancedFilterService.getCtrl().toggleFilterBuilder("ui")}validate(){let e=!this.items.every(({valid:t})=>t);e?this.validationMessage=this.advancedFilterExpressionService.translate("advancedFilterBuilderValidationIncomplete"):(e=JSON.stringify(this.filterModel)===this.stringifiedModel,e?this.validationMessage=this.advancedFilterExpressionService.translate("advancedFilterBuilderValidationAlreadyApplied"):this.validationMessage=null),xe.setDisabled(this.eApplyFilterButton,e),this.validationTooltipFeature.refreshToolTip()}validateItems(){const e=i=>{i.type=void 0},t=i=>{delete i.filter};this.items.forEach(i=>{if(!i.valid||!i.filterModel||i.filterModel.filterType==="join")return;const{filterModel:s}=i,{colId:r}=s,a=this.advancedFilterExpressionService.getColumnAutocompleteEntries().find(({key:u})=>u===r),n=this.advancedFilterExpressionService.getColumnDetails(s.colId);if(!a||!n.column){i.valid=!1,s.colId=void 0,e(s),t(s);return}const d=this.advancedFilterExpressionService.getDataTypeExpressionOperator(n.baseCellDataType).operators[s.type];if(!d){i.valid=!1,e(s),t(s);return}if(d.numOperands>0&&!xe.exists(s.filter)){i.valid=!1;return}})}};l([te("eList")],P.prototype,"eList",2),l([te("eApplyFilterButton")],P.prototype,"eApplyFilterButton",2),l([te("eCancelFilterButton")],P.prototype,"eCancelFilterButton",2),l([$("filterManager")],P.prototype,"filterManager",2),l([$("advancedFilterService")],P.prototype,"advancedFilterService",2),l([$("advancedFilterExpressionService")],P.prototype,"advancedFilterExpressionService",2),l([$("beans")],P.prototype,"beans",2),l([Ye],P.prototype,"postConstruct",1);var S=class _e extends $e{constructor(t){super(),this.enabled=t}postConstruct(){this.hasAdvancedFilterParent=!!this.gos.get("advancedFilterParent"),this.ctrlsService.whenReady(()=>this.setAdvancedFilterComp()),this.addManagedListener(this.eventService,X.EVENT_ADVANCED_FILTER_ENABLED_CHANGED,({enabled:t})=>this.onEnabledChanged(t)),this.addManagedPropertyListener("advancedFilterParent",()=>this.updateComps()),this.addDestroyFunc(()=>{this.destroyAdvancedFilterComp(),this.destroyBean(this.eBuilderComp),this.eBuilderDialog&&this.eBuilderDialog.isAlive()&&this.destroyBean(this.eBuilderDialog)})}setupHeaderComp(t){this.eHeaderComp=this.createManagedBean(new I(this.enabled&&!this.hasAdvancedFilterParent)),t.insertAdjacentElement("beforebegin",this.eHeaderComp.getGui())}focusHeaderComp(){return this.eHeaderComp?(this.eHeaderComp.getFocusableElement().focus(),!0):!1}refreshComp(){var t,i;(t=this.eFilterComp)==null||t.refresh(),(i=this.eHeaderComp)==null||i.refresh()}refreshBuilderComp(){var t;(t=this.eBuilderComp)==null||t.refresh()}getHeaderHeight(){var t,i;return(i=(t=this.eHeaderComp)==null?void 0:t.getHeight())!=null?i:0}setInputDisabled(t){var i,s;(i=this.eFilterComp)==null||i.setInputDisabled(t),(s=this.eHeaderComp)==null||s.setInputDisabled(t)}toggleFilterBuilder(t,i){if(i&&this.eBuilderDialog||i===!1&&!this.eBuilderDialog)return;if(this.eBuilderDialog){this.builderDestroySource=t,this.destroyBean(this.eBuilderDialog);return}this.setInputDisabled(!0);const{width:s,height:r,minWidth:a}=this.getBuilderDialogSize();this.eBuilderComp=this.createBean(new P),this.eBuilderDialog=this.createBean(new ye({title:this.advancedFilterExpressionService.translate("advancedFilterBuilderTitle"),component:this.eBuilderComp,width:s,height:r,resizable:!0,movable:!0,maximizable:!0,centered:!0,closable:!0,minWidth:a,afterGuiAttached:()=>{var n;return(n=this.eBuilderComp)==null?void 0:n.afterGuiAttached()}})),this.dispatchFilterBuilderVisibleChangedEvent(t,!0),this.eBuilderDialog.addEventListener(ye.EVENT_DESTROYED,()=>{var n;this.destroyBean(this.eBuilderComp),this.eBuilderComp=void 0,this.eBuilderDialog=void 0,this.setInputDisabled(!1),this.dispatchEvent({type:_e.EVENT_BUILDER_CLOSED}),this.dispatchFilterBuilderVisibleChangedEvent((n=this.builderDestroySource)!=null?n:"ui",!1),this.builderDestroySource=void 0})}dispatchFilterBuilderVisibleChangedEvent(t,i){const s={type:X.EVENT_ADVANCED_FILTER_BUILDER_VISIBLE_CHANGED,source:t,visible:i};this.eventService.dispatchEvent(s)}getBuilderDialogSize(){var t,i;const s=(i=(t=this.gos.get("advancedFilterBuilderParams"))==null?void 0:t.minWidth)!=null?i:500,r=this.popupService.getPopupParent(),a=Math.round(Z.getAbsoluteWidth(r))-2,n=Math.round(Z.getAbsoluteHeight(r)*.75)-2,o=Math.min(Math.max(600,s),a),d=Math.min(600,n);return{width:o,height:d,minWidth:s}}onEnabledChanged(t){this.enabled=t,this.updateComps()}updateComps(){this.setAdvancedFilterComp(),this.setHeaderCompEnabled(),this.eventService.dispatchEvent({type:X.EVENT_HEADER_HEIGHT_CHANGED})}setAdvancedFilterComp(){if(this.destroyAdvancedFilterComp(),!this.enabled)return;const t=this.gos.get("advancedFilterParent");if(this.hasAdvancedFilterParent=!!t,t){const i=this.createBean(new E),s=i.getGui(),{allThemes:r}=this.environment.getTheme();r.length&&s.classList.add(...r),s.classList.add(this.gos.get("enableRtl")?"ag-rtl":"ag-ltr"),t.appendChild(s),this.eFilterComp=i}}setHeaderCompEnabled(){var t;(t=this.eHeaderComp)==null||t.setEnabled(this.enabled&&!this.hasAdvancedFilterParent)}destroyAdvancedFilterComp(){this.eFilterComp&&(Z.removeFromParent(this.eFilterComp.getGui()),this.destroyBean(this.eFilterComp))}};S.EVENT_BUILDER_CLOSED="advancedFilterBuilderClosed",l([j("focusService")],S.prototype,"focusService",2),l([j("ctrlsService")],S.prototype,"ctrlsService",2),l([j("popupService")],S.prototype,"popupService",2),l([j("advancedFilterExpressionService")],S.prototype,"advancedFilterExpressionService",2),l([Ke],S.prototype,"postConstruct",1);var Le=S,E=class extends Ue{constructor(){super(`
            <div class="ag-advanced-filter" role="presentation" tabindex="-1">
                <ag-autocomplete ref="eAutocomplete"></ag-autocomplete>
                <button class="ag-button ag-standard-button ag-advanced-filter-apply-button" ref="eApplyFilterButton"></button>
                <button class="ag-advanced-filter-builder-button" ref="eBuilderFilterButton">
                    <span ref="eBuilderFilterButtonIcon" aria-hidden="true"></span>
                    <span class="ag-advanced-filter-builder-button-label" ref="eBuilderFilterButtonLabel"></span>
                </button>
            </div>`),this.expressionParser=null,this.isApplyDisabled=!0,this.builderOpen=!1}postConstruct(){this.eAutocomplete.setListGenerator((e,t)=>this.generateAutocompleteListParams(t)).setValidator(()=>this.validateValue()).setForceLastSelection((e,t)=>this.forceLastSelection(e,t)).setInputAriaLabel(this.advancedFilterExpressionService.translate("ariaAdvancedFilterInput")).setListAriaLabel(this.advancedFilterExpressionService.translate("ariaLabelAdvancedFilterAutocomplete")),this.refresh(),this.addManagedListener(this.eAutocomplete,U.EVENT_VALUE_CHANGED,({value:e})=>this.onValueChanged(e)),this.addManagedListener(this.eAutocomplete,U.EVENT_VALUE_CONFIRMED,({isValid:e})=>this.onValueConfirmed(e)),this.addManagedListener(this.eAutocomplete,U.EVENT_OPTION_SELECTED,({position:e,updateEntry:t,autocompleteType:i})=>this.onOptionSelected(e,t,i)),this.addManagedListener(this.eAutocomplete,U.EVENT_VALID_CHANGED,({isValid:e,validationMessage:t})=>this.onValidChanged(e,t)),this.setupApplyButton(),this.setupBuilderButton()}refresh(){const e=this.advancedFilterService.getExpressionDisplayValue();this.eAutocomplete.setValue({value:e??"",position:e?.length,updateListOnlyIfOpen:!0})}setInputDisabled(e){this.eAutocomplete.setInputDisabled(e),A.setDisabled(this.eApplyFilterButton,e||this.isApplyDisabled)}getTooltipParams(){const e=super.getTooltipParams();return e.location="advancedFilter",e}setupApplyButton(){this.eApplyFilterButton.innerText=this.advancedFilterExpressionService.translate("advancedFilterApply"),this.activateTabIndex([this.eApplyFilterButton]),this.addManagedListener(this.eApplyFilterButton,"click",()=>this.onValueConfirmed(this.eAutocomplete.isValid())),A.setDisabled(this.eApplyFilterButton,this.isApplyDisabled)}setupBuilderButton(){this.eBuilderFilterButtonIcon.appendChild(A.createIconNoSpan("advancedFilterBuilder",this.gos)),this.eBuilderFilterButtonLabel.innerText=this.advancedFilterExpressionService.translate("advancedFilterBuilder"),this.activateTabIndex([this.eBuilderFilterButton]),this.addManagedListener(this.eBuilderFilterButton,"click",()=>this.openBuilder()),this.addManagedListener(this.advancedFilterService.getCtrl(),Le.EVENT_BUILDER_CLOSED,()=>this.closeBuilder())}onValueChanged(e){var t;e=A.makeNull(e),this.advancedFilterService.setExpressionDisplayValue(e),this.expressionParser=this.advancedFilterService.createExpressionParser(e);const i=(t=this.expressionParser)==null?void 0:t.parseExpression();i&&i!==e&&this.eAutocomplete.setValue({value:i,silent:!0,restoreFocus:!0})}onValueConfirmed(e){!e||this.isApplyDisabled||(A.setDisabled(this.eApplyFilterButton,!0),this.advancedFilterService.applyExpression(),this.filterManager.onFilterChanged({source:"advancedFilter"}))}onOptionSelected(e,t,i){const{updatedValue:s,updatedPosition:r,hideAutocomplete:a}=this.updateExpression(e,t,i);this.eAutocomplete.setValue({value:s,position:r,updateListOnlyIfOpen:a,restoreFocus:!0})}validateValue(){var e,t,i;return(e=this.expressionParser)!=null&&e.isValid()?null:(i=(t=this.expressionParser)==null?void 0:t.getValidationMessage())!=null?i:null}onValidChanged(e,t){this.isApplyDisabled=!e||this.advancedFilterService.isCurrentExpressionApplied(),A.setDisabled(this.eApplyFilterButton,this.isApplyDisabled),this.setTooltip({newTooltipText:t,showDelayOverride:1e3})}generateAutocompleteListParams(e){return this.expressionParser?this.expressionParser.getAutocompleteListParams(e):this.advancedFilterExpressionService.getDefaultAutocompleteListParams("")}updateExpression(e,t,i){var s,r;return this.advancedFilterExpressionService.updateAutocompleteCache(t,i),(r=(s=this.expressionParser)==null?void 0:s.updateExpression(e,t,i))!=null?r:this.advancedFilterService.getDefaultExpression(t)}forceLastSelection({key:e,displayValue:t},i){return!!i.toLocaleLowerCase().match(`^${(t??e).toLocaleLowerCase()}\\s*$`)}openBuilder(){this.builderOpen||(this.builderOpen=!0,A.setDisabled(this.eBuilderFilterButton,!0),this.advancedFilterService.getCtrl().toggleFilterBuilder("ui"))}closeBuilder(){this.builderOpen&&(this.builderOpen=!1,A.setDisabled(this.eBuilderFilterButton,!1),this.eBuilderFilterButton.focus())}};l([_("eAutocomplete")],E.prototype,"eAutocomplete",2),l([_("eApplyFilterButton")],E.prototype,"eApplyFilterButton",2),l([_("eBuilderFilterButton")],E.prototype,"eBuilderFilterButton",2),l([_("eBuilderFilterButtonIcon")],E.prototype,"eBuilderFilterButtonIcon",2),l([_("eBuilderFilterButtonLabel")],E.prototype,"eBuilderFilterButtonLabel",2),l([Y("advancedFilterService")],E.prototype,"advancedFilterService",2),l([Y("advancedFilterExpressionService")],E.prototype,"advancedFilterExpressionService",2),l([Y("filterManager")],E.prototype,"filterManager",2),l([je],E.prototype,"postConstruct",1);import{Autowired as ue,Bean as St,BeanStub as Vt,PostConstruct as Ot,_ as D}from"@ag-grid-community/core";var Lt={ariaAdvancedFilterBuilderItem:e=>`${e[0]}. Level ${e[1]}. Press ENTER to edit.`,ariaAdvancedFilterBuilderItemValidation:e=>`${e[0]}. Level ${e[1]}. ${e[2]} Press ENTER to edit.`,ariaAdvancedFilterBuilderList:"Advanced Filter Builder List",ariaAdvancedFilterBuilderFilterItem:"Filter Condition",ariaAdvancedFilterBuilderGroupItem:"Filter Group",ariaAdvancedFilterBuilderColumn:"Column",ariaAdvancedFilterBuilderOption:"Option",ariaAdvancedFilterBuilderValue:"Value",ariaAdvancedFilterBuilderJoinOperator:"Join Operator",ariaAdvancedFilterInput:"Advanced Filter Input",ariaLabelAdvancedFilterAutocomplete:"Advanced Filter Autocomplete",advancedFilterContains:"contains",advancedFilterNotContains:"does not contain",advancedFilterTextEquals:"equals",advancedFilterTextNotEqual:"does not equal",advancedFilterStartsWith:"begins with",advancedFilterEndsWith:"ends with",advancedFilterBlank:"is blank",advancedFilterNotBlank:"is not blank",advancedFilterEquals:"=",advancedFilterNotEqual:"!=",advancedFilterGreaterThan:">",advancedFilterGreaterThanOrEqual:">=",advancedFilterLessThan:"<",advancedFilterLessThanOrEqual:"<=",advancedFilterTrue:"is true",advancedFilterFalse:"is false",advancedFilterAnd:"AND",advancedFilterOr:"OR",advancedFilterApply:"Apply",advancedFilterBuilder:"Builder",advancedFilterValidationMissingColumn:"Column is missing",advancedFilterValidationMissingOption:"Option is missing",advancedFilterValidationMissingValue:"Value is missing",advancedFilterValidationInvalidColumn:"Column not found",advancedFilterValidationInvalidOption:"Option not found",advancedFilterValidationMissingQuote:"Value is missing an end quote",advancedFilterValidationNotANumber:"Value is not a number",advancedFilterValidationInvalidDate:"Value is not a valid date",advancedFilterValidationMissingCondition:"Condition is missing",advancedFilterValidationJoinOperatorMismatch:"Join operators within a condition must be the same",advancedFilterValidationInvalidJoinOperator:"Join operator not found",advancedFilterValidationMissingEndBracket:"Missing end bracket",advancedFilterValidationExtraEndBracket:"Too many end brackets",advancedFilterValidationMessage:e=>`Expression has an error. ${e[0]} - ${e[1]}.`,advancedFilterValidationMessageAtEnd:e=>`Expression has an error. ${e[0]} at end of expression.`,advancedFilterBuilderTitle:"Advanced Filter",advancedFilterBuilderApply:"Apply",advancedFilterBuilderCancel:"Cancel",advancedFilterBuilderAddButtonTooltip:"Add Filter or Group",advancedFilterBuilderRemoveButtonTooltip:"Remove",advancedFilterBuilderMoveUpButtonTooltip:"Move Up",advancedFilterBuilderMoveDownButtonTooltip:"Move Down",advancedFilterBuilderAddJoin:"Add Group",advancedFilterBuilderAddCondition:"Add Filter",advancedFilterBuilderSelectColumn:"Select a column",advancedFilterBuilderSelectOption:"Select an option",advancedFilterBuilderEnterValue:"Enter a value...",advancedFilterBuilderValidationAlreadyApplied:"Current filter already applied.",advancedFilterBuilderValidationIncomplete:"Not all conditions are complete.",advancedFilterBuilderValidationSelectColumn:"Must select a column.",advancedFilterBuilderValidationSelectOption:"Must select an option.",advancedFilterBuilderValidationEnterValue:"Must enter a value."};function pe(e,t,i){if(!e)return"";const s=i-t;return s?e.slice(0,e.length-s):e}function B(e,t,i,s,r,a,n){const o=i+(!e.length||n?0:1);let d=0;return r&&(e[o]===" "?d=1:(s+=" ",a&&(s+='"'))),{updatedValue:e.slice(0,t)+s+e.slice(o),updatedPosition:t+s.length+d}}function Tt(e,t,i){let s=t;for(;s<i&&e[s]===" ";)s++;return s}function ce(e,t,i,s){let r=t,a=!1;for(;r<e.length;){const n=e[r];if(n==="("){s&&e[r-1]===" "?a=!0:r=r-1;break}else if(n===" "||i&&n===")"){r=r-1;break}r++}return{endPosition:r,isEmpty:a}}function he(e,t,i,s){i!==t&&(e.expression=B(e.expression,s-t.length+1,s,i).updatedValue)}function Mt(e){return e.replace(/(['"])/,"\\$1")}var _t=class{constructor(e,t){this.params=e,this.startPosition=t,this.type="column",this.valid=!0,this.hasStartChar=!1,this.hasEndChar=!1,this.colName=""}parse(e,t){if(e===C.COL_START_CHAR&&!this.colName)this.hasStartChar=!0;else if(e===C.COL_END_CHAR&&this.hasStartChar){if(this.parseColumn(!1,t))return this.hasEndChar=!0,!1;this.colName+=e}else this.colName+=e}getDisplayValue(){return(this.hasStartChar?C.COL_START_CHAR:"")+this.colName+(this.hasEndChar?C.COL_END_CHAR:"")}getColId(){return this.colId}complete(e){this.parseColumn(!0,e)}getValidationError(){var e;return this.valid?null:{message:this.params.advancedFilterExpressionService.translate("advancedFilterValidationInvalidColumn"),startPosition:this.startPosition,endPosition:(e=this.endPosition)!=null?e:this.params.expression.length-1}}parseColumn(e,t){var i;this.endPosition=t;const s=this.params.advancedFilterExpressionService.getColId(this.colName);return s&&this.hasStartChar&&(this.colId=s.colId,he(this.params,this.colName,s.columnName,t-1),this.colName=s.columnName,this.column=this.params.columnModel.getPrimaryColumn(this.colId),this.column)?(this.baseCellDataType=(i=this.params.dataTypeService.getBaseDataType(this.column))!=null?i:"text",!0):(e&&(this.valid=!1),this.baseCellDataType="text",!1)}},wt=class{constructor(e,t,i){this.params=e,this.startPosition=t,this.baseCellDataType=i,this.type="operator",this.valid=!0,this.expectedNumOperands=0,this.operator=""}parse(e,t){if(e===" "||e===")"){if(this.parseOperator(!1,t-1))return!0;this.operator+=e}else this.operator+=e}complete(e){this.parseOperator(!0,e)}getValidationError(){var e;return this.valid?null:{message:this.params.advancedFilterExpressionService.translate("advancedFilterValidationInvalidOption"),startPosition:this.startPosition,endPosition:(e=this.endPosition)!=null?e:this.params.expression.length-1}}getDisplayValue(){return this.operator}getOperatorKey(){return this.parsedOperator}parseOperator(e,t){const i=this.params.advancedFilterExpressionService.getDataTypeExpressionOperator(this.baseCellDataType),s=i.findOperator(this.operator);if(this.endPosition=t,s){this.parsedOperator=s;const a=i.operators[s];this.expectedNumOperands=a.numOperands;const n=a.displayValue;return he(this.params,this.operator,n,t),this.operator=n,!0}return(e||!(s===null))&&(this.valid=!1),!1}},It=class{constructor(e,t,i,s){this.params=e,this.startPosition=t,this.baseCellDataType=i,this.column=s,this.type="operand",this.valid=!0,this.operand="",this.validationMessage=null}parse(e,t){if(e===" ")if(this.quotes)this.operand+=e;else return this.parseOperand(!1,t),!0;else if(e===")"){if(this.baseCellDataType==="number"||!this.quotes)return this.parseOperand(!1,t-1),!0;this.operand+=e}else if(!this.operand&&!this.quotes&&(e==="'"||e==='"'))this.quotes=e;else{if(this.quotes&&e===this.quotes)return this.parseOperand(!1,t),!1;this.operand+=e}}complete(e){this.parseOperand(!0,e)}getValidationError(){var e;return this.validationMessage?{message:this.validationMessage,startPosition:this.startPosition,endPosition:(e=this.endPosition)!=null?e:this.params.expression.length-1}:null}getRawValue(){return this.operand}getModelValue(){return this.modelValue}parseOperand(e,t){const{advancedFilterExpressionService:i}=this.params;if(this.endPosition=t,this.modelValue=this.operand,e&&this.quotes)this.valid=!1,this.validationMessage=i.translate("advancedFilterValidationMissingQuote");else if(this.modelValue==="")this.valid=!1,this.validationMessage=i.translate("advancedFilterValidationMissingValue");else{const s=i.getOperandModelValue(this.operand,this.baseCellDataType,this.column);switch(s!=null&&(this.modelValue=s),this.baseCellDataType){case"number":(this.quotes||isNaN(this.modelValue))&&(this.valid=!1,this.validationMessage=i.translate("advancedFilterValidationNotANumber"));break;case"date":case"dateString":s==null&&(this.valid=!1,this.validationMessage=i.translate("advancedFilterValidationInvalidDate"));break}}}},C=class{constructor(e,t){this.params=e,this.startPosition=t,this.isAwaiting=!0}parseExpression(){var e,t;let i=this.startPosition;const{expression:s}=this.params;for(;i<s.length;){const r=s[i];if(!(r===" "&&this.isAwaiting)){if(this.isAwaiting=!1,!this.parser){let n;this.columnParser?this.operatorParser?(this.operandParser=new It(this.params,i,this.columnParser.baseCellDataType,this.columnParser.column),n=this.operandParser):(this.operatorParser=new wt(this.params,i,this.columnParser.baseCellDataType),n=this.operatorParser):(this.columnParser=new _t(this.params,i),n=this.columnParser),this.parser=n}const a=this.parser.parse(r,i);if(a!=null){if(this.isComplete())return this.returnEndPosition(a?i-1:i,!0);this.parser=void 0,this.isAwaiting=!0}}i++}return(t=(e=this.parser)==null?void 0:e.complete)==null||t.call(e,i-1),this.returnEndPosition(i)}isValid(){return this.isComplete()&&this.columnParser.valid&&this.operatorParser.valid&&(!this.operandParser||this.operandParser.valid)}getValidationError(){var e,t,i,s,r;const a=(r=(i=(e=this.columnParser)==null?void 0:e.getValidationError())!=null?i:(t=this.operatorParser)==null?void 0:t.getValidationError())!=null?r:(s=this.operandParser)==null?void 0:s.getValidationError();if(a)return a;const n=this.params.expression.length;let o;return this.columnParser?this.operatorParser?this.operatorParser.expectedNumOperands&&!this.operandParser&&(o="advancedFilterValidationMissingValue"):o="advancedFilterValidationMissingOption":o="advancedFilterValidationMissingColumn",o?{message:this.params.advancedFilterExpressionService.translate(o),startPosition:n,endPosition:n}:null}getFunctionString(e){return this.getFunctionCommon(e,(t,i,s,r)=>{const a=Mt(s),n=t==null?"":`, params.operands[${t}]`;return`params.operators[${i}].evaluator(expressionProxy.getValue('${a}', node), node, params.evaluatorParams[${r}]${n})`})}getFunctionParsed(e){return this.getFunctionCommon(e,(t,i,s,r)=>(a,n,o)=>o.operators[i].evaluator(a.getValue(s,n),n,o.evaluatorParams[r],t==null?void 0:o.operands[t]))}getAutocompleteListParams(e){if(this.isColumnPosition(e))return this.getColumnAutocompleteListParams(e);if(this.isOperatorPosition(e))return this.getOperatorAutocompleteListParams(e);if(!this.isBeyondEndPosition(e))return{enabled:!1}}updateExpression(e,t,i){var s,r,a,n,o;const{expression:d}=this.params;if(this.isColumnPosition(e))return B(this.params.expression,this.startPosition,(s=this.columnParser)!=null&&s.getColId()?this.columnParser.endPosition:ce(d,e).endPosition,this.params.advancedFilterExpressionService.getColumnValue(t),!0);if(this.isOperatorPosition(e)){const u=this.getBaseCellDataTypeFromOperatorAutocompleteType(i),p=this.hasOperand(u,t.key),h=p&&this.doesOperandNeedQuotes(u);let f;if(((r=this.operatorParser)==null?void 0:r.startPosition)!=null&&e<this.operatorParser.startPosition)f=B(d,e,e,(a=t.displayValue)!=null?a:t.key,p,h);else{let v,O=!1;if((n=this.operatorParser)!=null&&n.getOperatorKey())v=this.operatorParser.endPosition;else{const{endPosition:L,isEmpty:x}=ce(d,e,!0,!0);v=L,O=x}f=B(d,Tt(d,this.columnParser.endPosition+1,v),v,(o=t.displayValue)!=null?o:t.key,p,h,O)}return Q(z({},f),{hideAutocomplete:!p})}return null}getModel(){const e=this.columnParser.getColId(),t={filterType:this.columnParser.baseCellDataType,colId:e,type:this.operatorParser.getOperatorKey()};return this.operatorParser.expectedNumOperands&&(t.filter=this.operandParser.getModelValue()),t}getFunctionCommon(e,t){var i,s;const r=this.columnParser.getColId(),a=(i=this.operatorParser)==null?void 0:i.getOperatorKey(),{operators:n,evaluatorParams:o,operands:d}=e,u=this.params.advancedFilterExpressionService.getExpressionOperator(this.columnParser.baseCellDataType,a),p=this.addToListAndGetIndex(n,u),h=this.params.advancedFilterExpressionService.getExpressionEvaluatorParams(r),f=this.addToListAndGetIndex(o,h),v=((s=this.operatorParser)==null?void 0:s.expectedNumOperands)===0?void 0:this.addToListAndGetIndex(d,this.getOperandValue());return t(v,p,r,f)}getOperandValue(){let e=this.operandParser.getRawValue();const{baseCellDataType:t,column:i}=this.columnParser;switch(t){case"number":e=Number(e);break;case"date":case"dateString":e=this.params.valueService.parseValue(i,null,e,void 0);break}return t==="dateString"?this.params.dataTypeService.getDateParserFunction(i)(e):e}isComplete(){return!!(this.operatorParser&&(!this.operatorParser.expectedNumOperands||this.operatorParser.expectedNumOperands&&this.operandParser))}isColumnPosition(e){return!this.columnParser||this.columnParser.endPosition==null||e<=this.columnParser.endPosition+1}isOperatorPosition(e){return!this.operatorParser||this.operatorParser.endPosition==null||e<=this.operatorParser.endPosition+1}isBeyondEndPosition(e){return this.isComplete()&&this.endPosition!=null&&e>this.endPosition+1&&this.endPosition+1<this.params.expression.length}returnEndPosition(e,t){return this.endPosition=t?e:e-1,e}getColumnAutocompleteListParams(e){return this.params.advancedFilterExpressionService.generateAutocompleteListParams(this.params.advancedFilterExpressionService.getColumnAutocompleteEntries(),"column",this.getColumnSearchString(e))}getColumnSearchString(e){var t,i,s,r,a;const n=(i=(t=this.columnParser)==null?void 0:t.getDisplayValue())!=null?i:"",o=pe(n,e,((s=this.columnParser)==null?void 0:s.endPosition)==null?this.params.expression.length:this.columnParser.endPosition+1),d=((r=this.columnParser)==null?void 0:r.hasStartChar)&&o.length>0,u=((a=this.columnParser)==null?void 0:a.hasEndChar)&&o.length===n.length+2;return d?o.slice(1,u?-1:void 0):o}getOperatorAutocompleteListParams(e){var t,i,s,r,a;const n=(t=this.columnParser)==null?void 0:t.column;if(!n)return{enabled:!1};const o=this.columnParser.baseCellDataType,d=((i=this.operatorParser)==null?void 0:i.startPosition)!=null&&e<this.operatorParser.startPosition?"":pe((r=(s=this.operatorParser)==null?void 0:s.getDisplayValue())!=null?r:"",e,((a=this.operatorParser)==null?void 0:a.endPosition)==null?this.params.expression.length:this.operatorParser.endPosition+1);return this.params.advancedFilterExpressionService.generateAutocompleteListParams(this.params.advancedFilterExpressionService.getOperatorAutocompleteEntries(n,o),`operator-${o}`,d)}getBaseCellDataTypeFromOperatorAutocompleteType(e){return e?.replace("operator-","")}hasOperand(e,t){var i,s;return!e||!t||((s=(i=this.params.advancedFilterExpressionService.getExpressionOperator(e,t))==null?void 0:i.numOperands)!=null?s:0)>0}doesOperandNeedQuotes(e){return e!=="number"}addToListAndGetIndex(e,t){const i=e.length;return e.push(t),i}};C.COL_START_CHAR="[",C.COL_END_CHAR="]";function J(e,t,i){let s=!1;const r=e.toLocaleLowerCase(),a=r+" ",n=Object.entries(t).find(([o,d])=>{const u=i(d).toLocaleLowerCase();return u.startsWith(a)&&(s=!0),u===r});return n?n[0]:s?null:void 0}function ve(e,t){return(t??Object.keys(e)).map(s=>({key:s,displayValue:e[s].displayValue}))}var Te=class{constructor(e){this.params=e,this.initOperators()}getEntries(e){return ve(this.operators,e)}findOperator(e){return J(e,this.operators,({displayValue:t})=>t)}initOperators(){const{translate:e}=this.params;this.operators={contains:{displayValue:e("advancedFilterContains"),evaluator:(t,i,s,r)=>this.evaluateExpression(t,i,s,r,!1,(a,n)=>a.includes(n)),numOperands:1},notContains:{displayValue:e("advancedFilterNotContains"),evaluator:(t,i,s,r)=>this.evaluateExpression(t,i,s,r,!0,(a,n)=>!a.includes(n)),numOperands:1},equals:{displayValue:e("advancedFilterTextEquals"),evaluator:(t,i,s,r)=>this.evaluateExpression(t,i,s,r,!1,(a,n)=>a===n),numOperands:1},notEqual:{displayValue:e("advancedFilterTextNotEqual"),evaluator:(t,i,s,r)=>this.evaluateExpression(t,i,s,r,!0,(a,n)=>a!=n),numOperands:1},startsWith:{displayValue:e("advancedFilterStartsWith"),evaluator:(t,i,s,r)=>this.evaluateExpression(t,i,s,r,!1,(a,n)=>a.startsWith(n)),numOperands:1},endsWith:{displayValue:e("advancedFilterEndsWith"),evaluator:(t,i,s,r)=>this.evaluateExpression(t,i,s,r,!1,(a,n)=>a.endsWith(n)),numOperands:1},blank:{displayValue:e("advancedFilterBlank"),evaluator:t=>t==null||typeof t=="string"&&t.trim().length===0,numOperands:0},notBlank:{displayValue:e("advancedFilterNotBlank"),evaluator:t=>t!=null&&(typeof t!="string"||t.trim().length>0),numOperands:0}}}evaluateExpression(e,t,i,s,r,a){return e==null?r:i.caseSensitive?a(i.valueConverter(e,t),s):a(i.valueConverter(e,t).toLocaleLowerCase(),s.toLocaleLowerCase())}},me=class{constructor(e){this.params=e,this.initOperators()}getEntries(e){return ve(this.operators,e)}findOperator(e){return J(e,this.operators,({displayValue:t})=>t)}initOperators(){const{translate:e,equals:t}=this.params;this.operators={equals:{displayValue:e("advancedFilterEquals"),evaluator:(i,s,r,a)=>this.evaluateSingleOperandExpression(i,s,r,a,!!r.includeBlanksInEquals,t),numOperands:1},notEqual:{displayValue:e("advancedFilterNotEqual"),evaluator:(i,s,r,a)=>this.evaluateSingleOperandExpression(i,s,r,a,!!r.includeBlanksInEquals,(n,o)=>!t(n,o)),numOperands:1},greaterThan:{displayValue:e("advancedFilterGreaterThan"),evaluator:(i,s,r,a)=>this.evaluateSingleOperandExpression(i,s,r,a,!!r.includeBlanksInGreaterThan,(n,o)=>n>o),numOperands:1},greaterThanOrEqual:{displayValue:e("advancedFilterGreaterThanOrEqual"),evaluator:(i,s,r,a)=>this.evaluateSingleOperandExpression(i,s,r,a,!!r.includeBlanksInGreaterThan,(n,o)=>n>=o),numOperands:1},lessThan:{displayValue:e("advancedFilterLessThan"),evaluator:(i,s,r,a)=>this.evaluateSingleOperandExpression(i,s,r,a,!!r.includeBlanksInLessThan,(n,o)=>n<o),numOperands:1},lessThanOrEqual:{displayValue:e("advancedFilterLessThanOrEqual"),evaluator:(i,s,r,a)=>this.evaluateSingleOperandExpression(i,s,r,a,!!r.includeBlanksInLessThan,(n,o)=>n<=o),numOperands:1},blank:{displayValue:e("advancedFilterBlank"),evaluator:i=>i==null,numOperands:0},notBlank:{displayValue:e("advancedFilterNotBlank"),evaluator:i=>i!=null,numOperands:0}}}evaluateSingleOperandExpression(e,t,i,s,r,a){return e==null?r:a(i.valueConverter(e,t),s)}},Nt=class{constructor(e){this.params=e,this.initOperators()}getEntries(e){return ve(this.operators,e)}findOperator(e){return J(e,this.operators,({displayValue:t})=>t)}initOperators(){const{translate:e}=this.params;this.operators={true:{displayValue:e("advancedFilterTrue"),evaluator:t=>!!t,numOperands:0},false:{displayValue:e("advancedFilterFalse"),evaluator:t=>t===!1,numOperands:0},blank:{displayValue:e("advancedFilterBlank"),evaluator:t=>t==null,numOperands:0},notBlank:{displayValue:e("advancedFilterNotBlank"),evaluator:t=>t!=null,numOperands:0}}}},V=class extends Vt{constructor(){super(...arguments),this.columnNameToIdMap={},this.columnAutocompleteEntries=null,this.expressionEvaluatorParams={}}postConstruct(){this.expressionJoinOperators=this.generateExpressionJoinOperators(),this.expressionOperators=this.generateExpressionOperators()}parseJoinOperator(e){var t;const{type:i}=e;return(t=this.expressionJoinOperators[i])!=null?t:i}getColumnDisplayValue(e){const{colId:t}=e,s=this.getColumnAutocompleteEntries().find(({key:a})=>a===t);let r;return s?(r=s.displayValue,this.columnNameToIdMap[r.toLocaleUpperCase()]={colId:t,columnName:r}):r=t,r}getOperatorDisplayValue(e){var t,i;return(i=(t=this.getExpressionOperator(e.filterType,e.type))==null?void 0:t.displayValue)!=null?i:e.type}getOperandModelValue(e,t,i){var s;switch(t){case"number":return D.exists(e)?Number(e):null;case"date":return D.serialiseDate(this.valueService.parseValue(i,null,e,void 0),!1);case"dateString":const r=this.valueService.parseValue(i,null,e,void 0);return D.serialiseDate((s=this.dataTypeService.getDateParserFunction(i)(r))!=null?s:null,!1)}return e}getOperandDisplayValue(e,t){var i,s;const{colId:r,filter:a}=e,n=this.columnModel.getPrimaryColumn(r);let o="";if(a!=null){let d;switch(e.filterType){case"number":d=(i=D.toStringOrNull(a))!=null?i:"";break;case"date":const u=D.parseDateTimeFromString(a);d=n?this.valueService.formatValue(n,null,u):null;break;case"dateString":const p=D.parseDateTimeFromString(a),h=n?this.dataTypeService.getDateFormatterFunction(n)(p??void 0):null;d=n?this.valueService.formatValue(n,null,h):null;break}e.filterType!=="number"&&(d=(s=d??D.toStringOrNull(a))!=null?s:"",t||(d=`"${d}"`)),o=t?d:` ${d}`}return o}parseColumnFilterModel(e){var t,i;const s=(t=this.getColumnDisplayValue(e))!=null?t:"",r=(i=this.getOperatorDisplayValue(e))!=null?i:"",a=this.getOperandDisplayValue(e);return`[${s}] ${r}${a}`}updateAutocompleteCache(e,t){if(t==="column"){const{key:i,displayValue:s}=e;this.columnNameToIdMap[e.displayValue.toLocaleUpperCase()]={colId:i,columnName:s}}}translate(e,t){let i=Lt[e];return typeof i=="function"&&(i=i(t)),this.localeService.getLocaleTextFunc()(e,i,t)}generateAutocompleteListParams(e,t,i){return{enabled:!0,type:t,searchString:i,entries:e}}getColumnAutocompleteEntries(){var e;if(this.columnAutocompleteEntries)return this.columnAutocompleteEntries;const t=(e=this.columnModel.getAllPrimaryColumns())!=null?e:[],i=[],s=this.gos.get("includeHiddenColumnsInAdvancedFilter");return t.forEach(r=>{r.getColDef().filter&&(s||r.isVisible()||r.isRowGroupActive())&&i.push({key:r.getColId(),displayValue:this.columnModel.getDisplayNameForColumn(r,"advancedFilter")})}),i.sort((r,a)=>{var n,o;const d=(n=r.displayValue)!=null?n:"",u=(o=a.displayValue)!=null?o:"";return d<u?-1:u>d?1:0}),i}getOperatorAutocompleteEntries(e,t){const i=this.getActiveOperators(e);return this.getDataTypeExpressionOperator(t).getEntries(i)}getJoinOperatorAutocompleteEntries(){return Object.entries(this.expressionJoinOperators).map(([e,t])=>({key:e,displayValue:t}))}getDefaultAutocompleteListParams(e){return this.generateAutocompleteListParams(this.getColumnAutocompleteEntries(),"column",e)}getDataTypeExpressionOperator(e){return this.expressionOperators[e]}getExpressionOperator(e,t){var i,s;return(s=(i=this.getDataTypeExpressionOperator(e))==null?void 0:i.operators)==null?void 0:s[t]}getExpressionJoinOperators(){return this.expressionJoinOperators}getColId(e){const t=e.toLocaleUpperCase(),i=this.columnNameToIdMap[t];if(i)return i;const r=this.getColumnAutocompleteEntries().find(({displayValue:a})=>a.toLocaleUpperCase()===t);if(r){const{key:a,displayValue:n}=r,o={colId:a,columnName:n};return this.columnNameToIdMap[t]=o,o}return null}getExpressionEvaluatorParams(e){let t=this.expressionEvaluatorParams[e];if(t)return t;const i=this.columnModel.getPrimaryColumn(e);if(!i)return{valueConverter:a=>a};switch(this.dataTypeService.getBaseDataType(i)){case"dateString":t={valueConverter:this.dataTypeService.getDateParserFunction(i)};break;case"object":i.getColDef().filterValueGetter?t={valueConverter:a=>a}:t={valueConverter:(a,n)=>{var o;return(o=this.valueService.formatValue(i,n,a))!=null?o:typeof a.toString=="function"?a.toString():""}};break;case"text":case void 0:t={valueConverter:a=>D.toStringOrNull(a)};break;default:t={valueConverter:a=>a};break}const{filterParams:r}=i.getColDef();return r&&["caseSensitive","includeBlanksInEquals","includeBlanksInLessThan","includeBlanksInGreaterThan"].forEach(a=>{const n=r[a];n&&(t[a]=n)}),this.expressionEvaluatorParams[e]=t,t}getColumnDetails(e){var t,i;const s=(t=this.columnModel.getPrimaryColumn(e))!=null?t:void 0,r=(i=s?this.dataTypeService.getBaseDataType(s):void 0)!=null?i:"text";return{column:s,baseCellDataType:r}}generateExpressionOperators(){const e=(t,i)=>this.translate(t,i);return{text:new Te({translate:e}),boolean:new Nt({translate:e}),object:new Te({translate:e}),number:new me({translate:e,equals:(t,i)=>t===i}),date:new me({translate:e,equals:(t,i)=>t.getTime()===i.getTime()}),dateString:new me({translate:e,equals:(t,i)=>t.getTime()===i.getTime()})}}getColumnValue({displayValue:e}){return`${C.COL_START_CHAR}${e}${C.COL_END_CHAR}`}generateExpressionJoinOperators(){return{AND:this.translate("advancedFilterAnd"),OR:this.translate("advancedFilterOr")}}getActiveOperators(e){var t;const i=(t=e.getColDef().filterParams)==null?void 0:t.filterOptions;return i&&i.every(r=>typeof r=="string")?i:void 0}resetColumnCaches(){this.columnAutocompleteEntries=null,this.columnNameToIdMap={},this.expressionEvaluatorParams={}}};l([ue("valueService")],V.prototype,"valueService",2),l([ue("columnModel")],V.prototype,"columnModel",2),l([ue("dataTypeService")],V.prototype,"dataTypeService",2),l([Ot],V.prototype,"postConstruct",1),V=l([St("advancedFilterExpressionService")],V);import{Autowired as H,Bean as kt,BeanStub as Rt,Events as ge,PostConstruct as Gt,_ as Me}from"@ag-grid-community/core";var Wt=class{constructor(e){this.params=e,this.operators=[],this.operatorStartPositions=[],this.operatorEndPositions=[],this.activeOperator=0,this.validationError=null}parseExpression(e){this.operators.push(""),this.operatorStartPositions.push(e),this.operatorEndPositions.push(void 0);const{expression:t}=this.params;for(;e<t.length;){const i=t[e];if(i===" "){if(this.parseOperator(e-1))return this.activeOperator++,e-1;this.operators[this.activeOperator]+=i}else this.operators[this.activeOperator]+=i;e++}return this.parseOperator(e-1),e}isValid(){return!this.validationError&&(!this.operators.length||!!this.parsedOperator)}getValidationError(){return this.validationError}getFunction(){return this.parsedOperator==="OR"?"||":"&&"}getModel(){return this.parsedOperator==="OR"?"OR":"AND"}getAutocompleteListParams(e,t){let i;if(t==null)i="";else{const r=this.operators[t],a=this.operatorEndPositions[t];i=pe(r,e,a==null?this.params.expression.length:a+1)}let s=this.params.advancedFilterExpressionService.getJoinOperatorAutocompleteEntries();return(t||t==null&&this.activeOperator)&&(s=s.filter(({key:r})=>r===this.parsedOperator)),this.params.advancedFilterExpressionService.generateAutocompleteListParams(s,"join",i)}updateExpression(e,t,i){var s,r;let{expression:a}=this.params;const n=(s=t.displayValue)!=null?s:t.key;if(i===0)for(let u=this.operatorEndPositions.length-1;u>0;u--){const p=this.operatorEndPositions[u];p!=null&&(a=B(a,this.operatorStartPositions[u],p,n).updatedValue)}const o=this.operatorStartPositions.length>i?this.operatorStartPositions[i]:e,d=(r=this.operatorEndPositions.length>i?this.operatorEndPositions[i]:void 0)!=null?r:ce(a,e,!0).endPosition;return B(a,o,d,n,!0)}getNumOperators(){return this.operators.length}getLastOperatorEndPosition(){return this.operatorEndPositions[this.operatorEndPositions.length-1]}parseOperator(e){const t=this.operators.length>this.activeOperator?this.operators[this.activeOperator]:"",i=this.params.advancedFilterExpressionService.getExpressionJoinOperators(),s=J(t,i,r=>r);if(s){this.operatorEndPositions[this.activeOperator]=e;const r=i[s];if(this.activeOperator){if(s!==this.parsedOperator)return this.validationError||(this.validationError={message:this.params.advancedFilterExpressionService.translate("advancedFilterValidationJoinOperatorMismatch"),startPosition:e-t.length+1,endPosition:e}),!1}else this.parsedOperator=s;return t!==r&&(he(this.params,t,r,e),this.operators[this.activeOperator]=r),!0}else return s===null?!1:(this.validationError||(this.validationError={message:this.params.advancedFilterExpressionService.translate("advancedFilterValidationInvalidJoinOperator"),startPosition:e-t.length+1,endPosition:e}),!0)}},Ht=class we{constructor(t,i){this.params=t,this.startPosition=i,this.expectingExpression=!0,this.expectingOperator=!1,this.expressionParsers=[],this.operatorParser=new Wt(this.params),this.missingEndBracket=!1,this.extraEndBracket=!1}parseExpression(){let t=this.startPosition;const{expression:i}=this.params;for(;t<i.length;){const s=i[t];if(s==="("&&!this.expectingOperator){const r=new we(this.params,t+1);t=r.parseExpression(),this.expressionParsers.push(r),this.expectingExpression=!1,this.expectingOperator=!0}else{if(s===")")return this.endPosition=t-1,this.startPosition===0&&(this.extraEndBracket=!0),t;if(s!==" ")if(this.expectingExpression){const r=new C(this.params,t);t=r.parseExpression(),this.expressionParsers.push(r),this.expectingExpression=!1,this.expectingOperator=!0}else this.expectingOperator&&(t=this.operatorParser.parseExpression(t),this.expectingOperator=!1,this.expectingExpression=!0)}t++}return this.startPosition>0&&(this.missingEndBracket=!0),t}isValid(){return!this.missingEndBracket&&!this.extraEndBracket&&this.expressionParsers.length===this.operatorParser.getNumOperators()+1&&this.operatorParser.isValid()&&this.expressionParsers.every(t=>t.isValid())}getValidationError(){const t=this.operatorParser.getValidationError();for(let s=0;s<this.expressionParsers.length;s++){const r=this.expressionParsers[s].getValidationError();if(r)return t&&t.startPosition<r.startPosition?t:r}if(t)return t;if(this.extraEndBracket)return{message:this.params.advancedFilterExpressionService.translate("advancedFilterValidationExtraEndBracket"),startPosition:this.endPosition+1,endPosition:this.endPosition+1};let i;return this.expressionParsers.length===this.operatorParser.getNumOperators()?i="advancedFilterValidationMissingCondition":this.missingEndBracket&&(i="advancedFilterValidationMissingEndBracket"),i?{message:this.params.advancedFilterExpressionService.translate(i),startPosition:this.params.expression.length,endPosition:this.params.expression.length}:null}getFunctionString(t){const i=this.expressionParsers.length>1,s=this.expressionParsers.map(r=>r.getFunctionString(t)).join(` ${this.operatorParser.getFunction()} `);return i?`(${s})`:s}getFunctionParsed(t){const i=this.operatorParser.getFunction(),s=this.expressionParsers.map(a=>a.getFunctionParsed(t)),r=i==="&&"?"every":"some";return(a,n,o)=>s[r](d=>d(a,n,o))}getAutocompleteListParams(t){if(this.endPosition!=null&&t>this.endPosition+1)return;if(!this.expressionParsers.length)return this.getColumnAutocompleteListParams();const i=this.getExpressionParserIndex(t);if(i==null)return this.params.expression[t]==="("?{enabled:!1}:this.getColumnAutocompleteListParams();const r=this.expressionParsers[i].getAutocompleteListParams(t);if(!r){if(i<this.expressionParsers.length-1)return this.operatorParser.getAutocompleteListParams(t,i);if(this.expressionParsers.length===this.operatorParser.getNumOperators()){const a=this.operatorParser.getLastOperatorEndPosition();return a==null||t<=a+1?this.operatorParser.getAutocompleteListParams(t,this.operatorParser.getNumOperators()-1):this.getColumnAutocompleteListParams()}return this.params.expression[t-1]===")"?{enabled:!1}:this.operatorParser.getAutocompleteListParams(t)}return r}updateExpression(t,i,s){var r;const a=this.params.expression,n=this.getExpressionParserIndex(t);if(n==null){const u=s==="column"?this.params.advancedFilterExpressionService.getColumnValue(i):(r=i.displayValue)!=null?r:i.key;return B(a,this.startPosition,this.startPosition,u,!0)}const d=this.expressionParsers[n].updateExpression(t,i,s);return d??(s==="column"?B(a,t,a.length-1,this.params.advancedFilterExpressionService.getColumnValue(i),!0):this.endPosition!=null&&t>this.endPosition+1?null:this.operatorParser.updateExpression(t,i,n))}getModel(){return this.expressionParsers.length>1?{filterType:"join",type:this.operatorParser.getModel(),conditions:this.expressionParsers.map(t=>t.getModel())}:this.expressionParsers[0].getModel()}getColumnAutocompleteListParams(){return this.params.advancedFilterExpressionService.generateAutocompleteListParams(this.params.advancedFilterExpressionService.getColumnAutocompleteEntries(),"column","")}getExpressionParserIndex(t){let i;for(let s=0;s<this.expressionParsers.length&&!(this.expressionParsers[s].startPosition>t);s++)i=s;return i}},Ut=class{constructor(e){this.params=e,this.valid=!1}parseExpression(){this.joinExpressionParser=new Ht(this.params,0);const e=this.joinExpressionParser.parseExpression();return this.valid=e>=this.params.expression.length-1&&this.joinExpressionParser.isValid(),this.params.expression}isValid(){return this.valid}getValidationMessage(){const e=this.joinExpressionParser.getValidationError();if(!e)return null;const{message:t,startPosition:i,endPosition:s}=e;return i<this.params.expression.length?this.params.advancedFilterExpressionService.translate("advancedFilterValidationMessage",[t,this.params.expression.slice(i,s+1).trim()]):this.params.advancedFilterExpressionService.translate("advancedFilterValidationMessageAtEnd",[t])}getFunctionString(){const e=this.createFunctionParams();return{functionString:`return ${this.joinExpressionParser.getFunctionString(e)};`,params:e}}getFunctionParsed(){const e=this.createFunctionParams();return{expressionFunction:this.joinExpressionParser.getFunctionParsed(e),params:e}}getAutocompleteListParams(e){var t;return(t=this.joinExpressionParser.getAutocompleteListParams(e))!=null?t:{enabled:!1}}updateExpression(e,t,i){return this.joinExpressionParser.updateExpression(e,t,i)}getModel(){return this.isValid()?this.joinExpressionParser.getModel():null}createFunctionParams(){return{operands:[],operators:[],evaluatorParams:[]}}},y=class extends Rt{constructor(){super(...arguments),this.appliedExpression=null,this.expression=null,this.isValid=!0}postConstruct(){this.setEnabled(this.gos.get("enableAdvancedFilter"),!0),this.ctrl=this.createManagedBean(new Le(this.enabled)),this.expressionProxy={getValue:(e,t)=>{const i=this.columnModel.getPrimaryColumn(e);return i?this.valueService.getValue(i,t,!0):void 0}},this.addManagedPropertyListener("enableAdvancedFilter",e=>this.setEnabled(!!e.currentValue)),this.addManagedListener(this.eventService,ge.EVENT_NEW_COLUMNS_LOADED,e=>this.onNewColumnsLoaded(e)),this.addManagedPropertyListener("includeHiddenColumnsInAdvancedFilter",()=>this.updateValidity())}isEnabled(){return this.enabled}isFilterPresent(){return!!this.expressionFunction}doesFilterPass(e){return this.expressionFunction(this.expressionProxy,e,this.expressionParams)}getModel(){var e;const t=this.createExpressionParser(this.appliedExpression);return t?.parseExpression(),(e=t?.getModel())!=null?e:null}setModel(e){const t=(s,r)=>{if(s.filterType==="join"){const a=this.advancedFilterExpressionService.parseJoinOperator(s),n=s.conditions.map(o=>t(o)).filter(o=>Me.exists(o)).join(` ${a} `);return r||s.conditions.length<=1?n:`(${n})`}else return this.advancedFilterExpressionService.parseColumnFilterModel(s)},i=e?t(e,!0):null;this.setExpressionDisplayValue(i),this.applyExpression(),this.ctrl.refreshComp(),this.ctrl.refreshBuilderComp()}getExpressionDisplayValue(){return this.expression}setExpressionDisplayValue(e){this.expression=e}isCurrentExpressionApplied(){return this.appliedExpression===this.expression}createExpressionParser(e){return e?new Ut({expression:e,columnModel:this.columnModel,dataTypeService:this.dataTypeService,valueService:this.valueService,advancedFilterExpressionService:this.advancedFilterExpressionService}):null}getDefaultExpression(e){const t=this.advancedFilterExpressionService.getColumnValue(e)+" ";return{updatedValue:t,updatedPosition:t.length}}isHeaderActive(){return!this.gos.get("advancedFilterParent")}getCtrl(){return this.ctrl}setEnabled(e,t){const i=this.enabled,s=this.rowModel.getType(),r=s==="clientSide"||s==="serverSide";if(e&&!s&&Me.warnOnce("Advanced Filter is only supported with the Client-Side Row Model or Server-Side Row Model."),this.enabled=e&&r,!t&&this.enabled!==i){const a={type:ge.EVENT_ADVANCED_FILTER_ENABLED_CHANGED,enabled:this.enabled};this.eventService.dispatchEvent(a)}}applyExpression(){const e=this.createExpressionParser(this.expression);e?.parseExpression(),this.applyExpressionFromParser(e)}applyExpressionFromParser(e){if(this.isValid=!e||e.isValid(),!e||!this.isValid){this.expressionFunction=null,this.expressionParams=null,this.appliedExpression=null;return}const{expressionFunction:t,params:i}=this.getFunction(e);this.expressionFunction=t,this.expressionParams=i,this.appliedExpression=this.expression}getFunction(e){if(this.gos.get("suppressAdvancedFilterEval"))return e.getFunctionParsed();{const{functionString:t,params:i}=e.getFunctionString();return{expressionFunction:new Function("expressionProxy","node","params",t),params:i}}}updateValidity(){this.advancedFilterExpressionService.resetColumnCaches();const e=this.createExpressionParser(this.expression);e?.parseExpression();const i=(!e||e.isValid())!==this.isValid;return this.applyExpressionFromParser(e),this.ctrl.refreshComp(),this.ctrl.refreshBuilderComp(),i}onNewColumnsLoaded(e){if(e.source!=="gridInitializing"||!this.dataTypeService.isPendingInference())return;this.ctrl.setInputDisabled(!0);const t=this.addManagedListener(this.eventService,ge.EVENT_DATA_TYPES_INFERRED,()=>{t?.(),this.ctrl.setInputDisabled(!1)})}};l([H("valueService")],y.prototype,"valueService",2),l([H("columnModel")],y.prototype,"columnModel",2),l([H("dataTypeService")],y.prototype,"dataTypeService",2),l([H("rowModel")],y.prototype,"rowModel",2),l([H("advancedFilterExpressionService")],y.prototype,"advancedFilterExpressionService",2),l([Gt],y.prototype,"postConstruct",1),y=l([kt("advancedFilterService")],y);var jt="31.3.4",$t={version:jt,moduleName:We.AdvancedFilterModule,beans:[y,V],agStackComponents:[{componentName:"agAdvancedFilter",componentClass:E}],dependantModules:[He]};export{$t as AdvancedFilterModule};

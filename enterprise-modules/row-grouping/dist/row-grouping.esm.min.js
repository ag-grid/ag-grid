/**
 * @ag-grid-enterprise/row-grouping - Advanced Data Grid / Data Table supporting Javascript / React / AngularJS / Web Components * @version v26.1.0
 * @link http://www.ag-grid.com/
' * @license Commercial
 */

/**
 * @ag-grid-enterprise/row-grouping - Advanced Data Grid / Data Table supporting Javascript / React / AngularJS / Web Components * @version v26.1.0
 * @link http://www.ag-grid.com/
' * @license Commercial
 */
import{_ as t,Autowired as e,Bean as o,BeanStub as n,NumberSequence as r,RowNode as i,PostConstruct as a,Events as s,DragSourceType as u,DragAndDropService as p,TouchListener as l,VirtualList as c,Optional as d,RefSelector as h,Component as g,PositionableFeature as f,HorizontalDirection as v,VerticalDirection as m,Constants as y,ModuleNames as C}from"@ag-grid-community/core";import{EnterpriseCoreModule as G}from"@ag-grid-enterprise/core";var A,D=(A=function(t,e){return(A=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}A(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),E=function(t,e,o,n){var r,i=arguments.length,a=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,o,a):r(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a},O=function(n){function r(){return null!==n&&n.apply(this,arguments)||this}return D(r,n),r.prototype.execute=function(e){var o=t.missingOrEmpty(this.columnModel.getValueColumns()),n=!this.gridOptionsWrapper.getGroupRowAggNodesFunc(),r=e.changedPath&&e.changedPath.isActive();if(!(o&&n&&r)){var i=this.createAggDetails(e);this.recursivelyCreateAggData(i)}},r.prototype.createAggDetails=function(t){var e=this.columnModel.isPivotActive(),o=this.columnModel.getValueColumns(),n=e?this.columnModel.getPivotColumns():[];return{changedPath:t.changedPath,valueColumns:o,pivotColumns:n}},r.prototype.recursivelyCreateAggData=function(t){var e=this;this.filteredOnly=!this.gridOptionsWrapper.isSuppressAggFilteredOnly();t.changedPath.forEachChangedNodeDepthFirst((function(o){if(!o.hasChildren())o.aggData&&o.setAggData(null);else{if(-1===o.level){var n=!e.columnModel.isPivotMode();if(e.gridOptionsWrapper.isSuppressAggAtRootLevel()&&n)return}e.aggregateRowNode(o,t)}}),!0)},r.prototype.aggregateRowNode=function(t,e){var o,n=0===e.valueColumns.length,r=0===e.pivotColumns.length,i=this.gridOptionsWrapper.getGroupRowAggNodesFunc();o=i?i(t.childrenAfterFilter):n?null:r?this.aggregateRowNodeUsingValuesOnly(t,e):this.aggregateRowNodeUsingValuesAndPivot(t),t.setAggData(o),t.sibling&&t.sibling.setAggData(o)},r.prototype.aggregateRowNodeUsingValuesAndPivot=function(e){var o=this,n={},r=this.pivotStage.getPivotColumnDefs();return r.filter((function(e){return!t.exists(e.pivotTotalColumnIds)})).forEach((function(t){var r,i=t.pivotKeys||[],a=t.pivotValueColumn,s=t.colId;r=e.leafGroup?o.getValuesFromMappedSet(e.childrenMapped,i,a):o.getValuesPivotNonLeaf(e,s),n[s]=o.aggregateValues(r,a.getAggFunc(),a,e)})),r.filter((function(e){return t.exists(e.pivotTotalColumnIds)})).forEach((function(t){var r=[],i=t.pivotValueColumn,a=t.pivotTotalColumnIds,s=t.colId;a&&a.length&&(a.forEach((function(t){r.push(n[t])})),n[s]=o.aggregateValues(r,i.getAggFunc(),i,e))})),n},r.prototype.aggregateRowNodeUsingValuesOnly=function(t,e){var o=this,n={},r=e.changedPath.isActive()?e.changedPath.getValueColumnsForNode(t,e.valueColumns):e.valueColumns,i=e.changedPath.isActive()?e.changedPath.getNotValueColumnsForNode(t,e.valueColumns):null,a=this.getValuesNormal(t,r),s=t.aggData;return r.forEach((function(e,r){n[e.getId()]=o.aggregateValues(a[r],e.getAggFunc(),e,t)})),i&&s&&i.forEach((function(t){n[t.getId()]=s[t.getId()]})),n},r.prototype.getValuesPivotNonLeaf=function(t,e){var o=[];return t.childrenAfterFilter.forEach((function(t){var n=t.aggData[e];o.push(n)})),o},r.prototype.getValuesFromMappedSet=function(t,e,o){var n=this,r=t;if(e.forEach((function(t){return r=r?r[t]:null})),!r)return[];var i=[];return r.forEach((function(t){var e=n.valueService.getValue(o,t);i.push(e)})),i},r.prototype.getValuesNormal=function(t,e){var o=[];e.forEach((function(){return o.push([])}));for(var n=e.length,r=this.filteredOnly?t.childrenAfterFilter:t.childrenAfterGroup,i=r.length,a=0;a<i;a++)for(var s=r[a],u=0;u<n;u++){var p=e[u],l=this.valueService.getValue(p,s);o[u].push(l)}return o},r.prototype.aggregateValues=function(e,o,n,r){var i="string"==typeof o?this.aggFuncService.getAggFunc(o):o;if("function"!=typeof i)return console.error("AG Grid: unrecognised aggregation function "+o),null;var a=function(){t.doOnce((function(){console.warn("AG Grid: since v24.0, custom aggregation functions take a params object. Please alter your aggregation function to use params.values")}),"aggregationStage.aggregateValues Deprecation")};return i({values:e,column:n,colDef:n?n.getColDef():void 0,rowNode:r,data:r?r.data:void 0,api:this.gridApi,columnApi:this.columnApi,context:this.gridOptionsWrapper.getContext(),forEach:function(t,o){return a(),e.forEach(t,o)},get length(){return a(),e.length},set length(t){a(),e.length=t}})},E([e("columnModel")],r.prototype,"columnModel",void 0),E([e("valueService")],r.prototype,"valueService",void 0),E([e("pivotStage")],r.prototype,"pivotStage",void 0),E([e("aggFuncService")],r.prototype,"aggFuncService",void 0),E([e("gridApi")],r.prototype,"gridApi",void 0),E([e("columnApi")],r.prototype,"columnApi",void 0),r=E([o("aggregationStage")],r)}(n),N=function(){function t(){this.allSets={},this.allParents=[]}return t.prototype.removeFromChildrenAfterGroup=function(t,e){this.getSet(t).removeFromChildrenAfterGroup[e.id]=!0},t.prototype.removeFromAllLeafChildren=function(t,e){this.getSet(t).removeFromAllLeafChildren[e.id]=!0},t.prototype.getSet=function(t){return this.allSets[t.id]||(this.allSets[t.id]={removeFromAllLeafChildren:{},removeFromChildrenAfterGroup:{}},this.allParents.push(t)),this.allSets[t.id]},t.prototype.getAllParents=function(){return this.allParents},t.prototype.flush=function(){var t=this;this.allParents.forEach((function(e){var o=t.allSets[e.id];e.childrenAfterGroup=e.childrenAfterGroup.filter((function(t){return!o.removeFromChildrenAfterGroup[t.id]})),e.allLeafChildren=e.allLeafChildren.filter((function(t){return!o.removeFromAllLeafChildren[t.id]})),e.updateHasChildren()})),this.allSets={},this.allParents.length=0},t}(),_=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),P=function(t,e,o,n){var r,i=arguments.length,a=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,o,a):r(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a},S=function(n){function s(){var t=null!==n&&n.apply(this,arguments)||this;return t.groupIdSequence=new r,t}return _(s,n),s.prototype.postConstruct=function(){this.usingTreeData=this.gridOptionsWrapper.isTreeData(),this.usingTreeData&&(this.getDataPath=this.gridOptionsWrapper.getDataPathFunc())},s.prototype.execute=function(t){var e=this.createGroupingDetails(t);if(e.transactions)this.handleTransaction(e);else{var o=!0===t.afterColumnsChanged;this.shotgunResetEverything(e,o)}this.sortGroupsWithComparator(e.rootNode),this.selectableService.updateSelectableAfterGrouping(e.rootNode)},s.prototype.createGroupingDetails=function(t){var e=t.rowNode,o=t.changedPath,n=t.rowNodeTransactions,r=t.rowNodeOrder,i=this.usingTreeData?null:this.columnModel.getRowGroupColumns();return{includeParents:!this.gridOptionsWrapper.isSuppressParentsInRowNodes(),expandByDefault:this.gridOptionsWrapper.getGroupDefaultExpanded(),groupedCols:i,rootNode:e,pivotMode:this.columnModel.isPivotMode(),groupedColCount:this.usingTreeData||!i?0:i.length,rowNodeOrder:r,transactions:n,changedPath:o}},s.prototype.handleTransaction=function(e){var o=this;e.transactions.forEach((function(n){var r=o.usingTreeData?void 0:new N;if(t.existsAndNotEmpty(n.remove)&&o.removeNodes(n.remove,e,r),t.existsAndNotEmpty(n.update)&&o.moveNodesInWrongPath(n.update,e,r),t.existsAndNotEmpty(n.add)&&o.insertNodes(n.add,e,!1),r){var i=r.getAllParents().slice();r.flush(),o.removeEmptyGroups(i,e)}})),e.rowNodeOrder&&this.sortChildren(e)},s.prototype.sortChildren=function(e){e.changedPath.forEachChangedNodeDepthFirst((function(o){t.sortRowNodesByOrder(o.childrenAfterGroup,e.rowNodeOrder)}))},s.prototype.sortGroupsWithComparator=function(e){if(!this.usingTreeData){var o=this.gridOptionsWrapper.getDefaultGroupOrderComparator();t.exists(o)&&function e(n){t.exists(n.childrenAfterGroup)&&!n.leafGroup&&(n.childrenAfterGroup.sort(o),n.childrenAfterGroup.forEach((function(t){return e(t)})))}(e)}},s.prototype.getExistingPathForNode=function(t,e){for(var o=[],n=this.usingTreeData?t:t.parent;n&&n!==e.rootNode;)o.push({key:n.key,rowGroupColumn:n.rowGroupColumn,field:n.field}),n=n.parent;return o.reverse(),o},s.prototype.moveNodesInWrongPath=function(e,o,n){var r=this;e.forEach((function(e){o.changedPath.isActive()&&o.changedPath.addParentNode(e.parent);var i=function(t){return t.key},a=r.getExistingPathForNode(e,o).map(i),s=r.getGroupInfo(e,o).map(i);t.areEqual(a,s)||r.moveNode(e,o,n)}))},s.prototype.moveNode=function(t,e,o){if(this.removeNodesInStages([t],e,o),this.insertOneNode(t,e,!0),t.setData(t.data),e.changedPath.isActive()){var n=t.parent;e.changedPath.addParentNode(n)}},s.prototype.removeNodes=function(t,e,o){this.removeNodesInStages(t,e,o),e.changedPath.isActive()&&t.forEach((function(t){return e.changedPath.addParentNode(t.parent)}))},s.prototype.removeNodesInStages=function(t,e,o){if(this.removeNodesFromParents(t,e,o),this.usingTreeData){this.postRemoveCreateFillerNodes(t,e);var n=t.map((function(t){return t.parent}));this.removeEmptyGroups(n,e)}},s.prototype.forEachParentGroup=function(t,e,o){for(var n=e;n&&n!==t.rootNode;)o(n),n=n.parent},s.prototype.removeNodesFromParents=function(t,e,o){var n=this,r=null==o,i=o||new N;t.forEach((function(t){n.removeFromParent(t,i),n.forEachParentGroup(e,t.parent,(function(e){i.removeFromAllLeafChildren(e,t)}))})),r&&i.flush()},s.prototype.postRemoveCreateFillerNodes=function(t,e){var o=this;t.forEach((function(t){if(t.hasChildren()){var n=o.getExistingPathForNode(t,e),r=o.findParentForNode(t,n,e);r.expanded=t.expanded,r.allLeafChildren=t.allLeafChildren,r.childrenAfterGroup=t.childrenAfterGroup,r.childrenMapped=t.childrenMapped,r.updateHasChildren(),r.childrenAfterGroup.forEach((function(t){return t.parent=r}))}}))},s.prototype.removeEmptyGroups=function(t,e){for(var o=this,n=!0,r=function(){n=!1;var r=new N;t.forEach((function(t){o.forEachParentGroup(e,t,(function(t){(function(t){var e=o.getChildrenMappedKey(t.key,t.rowGroupColumn),n=t.parent;return!(!n||!n.childrenMapped||!n.childrenMapped[e])&&!!t.isEmptyRowGroupNode()})(t)&&(n=!0,o.removeFromParent(t,r),t.setSelected(!1))}))})),r.flush()};n;)r()},s.prototype.removeFromParent=function(e,o){e.parent&&(o?o.removeFromChildrenAfterGroup(e.parent,e):(t.removeFromArray(e.parent.childrenAfterGroup,e),e.parent.updateHasChildren()));var n=this.getChildrenMappedKey(e.key,e.rowGroupColumn);e.parent&&e.parent.childrenMapped&&(e.parent.childrenMapped[n]=void 0),e.setRowTop(null),e.setRowIndex(null)},s.prototype.addToParent=function(t,e){var o=this.getChildrenMappedKey(t.key,t.rowGroupColumn);e&&(null!=e.childrenMapped&&(e.childrenMapped[o]=t),e.childrenAfterGroup.push(t),e.updateHasChildren())},s.prototype.areGroupColsEqual=function(e,o){return null!=e&&null!=o&&e.pivotMode===o.pivotMode&&t.areEqual(e.groupedCols,o.groupedCols)},s.prototype.checkAllGroupDataAfterColsChanged=function(t){var e=this,o=function(t){t&&t.forEach((function(t){if(!(!e.usingTreeData&&!t.group)){var n={field:t.field,key:t.key,rowGroupColumn:t.rowGroupColumn};e.setGroupData(t,n),o(t.childrenAfterGroup)}}))};o(t.rootNode.childrenAfterGroup)},s.prototype.shotgunResetEverything=function(t,e){this.noChangeInGroupingColumns(t,e)||(this.selectionService.removeGroupsFromSelection(),t.rootNode.leafGroup=!this.usingTreeData&&0===t.groupedCols.length,t.rootNode.childrenAfterGroup=[],t.rootNode.childrenMapped={},t.rootNode.updateHasChildren(),this.insertNodes(t.rootNode.allLeafChildren,t,!1))},s.prototype.noChangeInGroupingColumns=function(t,e){var o=!1,n=this.columnModel.getGroupDisplayColumns(),r=n?n.map((function(t){return t.getId()})).join("-"):"";return e&&(o=this.usingTreeData||this.areGroupColsEqual(t,this.oldGroupingDetails),this.oldGroupDisplayColIds!==r&&this.checkAllGroupDataAfterColsChanged(t)),this.oldGroupingDetails=t,this.oldGroupDisplayColIds=r,o},s.prototype.insertNodes=function(t,e,o){var n=this;t.forEach((function(t){n.insertOneNode(t,e,o),e.changedPath.isActive()&&e.changedPath.addParentNode(t.parent)}))},s.prototype.insertOneNode=function(t,e,o){var n=this.getGroupInfo(t,e),r=this.findParentForNode(t,n,e);r.group||console.warn("AG Grid: duplicate group keys for row data, keys should be unique",[r.data,t.data]),this.usingTreeData?this.swapGroupWithUserNode(r,t,o):(t.parent=r,t.level=n.length,r.childrenAfterGroup.push(t),r.updateHasChildren())},s.prototype.findParentForNode=function(t,e,o){var n=this,r=o.rootNode;return e.forEach((function(e,i){(r=n.getOrCreateNextNode(r,e,i,o)).allLeafChildren.push(t)})),r},s.prototype.swapGroupWithUserNode=function(t,e,o){e.parent=t.parent,e.key=t.key,e.field=t.field,e.groupData=t.groupData,e.level=t.level,o||(e.expanded=t.expanded),e.leafGroup=t.leafGroup,e.rowGroupIndex=t.rowGroupIndex,e.allLeafChildren=t.allLeafChildren,e.childrenAfterGroup=t.childrenAfterGroup,e.childrenMapped=t.childrenMapped,e.updateHasChildren(),this.removeFromParent(t),e.childrenAfterGroup.forEach((function(t){return t.parent=e})),this.addToParent(e,t.parent)},s.prototype.getOrCreateNextNode=function(t,e,o,n){var r=this.getChildrenMappedKey(e.key,e.rowGroupColumn),i=t.childrenMapped?t.childrenMapped[r]:void 0;return i||(i=this.createGroup(e,t,o,n),this.addToParent(i,t)),i},s.prototype.createGroup=function(t,e,o,n){var r=new i(this.beans);return r.group=!0,r.field=t.field,r.rowGroupColumn=t.rowGroupColumn,this.setGroupData(r,t),r.id=i.ID_PREFIX_ROW_GROUP+this.groupIdSequence.next(),r.key=t.key,r.level=o,r.leafGroup=!this.usingTreeData&&o===n.groupedColCount-1,r.allLeafChildren=[],r.setAllChildrenCount(0),r.rowGroupIndex=this.usingTreeData?null:o,r.childrenAfterGroup=[],r.childrenMapped={},r.updateHasChildren(),r.parent=n.includeParents?e:null,this.setExpandedInitialValue(n,r),r},s.prototype.setGroupData=function(t,e){var o=this;t.groupData={},this.columnModel.getGroupDisplayColumns().forEach((function(n){(o.usingTreeData||!!t.rowGroupColumn&&n.isRowGroupDisplayed(t.rowGroupColumn.getId()))&&(t.groupData[n.getColId()]=e.key)}))},s.prototype.getChildrenMappedKey=function(t,e){return e?e.getId()+"-"+t:t},s.prototype.setExpandedInitialValue=function(t,e){if(t.pivotMode&&e.leafGroup)e.expanded=!1;else{var o=this.gridOptionsWrapper.getIsGroupOpenByDefaultFunc();if(o){var n={rowNode:e,field:e.field,key:e.key,level:e.level,rowGroupColumn:e.rowGroupColumn};e.expanded=1==o(n)}else{var r=t.expandByDefault;-1!==t.expandByDefault?e.expanded=e.level<r:e.expanded=!0}}},s.prototype.getGroupInfo=function(t,e){return this.usingTreeData?this.getGroupInfoFromCallback(t):this.getGroupInfoFromGroupColumns(t,e)},s.prototype.getGroupInfoFromCallback=function(e){var o=this.getDataPath?this.getDataPath(e.data):null;null!=o&&0!==o.length||t.doOnce((function(){return console.warn("getDataPath() should not return an empty path for data",e.data)}),"groupStage.getGroupInfoFromCallback");return o?o.map((function(t){return{key:t,field:null,rowGroupColumn:null}})):[]},s.prototype.getGroupInfoFromGroupColumns=function(t,e){var o=this,n=[];return e.groupedCols.forEach((function(r){var i=o.valueService.getKeyForNode(r,t),a=null!=i;if(e.pivotMode&&!a&&(i=" ",a=!0),a){var s={key:i,field:r.getColDef().field,rowGroupColumn:r};n.push(s)}})),n},P([e("columnModel")],s.prototype,"columnModel",void 0),P([e("selectableService")],s.prototype,"selectableService",void 0),P([e("valueService")],s.prototype,"valueService",void 0),P([e("beans")],s.prototype,"beans",void 0),P([e("selectionService")],s.prototype,"selectionService",void 0),P([a],s.prototype,"postConstruct",null),s=P([o("groupStage")],s)}(n),T=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),b=function(t,e,o,n){var r,i=arguments.length,a=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,o,a):r(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a},M=function(){for(var t=0,e=0,o=arguments.length;e<o;e++)t+=arguments[e].length;var n=Array(t),r=0;for(e=0;e<o;e++)for(var i=arguments[e],a=0,s=i.length;a<s;a++,r++)n[r]=i[a];return n},w=function(n){function i(){return null!==n&&n.apply(this,arguments)||this}var a;return T(i,n),a=i,i.prototype.createPivotColumnDefs=function(e){var o=[],n=[],i=this.columnModel.getPivotColumns(),a=this.columnModel.getValueColumns(),s=i.length,u=new r;return this.recursivelyAddGroup(o,n,1,e,[],u,s,i),this.addRowGroupTotals(o,n,a,u),this.addExpandablePivotGroups(o,n,u),this.addPivotTotalsToGroups(o,n,u),{pivotColumnGroupDefs:o,pivotColumnDefs:n.map((function(e){return t.cloneObject(e)}))}},i.prototype.recursivelyAddGroup=function(e,o,n,r,i,a,s,u){var p=this;t.iterateObject(r,(function(t,r){var l=M(i,[t]);if(n!==s){var c={children:[],headerName:t,pivotKeys:l,columnGroupShow:"open",groupId:"pivot"+a.next()};e.push(c),p.recursivelyAddGroup(c.children,o,n+1,r,l,a,s,u)}else{var d=p.columnModel.getValueColumns(),h={children:[],headerName:t,pivotKeys:l,columnGroupShow:"open",groupId:"pivot"+a.next()};if(0===d.length){var g=p.createColDef(null,"-",l,a);h.children.push(g),o.push(g)}else d.forEach((function(t){var e=p.columnModel.getDisplayNameForColumn(t,"header"),n=p.createColDef(t,e,l,a);n.columnGroupShow="open",h.children.push(n),o.push(n)}));e.push(h)}}));var l=u[n-1].getColDef().pivotComparator,c=this.headerNameComparator.bind(this,l);e.sort(c)},i.prototype.addExpandablePivotGroups=function(t,e,o){var n=this;if(!this.gridOptionsWrapper.isSuppressExpandablePivotGroups()&&!this.gridOptionsWrapper.getPivotColumnGroupTotals()){var r=function(t,e,o,i){var a=t;if(a.children){var s=new Map;a.children.forEach((function(t){r(t,e,o,s)}));var u=!a.children.some((function(t){return t.children}));n.columnModel.getValueColumns().forEach((function(r){var i=n.columnModel.getDisplayNameForColumn(r,"header"),a=n.createColDef(r,i,t.pivotKeys,o);(a.pivotTotalColumnIds=s.get(r.getColId()),a.columnGroupShow="closed",a.aggFunc=r.getAggFunc(),u)||(t.children.push(a),e.push(a))})),n.merge(i,s)}else{var p=t;if(!p.pivotValueColumn)return;var l=p.pivotValueColumn.getColId(),c=i.has(l)?i.get(l):[];c.push(p.colId),i.set(l,c)}};t.forEach((function(t){r(t,e,o,new Map)}))}},i.prototype.addPivotTotalsToGroups=function(t,e,o){var n=this;if(this.gridOptionsWrapper.getPivotColumnGroupTotals()){var r="after"===this.gridOptionsWrapper.getPivotColumnGroupTotals(),i=this.columnModel.getValueColumns(),a=i.map((function(t){return t.getAggFunc()}));if(a&&!(a.length<1)&&this.sameAggFuncs(a)){var s=i[0];t.forEach((function(t){n.recursivelyAddPivotTotal(t,e,o,s,r)}))}}},i.prototype.recursivelyAddPivotTotal=function(t,e,o,n,r){var i=this,a=t;if(!a.children){var s=t;return s.colId?[s.colId]:null}var u=[];if(a.children.forEach((function(t){var a=i.recursivelyAddPivotTotal(t,e,o,n,r);a&&(u=u.concat(a))})),a.children.length>1){var p=this.gridOptionsWrapper.getLocaleTextFunc()("pivotColumnGroupTotals","Total"),l=this.createColDef(n,p,t.pivotKeys,o);l.pivotTotalColumnIds=u,l.aggFunc=n.getAggFunc();var c=t.children;r?c.push(l):c.unshift(l),e.push(l)}return u},i.prototype.addRowGroupTotals=function(t,e,o,n){var r=this;if(this.gridOptionsWrapper.getPivotRowTotals())for(var i="after"===this.gridOptionsWrapper.getPivotRowTotals(),a=i?o.slice():o.slice().reverse(),s=function(o){var s=a[o],p=[];t.forEach((function(t){p=p.concat(r.extractColIdsForValueColumn(t,s))})),u.createRowGroupTotal(t,e,[],n,s,p,i)},u=this,p=0;p<a.length;p++)s(p)},i.prototype.extractColIdsForValueColumn=function(t,e){var o=this,n=t;if(!n.children){var r=n;return r.pivotValueColumn===e&&r.colId?[r.colId]:[]}var i=[];return n.children.forEach((function(t){o.extractColIdsForValueColumn(t,e);var n=o.extractColIdsForValueColumn(t,e);i=i.concat(n)})),i},i.prototype.createRowGroupTotal=function(t,e,o,n,r,i,s){var u=o.slice(0),p=this.columnModel.getValueColumns(),l={children:[],pivotKeys:u,groupId:a.PIVOT_ROW_TOTAL_PREFIX+n.next()};if(0===p.length){var c=this.createColDef(null,"-",u,n);l.children.push(c),e.push(c)}else{var d=this.columnModel.getDisplayNameForColumn(r,"header");(c=this.createColDef(r,d,u,n)).pivotTotalColumnIds=i,l.children.push(c),e.push(c)}s?t.push(l):t.unshift(l)},i.prototype.createColDef=function(e,o,n,r){var i={};if(e){var a=e.getColDef();t.assign(i,a),i.hide=!1}return i.headerName=o,i.colId="pivot_"+r.next(),i.field=i.colId,i.pivotKeys=n,i.pivotValueColumn=e,i.filter=!1,i},i.prototype.sameAggFuncs=function(t){if(1==t.length)return!0;for(var e=1;e<t.length;e++)if(t[e]!==t[0])return!1;return!0},i.prototype.headerNameComparator=function(t,e,o){return t?t(e.headerName,o.headerName):e.headerName&&!o.headerName?1:!e.headerName&&o.headerName?-1:e.headerName&&o.headerName?e.headerName<o.headerName?-1:e.headerName>o.headerName?1:0:0},i.prototype.merge=function(t,e){e.forEach((function(e,o,n){var r=t.has(o)?t.get(o):[],i=M(r,e);t.set(o,i)}))},i.PIVOT_ROW_TOTAL_PREFIX="PivotRowTotal_",b([e("columnModel")],i.prototype,"columnModel",void 0),i=a=b([o("pivotColDefService")],i)}(n),F=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),I=function(t,e,o,n){var r,i=arguments.length,a=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,o,a):r(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a},R=function(n){function r(){var t=null!==n&&n.apply(this,arguments)||this;return t.uniqueValues={},t}return F(r,n),r.prototype.execute=function(t){var e=t.rowNode,o=t.changedPath;this.columnModel.isPivotActive()?this.executePivotOn(e,o):this.executePivotOff(o)},r.prototype.executePivotOff=function(t){this.aggregationColumnsHashLastTime=null,this.uniqueValues={},this.columnModel.isSecondaryColumnsPresent()&&(this.columnModel.setSecondaryColumns(null,"rowModelUpdated"),t&&t.setInactive())},r.prototype.executePivotOn=function(t,e){var o=this.bucketUpRowNodes(t),n=this.setUniqueValues(o),r=this.columnModel.getValueColumns(),i=r.map((function(t){return t.getId()})).join("#"),a=r.map((function(t){return t.getAggFunc().toString()})).join("#"),s=this.aggregationColumnsHashLastTime!==i,u=this.aggregationFuncsHashLastTime!==a;if(this.aggregationColumnsHashLastTime=i,this.aggregationFuncsHashLastTime=a,n||s||u){var p=this.pivotColDefService.createPivotColumnDefs(this.uniqueValues),l=p.pivotColumnGroupDefs,c=p.pivotColumnDefs;this.pivotColumnDefs=c,this.columnModel.setSecondaryColumns(l,"rowModelUpdated"),e&&e.setInactive()}},r.prototype.setUniqueValues=function(t){return!!(JSON.stringify(t)!==JSON.stringify(this.uniqueValues))&&(this.uniqueValues=t,!0)},r.prototype.bucketUpRowNodes=function(t){var e=this,o={},n=function(t){t.leafGroup?e.bucketRowNode(t,o):t.childrenAfterFilter.forEach((function(t){n(t)}))};return n(t),o},r.prototype.bucketRowNode=function(t,e){var o=this.columnModel.getPivotColumns();0!==o.length?t.childrenMapped=this.bucketChildren(t.childrenAfterFilter,o,0,e):t.childrenMapped=null},r.prototype.bucketChildren=function(e,o,n,r){var i=this,a={},s=o[n];if(e.forEach((function(e){var o=i.valueService.getKeyForNode(s,e);t.missing(o)&&(o=""),r[o]||(r[o]={}),a[o]||(a[o]=[]),a[o].push(e)})),n===o.length-1)return a;var u={};return t.iterateObject(a,(function(t,e){u[t]=i.bucketChildren(e,o,n+1,r[t])})),u},r.prototype.getPivotColumnDefs=function(){return this.pivotColumnDefs},I([e("valueService")],r.prototype,"valueService",void 0),I([e("columnModel")],r.prototype,"columnModel",void 0),I([e("pivotColDefService")],r.prototype,"pivotColDefService",void 0),r=I([o("pivotStage")],r)}(n),L=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),x=function(t,e,o,n){var r,i=arguments.length,a=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,o,a):r(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a},V="undefined"==typeof BigInt?null:BigInt,W=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.aggFuncsMap={},t.initialised=!1,t}var r;return L(n,e),r=n,n.prototype.init=function(){this.initialised||(this.initialiseWithDefaultAggregations(),this.addAggFuncs(this.gridOptionsWrapper.getAggFuncs()))},n.prototype.initialiseWithDefaultAggregations=function(){this.aggFuncsMap[r.AGG_SUM]=U,this.aggFuncsMap[r.AGG_FIRST]=j,this.aggFuncsMap[r.AGG_LAST]=k,this.aggFuncsMap[r.AGG_MIN]=H,this.aggFuncsMap[r.AGG_MAX]=B,this.aggFuncsMap[r.AGG_COUNT]=z,this.aggFuncsMap[r.AGG_AVG]=q,this.initialised=!0},n.prototype.getDefaultAggFunc=function(e){var o=this.getFuncNames(e),n=t.includes(o,r.AGG_SUM),i=t.exists(this.aggFuncsMap[r.AGG_SUM]);return n&&i?r.AGG_SUM:t.existsAndNotEmpty(o)?o[0]:null},n.prototype.addAggFuncs=function(e){t.iterateObject(e,this.addAggFunc.bind(this))},n.prototype.addAggFunc=function(t,e){this.init(),this.aggFuncsMap[t]=e},n.prototype.getAggFunc=function(t){return this.init(),this.aggFuncsMap[t]},n.prototype.getFuncNames=function(t){var e=t.getColDef().allowedAggFuncs;return null==e?Object.keys(this.aggFuncsMap).sort():e},n.prototype.clear=function(){this.aggFuncsMap={}},n.AGG_SUM="sum",n.AGG_FIRST="first",n.AGG_LAST="last",n.AGG_MIN="min",n.AGG_MAX="max",n.AGG_COUNT="count",n.AGG_AVG="avg",x([a],n.prototype,"init",null),n=r=x([o("aggFuncService")],n)}(n);function U(t){for(var e=t.values,o=null,n=0;n<e.length;n++){var r=e[n];"number"==typeof r?null===o?o=r:o+=V?"number"==typeof o?r:V(r):r:"bigint"==typeof r&&(o=null===o?r:("bigint"==typeof o?o:V(o))+r)}return o}function j(t){return t.values.length>0?t.values[0]:null}function k(e){return e.values.length>0?t.last(e.values):null}function H(t){for(var e=t.values,o=null,n=0;n<e.length;n++){var r=e[n];"number"!=typeof r&&"bigint"!=typeof r||!(null===o||o>r)||(o=r)}return o}function B(t){for(var e=t.values,o=null,n=0;n<e.length;n++){var r=e[n];"number"!=typeof r&&"bigint"!=typeof r||!(null===o||o<r)||(o=r)}return o}function z(t){for(var e=t.values,o=0,n=0;n<e.length;n++){var r=e[n];o+=null!=r&&"number"==typeof r.value?r.value:1}return{value:o,toString:function(){return this.value.toString()},toNumber:function(){return this.value}}}function q(t){for(var e=t.values,o=0,n=0,r=0;r<e.length;r++){var i=e[r],a=null;"number"==typeof i||"bigint"==typeof i?(a=i,n++):null==i||"number"!=typeof i.value&&"bigint"!=typeof i.value||"number"!=typeof i.count||(a=V?i.value*("number"==typeof i.value?i.count:V(i.count)):i.value*i.count,n+=i.count),"number"==typeof a?o+=V?"number"==typeof o?a:V(a):a:"bigint"==typeof a&&(o=("bigint"==typeof o?o:V(o))+a)}var s=null;return n>0&&(s=V?o/("number"==typeof o?n:V(n)):o/n),{count:n,value:s,toString:function(){return"number"==typeof this.value||"bigint"==typeof this.value?this.value.toString():""},toNumber:function(){return this.value}}}var K=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),X=function(t,e,o,n){var r,i=arguments.length,a=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,o,a):r(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a},Y=function(o){function n(t,e,n,r,i){var a=o.call(this)||this;return a.column=t,a.dragSourceDropTarget=e,a.ghost=n,a.valueColumn=r,a.horizontal=i,a.popupShowing=!1,a}return K(n,o),n.prototype.init=function(){this.setTemplate(n.TEMPLATE),this.addElementClasses(this.getGui()),this.addElementClasses(this.eDragHandle,"drag-handle"),this.addElementClasses(this.eText,"text"),this.addElementClasses(this.eButton,"button"),this.eDragHandle.appendChild(t.createIconNoSpan("columnDrag",this.gridOptionsWrapper)),this.eButton.appendChild(t.createIconNoSpan("cancel",this.gridOptionsWrapper)),this.displayName=this.columnModel.getDisplayNameForColumn(this.column,"columnDrop"),this.setupComponents(),this.ghost||this.gridOptionsWrapper.isFunctionsReadOnly()||this.addDragSource(),this.setupTooltip()},n.prototype.setupTooltip=function(){var t=this,e=function(){var e=t.column.getColDef().headerTooltip;t.setTooltip(e)};e(),this.addManagedListener(this.eventService,s.EVENT_NEW_COLUMNS_LOADED,e)},n.prototype.addDragSource=function(){var t=this,e={type:u.ToolPanel,eElement:this.eDragHandle,defaultIconName:p.ICON_HIDE,getDragItem:function(){return t.createDragItem()},dragItemName:this.displayName,dragSourceDropTarget:this.dragSourceDropTarget};this.dragAndDropService.addDragSource(e,!0),this.addDestroyFunc((function(){return t.dragAndDropService.removeDragSource(e)}))},n.prototype.createDragItem=function(){var t={};return t[this.column.getId()]=this.column.isVisible(),{columns:[this.column],visibleState:t}},n.prototype.setupComponents=function(){this.setTextValue(),this.setupRemove(),this.ghost&&t.addCssClass(this.getGui(),"ag-column-drop-cell-ghost"),this.valueColumn&&!this.gridOptionsWrapper.isFunctionsReadOnly()&&this.addGuiEventListener("click",this.onShowAggFuncSelection.bind(this))},n.prototype.setupRemove=function(){var e=this;t.setDisplayed(this.eButton,!this.gridOptionsWrapper.isFunctionsReadOnly()),this.addManagedListener(this.eButton,"click",(function(t){var o={type:n.EVENT_COLUMN_REMOVE};e.dispatchEvent(o),t.stopPropagation()}));var o=new l(this.eButton);this.addManagedListener(o,l.EVENT_TAP,(function(t){var o={type:n.EVENT_COLUMN_REMOVE};e.dispatchEvent(o)})),this.addDestroyFunc(o.destroy.bind(o))},n.prototype.setTextValue=function(){var e;if(this.valueColumn){var o=this.column.getAggFunc(),n="string"==typeof o?o:"agg";e=this.gridOptionsWrapper.getLocaleTextFunc()(n,n)+"("+this.displayName+")"}else e=this.displayName;var r=t.escapeString(e);this.eText.innerHTML=r},n.prototype.onShowAggFuncSelection=function(){var e=this;if(!this.popupShowing){this.popupShowing=!0;var o=new c("select-agg-func"),n=this.aggFuncService.getFuncNames(this.column);o.setModel({getRow:function(t){return n[t]},getRowCount:function(){return n.length}}),this.getContext().createBean(o);var r=t.loadTemplate('<div class="ag-select-agg-func-popup"></div>');r.style.top="0px",r.style.left="0px",r.appendChild(o.getGui()),r.style.width=this.getGui().clientWidth+"px";var i=this.gridOptionsWrapper.getLocaleTextFunc(),a=this.popupService.addPopup({modal:!0,eChild:r,closeOnEsc:!0,closedCallback:function(){e.destroyBean(o),e.popupShowing=!1},ariaLabel:i("ariaLabelAggregationFunction","Aggregation Function")});a&&o.setComponentCreator(this.createAggSelect.bind(this,a.hideFunc)),this.popupService.positionPopupUnderComponent({type:"aggFuncSelect",eventSource:this.getGui(),ePopup:r,keepWithinBounds:!0,column:this.column}),o.refresh()}},n.prototype.createAggSelect=function(t,e){var o=this,n=this.gridOptionsWrapper.getLocaleTextFunc(),r=e.toString(),i=n(r,r);return new Q((function(){if(t(),o.gridOptionsWrapper.isFunctionsPassive()){var n={type:s.EVENT_COLUMN_AGG_FUNC_CHANGE_REQUEST,columns:[o.column],aggFunc:e,api:o.gridApi,columnApi:o.columnApi};o.eventService.dispatchEvent(n)}else o.columnModel.setColumnAggFunc(o.column,e,"toolPanelDragAndDrop")}),i)},n.prototype.addElementClasses=function(e,o){o=o?"-"+o:"",t.addCssClass(e,"ag-column-drop-cell"+o);var n=this.horizontal?"horizontal":"vertical";t.addCssClass(e,"ag-column-drop-"+n+"-cell"+o)},n.EVENT_COLUMN_REMOVE="columnRemove",n.TEMPLATE='<span>\n          <span ref="eDragHandle" class="ag-drag-handle ag-column-drop-cell-drag-handle"></span>\n          <span ref="eText" class="ag-column-drop-cell-text"></span>\n          <span ref="eButton" class="ag-column-drop-cell-button"></span>\n        </span>',X([e("dragAndDropService")],n.prototype,"dragAndDropService",void 0),X([e("columnModel")],n.prototype,"columnModel",void 0),X([e("popupService")],n.prototype,"popupService",void 0),X([d("aggFuncService")],n.prototype,"aggFuncService",void 0),X([e("columnApi")],n.prototype,"columnApi",void 0),X([e("gridApi")],n.prototype,"gridApi",void 0),X([h("eText")],n.prototype,"eText",void 0),X([h("eDragHandle")],n.prototype,"eDragHandle",void 0),X([h("eButton")],n.prototype,"eButton",void 0),X([a],n.prototype,"init",null),n}(g),Q=function(t){function e(e,o){var n=t.call(this,'<div class="ag-select-agg-func-item"/>')||this;return n.getGui().innerText=o,n.value=o,n.addGuiEventListener("click",e),n}return K(e,t),e}(g),J=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),Z=function(e){function o(t,n){var r=e.call(this,'<div class="ag-unselectable"></div>')||this;return r.horizontal=t,r.valueColumn=n,r.state=o.STATE_NOT_DRAGGING,r.guiDestroyFunctions=[],r.childColumnComponents=[],r.resizeEnabled=!1,r.addElementClasses(r.getGui()),r.eColumnDropList=document.createElement("div"),r.addElementClasses(r.eColumnDropList,"list"),r}return J(o,e),o.prototype.isHorizontal=function(){return this.horizontal},o.prototype.toggleResizable=function(t){this.positionableFeature.setResizable(!!t&&{bottom:!0}),this.resizeEnabled=t},o.prototype.setBeans=function(t){this.beans=t},o.prototype.destroy=function(){this.destroyGui(),e.prototype.destroy.call(this)},o.prototype.destroyGui=function(){this.guiDestroyFunctions.forEach((function(t){return t()})),this.guiDestroyFunctions.length=0,this.childColumnComponents.length=0,t.clearElement(this.getGui()),t.clearElement(this.eColumnDropList)},o.prototype.init=function(t){this.params=t,this.addManagedListener(this.beans.eventService,s.EVENT_NEW_COLUMNS_LOADED,this.refreshGui.bind(this)),this.addManagedListener(this.beans.gridOptionsWrapper,"functionsReadOnly",this.refreshGui.bind(this)),this.setupDropTarget(),this.positionableFeature=new f(this.getGui(),{minHeight:100}),this.createManagedBean(this.positionableFeature),this.refreshGui()},o.prototype.addElementClasses=function(e,o){o=o?"-"+o:"",t.addCssClass(e,"ag-column-drop"+o);var n=this.horizontal?"horizontal":"vertical";t.addCssClass(e,"ag-column-drop-"+n+o)},o.prototype.setupDropTarget=function(){this.dropTarget={getContainer:this.getGui.bind(this),getIconName:this.getIconName.bind(this),onDragging:this.onDragging.bind(this),onDragEnter:this.onDragEnter.bind(this),onDragLeave:this.onDragLeave.bind(this),onDragStop:this.onDragStop.bind(this),isInterestedIn:this.isInterestedIn.bind(this)},this.beans.dragAndDropService.addDropTarget(this.dropTarget)},o.prototype.isInterestedIn=function(t){return t===u.HeaderCell||t===u.ToolPanel},o.prototype.checkInsertIndex=function(t){var e=this.horizontal?this.getNewHorizontalInsertIndex(t):this.getNewVerticalInsertIndex(t);if(e<0)return!1;var o=e!==this.insertIndex;return o&&(this.insertIndex=e),o},o.prototype.getNewHorizontalInsertIndex=function(e){if(t.missing(e.hDirection))return-1;var o=0,n=e.event,r=this.beans.gridOptionsWrapper.isEnableRtl(),i=e.hDirection===v.Left,a=n.clientX;return this.childColumnComponents.forEach((function(t){var e=t.getGui().getBoundingClientRect(),n=i?e.right:e.left;(r?a<=n:a>=n)&&o++})),o},o.prototype.getNewVerticalInsertIndex=function(e){if(t.missing(e.vDirection))return-1;var o=0,n=e.event;return this.childColumnComponents.forEach((function(t){var r=t.getGui().getBoundingClientRect();n.clientY>=(e.vDirection===m.Down?r.top:r.bottom)&&o++})),o},o.prototype.checkDragStartedBySelf=function(t){this.state===o.STATE_NOT_DRAGGING&&(this.state=o.STATE_REARRANGE_COLUMNS,this.potentialDndColumns=t.dragSource.getDragItem().columns||[],this.refreshGui(),this.checkInsertIndex(t),this.refreshGui())},o.prototype.onDragging=function(t){this.checkDragStartedBySelf(t),this.checkInsertIndex(t)&&this.refreshGui()},o.prototype.onDragEnter=function(t){var e=t.dragSource.getDragItem().columns||[];this.state=o.STATE_NEW_COLUMNS_IN;var n=e.filter(this.isColumnDroppable.bind(this));n.length>0&&(this.potentialDndColumns=n,this.checkInsertIndex(t),this.refreshGui())},o.prototype.isPotentialDndColumns=function(){return t.existsAndNotEmpty(this.potentialDndColumns)},o.prototype.onDragLeave=function(t){if(this.state===o.STATE_REARRANGE_COLUMNS){var e=t.dragSource.getDragItem().columns||[];this.removeColumns(e)}this.isPotentialDndColumns()&&(this.potentialDndColumns=[],this.refreshGui()),this.state=o.STATE_NOT_DRAGGING},o.prototype.onDragStop=function(){if(this.isPotentialDndColumns()){var t=!1;this.state===o.STATE_NEW_COLUMNS_IN?(this.addColumns(this.potentialDndColumns),t=!0):t=this.rearrangeColumns(this.potentialDndColumns),this.potentialDndColumns=[],this.beans.gridOptionsWrapper.isFunctionsPassive()&&t||this.refreshGui()}this.state=o.STATE_NOT_DRAGGING},o.prototype.removeColumns=function(e){var o=this.getExistingColumns().filter((function(o){return!t.includes(e,o)}));this.updateColumns(o)},o.prototype.addColumns=function(e){if(e){var o=this.getExistingColumns().slice(),n=e.filter((function(t){return o.indexOf(t)<0}));t.insertArrayIntoArray(o,n,this.insertIndex),this.updateColumns(o)}},o.prototype.rearrangeColumns=function(e){var o=this.getNonGhostColumns().slice();return t.insertArrayIntoArray(o,e,this.insertIndex),!t.areEqual(o,this.getExistingColumns())&&(this.updateColumns(o),!0)},o.prototype.refreshGui=function(){var t=this.eColumnDropList.scrollTop,e=this.resizeEnabled;this.toggleResizable(!1),this.destroyGui(),this.addIconAndTitleToGui(),this.addEmptyMessageToGui(),this.addColumnsToGui(),this.isHorizontal()||(this.eColumnDropList.scrollTop=t),e&&this.toggleResizable(e)},o.prototype.getNonGhostColumns=function(){var e=this,o=this.getExistingColumns();return this.isPotentialDndColumns()?o.filter((function(o){return!t.includes(e.potentialDndColumns,o)})):o},o.prototype.addColumnsToGui=function(){var t=this,e=this.getNonGhostColumns(),o=this.isPotentialDndColumns(),n=[];e.forEach((function(e,r){if(!(o&&r>=t.insertIndex)){var i=t.createColumnComponent(e,!1);n.push(i)}})),this.isPotentialDndColumns()&&(this.potentialDndColumns.forEach((function(e){var o=t.createColumnComponent(e,!0);n.push(o)})),e.forEach((function(e,o){if(!(o<t.insertIndex)){var r=t.createColumnComponent(e,!1);n.push(r)}}))),this.getGui().appendChild(this.eColumnDropList),n.forEach((function(e,o){o>0&&t.addArrow(t.eColumnDropList),t.eColumnDropList.appendChild(e.getGui())}))},o.prototype.createColumnComponent=function(t,e){var o=this,n=new Y(t,this.dropTarget,e,this.valueColumn,this.horizontal);return n.addEventListener(Y.EVENT_COLUMN_REMOVE,this.removeColumns.bind(this,[t])),this.beans.context.createBean(n),this.guiDestroyFunctions.push((function(){return o.destroyBean(n)})),e||this.childColumnComponents.push(n),n},o.prototype.addIconAndTitleToGui=function(){var e=this.params.icon,o=document.createElement("div");if(this.addElementClasses(o,"title-bar"),this.addElementClasses(e,"icon"),t.addOrRemoveCssClass(this.getGui(),"ag-column-drop-empty",this.isExistingColumnsEmpty()),o.appendChild(e),!this.horizontal){var n=document.createElement("span");this.addElementClasses(n,"title"),n.innerHTML=this.params.title,o.appendChild(n)}this.getGui().appendChild(o)},o.prototype.isExistingColumnsEmpty=function(){return 0===this.getExistingColumns().length},o.prototype.addEmptyMessageToGui=function(){if(this.isExistingColumnsEmpty()&&!this.isPotentialDndColumns()){var t=document.createElement("span");t.innerHTML=this.params.emptyMessage,this.addElementClasses(t,"empty-message"),this.eColumnDropList.appendChild(t)}},o.prototype.addArrow=function(e){if(this.horizontal){var o=this.beans.gridOptionsWrapper.isEnableRtl(),n=t.createIconNoSpan(o?"smallLeft":"smallRight",this.beans.gridOptionsWrapper);this.addElementClasses(n,"cell-separator"),e.appendChild(n)}},o.STATE_NOT_DRAGGING="notDragging",o.STATE_NEW_COLUMNS_IN="newColumnsIn",o.STATE_REARRANGE_COLUMNS="rearrangeColumns",o}(g),$=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),tt=function(t,e,o,n){var r,i=arguments.length,a=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,o,a):r(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a},et=function(o){function n(t){return o.call(this,t,!1)||this}return $(n,o),n.prototype.passBeansUp=function(){o.prototype.setBeans.call(this,{gridOptionsWrapper:this.gridOptionsWrapper,eventService:this.eventService,context:this.getContext(),loggerFactory:this.loggerFactory,dragAndDropService:this.dragAndDropService});var e=this.gridOptionsWrapper.getLocaleTextFunc(),n=e("rowGroupColumnsEmptyMessage","Drag here to set row groups"),r=e("groups","Row Groups");o.prototype.init.call(this,{dragAndDropIcon:p.ICON_GROUP,icon:t.createIconNoSpan("rowGroupPanel",this.gridOptionsWrapper,null),emptyMessage:n,title:r}),this.addManagedListener(this.eventService,s.EVENT_COLUMN_ROW_GROUP_CHANGED,this.refreshGui.bind(this))},n.prototype.getTooltipParams=function(){var t=o.prototype.getTooltipParams.call(this);return t.location="rowGroupColumnsList",t},n.prototype.isColumnDroppable=function(t){return!(this.gridOptionsWrapper.isFunctionsReadOnly()||!t.isPrimary())&&(t.isAllowRowGroup()&&!t.isRowGroupActive())},n.prototype.updateColumns=function(t){if(this.gridOptionsWrapper.isFunctionsPassive()){var e={type:s.EVENT_COLUMN_ROW_GROUP_CHANGE_REQUEST,columns:t,api:this.gridApi,columnApi:this.columnApi};this.eventService.dispatchEvent(e)}else this.columnModel.setRowGroupColumns(t,"toolPanelUi")},n.prototype.getIconName=function(){return this.isPotentialDndColumns()?p.ICON_GROUP:p.ICON_NOT_ALLOWED},n.prototype.getExistingColumns=function(){return this.columnModel.getRowGroupColumns()},tt([e("columnModel")],n.prototype,"columnModel",void 0),tt([e("loggerFactory")],n.prototype,"loggerFactory",void 0),tt([e("dragAndDropService")],n.prototype,"dragAndDropService",void 0),tt([e("columnApi")],n.prototype,"columnApi",void 0),tt([e("gridApi")],n.prototype,"gridApi",void 0),tt([a],n.prototype,"passBeansUp",null),n}(Z),ot=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),nt=function(t,e,o,n){var r,i=arguments.length,a=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,o,a):r(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a},rt=function(o){function n(t){return o.call(this,t,!1)||this}return ot(n,o),n.prototype.passBeansUp=function(){o.prototype.setBeans.call(this,{gridOptionsWrapper:this.gridOptionsWrapper,eventService:this.eventService,context:this.getContext(),loggerFactory:this.loggerFactory,dragAndDropService:this.dragAndDropService});var e=this.gridOptionsWrapper.getLocaleTextFunc(),n=e("pivotColumnsEmptyMessage","Drag here to set column labels"),r=e("pivots","Column Labels");o.prototype.init.call(this,{dragAndDropIcon:p.ICON_GROUP,icon:t.createIconNoSpan("pivotPanel",this.gridOptionsWrapper,null),emptyMessage:n,title:r}),this.addManagedListener(this.eventService,s.EVENT_NEW_COLUMNS_LOADED,this.refresh.bind(this)),this.addManagedListener(this.eventService,s.EVENT_COLUMN_PIVOT_CHANGED,this.refresh.bind(this)),this.addManagedListener(this.eventService,s.EVENT_COLUMN_PIVOT_MODE_CHANGED,this.checkVisibility.bind(this)),this.refresh()},n.prototype.getTooltipParams=function(){var t=o.prototype.getTooltipParams.call(this);return t.location="pivotColumnsList",t},n.prototype.refresh=function(){this.checkVisibility(),this.refreshGui()},n.prototype.checkVisibility=function(){var t=this.columnModel.isPivotMode();if(this.isHorizontal())switch(this.gridOptionsWrapper.getPivotPanelShow()){case"always":this.setDisplayed(t);break;case"onlyWhenPivoting":var e=this.columnModel.isPivotActive();this.setDisplayed(t&&e);break;default:this.setDisplayed(!1)}else this.setDisplayed(t)},n.prototype.isColumnDroppable=function(t){return!(this.gridOptionsWrapper.isFunctionsReadOnly()||!t.isPrimary())&&(t.isAllowPivot()&&!t.isPivotActive())},n.prototype.updateColumns=function(t){if(this.gridOptionsWrapper.isFunctionsPassive()){var e={type:s.EVENT_COLUMN_PIVOT_CHANGE_REQUEST,columns:t,api:this.gridApi,columnApi:this.columnApi};this.eventService.dispatchEvent(e)}else this.columnModel.setPivotColumns(t,"toolPanelUi")},n.prototype.getIconName=function(){return this.isPotentialDndColumns()?p.ICON_PIVOT:p.ICON_NOT_ALLOWED},n.prototype.getExistingColumns=function(){return this.columnModel.getPivotColumns()},nt([e("columnModel")],n.prototype,"columnModel",void 0),nt([e("loggerFactory")],n.prototype,"loggerFactory",void 0),nt([e("dragAndDropService")],n.prototype,"dragAndDropService",void 0),nt([e("columnApi")],n.prototype,"columnApi",void 0),nt([e("gridApi")],n.prototype,"gridApi",void 0),nt([a],n.prototype,"passBeansUp",null),n}(Z),it=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),at=function(t,e,o,n){var r,i=arguments.length,a=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,o,a):r(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a},st=function(o){function n(){return o.call(this)||this}return it(n,o),n.prototype.postConstruct=function(){this.setGui(this.createNorthPanel()),this.addManagedListener(this.eventService,s.EVENT_COLUMN_ROW_GROUP_CHANGED,this.onRowGroupChanged.bind(this)),this.addManagedListener(this.eventService,s.EVENT_NEW_COLUMNS_LOADED,this.onRowGroupChanged.bind(this)),this.onRowGroupChanged()},n.prototype.createNorthPanel=function(){var e=document.createElement("div"),o=this.onDropPanelVisible.bind(this);return t.addCssClass(e,"ag-column-drop-wrapper"),this.rowGroupComp=new et(!0),this.createManagedBean(this.rowGroupComp),this.pivotComp=new rt(!0),this.createManagedBean(this.pivotComp),e.appendChild(this.rowGroupComp.getGui()),e.appendChild(this.pivotComp.getGui()),this.addManagedListener(this.rowGroupComp,g.EVENT_DISPLAYED_CHANGED,o),this.addManagedListener(this.pivotComp,g.EVENT_DISPLAYED_CHANGED,o),this.onDropPanelVisible(),e},n.prototype.onDropPanelVisible=function(){var t=this.rowGroupComp.isDisplayed()&&this.pivotComp.isDisplayed();this.rowGroupComp.addOrRemoveCssClass("ag-column-drop-horizontal-half-width",t),this.pivotComp.addOrRemoveCssClass("ag-column-drop-horizontal-half-width",t)},n.prototype.onRowGroupChanged=function(){if(this.rowGroupComp){var t=this.gridOptionsWrapper.getRowGroupPanelShow();if(t===y.ALWAYS)this.rowGroupComp.setDisplayed(!0);else if(t===y.ONLY_WHEN_GROUPING){var e=!this.columnModel.isRowGroupEmpty();this.rowGroupComp.setDisplayed(e)}else this.rowGroupComp.setDisplayed(!1)}},at([e("columnModel")],n.prototype,"columnModel",void 0),at([a],n.prototype,"postConstruct",null),n}(g),ut={moduleName:C.RowGroupingModule,beans:[O,S,w,R,W],agStackComponents:[{componentName:"AgGridHeaderDropZones",componentClass:st}],dependantModules:[G]},pt=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),lt=function(t,e,o,n){var r,i=arguments.length,a=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,o,a):r(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a},ct=function(o){function n(t){return o.call(this,t,!0)||this}return pt(n,o),n.prototype.passBeansUp=function(){o.prototype.setBeans.call(this,{gridOptionsWrapper:this.gridOptionsWrapper,eventService:this.eventService,context:this.getContext(),loggerFactory:this.loggerFactory,dragAndDropService:this.dragAndDropService});var e=this.gridOptionsWrapper.getLocaleTextFunc(),n=e("valueColumnsEmptyMessage","Drag here to aggregate"),r=e("values","Values");o.prototype.init.call(this,{dragAndDropIcon:p.ICON_AGGREGATE,icon:t.createIconNoSpan("valuePanel",this.gridOptionsWrapper,null),emptyMessage:n,title:r}),this.addManagedListener(this.eventService,s.EVENT_COLUMN_VALUE_CHANGED,this.refreshGui.bind(this))},n.prototype.getTooltipParams=function(){var t=o.prototype.getTooltipParams.call(this);return t.location="valueColumnsList",t},n.prototype.getIconName=function(){return this.isPotentialDndColumns()?p.ICON_AGGREGATE:p.ICON_NOT_ALLOWED},n.prototype.isColumnDroppable=function(t){return!(this.gridOptionsWrapper.isFunctionsReadOnly()||!t.isPrimary())&&(t.isAllowValue()&&!t.isValueActive())},n.prototype.updateColumns=function(t){if(this.gridOptionsWrapper.isFunctionsPassive()){var e={type:s.EVENT_COLUMN_VALUE_CHANGE_REQUEST,columns:t,api:this.gridApi,columnApi:this.columnApi};this.eventService.dispatchEvent(e)}else this.columnModel.setValueColumns(t,"toolPanelUi")},n.prototype.getExistingColumns=function(){return this.columnModel.getValueColumns()},lt([e("columnModel")],n.prototype,"columnModel",void 0),lt([e("loggerFactory")],n.prototype,"loggerFactory",void 0),lt([e("dragAndDropService")],n.prototype,"dragAndDropService",void 0),lt([e("columnApi")],n.prototype,"columnApi",void 0),lt([e("gridApi")],n.prototype,"gridApi",void 0),lt([a],n.prototype,"passBeansUp",null),n}(Z);export{rt as PivotDropZonePanel,et as RowGroupDropZonePanel,ut as RowGroupingModule,ct as ValuesDropZonePanel};
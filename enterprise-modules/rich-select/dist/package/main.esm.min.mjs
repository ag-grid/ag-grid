import{ModuleNames as E}from"@ag-grid-community/core";import{EnterpriseCoreModule as C}from"@ag-grid-enterprise/core";import{AgRichSelect as y,Events as b,PopupComponent as P,_ as d}from"@ag-grid-community/core";var m=class extends P{constructor(){super('<div class="ag-cell-edit-wrapper"></div>')}init(t){this.params=t;const{cellStartedEdit:i,cellHeight:e,values:a}=t;d.missing(a)&&console.warn("AG Grid: agRichSelectCellEditor requires cellEditorParams.values to be set");const{params:r,valuesPromise:s}=this.buildRichSelectParams();this.richSelect=this.createManagedBean(new y(r)),this.richSelect.addCssClass("ag-cell-editor"),this.appendChild(this.richSelect),s&&s.then(c=>{this.richSelect.setValueList({valueList:c,refresh:!0});const o=this.getSearchStringCallback(c);o&&this.richSelect.setSearchStringCreator(o)}),this.addManagedListener(this.richSelect,b.EVENT_FIELD_PICKER_VALUE_SELECTED,this.onEditorPickerValueSelected.bind(this)),this.addManagedListener(this.richSelect.getGui(),"focusout",this.onEditorFocusOut.bind(this)),this.focusAfterAttached=i,d.exists(e)&&this.richSelect.setRowHeight(e)}onEditorPickerValueSelected(t){this.params.stopEditing(!t.fromEnterKey)}onEditorFocusOut(t){this.richSelect.getGui().contains(t.relatedTarget)||this.params.stopEditing(!0)}buildRichSelectParams(){const{cellRenderer:t,value:i,values:e,formatValue:a,searchDebounceDelay:r,valueListGap:s,valueListMaxHeight:c,valueListMaxWidth:o,allowTyping:p,filterList:S,searchType:g,highlightMatch:f,valuePlaceholder:v,eventKey:h}=this.params,n={value:i,cellRenderer:t,searchDebounceDelay:r,valueFormatter:a,pickerAriaLabelKey:"ariaLabelRichSelectField",pickerAriaLabelValue:"Rich Select Field",pickerType:"virtual-list",pickerGap:s,allowTyping:p,filterList:S,searchType:g,highlightMatch:f,maxPickerHeight:c,maxPickerWidth:o,placeholder:v,initialInputValue:h?.length===1?h:void 0};let l,u;return typeof e=="function"?l=e(this.params):l=e??[],Array.isArray(l)?(n.valueList=l,n.searchStringCreator=this.getSearchStringCallback(l)):u=l,{params:n,valuesPromise:u}}getSearchStringCallback(t){const{colDef:i}=this.params;if(!(typeof t[0]!="object"||!i.keyCreator))return e=>e.map(a=>{const r=this.gos.addGridCommonParams({value:a,colDef:this.params.colDef,column:this.params.column,node:this.params.node,data:this.params.data});return i.keyCreator(r)})}afterGuiAttached(){const{focusAfterAttached:t,params:i}=this;setTimeout(()=>{if(!this.isAlive())return;if(t){const a=this.richSelect.getFocusableElement();a.focus();const{allowTyping:r,eventKey:s}=this.params;r&&(!s||s.length!==1)&&a.select()}this.richSelect.showPicker();const{eventKey:e}=i;e&&e?.length===1&&this.richSelect.searchTextFromString(e)})}getValue(){return this.richSelect.getValue()}isPopup(){return!1}},k="31.3.4",R={version:k,moduleName:E.RichSelectModule,beans:[],userComponents:[{componentName:"agRichSelect",componentClass:m},{componentName:"agRichSelectCellEditor",componentClass:m}],dependantModules:[C]};export{R as RichSelectModule};

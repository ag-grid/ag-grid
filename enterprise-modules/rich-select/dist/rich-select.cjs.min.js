/**
          * @ag-grid-enterprise/rich-select - Advanced Data Grid / Data Table supporting Javascript / Typescript / React / Angular / Vue * @version v29.0.0
          * @link https://www.ag-grid.com/
          * @license Commercial
          */
/**
          * @ag-grid-enterprise/rich-select - Advanced Data Grid / Data Table supporting Javascript / Typescript / React / Angular / Vue * @version v29.0.0
          * @link https://www.ag-grid.com/
          * @license Commercial
          */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@ag-grid-community/core"),t=require("@ag-grid-enterprise/core");function i(e,t){e.then((function(e){var i=e.getGui();null!=i&&("object"==typeof i?t.appendChild(i):t.innerHTML=i)}))}var r,o=(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=function(e,t,i,r){var o,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(n<3?o(s):n>3?o(t,i,s):o(t,i))||s);return n>3&&s&&Object.defineProperty(t,i,s),s},s=function(t){function r(e){var i=t.call(this,'<div class="ag-rich-select-row" role="presentation"></div>')||this;return i.params=e,i}return o(r,t),r.prototype.setState=function(e,t,i){this.populateWithRenderer(e,t)||this.populateWithoutRenderer(e,t),this.updateSelected(i)},r.prototype.updateSelected=function(e){this.addOrRemoveCssClass("ag-rich-select-row-selected",e)},r.prototype.populateWithoutRenderer=function(t,i){var r=null!=i?i:t;e._.exists(r)&&""!==r?this.getGui().textContent=r.toString():this.getGui().innerHTML="&nbsp;"},r.prototype.populateWithRenderer=function(e,t){var r=this,o={value:e,valueFormatted:t,api:this.gridOptionsService.get("api")},n=this.userComponentFactory.getCellRendererDetails(this.params,o),s=n?n.newAgStackInstance():void 0;return null!=s?i(s,this.getGui()):this.getGui().innerText=null!=o.valueFormatted?o.valueFormatted:o.value,!!s&&(s.then((function(e){r.addDestroyFunc((function(){r.getContext().destroyBean(e)}))})),!0)},n([e.Autowired("userComponentFactory")],r.prototype,"userComponentFactory",void 0),r}(e.Component),a=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])})(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),c=function(e,t,i,r){var o,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(n<3?o(s):n>3?o(t,i,s):o(t,i))||s);return n>3&&s&&Object.defineProperty(t,i,s),s},l=function(t){function r(){var e=t.call(this,r.TEMPLATE)||this;return e.selectionConfirmed=!1,e.searchString="",e}return a(r,t),r.prototype.init=function(t){this.params=t,this.selectedValue=t.value,this.originalSelectedValue=t.value,this.focusAfterAttached=t.cellStartedEdit;var i=e._.createIconNoSpan("smallDown",this.gridOptionsService);if(i.classList.add("ag-rich-select-value-icon"),this.eValue.appendChild(i),this.virtualList=this.createManagedBean(new e.VirtualList("rich-select")),this.virtualList.setComponentCreator(this.createRowComponent.bind(this)),this.eList.appendChild(this.virtualList.getGui()),e._.exists(this.params.cellHeight)&&this.virtualList.setRowHeight(this.params.cellHeight),this.renderSelectedValue(),e._.missing(t.values))console.warn("AG Grid: richSelectCellEditor requires values for it to work");else{var r=t.values;this.virtualList.setModel({getRowCount:function(){return r.length},getRow:function(e){return r[e]}}),this.addGuiEventListener("keydown",this.onKeyDown.bind(this));var o=this.virtualList.getGui();this.addManagedListener(o,"click",this.onClick.bind(this)),this.addManagedListener(o,"mousemove",this.onMouseMove.bind(this));var n=e._.exists(t.searchDebounceDelay)?t.searchDebounceDelay:300;this.clearSearchString=e._.debounce(this.clearSearchString,n),e._.exists(t.charPress)&&this.searchText(t.charPress)}},r.prototype.onKeyDown=function(t){var i=t.key;switch(t.preventDefault(),i){case e.KeyCode.ENTER:this.onEnterKeyDown();break;case e.KeyCode.TAB:this.confirmSelection();break;case e.KeyCode.DOWN:case e.KeyCode.UP:this.onNavigationKeyPressed(t,i);break;default:this.searchText(t)}},r.prototype.confirmSelection=function(){this.selectionConfirmed=!0},r.prototype.onEnterKeyDown=function(){this.confirmSelection(),this.params.stopEditing()},r.prototype.onNavigationKeyPressed=function(t,i){t.preventDefault();var r=this.params.values.indexOf(this.selectedValue),o=i===e.KeyCode.UP?r-1:r+1;if(o>=0&&o<this.params.values.length){var n=this.params.values[o];this.setSelectedValue(n)}},r.prototype.searchText=function(t){if("string"==typeof t)this.searchString+=t,this.runSearch(),this.clearSearchString();else{var i=t.key;if(i===e.KeyCode.BACKSPACE)this.searchString=this.searchString.slice(0,-1),i="";else if(!e._.isEventFromPrintableCharacter(t))return;this.searchText(i)}},r.prototype.runSearch=function(){var t,i=this,r=this.params.values;if("number"!=typeof r[0]&&"string"!=typeof r[0]||(t=r.map(String)),"object"==typeof r[0]&&this.params.colDef.keyCreator&&(t=r.map((function(e){var t={value:e,colDef:i.params.colDef,column:i.params.column,node:i.params.node,data:i.params.data,api:i.gridOptionsService.get("api"),columnApi:i.gridOptionsService.get("columnApi"),context:i.gridOptionsService.get("context")};return i.params.colDef.keyCreator(t)}))),t){var o=e._.fuzzySuggestions(this.searchString,t,!0,!0)[0];if(o){var n=r[t.indexOf(o)];this.setSelectedValue(n)}}},r.prototype.clearSearchString=function(){this.searchString=""},r.prototype.renderSelectedValue=function(){var t=this,r=this.params.formatValue(this.selectedValue),o=this.eValue,n={value:this.selectedValue,valueFormatted:r,api:this.gridOptionsService.get("api")},s=this.userComponentFactory.getCellRendererDetails(this.params,n),a=s?s.newAgStackInstance():void 0;a?(i(a,o),a.then((function(e){t.addDestroyFunc((function(){return t.getContext().destroyBean(e)}))}))):e._.exists(this.selectedValue)?o.innerText=r:e._.clearElement(o)},r.prototype.setSelectedValue=function(e){if(this.selectedValue!==e){var t=this.params.values.indexOf(e);-1!==t&&(this.selectedValue=e,this.virtualList.ensureIndexVisible(t),this.virtualList.forEachRenderedRow((function(e,i){e.updateSelected(t===i)})),this.virtualList.focusRow(t))}},r.prototype.createRowComponent=function(e){var t=this.params.formatValue(e),i=new s(this.params);return this.getContext().createBean(i),i.setState(e,t,e===this.selectedValue),i},r.prototype.onMouseMove=function(e){var t=this.virtualList.getGui().getBoundingClientRect(),i=this.virtualList.getScrollTop(),r=e.clientY-t.top+i,o=Math.floor(r/this.virtualList.getRowHeight()),n=this.params.values[o];void 0!==n&&this.setSelectedValue(n)},r.prototype.onClick=function(){this.confirmSelection(),this.params.stopEditing()},r.prototype.afterGuiAttached=function(){var e=this.params.values.indexOf(this.selectedValue);if(this.virtualList.refresh(),e>=0&&this.virtualList.ensureIndexVisible(e),this.virtualList.refresh(),this.focusAfterAttached){var t=-1!==e?e:0;this.params.values.length?this.virtualList.focusRow(t):this.getGui().focus()}},r.prototype.getValue=function(){return this.selectionConfirmed?this.selectedValue:this.originalSelectedValue},r.TEMPLATE='<div class="ag-rich-select" tabindex="-1">\n            <div ref="eValue" class="ag-rich-select-value"></div>\n            <div ref="eList" class="ag-rich-select-list"></div>\n        </div>',c([e.Autowired("userComponentFactory")],r.prototype,"userComponentFactory",void 0),c([e.RefSelector("eValue")],r.prototype,"eValue",void 0),c([e.RefSelector("eList")],r.prototype,"eList",void 0),r}(e.PopupComponent),u={version:"29.0.0",moduleName:e.ModuleNames.RichSelectModule,beans:[],userComponents:[{componentName:"agRichSelect",componentClass:l},{componentName:"agRichSelectCellEditor",componentClass:l}],dependantModules:[t.EnterpriseCoreModule]};exports.RichSelectModule=u;
var __defProp=Object.defineProperty,__getOwnPropDesc=Object.getOwnPropertyDescriptor,__getOwnPropNames=Object.getOwnPropertyNames,__hasOwnProp=Object.prototype.hasOwnProperty,__export=(t,e)=>{for(var s in e)__defProp(t,s,{get:e[s],enumerable:!0})},__copyProps=(t,e,s,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of __getOwnPropNames(e))!__hasOwnProp.call(t,r)&&r!==s&&__defProp(t,r,{get:()=>e[r],enumerable:!(i=__getOwnPropDesc(e,r))||i.enumerable});return t},__toCommonJS=t=>__copyProps(__defProp({},"__esModule",{value:!0}),t),__decorateClass=(t,e,s,i)=>{for(var r=i>1?void 0:i?__getOwnPropDesc(e,s):e,l=t.length-1,a;l>=0;l--)(a=t[l])&&(r=(i?a(e,s,r):a(r))||r);return i&&r&&__defProp(e,s,r),r},main_exports={};__export(main_exports,{SetFilter:()=>SetFilter,SetFilterModule:()=>SetFilterModule}),module.exports=__toCommonJS(main_exports);var import_core7=require("@ag-grid-community/core"),import_core8=require("@ag-grid-enterprise/core"),import_core5=require("@ag-grid-community/core"),import_core3=require("@ag-grid-community/core"),import_core=require("@ag-grid-community/core"),ClientSideValuesExtractor=class{constructor(t,e,s,i,r,l,a,n,h,o,d){this.rowModel=t,this.filterParams=e,this.createKey=s,this.caseFormat=i,this.columnModel=r,this.valueService=l,this.treeDataOrGrouping=a,this.treeData=n,this.getDataPath=h,this.groupAllowUnbalanced=o,this.addManagedListener=d}extractUniqueValuesAsync(t,e){return new import_core.AgPromise(s=>{if(this.rowModel.isRowDataLoaded())s(this.extractUniqueValues(t,e));else{const i=this.addManagedListener(import_core.Events.EVENT_ROW_COUNT_READY,()=>{i?.(),s(this.extractUniqueValues(t,e))})}})}extractUniqueValues(t,e){const s=new Map,i=this.extractExistingFormattedKeys(e),r=new Set,l=this.treeData&&!!this.getDataPath,a=this.columnModel.getRowGroupColumns(),n=(h,o)=>{const d=this.caseFormat(h);if(!r.has(d)){r.add(d);let u=h,p=import_core._.makeNull(o);const c=i?.get(d);c!=null&&(u=c,p=e.get(c)),s.set(u,p)}};return this.rowModel.forEachLeafNode(h=>{if(!h.data||!t(h))return;if(this.treeDataOrGrouping){this.addValueForTreeDataOrGrouping(h,l,a,n);return}let o=this.getValue(h);if(this.filterParams.convertValuesToStrings){this.addValueForConvertValuesToString(h,o,n);return}o!=null&&Array.isArray(o)?(o.forEach(d=>{n(this.createKey(d,h),d)}),o.length===0&&n(null,null)):n(this.createKey(o,h),o)}),s}addValueForConvertValuesToString(t,e,s){const i=this.createKey(e,t);i!=null&&Array.isArray(i)?(i.forEach(r=>{const l=import_core._.toStringOrNull(import_core._.makeNull(r));s(l,l)}),i.length===0&&s(null,null)):s(i,i)}addValueForTreeDataOrGrouping(t,e,s,i){var r;let l;if(e){if((r=t.childrenAfterGroup)!=null&&r.length)return;l=this.getDataPath(t.data)}else l=s.map(a=>this.valueService.getKeyForNode(a,t)),l.push(this.getValue(t));l&&(l=l.map(a=>import_core._.toStringOrNull(import_core._.makeNull(a)))),!e&&this.groupAllowUnbalanced&&l?.some(a=>a==null)&&(l=l.filter(a=>a!=null)),i(this.createKey(l),l)}getValue(t){return this.filterParams.getValue(t)}extractExistingFormattedKeys(t){if(!t)return null;const e=new Map;return t.forEach((s,i)=>{e.set(this.caseFormat(i),i)}),e}},SetFilterDisplayValue=class{};SetFilterDisplayValue.SELECT_ALL="__AG_SELECT_ALL__",SetFilterDisplayValue.ADD_SELECTION_TO_FILTER="__AG_ADD_SELECTION_TO_FILTER__";var FlatSetDisplayValueModel=class{constructor(t,e,s,i){this.valueService=t,this.valueFormatter=e,this.formatter=s,this.column=i,this.displayedKeys=[]}updateDisplayedValuesToAllAvailable(t,e,s){this.displayedKeys=Array.from(s)}updateDisplayedValuesToMatchMiniFilter(t,e,s,i,r){this.displayedKeys=[];for(let l of s)if(l==null)r&&this.displayedKeys.push(l);else{const a=t(l),n=this.valueService.formatValue(this.column,null,a,this.valueFormatter,!1),h=this.formatter(n);i(h)&&this.displayedKeys.push(l)}}getDisplayedValueCount(){return this.displayedKeys.length}getDisplayedItem(t){return this.displayedKeys[t]}getSelectAllItem(){return SetFilterDisplayValue.SELECT_ALL}getAddSelectionToFilterItem(){return SetFilterDisplayValue.ADD_SELECTION_TO_FILTER}getDisplayedKeys(){return this.displayedKeys}forEachDisplayedKey(t){this.displayedKeys.forEach(t)}someDisplayedKey(t){return this.displayedKeys.some(t)}hasGroups(){return!1}refresh(){}},import_core2=require("@ag-grid-community/core"),_TreeSetDisplayValueModel=class L{constructor(e,s,i,r){this.formatter=e,this.treeListPathGetter=s,this.treeListFormatter=i,this.treeDataOrGrouping=r,this.allDisplayedItemsTree=[],this.activeDisplayedItemsFlat=[],this.selectAllItem={depth:0,filterPasses:!0,available:!0,treeKey:SetFilterDisplayValue.SELECT_ALL,children:this.allDisplayedItemsTree,expanded:!0,key:SetFilterDisplayValue.SELECT_ALL,parentTreeKeys:[]},this.addSelectionToFilterItem={depth:0,filterPasses:!0,available:!0,treeKey:SetFilterDisplayValue.ADD_SELECTION_TO_FILTER,expanded:!0,key:SetFilterDisplayValue.ADD_SELECTION_TO_FILTER,parentTreeKeys:[]}}updateDisplayedValuesToAllAvailable(e,s,i,r){r==="reload"?this.generateItemTree(e,s,i):r==="otherFilter"?(this.updateAvailable(i),this.updateExpandAll()):r==="miniFilter"&&(this.resetFilter(),this.updateExpandAll()),this.flattenItems()}updateDisplayedValuesToMatchMiniFilter(e,s,i,r,l,a){a==="reload"?this.generateItemTree(e,s,i):a==="otherFilter"&&this.updateAvailable(i),this.updateFilter(r,l),this.updateExpandAll(),this.flattenItems()}generateItemTree(e,s,i){var r;this.allDisplayedItemsTree=[],this.groupsExist=!1;const l=this.getTreeListPathGetter(e,i);for(let a of s){const n=e(a),h=(r=l(n))!=null?r:[null];h.length>1&&(this.groupsExist=!0);const o=i.has(a);let d=this.allDisplayedItemsTree,u,p=[];h.forEach((c,f)=>{d||(d=[],u.children=d),u=d.find(y=>{var m;return((m=y.treeKey)==null?void 0:m.toUpperCase())===c?.toUpperCase()}),u||(u={treeKey:c,depth:f,filterPasses:!0,expanded:!1,available:o,parentTreeKeys:p},f===h.length-1&&(u.key=a),d.push(u)),d=u.children,p=[...p,c]})}this.updateAvailable(i),this.selectAllItem.children=this.allDisplayedItemsTree,this.selectAllItem.expanded=!1}getTreeListPathGetter(e,s){if(this.treeListPathGetter)return this.treeListPathGetter;if(this.treeDataOrGrouping)return r=>r;let i=!1;for(const r of s){const l=e(r);if(l instanceof Date){i=!0;break}else if(l!=null)break}return i?L.DATE_TREE_LIST_PATH_GETTER:(import_core2._.warnOnce("property treeList=true for Set Filter params, but you did not provide a treeListPathGetter or values of type Date."),r=>[String(r)])}flattenItems(){this.activeDisplayedItemsFlat=[];const e=s=>{s.forEach(i=>{!i.filterPasses||!i.available||(this.activeDisplayedItemsFlat.push(i),i.children&&i.expanded&&e(i.children))})};e(this.allDisplayedItemsTree)}resetFilter(){const e=s=>{s.children&&s.children.forEach(i=>{e(i)}),s.filterPasses=!0};this.allDisplayedItemsTree.forEach(s=>e(s))}updateFilter(e,s){const i=r=>r.available?r.treeKey==null?s:e(this.formatter(this.treeListFormatter?this.treeListFormatter(r.treeKey,r.depth,r.parentTreeKeys):r.treeKey)):!1;this.allDisplayedItemsTree.forEach(r=>this.recursiveItemCheck(r,!1,i,"filterPasses"))}getDisplayedValueCount(){return this.activeDisplayedItemsFlat.length}getDisplayedItem(e){return this.activeDisplayedItemsFlat[e]}getSelectAllItem(){return this.selectAllItem}getAddSelectionToFilterItem(){return this.addSelectionToFilterItem}getDisplayedKeys(){const e=[];return this.forEachDisplayedKey(s=>e.push(s)),e}forEachDisplayedKey(e){const s=(i,r)=>{i.children?(!i.expanded||!r)&&i.children.forEach(l=>{l.filterPasses&&s(l,!1)}):e(i.key)};this.activeDisplayedItemsFlat.forEach(i=>s(i,!0))}someDisplayedKey(e){const s=(i,r)=>{if(i.children){if(!i.expanded||!r)return i.children.some(l=>l.filterPasses?s(l,!1):!1)}else return e(i.key);return!1};return this.activeDisplayedItemsFlat.some(i=>s(i,!0))}hasGroups(){return this.groupsExist}refresh(){this.updateExpandAll(),this.flattenItems()}updateExpandAll(){const e=(i,r,l)=>{for(const a of i){if(!a.filterPasses||!a.available||!a.children)continue;if(r=r||!!a.expanded,l=l||!a.expanded,r&&l)return;const n=e(a.children,r,l);if(n===void 0)return;n?r=!0:l=!0}return r&&l?void 0:r},s=this.getSelectAllItem();s.expanded=e(s.children,!1,!1)}recursiveItemCheck(e,s,i,r){let l=!1;e.children&&e.children.forEach(n=>{const h=this.recursiveItemCheck(n,s||i(e),i,r);l=l||h});const a=s||l||i(e);return e[r]=a,a}updateAvailable(e){const s=i=>e.has(i.key);this.allDisplayedItemsTree.forEach(i=>this.recursiveItemCheck(i,!1,s,"available"))}};_TreeSetDisplayValueModel.DATE_TREE_LIST_PATH_GETTER=t=>t?[String(t.getFullYear()),String(t.getMonth()+1),String(t.getDate())]:null;var TreeSetDisplayValueModel=_TreeSetDisplayValueModel,SetValueModelFilteringKeys=class{constructor({caseFormat:t}){this.filteringKeys=null,this.filteringKeysCaseFormatted=null,this.hasNoAppliedFilteringKeys=!1,this.caseFormat=t}allFilteringKeys(){return this.filteringKeys}allFilteringKeysCaseFormatted(){return this.filteringKeysCaseFormatted}noAppliedFilteringKeys(){return this.hasNoAppliedFilteringKeys}setFilteringKeys(t){this.filteringKeys=new Set(t),this.hasNoAppliedFilteringKeys=!this.filteringKeys||this.filteringKeys.size===0,this.filteringKeysCaseFormatted=new Set,this.filteringKeys.forEach(e=>this.filteringKeysCaseFormatted.add(this.caseFormat(e)))}addFilteringKey(t){this.filteringKeys==null&&(this.filteringKeys=new Set,this.filteringKeysCaseFormatted=new Set),this.filteringKeys.add(t),this.filteringKeysCaseFormatted.add(this.caseFormat(t)),this.hasNoAppliedFilteringKeys&&(this.hasNoAppliedFilteringKeys=!1)}hasCaseFormattedFilteringKey(t){return this.filteringKeysCaseFormatted.has(this.caseFormat(t))}hasFilteringKey(t){return this.filteringKeys.has(t)}reset(){this.filteringKeys=null,this.filteringKeysCaseFormatted=null,this.hasNoAppliedFilteringKeys=!1}},_SetValueModel=class w{constructor(e){this.localEventService=new import_core3.EventService,this.miniFilterText=null,this.addCurrentSelectionToFilter=!1,this.providedValues=null,this.allValues=new Map,this.availableKeys=new Set,this.selectedKeys=new Set,this.initialised=!1;const{usingComplexObjects:s,columnModel:i,valueService:r,treeDataTreeList:l,groupingTreeList:a,filterParams:n,gos:h,valueFormatter:o,addManagedListener:d}=e,{column:u,colDef:p,textFormatter:c,doesRowPassOtherFilter:f,suppressSorting:y,comparator:m,rowModel:T,values:F,caseSensitive:K,convertValuesToStrings:x,treeList:S,treeListPathGetter:A,treeListFormatter:b}=n;this.filterParams=n,this.gos=h,this.setIsLoading=e.setIsLoading,this.translate=e.translate,this.caseFormat=e.caseFormat,this.createKey=e.createKey,this.usingComplexObjects=!!e.usingComplexObjects,this.formatter=c||import_core3.TextFilter.DEFAULT_FORMATTER,this.doesRowPassOtherFilters=f,this.suppressSorting=y||!1,this.convertValuesToStrings=!!x,this.filteringKeys=new SetValueModelFilteringKeys({caseFormat:this.caseFormat});const g=m??p.comparator,M=!!l||!!a;this.compareByValue=!!(s&&g||M||S&&!A),M&&!g?this.entryComparator=this.createTreeDataOrGroupingComparator():S&&!A&&!g?this.entryComparator=([E,C],[I,V])=>import_core3._.defaultComparator(C,V):this.entryComparator=([E,C],[I,V])=>g(C,V),this.keyComparator=g??import_core3._.defaultComparator,this.caseSensitive=!!K;const _=h.get("getDataPath"),D=h.get("groupAllowUnbalanced");T.getType()==="clientSide"&&(this.clientSideValuesExtractor=new ClientSideValuesExtractor(T,this.filterParams,this.createKey,this.caseFormat,i,r,M,!!l,_,D,d)),F==null?this.valuesType=2:(this.valuesType=Array.isArray(F)?0:1,this.providedValues=F),this.displayValueModel=S?new TreeSetDisplayValueModel(this.formatter,A,b,l||a):new FlatSetDisplayValueModel(r,o,this.formatter,u),this.updateAllValues().then(E=>this.resetSelectionState(E||[]))}addEventListener(e,s,i){this.localEventService.addEventListener(e,s,i)}removeEventListener(e,s,i){this.localEventService.removeEventListener(e,s,i)}updateOnParamsChange(e){return new import_core3.AgPromise(s=>{const{values:i,textFormatter:r,suppressSorting:l}=e,a=this.providedValues,n=this.suppressSorting;if(this.filterParams=e,this.formatter=r||import_core3.TextFilter.DEFAULT_FORMATTER,this.suppressSorting=l||!1,this.providedValues=i??null,this.providedValues!==a||this.suppressSorting!==n){!i||i.length===0?(this.valuesType=2,this.providedValues=null):this.valuesType=Array.isArray(i)?0:1;const h=this.getModel();this.updateAllValues().then(o=>{this.setModel(h).then(()=>s())})}else s()})}refreshValues(){return new import_core3.AgPromise(e=>{this.allValuesPromise.then(()=>{const s=this.getModel();this.updateAllValues(),this.setModel(s).then(()=>e())})})}overrideValues(e){return new import_core3.AgPromise(s=>{this.allValuesPromise.then(()=>{this.valuesType=0,this.providedValues=e,this.refreshValues().then(()=>s())})})}refreshAfterAnyFilterChanged(){return this.showAvailableOnly()?this.allValuesPromise.then(e=>(this.updateAvailableKeys(e??[],"otherFilter"),!0)):import_core3.AgPromise.resolve(!1)}isInitialised(){return this.initialised}updateAllValues(){return this.allValuesPromise=new import_core3.AgPromise(e=>{switch(this.valuesType){case 2:this.getValuesFromRowsAsync(!1).then(s=>e(this.processAllValues(s)));break;case 0:{e(this.processAllValues(this.uniqueValues(this.validateProvidedValues(this.providedValues))));break}case 1:{this.setIsLoading(!0);const s=this.providedValues,{column:i,colDef:r}=this.filterParams,l=this.gos.addGridCommonParams({success:a=>{this.setIsLoading(!1),e(this.processAllValues(this.uniqueValues(this.validateProvidedValues(a))))},colDef:r,column:i});window.setTimeout(()=>s(l),0);break}default:throw new Error("Unrecognised valuesType")}}),this.allValuesPromise.then(e=>this.updateAvailableKeys(e||[],"reload")).then(()=>this.initialised=!0),this.allValuesPromise}processAllValues(e){const s=this.sortKeys(e);return this.allValues=e??new Map,s}validateProvidedValues(e){if(this.usingComplexObjects&&e?.length){const s=e[0];s&&typeof s!="object"&&typeof s!="function"&&(this.createKey(s)==null?import_core3._.warnOnce("Set Filter Key Creator is returning null for provided values and provided values are primitives. Please provide complex objects or set convertValuesToStrings=true in the filterParams. See https://www.ag-grid.com/javascript-data-grid/filter-set-filter-list/#filter-value-types"):import_core3._.warnOnce("Set Filter has a Key Creator, but provided values are primitives. Did you mean to provide complex objects or enable convertValuesToStrings?"))}return e}setValuesType(e){this.valuesType=e}getValuesType(){return this.valuesType}isKeyAvailable(e){return this.availableKeys.has(e)}showAvailableOnly(){return this.valuesType===2}updateAvailableKeys(e,s){const i=this.showAvailableOnly()?this.sortKeys(this.getValuesFromRows(!0)):e;this.availableKeys=new Set(i),this.localEventService.dispatchEvent({type:w.EVENT_AVAILABLE_VALUES_CHANGED}),this.updateDisplayedValues(s,e)}sortKeys(e){const s=e??new Map;if(this.suppressSorting)return Array.from(s.keys());let i;return this.compareByValue?i=Array.from(s.entries()).sort(this.entryComparator).map(([r])=>r):i=Array.from(s.keys()).sort(this.keyComparator),this.filterParams.excelMode&&s.has(null)&&(i=i.filter(r=>r!=null),i.push(null)),i}getParamsForValuesFromRows(e=!1){if(!this.clientSideValuesExtractor)return import_core3._.doOnce(()=>{console.error("AG Grid: Set Filter cannot initialise because you are using a row model that does not contain all rows in the browser. Either use a different filter type, or configure Set Filter such that you provide it with values")},"setFilterValueNotCSRM"),null;const s=r=>!e||this.doesRowPassOtherFilters(r),i=e&&!this.caseSensitive?this.allValues:void 0;return{predicate:s,existingValues:i}}getValuesFromRows(e=!1){const s=this.getParamsForValuesFromRows(e);return s?this.clientSideValuesExtractor.extractUniqueValues(s.predicate,s.existingValues):null}getValuesFromRowsAsync(e=!1){const s=this.getParamsForValuesFromRows(e);return s?this.clientSideValuesExtractor.extractUniqueValuesAsync(s.predicate,s.existingValues):import_core3.AgPromise.resolve(null)}setMiniFilter(e){return e=import_core3._.makeNull(e),this.miniFilterText===e?!1:(e===null&&this.setAddCurrentSelectionToFilter(!1),this.miniFilterText=e,this.updateDisplayedValues("miniFilter"),!0)}getMiniFilter(){return this.miniFilterText}updateDisplayedValues(e,s){if(e==="expansion"){this.displayValueModel.refresh();return}if(this.miniFilterText==null){this.displayValueModel.updateDisplayedValuesToAllAvailable(a=>this.getValue(a),s,this.availableKeys,e);return}const i=this.caseFormat(this.formatter(this.miniFilterText)||""),r=a=>a!=null&&this.caseFormat(a).indexOf(i)>=0,l=!!this.filterParams.excelMode&&r(this.translate("blanks"));this.displayValueModel.updateDisplayedValuesToMatchMiniFilter(a=>this.getValue(a),s,this.availableKeys,r,l,e)}getDisplayedValueCount(){return this.displayValueModel.getDisplayedValueCount()}getDisplayedItem(e){return this.displayValueModel.getDisplayedItem(e)}getSelectAllItem(){return this.displayValueModel.getSelectAllItem()}getAddSelectionToFilterItem(){return this.displayValueModel.getAddSelectionToFilterItem()}hasSelections(){return this.filterParams.defaultToNothingSelected?this.selectedKeys.size>0:this.allValues.size!==this.selectedKeys.size}getKeys(){return Array.from(this.allValues.keys())}getValues(){return Array.from(this.allValues.values())}getValue(e){return this.allValues.get(e)}setAddCurrentSelectionToFilter(e){this.addCurrentSelectionToFilter=e}isInWindowsExcelMode(){return this.filterParams.excelMode==="windows"}isAddCurrentSelectionToFilterChecked(){return this.isInWindowsExcelMode()&&this.addCurrentSelectionToFilter}showAddCurrentSelectionToFilter(){return this.isInWindowsExcelMode()&&import_core3._.exists(this.miniFilterText)&&this.miniFilterText.length>0}selectAllMatchingMiniFilter(e=!1){this.miniFilterText==null?this.selectedKeys=new Set(this.allValues.keys()):(e&&this.selectedKeys.clear(),this.displayValueModel.forEachDisplayedKey(s=>this.selectedKeys.add(s)))}deselectAllMatchingMiniFilter(){this.miniFilterText==null?this.selectedKeys.clear():this.displayValueModel.forEachDisplayedKey(e=>this.selectedKeys.delete(e))}selectKey(e){this.selectedKeys.add(e)}deselectKey(e){this.filterParams.excelMode&&this.isEverythingVisibleSelected()&&this.resetSelectionState(this.displayValueModel.getDisplayedKeys()),this.selectedKeys.delete(e)}isKeySelected(e){return this.selectedKeys.has(e)}isEverythingVisibleSelected(){return!this.displayValueModel.someDisplayedKey(e=>!this.isKeySelected(e))}isNothingVisibleSelected(){return!this.displayValueModel.someDisplayedKey(e=>this.isKeySelected(e))}getModel(){if(!this.hasSelections())return null;const e=this.isAddCurrentSelectionToFilterChecked()?this.filteringKeys.allFilteringKeys():null;if(e&&e.size>0){if(this.selectedKeys){const s=new Set([...Array.from(e),...Array.from(this.selectedKeys).filter(i=>!e.has(i))]);return Array.from(s)}return Array.from(e)}return Array.from(this.selectedKeys)}setModel(e){return this.allValuesPromise.then(s=>{if(e==null)this.resetSelectionState(s??[]);else{this.selectedKeys.clear();const i=new Map;this.allValues.forEach((r,l)=>{i.set(this.caseFormat(l),l)}),e.forEach(r=>{const l=this.caseFormat(import_core3._.makeNull(r)),a=i.get(l);a!==void 0&&this.selectKey(a)})}})}uniqueValues(e){const s=new Map,i=new Set;return(e??[]).forEach(r=>{const l=import_core3._.makeNull(r),a=this.convertAndGetKey(l),n=this.caseFormat(a);i.has(n)||(i.add(n),s.set(a,l))}),s}convertAndGetKey(e){return this.convertValuesToStrings?e:this.createKey(e)}resetSelectionState(e){this.filterParams.defaultToNothingSelected?this.selectedKeys.clear():this.selectedKeys=new Set(e)}hasGroups(){return this.displayValueModel.hasGroups()}createTreeDataOrGroupingComparator(){return([e,s],[i,r])=>{if(s==null)return r==null?0:-1;if(r==null)return 1;for(let l=0;l<s.length;l++){if(l>=r.length)return 1;const a=import_core3._.defaultComparator(s[l],r[l]);if(a!==0)return a}return 0}}setAppliedModelKeys(e){this.filteringKeys.setFilteringKeys(e)}addToAppliedModelKeys(e){this.filteringKeys.addFilteringKey(e)}getAppliedModelKeys(){return this.filteringKeys.allFilteringKeys()}getCaseFormattedAppliedModelKeys(){return this.filteringKeys.allFilteringKeysCaseFormatted()}hasAppliedModelKey(e){return this.filteringKeys.hasCaseFormattedFilteringKey(e)}hasAnyAppliedModelKey(){return!this.filteringKeys.noAppliedFilteringKeys()}};_SetValueModel.EVENT_AVAILABLE_VALUES_CHANGED="availableValuesChanged";var SetValueModel=_SetValueModel,import_core4=require("@ag-grid-community/core"),_SetFilterListItem=class v extends import_core4.Component{constructor(e){var s;super(e.isGroup?v.GROUP_TEMPLATE:v.TEMPLATE),this.focusWrapper=e.focusWrapper,this.value=e.value,this.params=e.params,this.translate=e.translate,this.valueFormatter=e.valueFormatter,this.item=e.item,this.isSelected=e.isSelected,this.isTree=e.isTree,this.depth=(s=e.depth)!=null?s:0,this.isGroup=e.isGroup,this.groupsExist=e.groupsExist,this.isExpanded=e.isExpanded,this.hasIndeterminateExpandState=e.hasIndeterminateExpandState}init(){this.addDestroyFunc(()=>{var e;return(e=this.destroyCellRendererComponent)==null?void 0:e.call(this)}),this.render(),this.eCheckbox.setLabelEllipsis(!0).setValue(this.isSelected,!0).setDisabled(!!this.params.readOnly).getInputElement().setAttribute("tabindex","-1"),this.refreshVariableAriaLabels(),this.isTree&&(this.depth>0&&this.addCssClass("ag-set-filter-indent-"+this.depth),this.isGroup?this.setupExpansion():this.groupsExist&&this.addCssClass("ag-set-filter-add-group-indent"),import_core4._.setAriaLevel(this.getAriaElement(),this.depth+1)),this.refreshAriaChecked(),!this.params.readOnly&&this.eCheckbox.onValueChange(e=>this.onCheckboxChanged(!!e))}getFocusableElement(){return this.focusWrapper}setupExpansion(){this.eGroupClosedIcon.appendChild(import_core4._.createIcon("setFilterGroupClosed",this.gos,null)),this.eGroupOpenedIcon.appendChild(import_core4._.createIcon("setFilterGroupOpen",this.gos,null)),this.addManagedListener(this.eGroupClosedIcon,"click",this.onExpandOrContractClicked.bind(this)),this.addManagedListener(this.eGroupOpenedIcon,"click",this.onExpandOrContractClicked.bind(this)),this.hasIndeterminateExpandState&&(this.eGroupIndeterminateIcon.appendChild(import_core4._.createIcon("setFilterGroupIndeterminate",this.gos,null)),this.addManagedListener(this.eGroupIndeterminateIcon,"click",this.onExpandOrContractClicked.bind(this))),this.setExpandedIcons(),this.refreshAriaExpanded()}onExpandOrContractClicked(){this.setExpanded(!this.isExpanded)}setExpanded(e,s){if(this.isGroup&&e!==this.isExpanded){this.isExpanded=e;const i={type:v.EVENT_EXPANDED_CHANGED,isExpanded:!!e,item:this.item};s||this.dispatchEvent(i),this.setExpandedIcons(),this.refreshAriaExpanded()}}setExpandedIcons(){import_core4._.setDisplayed(this.eGroupClosedIcon,this.hasIndeterminateExpandState?this.isExpanded===!1:!this.isExpanded),import_core4._.setDisplayed(this.eGroupOpenedIcon,this.isExpanded===!0),this.hasIndeterminateExpandState&&import_core4._.setDisplayed(this.eGroupIndeterminateIcon,this.isExpanded===void 0)}onCheckboxChanged(e){this.isSelected=e;const s={type:v.EVENT_SELECTION_CHANGED,isSelected:e,item:this.item};this.dispatchEvent(s),this.refreshVariableAriaLabels(),this.refreshAriaChecked()}toggleSelected(){this.params.readOnly||this.setSelected(!this.isSelected)}setSelected(e,s){this.isSelected=e,this.eCheckbox.setValue(e,s),this.refreshAriaChecked()}refreshVariableAriaLabels(){if(!this.isTree)return;const e=this.localeService.getLocaleTextFunc(),s=this.eCheckbox.getValue(),i=s===void 0?e("ariaIndeterminate","indeterminate"):s?e("ariaVisible","visible"):e("ariaHidden","hidden"),r=e("ariaToggleVisibility","Press SPACE to toggle visibility");import_core4._.setAriaLabelledBy(this.eCheckbox.getInputElement(),void 0),this.eCheckbox.setInputAriaLabel(`${r} (${i})`)}setupFixedAriaLabels(e){if(!this.isTree)return;const i=this.localeService.getLocaleTextFunc()("ariaFilterValue","Filter Value"),r=this.getAriaElement();import_core4._.setAriaLabel(r,`${e} ${i}`),import_core4._.setAriaDescribedBy(r,this.eCheckbox.getInputElement().id)}refreshAriaChecked(){const e=this.getAriaElement();import_core4._.setAriaChecked(e,this.eCheckbox.getValue())}refreshAriaExpanded(){import_core4._.setAriaExpanded(this.getAriaElement(),!!this.isExpanded)}refresh(e,s,i){var r,l;if(this.item=e,s!==this.isSelected&&this.setSelected(s,!0),this.setExpanded(i,!0),this.valueFunction){const a=this.valueFunction();this.setTooltipAndCellRendererParams(a,a),this.cellRendererComponent||this.renderCellWithoutCellRenderer()}if(this.cellRendererComponent&&!((l=(r=this.cellRendererComponent).refresh)==null?void 0:l.call(r,this.cellRendererParams))){const n=this.cellRendererComponent;this.renderCell(),this.destroyBean(n)}}render(){const{params:{column:e}}=this;let{value:s}=this,i=null;typeof s=="function"?(this.valueFunction=s,i=this.valueFunction(),s=i):this.isTree?i=import_core4._.toStringOrNull(s):i=this.getFormattedValue(e,s),this.setTooltipAndCellRendererParams(s,i),this.renderCell()}setTooltipAndCellRendererParams(e,s){const i=this.gos.get("tooltipShowMode")==="whenTruncated";if(this.params.showTooltips&&(!i||!this.params.cellRenderer)){const r=s??import_core4._.toStringOrNull(e);let l;i&&(l=()=>{const a=this.eCheckbox.getGui().querySelector(".ag-label");return a?a.scrollWidth>a.clientWidth:!0}),this.setTooltip({newTooltipText:r,location:"setFilterValue",getColDef:()=>this.params.colDef,getColumn:()=>this.params.column,shouldDisplayTooltip:l})}this.cellRendererParams=this.gos.addGridCommonParams({value:e,valueFormatted:s,colDef:this.params.colDef,column:this.params.column,setTooltip:(r,l)=>{this.setTooltip({newTooltipText:r,getColDef:()=>this.params.colDef,getColumn:()=>this.params.column,location:"setFilterValue",shouldDisplayTooltip:l})}})}getTooltipParams(){const e=super.getTooltipParams();return e.location="setFilterValue",e.colDef=this.getComponentHolder(),this.isTree&&(e.level=this.depth),e}getFormattedValue(e,s){return this.valueService.formatValue(e,null,s,this.valueFormatter,!1)}renderCell(){const e=this.userComponentFactory.getSetFilterCellRendererDetails(this.params,this.cellRendererParams),s=e?e.newAgStackInstance():void 0;if(s==null){this.renderCellWithoutCellRenderer();return}s.then(i=>{i&&(this.cellRendererComponent=i,this.eCheckbox.setLabel(i.getGui()),this.destroyCellRendererComponent=()=>this.destroyBean(i))})}renderCellWithoutCellRenderer(){var e;let s=(e=this.cellRendererParams.valueFormatted==null?this.cellRendererParams.value:this.cellRendererParams.valueFormatted)!=null?e:this.translate("blanks");typeof s!="string"&&(import_core4._.warnOnce(`Set Filter Value Formatter must return string values. Please ensure the Set Filter Value Formatter returns string values for complex objects, or set convertValuesToStrings=true in the filterParams. See ${this.getFrameworkOverrides().getDocLink("filter-set-filter-list/#filter-value-types")}`),s=""),this.eCheckbox.setLabel(s),this.setupFixedAriaLabels(s)}getComponentHolder(){return this.params.column.getColDef()}};_SetFilterListItem.EVENT_SELECTION_CHANGED="selectionChanged",_SetFilterListItem.EVENT_EXPANDED_CHANGED="expandedChanged",_SetFilterListItem.GROUP_TEMPLATE=`
        <div class="ag-set-filter-item" aria-hidden="true">
            <span class="ag-set-filter-group-icons">
                <span class="ag-set-filter-group-closed-icon" ref="eGroupClosedIcon"></span>
                <span class="ag-set-filter-group-opened-icon" ref="eGroupOpenedIcon"></span>
                <span class="ag-set-filter-group-indeterminate-icon" ref="eGroupIndeterminateIcon"></span>
            </span>
            <ag-checkbox ref="eCheckbox" class="ag-set-filter-item-checkbox"></ag-checkbox>
        </div>`,_SetFilterListItem.TEMPLATE=`
        <div class="ag-set-filter-item">
            <ag-checkbox ref="eCheckbox" class="ag-set-filter-item-checkbox"></ag-checkbox>
        </div>`,__decorateClass([(0,import_core4.Autowired)("valueService")],_SetFilterListItem.prototype,"valueService",2),__decorateClass([(0,import_core4.Autowired)("userComponentFactory")],_SetFilterListItem.prototype,"userComponentFactory",2),__decorateClass([(0,import_core4.RefSelector)("eCheckbox")],_SetFilterListItem.prototype,"eCheckbox",2),__decorateClass([(0,import_core4.RefSelector)("eGroupOpenedIcon")],_SetFilterListItem.prototype,"eGroupOpenedIcon",2),__decorateClass([(0,import_core4.RefSelector)("eGroupClosedIcon")],_SetFilterListItem.prototype,"eGroupClosedIcon",2),__decorateClass([(0,import_core4.RefSelector)("eGroupIndeterminateIcon")],_SetFilterListItem.prototype,"eGroupIndeterminateIcon",2),__decorateClass([import_core4.PostConstruct],_SetFilterListItem.prototype,"init",1);var SetFilterListItem=_SetFilterListItem,DEFAULT_LOCALE_TEXT={loadingOoo:"Loading...",blanks:"(Blanks)",searchOoo:"Search...",selectAll:"(Select All)",selectAllSearchResults:"(Select All Search Results)",addCurrentSelectionToFilter:"Add current selection to filter",noMatches:"No matches."},SetFilterModelFormatter=class{getModelAsString(t,e){const{values:s}=t||e.getModel()||{},i=e.getValueModel();if(s==null||i==null)return"";const r=s.filter(n=>i.isKeyAvailable(n)),l=r.length,a=r.slice(0,10).map(n=>e.getFormattedValue(n));return`(${l}) ${a.join(",")}${l>10?",...":""}`}},SetFilter=class extends import_core5.ProvidedFilter{constructor(){super("setFilter"),this.valueModel=null,this.setFilterParams=null,this.virtualList=null,this.caseSensitive=!1,this.convertValuesToStrings=!1,this.treeDataTreeList=!1,this.groupingTreeList=!1,this.hardRefreshVirtualList=!1,this.noValueFormatterSupplied=!1,this.filterModelFormatter=new SetFilterModelFormatter,this.updateSetFilterOnParamsChange=t=>{var e;this.setFilterParams=t,this.convertValuesToStrings=!!t.convertValuesToStrings,this.caseSensitive=!!t.caseSensitive;const s=(e=t.keyCreator)!=null?e:t.colDef.keyCreator;this.setValueFormatter(t.valueFormatter,s,this.convertValuesToStrings,!!t.treeList,!!t.colDef.refData);const i=t.column.getId().startsWith(import_core5.GROUP_AUTO_COLUMN_ID);this.treeDataTreeList=this.gos.get("treeData")&&!!t.treeList&&i,this.getDataPath=this.gos.get("getDataPath"),this.groupingTreeList=!!this.columnModel.getRowGroupColumns().length&&!!t.treeList&&i,this.createKey=this.generateCreateKey(s,this.convertValuesToStrings,this.treeDataTreeList||this.groupingTreeList)}}postConstruct(){super.postConstruct()}updateUiVisibility(){}createBodyTemplate(){return`
            <div class="ag-set-filter">
                <div ref="eFilterLoading" class="ag-filter-loading ag-hidden">${this.translateForSetFilter("loadingOoo")}</div>
                <ag-input-text-field class="ag-mini-filter" ref="eMiniFilter"></ag-input-text-field>
                <div ref="eFilterNoMatches" class="ag-filter-no-matches ag-hidden">${this.translateForSetFilter("noMatches")}</div>
                <div ref="eSetFilterList" class="ag-set-filter-list" role="presentation"></div>
            </div>`}handleKeyDown(t){if(super.handleKeyDown(t),!t.defaultPrevented)switch(t.key){case import_core5.KeyCode.SPACE:this.handleKeySpace(t);break;case import_core5.KeyCode.ENTER:this.handleKeyEnter(t);break;case import_core5.KeyCode.LEFT:this.handleKeyLeft(t);break;case import_core5.KeyCode.RIGHT:this.handleKeyRight(t);break}}handleKeySpace(t){var e;(e=this.getComponentForKeyEvent(t))==null||e.toggleSelected()}handleKeyEnter(t){if(!this.setFilterParams)return;const{excelMode:e,readOnly:s}=this.setFilterParams||{};!e||s||(t.preventDefault(),this.onBtApply(!1,!1,t),this.setFilterParams.excelMode==="mac"&&this.eMiniFilter.getInputElement().select())}handleKeyLeft(t){var e;(e=this.getComponentForKeyEvent(t))==null||e.setExpanded(!1)}handleKeyRight(t){var e;(e=this.getComponentForKeyEvent(t))==null||e.setExpanded(!0)}getComponentForKeyEvent(t){var e;if(!this.eSetFilterList.contains(this.gos.getActiveDomElement())||!this.virtualList)return;const s=this.virtualList.getLastFocusedRow();if(s==null)return;const i=this.virtualList.getComponentAt(s);if(i==null)return;t.preventDefault();const{readOnly:r}=(e=this.setFilterParams)!=null?e:{};if(!r)return i}getCssIdentifier(){return"set-filter"}setModel(t){var e;return t==null&&((e=this.valueModel)==null?void 0:e.getModel())==null?(this.setMiniFilter(null),import_core5.AgPromise.resolve()):super.setModel(t)}refresh(t){var e,s,i;return!super.refresh(t)||["treeList","treeListFormatter","treeListPathGetter","keyCreator","convertValuesToStrings","caseSensitive","comparator","suppressSelectAll","excelMode"].some(l=>{var a;return t[l]!==((a=this.setFilterParams)==null?void 0:a[l])})||this.haveColDefParamsChanged(t.colDef)?!1:(super.updateParams(t),this.updateSetFilterOnParamsChange(t),this.updateMiniFilter(),(t.cellRenderer!==((e=this.setFilterParams)==null?void 0:e.cellRenderer)||t.valueFormatter!==((s=this.setFilterParams)==null?void 0:s.valueFormatter))&&this.checkAndRefreshVirtualList(),(i=this.valueModel)==null||i.updateOnParamsChange(t).then(()=>{var l;(l=this.valueModel)!=null&&l.hasSelections()&&this.refreshFilterValues()}),!0)}haveColDefParamsChanged(t){var e;const s=["keyCreator","filterValueGetter"],i=(e=this.setFilterParams)==null?void 0:e.colDef;return s.some(r=>t[r]!==i?.[r])}setModelAndRefresh(t){return this.valueModel?this.valueModel.setModel(t).then(()=>this.checkAndRefreshVirtualList()):import_core5.AgPromise.resolve()}resetUiToDefaults(){return this.setMiniFilter(null),this.setModelAndRefresh(null)}setModelIntoUi(t){this.setMiniFilter(null);const e=t==null?null:t.values;return this.setModelAndRefresh(e)}getModelFromUi(){if(!this.valueModel)throw new Error("Value model has not been created.");const t=this.valueModel.getModel();return t?{values:t,filterType:this.getFilterType()}:null}getFilterType(){return"set"}getValueModel(){return this.valueModel}areModelsEqual(t,e){return t==null&&e==null?!0:t!=null&&e!=null&&import_core5._.areEqual(t.values,e.values)}setParams(t){var e;this.applyExcelModeOptions(t),super.setParams(t),this.updateSetFilterOnParamsChange(t);const s=(e=t.keyCreator)!=null?e:t.colDef.keyCreator;this.valueModel=new SetValueModel({filterParams:t,setIsLoading:i=>this.setIsLoading(i),translate:i=>this.translateForSetFilter(i),caseFormat:i=>this.caseFormat(i),createKey:this.createKey,valueFormatter:this.valueFormatter,usingComplexObjects:!!s,gos:this.gos,columnModel:this.columnModel,valueService:this.valueService,treeDataTreeList:this.treeDataTreeList,groupingTreeList:this.groupingTreeList,addManagedListener:(i,r)=>this.addManagedListener(this.eventService,i,r)}),this.initialiseFilterBodyUi(),this.addEventListenersForDataChanges()}onAddCurrentSelectionToFilterChange(t){if(!this.valueModel)throw new Error("Value model has not been created.");this.valueModel.setAddCurrentSelectionToFilter(t)}setValueFormatter(t,e,s,i,r){let l=t;if(!l){if(e&&!s&&!i)throw new Error("AG Grid: Must supply a Value Formatter in Set Filter params when using a Key Creator unless convertValuesToStrings is enabled");this.noValueFormatterSupplied=!0,r||(l=a=>import_core5._.toStringOrNull(a.value))}this.valueFormatter=l}generateCreateKey(t,e,s){if(s&&!t)throw new Error("AG Grid: Must supply a Key Creator in Set Filter params when `treeList = true` on a group column, and Tree Data or Row Grouping is enabled.");return t?(i,r=null)=>{const l=this.getKeyCreatorParams(i,r);return import_core5._.makeNull(t(l))}:e?i=>Array.isArray(i)?i:import_core5._.makeNull(import_core5._.toStringOrNull(i)):i=>import_core5._.makeNull(import_core5._.toStringOrNull(i))}getFormattedValue(t){var e;let s=this.valueModel.getValue(t);this.noValueFormatterSupplied&&(this.treeDataTreeList||this.groupingTreeList)&&Array.isArray(s)&&(s=import_core5._.last(s));const i=this.valueService.formatValue(this.setFilterParams.column,null,s,this.valueFormatter,!1);return(e=i??import_core5._.toStringOrNull(s))!=null?e:this.translateForSetFilter("blanks")}applyExcelModeOptions(t){t.excelMode==="windows"?(t.buttons||(t.buttons=["apply","cancel"]),t.closeOnApply==null&&(t.closeOnApply=!0)):t.excelMode==="mac"&&(t.buttons||(t.buttons=["reset"]),t.applyMiniFilterWhileTyping==null&&(t.applyMiniFilterWhileTyping=!0),t.debounceMs==null&&(t.debounceMs=500)),t.excelMode&&t.defaultToNothingSelected&&(t.defaultToNothingSelected=!1,import_core5._.warnOnce('The Set Filter Parameter "defaultToNothingSelected" value was ignored because it does not work when "excelMode" is used.'))}addEventListenersForDataChanges(){this.isValuesTakenFromGrid()&&(this.addManagedListener(this.eventService,import_core5.Events.EVENT_CELL_VALUE_CHANGED,t=>{this.setFilterParams&&t.column===this.setFilterParams.column&&this.syncAfterDataChange()}),this.addManagedPropertyListeners(["treeData","getDataPath","groupAllowUnbalanced"],()=>{this.syncAfterDataChange()}))}syncAfterDataChange(){if(!this.valueModel)throw new Error("Value model has not been created.");return this.valueModel.refreshValues().then(()=>{this.checkAndRefreshVirtualList(),this.onBtApply(!1,!0)})}setIsLoading(t){import_core5._.setDisplayed(this.eFilterLoading,t),t||(this.hardRefreshVirtualList=!0)}initialiseFilterBodyUi(){this.initVirtualList(),this.initMiniFilter()}initVirtualList(){if(!this.setFilterParams)throw new Error("Set filter params have not been provided.");if(!this.valueModel)throw new Error("Value model has not been created.");const e=this.localeService.getLocaleTextFunc()("ariaFilterList","Filter List"),s=!!this.setFilterParams.treeList,i=this.virtualList=this.createBean(new import_core5.VirtualList({cssIdentifier:"filter",ariaRole:s?"tree":"listbox",listName:e})),r=this.getRefElement("eSetFilterList");s&&r.classList.add("ag-set-filter-tree-list"),r&&r.appendChild(i.getGui());const{cellHeight:l}=this.setFilterParams;l!=null&&i.setRowHeight(l);const a=(o,d)=>this.createSetListItem(o,s,d);i.setComponentCreator(a);const n=(o,d)=>this.updateSetListItem(o,d);i.setComponentUpdater(n);let h;this.setFilterParams.suppressSelectAll?h=new ModelWrapper(this.valueModel):h=new ModelWrapperWithSelectAll(this.valueModel,()=>this.isSelectAllSelected()),s&&(h=new TreeModelWrapper(h)),i.setModel(h)}getSelectAllLabel(){if(!this.setFilterParams)throw new Error("Set filter params have not been provided.");if(!this.valueModel)throw new Error("Value model has not been created.");const t=this.valueModel.getMiniFilter()==null||!this.setFilterParams.excelMode?"selectAll":"selectAllSearchResults";return this.translateForSetFilter(t)}getAddSelectionToFilterLabel(){if(!this.setFilterParams)throw new Error("Set filter params have not been provided.");if(!this.valueModel)throw new Error("Value model has not been created.");return this.translateForSetFilter("addCurrentSelectionToFilter")}createSetListItem(t,e,s){if(!this.setFilterParams)throw new Error("Set filter params have not been provided.");if(!this.valueModel)throw new Error("Value model has not been created.");const i=this.valueModel.hasGroups(),{isSelected:r,isExpanded:l}=this.isSelectedExpanded(t),{value:a,depth:n,isGroup:h,hasIndeterminateExpandState:o,selectedListener:d,expandedListener:u}=this.newSetListItemAttributes(t,e),p={focusWrapper:s,value:a,params:this.setFilterParams,translate:f=>this.translateForSetFilter(f),valueFormatter:this.valueFormatter,item:t,isSelected:r,isTree:e,depth:n,groupsExist:i,isGroup:h,isExpanded:l,hasIndeterminateExpandState:o},c=this.createBean(new SetFilterListItem(p));return c.addEventListener(SetFilterListItem.EVENT_SELECTION_CHANGED,d),u&&c.addEventListener(SetFilterListItem.EVENT_EXPANDED_CHANGED,u),c}newSetTreeItemAttributes(t,e){var s,i,r,l,a,n;if(!this.setFilterParams)throw new Error("Set filter params have not been provided.");if(!this.valueModel)throw new Error("Value model has not been created.");const h=this.valueModel.hasGroups();return t.key===SetFilterDisplayValue.SELECT_ALL?{value:()=>this.getSelectAllLabel(),isGroup:h,depth:t.depth,hasIndeterminateExpandState:!0,selectedListener:o=>this.onSelectAll(o.isSelected),expandedListener:o=>this.onExpandAll(o.item,o.isExpanded)}:t.key===SetFilterDisplayValue.ADD_SELECTION_TO_FILTER?{value:()=>this.getAddSelectionToFilterLabel(),depth:t.depth,isGroup:!1,hasIndeterminateExpandState:!1,selectedListener:o=>{this.onAddCurrentSelectionToFilterChange(o.isSelected)}}:t.children?{value:(r=(i=(s=this.setFilterParams).treeListFormatter)==null?void 0:i.call(s,t.treeKey,t.depth,t.parentTreeKeys))!=null?r:t.treeKey,depth:t.depth,isGroup:!0,selectedListener:o=>this.onGroupItemSelected(o.item,o.isSelected),expandedListener:o=>this.onExpandedChanged(o.item,o.isExpanded)}:{value:(n=(a=(l=this.setFilterParams).treeListFormatter)==null?void 0:a.call(l,t.treeKey,t.depth,t.parentTreeKeys))!=null?n:t.treeKey,depth:t.depth,selectedListener:o=>this.onItemSelected(o.item.key,o.isSelected)}}newSetListItemAttributes(t,e){if(!this.setFilterParams)throw new Error("Set filter params have not been provided.");if(!this.valueModel)throw new Error("Value model has not been created.");return this.isSetFilterModelTreeItem(t)?this.newSetTreeItemAttributes(t,e):t===SetFilterDisplayValue.SELECT_ALL?{value:()=>this.getSelectAllLabel(),selectedListener:s=>this.onSelectAll(s.isSelected)}:t===SetFilterDisplayValue.ADD_SELECTION_TO_FILTER?{value:()=>this.getAddSelectionToFilterLabel(),selectedListener:s=>{this.onAddCurrentSelectionToFilterChange(s.isSelected)}}:{value:this.valueModel.getValue(t),selectedListener:s=>this.onItemSelected(s.item,s.isSelected)}}updateSetListItem(t,e){const{isSelected:s,isExpanded:i}=this.isSelectedExpanded(t);e.refresh(t,s,i)}isSelectedExpanded(t){let e,s;return this.isSetFilterModelTreeItem(t)?(s=t.expanded,t.key===SetFilterDisplayValue.SELECT_ALL?e=this.isSelectAllSelected():t.key===SetFilterDisplayValue.ADD_SELECTION_TO_FILTER?e=this.valueModel.isAddCurrentSelectionToFilterChecked():t.children?e=this.areAllChildrenSelected(t):e=this.valueModel.isKeySelected(t.key)):t===SetFilterDisplayValue.SELECT_ALL?e=this.isSelectAllSelected():t===SetFilterDisplayValue.ADD_SELECTION_TO_FILTER?e=this.valueModel.isAddCurrentSelectionToFilterChecked():e=this.valueModel.isKeySelected(t),{isSelected:e,isExpanded:s}}isSetFilterModelTreeItem(t){return t?.treeKey!==void 0}initMiniFilter(){if(!this.setFilterParams)throw new Error("Set filter params have not been provided.");if(!this.valueModel)throw new Error("Value model has not been created.");const{eMiniFilter:t,localeService:e}=this,s=e.getLocaleTextFunc();t.setDisplayed(!this.setFilterParams.suppressMiniFilter),t.setValue(this.valueModel.getMiniFilter()),t.onValueChange(()=>this.onMiniFilterInput()),t.setInputAriaLabel(s("ariaSearchFilterValues","Search filter values")),this.addManagedListener(t.getInputElement(),"keydown",i=>this.onMiniFilterKeyDown(i))}updateMiniFilter(){if(!this.setFilterParams)throw new Error("Set filter params have not been provided.");if(!this.valueModel)throw new Error("Value model has not been created.");const{eMiniFilter:t}=this;t.isDisplayed()!==!this.setFilterParams.suppressMiniFilter&&t.setDisplayed(!this.setFilterParams.suppressMiniFilter);const e=this.valueModel.getMiniFilter();t.getValue()!==e&&t.setValue(e)}afterGuiAttached(t){if(!this.setFilterParams)throw new Error("Set filter params have not been provided.");super.afterGuiAttached(t),this.resetExpansion(),this.refreshVirtualList();const{eMiniFilter:e}=this;e.setInputPlaceholder(this.translateForSetFilter("searchOoo")),(!t||!t.suppressFocus)&&e.getFocusableElement().focus()}afterGuiDetached(){var t,e;super.afterGuiDetached(),(t=this.setFilterParams)!=null&&t.excelMode&&this.resetMiniFilter();const s=this.getModel();((e=this.setFilterParams)!=null&&e.excelMode||!this.areModelsEqual(s,this.getModelFromUi()))&&(this.resetUiToActiveModel(s),this.showOrHideResults())}applyModel(t="api"){if(!this.setFilterParams)throw new Error("Set filter params have not been provided.");if(!this.valueModel)throw new Error("Value model has not been created.");this.setFilterParams.excelMode&&t!=="rowDataUpdated"&&this.valueModel.isEverythingVisibleSelected()&&this.valueModel.selectAllMatchingMiniFilter();const e=this.valueModel.showAddCurrentSelectionToFilter()&&this.valueModel.isAddCurrentSelectionToFilterChecked();if(e&&!this.getModel())return!1;const s=super.applyModel(t),i=this.getModel();return i?(e||this.valueModel.setAppliedModelKeys(new Set),i.values.forEach(r=>{this.valueModel.addToAppliedModelKeys(r)})):e||this.valueModel.setAppliedModelKeys(null),s}isModelValid(t){return this.setFilterParams&&this.setFilterParams.excelMode?t==null||t.values.length>0:!0}doesFilterPass(t){if(!this.setFilterParams||!this.valueModel||!this.valueModel.getCaseFormattedAppliedModelKeys())return!0;if(!this.valueModel.hasAnyAppliedModelKey())return!1;const{node:e,data:s}=t;if(this.treeDataTreeList)return this.doesFilterPassForTreeData(e,s);if(this.groupingTreeList)return this.doesFilterPassForGrouping(e);let i=this.getValueFromNode(e);return this.convertValuesToStrings?this.doesFilterPassForConvertValuesToString(e,i):i!=null&&Array.isArray(i)?i.length===0?this.valueModel.hasAppliedModelKey(null):i.some(r=>this.isInAppliedModel(this.createKey(r,e))):this.isInAppliedModel(this.createKey(i,e))}doesFilterPassForConvertValuesToString(t,e){const s=this.createKey(e,t);return s!=null&&Array.isArray(s)?s.length===0?this.valueModel.hasAppliedModelKey(null):s.some(i=>this.isInAppliedModel(i)):this.isInAppliedModel(s)}doesFilterPassForTreeData(t,e){var s;return(s=t.childrenAfterGroup)!=null&&s.length?!1:this.isInAppliedModel(this.createKey(this.checkMakeNullDataPath(this.getDataPath(e))))}doesFilterPassForGrouping(t){const e=this.columnModel.getRowGroupColumns().map(s=>this.valueService.getKeyForNode(s,t));return e.push(this.getValueFromNode(t)),this.isInAppliedModel(this.createKey(this.checkMakeNullDataPath(e)))}checkMakeNullDataPath(t){return t&&(t=t.map(e=>import_core5._.toStringOrNull(import_core5._.makeNull(e)))),t?.some(e=>e==null)?null:t}isInAppliedModel(t){return this.valueModel.hasAppliedModelKey(t)}getValueFromNode(t){return this.setFilterParams.getValue(t)}getKeyCreatorParams(t,e=null){return{value:t,colDef:this.setFilterParams.colDef,column:this.setFilterParams.column,node:e,data:e?.data,api:this.setFilterParams.api,columnApi:this.setFilterParams.columnApi,context:this.setFilterParams.context}}onNewRowsLoaded(){this.isValuesTakenFromGrid()&&this.syncAfterDataChange()}isValuesTakenFromGrid(){return this.valueModel?this.valueModel.getValuesType()===2:!1}setFilterValues(t){if(!this.valueModel)throw new Error("Value model has not been created.");this.valueModel.overrideValues(t).then(()=>{this.checkAndRefreshVirtualList(),this.onUiChanged()})}resetFilterValues(){if(!this.valueModel)throw new Error("Value model has not been created.");this.valueModel.setValuesType(2),this.syncAfterDataChange()}refreshFilterValues(){if(!this.valueModel)throw new Error("Value model has not been created.");this.valueModel.isInitialised()&&this.valueModel.refreshValues().then(()=>{this.checkAndRefreshVirtualList(),this.onUiChanged()})}onAnyFilterChanged(){setTimeout(()=>{if(this.isAlive()){if(!this.valueModel)throw new Error("Value model has not been created.");this.valueModel.refreshAfterAnyFilterChanged().then(t=>{t&&(this.checkAndRefreshVirtualList(),this.showOrHideResults())})}},0)}onMiniFilterInput(){if(!this.setFilterParams)throw new Error("Set filter params have not been provided.");if(!this.valueModel)throw new Error("Value model has not been created.");if(!this.valueModel.setMiniFilter(this.eMiniFilter.getValue()))return;const{applyMiniFilterWhileTyping:t,readOnly:e}=this.setFilterParams||{};!e&&t?this.filterOnAllVisibleValues(!1):this.updateUiAfterMiniFilterChange()}updateUiAfterMiniFilterChange(){if(!this.setFilterParams)throw new Error("Set filter params have not been provided.");if(!this.valueModel)throw new Error("Value model has not been created.");const{excelMode:t,readOnly:e}=this.setFilterParams||{};t==null||e?this.checkAndRefreshVirtualList():this.valueModel.getMiniFilter()==null?this.resetUiToActiveModel(this.getModel()):(this.valueModel.selectAllMatchingMiniFilter(!0),this.checkAndRefreshVirtualList(),this.onUiChanged()),this.showOrHideResults()}showOrHideResults(){if(!this.valueModel)throw new Error("Value model has not been created.");const t=this.valueModel.getMiniFilter()!=null&&this.valueModel.getDisplayedValueCount()<1;import_core5._.setDisplayed(this.eNoMatches,t),import_core5._.setDisplayed(this.eSetFilterList,!t)}resetMiniFilter(){var t;this.eMiniFilter.setValue(null,!0),(t=this.valueModel)==null||t.setMiniFilter(null)}resetUiToActiveModel(t,e){this.setModelAndRefresh(t==null?null:t.values).then(()=>{this.onUiChanged(!1,"prevent"),e?.()})}handleCancelEnd(t){this.setMiniFilter(null),super.handleCancelEnd(t)}onMiniFilterKeyDown(t){const{excelMode:e,readOnly:s}=this.setFilterParams||{};t.key===import_core5.KeyCode.ENTER&&!e&&!s&&this.filterOnAllVisibleValues()}filterOnAllVisibleValues(t=!0){const{readOnly:e}=this.setFilterParams||{};if(!this.valueModel)throw new Error("Value model has not been created.");if(e)throw new Error("Unable to filter in readOnly mode.");this.valueModel.selectAllMatchingMiniFilter(!0),this.checkAndRefreshVirtualList(),this.onUiChanged(!1,t?"immediately":"debounce"),this.showOrHideResults()}focusRowIfAlive(t){t!=null&&window.setTimeout(()=>{if(!this.virtualList)throw new Error("Virtual list has not been created.");this.isAlive()&&this.virtualList.focusRow(t)},0)}onSelectAll(t){if(!this.valueModel)throw new Error("Value model has not been created.");if(!this.virtualList)throw new Error("Virtual list has not been created.");t?this.valueModel.selectAllMatchingMiniFilter():this.valueModel.deselectAllMatchingMiniFilter(),this.refreshAfterSelection()}onGroupItemSelected(t,e){const s=i=>{i.children?i.children.forEach(r=>s(r)):this.selectItem(i.key,e)};s(t),this.refreshAfterSelection()}onItemSelected(t,e){if(!this.valueModel)throw new Error("Value model has not been created.");if(!this.virtualList)throw new Error("Virtual list has not been created.");this.selectItem(t,e),this.refreshAfterSelection()}selectItem(t,e){e?this.valueModel.selectKey(t):this.valueModel.deselectKey(t)}onExpandAll(t,e){const s=i=>{i.filterPasses&&i.available&&i.children&&(i.children.forEach(r=>s(r)),i.expanded=e)};s(t),this.refreshAfterExpansion()}onExpandedChanged(t,e){t.expanded=e,this.refreshAfterExpansion()}refreshAfterExpansion(){const t=this.virtualList.getLastFocusedRow();this.valueModel.updateDisplayedValues("expansion"),this.checkAndRefreshVirtualList(),this.focusRowIfAlive(t)}refreshAfterSelection(){const t=this.virtualList.getLastFocusedRow();this.checkAndRefreshVirtualList(),this.onUiChanged(),this.focusRowIfAlive(t)}setMiniFilter(t){this.eMiniFilter.setValue(t),this.onMiniFilterInput()}getMiniFilter(){return this.valueModel?this.valueModel.getMiniFilter():null}checkAndRefreshVirtualList(){if(!this.virtualList)throw new Error("Virtual list has not been created.");this.virtualList.refresh(!this.hardRefreshVirtualList),this.hardRefreshVirtualList&&(this.hardRefreshVirtualList=!1)}getFilterKeys(){return this.valueModel?this.valueModel.getKeys():[]}getFilterValues(){return this.valueModel?this.valueModel.getValues():[]}getValues(){return this.getFilterKeys()}refreshVirtualList(){this.setFilterParams&&this.setFilterParams.refreshValuesOnOpen?this.refreshFilterValues():this.checkAndRefreshVirtualList()}translateForSetFilter(t){return this.localeService.getLocaleTextFunc()(t,DEFAULT_LOCALE_TEXT[t])}isSelectAllSelected(){if(!this.setFilterParams||!this.valueModel)return!1;if(this.setFilterParams.defaultToNothingSelected){if(this.valueModel.hasSelections()&&this.valueModel.isEverythingVisibleSelected())return!0;if(this.valueModel.isNothingVisibleSelected())return!1}else{if(this.valueModel.hasSelections()&&this.valueModel.isNothingVisibleSelected())return!1;if(this.valueModel.isEverythingVisibleSelected())return!0}}areAllChildrenSelected(t){const e=s=>{if(s.children){let i=!1,r=!1;return s.children.some(a=>{if(!a.filterPasses||!a.available)return!1;const n=e(a);return n===void 0?!0:(n?i=!0:r=!0,i&&r)})?void 0:i}else return this.valueModel.isKeySelected(s.key)};return this.setFilterParams.defaultToNothingSelected?this.valueModel.hasSelections()&&e(t):e(t)}destroy(){this.virtualList!=null&&(this.virtualList.destroy(),this.virtualList=null),super.destroy()}caseFormat(t){return t==null||typeof t!="string"||this.caseSensitive?t:t.toUpperCase()}resetExpansion(){var t,e;if(!((t=this.setFilterParams)!=null&&t.treeList))return;const s=(e=this.valueModel)==null?void 0:e.getSelectAllItem();if(this.isSetFilterModelTreeItem(s)){const i=r=>{r.children&&(r.children.forEach(l=>i(l)),r.expanded=!1)};i(s),this.valueModel.updateDisplayedValues("expansion")}}getModelAsString(t){return this.filterModelFormatter.getModelAsString(t,this)}getPositionableElement(){return this.eSetFilterList}};__decorateClass([(0,import_core5.RefSelector)("eMiniFilter")],SetFilter.prototype,"eMiniFilter",2),__decorateClass([(0,import_core5.RefSelector)("eFilterLoading")],SetFilter.prototype,"eFilterLoading",2),__decorateClass([(0,import_core5.RefSelector)("eSetFilterList")],SetFilter.prototype,"eSetFilterList",2),__decorateClass([(0,import_core5.RefSelector)("eFilterNoMatches")],SetFilter.prototype,"eNoMatches",2),__decorateClass([(0,import_core5.Autowired)("columnModel")],SetFilter.prototype,"columnModel",2),__decorateClass([(0,import_core5.Autowired)("valueService")],SetFilter.prototype,"valueService",2);var ModelWrapper=class{constructor(t){this.model=t}getRowCount(){return this.model.getDisplayedValueCount()}getRow(t){return this.model.getDisplayedItem(t)}areRowsEqual(t,e){return t===e}},ModelWrapperWithSelectAll=class{constructor(t,e){this.model=t,this.isSelectAllSelected=e}getRowCount(){const e=this.model.showAddCurrentSelectionToFilter()?2:1;return this.model.getDisplayedValueCount()+e}getRow(t){if(t===0)return this.model.getSelectAllItem();const e=this.model.showAddCurrentSelectionToFilter(),s=e?2:1;return t===1&&e?this.model.getAddSelectionToFilterItem():this.model.getDisplayedItem(t-s)}areRowsEqual(t,e){return t===e}},TreeModelWrapper=class{constructor(t){this.model=t}getRowCount(){return this.model.getRowCount()}getRow(t){return this.model.getRow(t)}areRowsEqual(t,e){return t==null&&e==null?!0:t!=null&&e!=null&&t.treeKey===e.treeKey&&t.depth===e.depth}},import_core6=require("@ag-grid-community/core"),SetFloatingFilterComp=class extends import_core6.Component{constructor(){super(`
            <div class="ag-floating-filter-input ag-set-floating-filter-input" role="presentation">
                <ag-input-text-field ref="eFloatingFilterText"></ag-input-text-field>
            </div>`),this.availableValuesListenerAdded=!1,this.filterModelFormatter=new SetFilterModelFormatter}destroy(){super.destroy()}init(t){this.params=t,this.eFloatingFilterText.setDisabled(!0).addGuiEventListener("click",()=>this.params.showParentFilter()),this.setParams(t)}setParams(t){const e=this.columnModel.getDisplayNameForColumn(t.column,"header",!0),s=this.localeService.getLocaleTextFunc();this.eFloatingFilterText.setInputAriaLabel(`${e} ${s("ariaFilterInput","Filter Input")}`)}onParamsUpdated(t){this.refresh(t)}refresh(t){this.params=t,this.setParams(t)}onParentModelChanged(t){this.updateFloatingFilterText(t)}parentSetFilterInstance(t){this.params.parentFilterInstance(e=>{if(!(e instanceof SetFilter))throw new Error("AG Grid - SetFloatingFilter expects SetFilter as its parent");t(e)})}addAvailableValuesListener(){this.parentSetFilterInstance(t=>{const e=t.getValueModel();e&&this.addManagedListener(e,SetValueModel.EVENT_AVAILABLE_VALUES_CHANGED,()=>this.updateFloatingFilterText())}),this.availableValuesListenerAdded=!0}updateFloatingFilterText(t){this.availableValuesListenerAdded||this.addAvailableValuesListener(),this.parentSetFilterInstance(e=>{this.eFloatingFilterText.setValue(this.filterModelFormatter.getModelAsString(t,e))})}};__decorateClass([(0,import_core6.RefSelector)("eFloatingFilterText")],SetFloatingFilterComp.prototype,"eFloatingFilterText",2),__decorateClass([(0,import_core6.Autowired)("columnModel")],SetFloatingFilterComp.prototype,"columnModel",2);var VERSION="31.3.4",SetFilterModule={version:VERSION,moduleName:import_core7.ModuleNames.SetFilterModule,beans:[],userComponents:[{componentName:"agSetColumnFilter",componentClass:SetFilter},{componentName:"agSetColumnFloatingFilter",componentClass:SetFloatingFilterComp}],dependantModules:[import_core8.EnterpriseCoreModule]};
